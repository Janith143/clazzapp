var Q=Object.defineProperty,A=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var f=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var j=(s,r,i)=>r in s?Q(s,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[r]=i,b=(s,r)=>{for(var i in r||(r={}))E.call(r,i)&&j(s,i,r[i]);if(f)for(var i of f(r))O.call(r,i)&&j(s,i,r[i]);return s},p=(s,r)=>A(s,M(r));import{r as a,j as e,y as $,l as L}from"./index-BXN-gaEy.js";import{C as P}from"./ConfirmationModal-CVK0Y9X0.js";import"./vendor-firebase-CLtQg3ae.js";const R=({quizData:s,currentUser:r,onFinishQuiz:i,onBack:y})=>{const[o,g]=a.useState(0),[m,k]=a.useState({}),[N,u]=a.useState(!1),w=a.useCallback(()=>u(!1),[]),v=a.useMemo(()=>new Date(new Date(`${s.date}T${s.startTime}`).getTime()+s.durationMinutes*6e4),[s]),[l,C]=a.useState(Math.round((v.getTime()-new Date().getTime())/1e3)),x=a.useCallback(()=>{const t={studentId:r.id,quizId:s.id,answers:Object.entries(m).map(([d,c])=>({questionId:d,selectedAnswerIds:c})),submittedAt:new Date().toISOString(),quizInstanceId:s.instanceStartDate};i(t)},[r.id,s.id,m,i,s.instanceStartDate]),S=()=>{x(),u(!1)};a.useEffect(()=>{if(l<=0){x();return}const t=setInterval(()=>{C(d=>d-1)},1e3);return()=>clearInterval(t)},[l,x]);const T=(t,d)=>{k(c=>{const h=c[t]||[];return h.includes(d)?p(b({},c),{[t]:h.filter(I=>I!==d)}):p(b({},c),{[t]:[...h,d]})})};if(s.questions.length===0)return e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{children:"This quiz has no questions yet. Please check back later."}),e.jsx("button",{onClick:y,className:"mt-4 px-4 py-2 bg-primary text-white rounded-md",children:"Go Back"})]});const n=s.questions[o];return e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8 animate-slideInUp",children:[e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"bg-light-surface dark:bg-dark-surface p-4 rounded-lg shadow-md mb-8 sticky top-20 z-10",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:s.title}),e.jsxs("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:["Question ",o+1," of ",s.questions.length]})]}),e.jsxs("div",{className:`flex items-center space-x-2 px-3 py-1.5 rounded-md text-white font-bold ${l<300?"bg-red-500 animate-pulse":"bg-primary"}`,children:[e.jsx($,{className:"w-5 h-5"}),e.jsxs("span",{children:[Math.floor(l/60),":",(l%60).toString().padStart(2,"0")]})]})]})}),e.jsx("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:n?e.jsxs("div",{children:[n.imageUrl&&e.jsx("div",{className:"mb-6 rounded-lg overflow-hidden",children:e.jsx("img",{src:L(n.imageUrl,800),alt:"Question visual aid",className:"max-h-80 w-auto mx-auto"})}),e.jsx("p",{className:"text-lg font-semibold mb-6",children:n.text}),e.jsx("div",{className:"space-y-4",children:n.answers.map(t=>e.jsxs("label",{className:"flex items-center p-4 border border-light-border dark:border-dark-border rounded-md cursor-pointer hover:border-primary transition-colors has-[:checked]:bg-primary/10 has-[:checked]:border-primary",children:[e.jsx("input",{type:"checkbox",name:`q_${n.id}`,checked:(m[n.id]||[]).includes(t.id),onChange:()=>T(n.id,t.id),className:"h-5 w-5 text-primary focus:ring-primary border-light-border dark:border-dark-border rounded"}),e.jsx("span",{className:"ml-4 text-md",children:t.text})]},t.id))})]}):e.jsx("p",{children:"Loading question..."})}),e.jsxs("div",{className:"mt-8 flex justify-between items-center",children:[e.jsx("button",{onClick:()=>g(t=>t-1),disabled:o===0,className:"px-6 py-2 text-sm font-medium border border-primary text-primary rounded-md hover:bg-primary/10 transition-colors disabled:opacity-50",children:"Previous"}),o===s.questions.length-1?e.jsx("button",{onClick:()=>u(!0),className:"px-6 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 transition-colors",children:"Finish Quiz"}):e.jsx("button",{onClick:()=>g(t=>t+1),disabled:o===s.questions.length-1,className:"px-6 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary-dark transition-colors disabled:opacity-50",children:"Next"})]})]}),e.jsx(P,{isOpen:N,onClose:w,onConfirm:S,title:"Finish Quiz",message:"Are you sure you want to finish and submit your quiz? You will not be able to change your answers.",confirmText:"Finish Quiz"})]})};export{R as default};
