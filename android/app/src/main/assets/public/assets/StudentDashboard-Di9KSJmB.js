var Ve=Object.defineProperty,Be=Object.defineProperties;var He=Object.getOwnPropertyDescriptors;var Se=Object.getOwnPropertySymbols;var We=Object.prototype.hasOwnProperty,Qe=Object.prototype.propertyIsEnumerable;var Ce=(t,d,a)=>d in t?Ve(t,d,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[d]=a,W=(t,d)=>{for(var a in d||(d={}))We.call(d,a)&&Ce(t,a,d[a]);if(Se)for(var a of Se(d))Qe.call(d,a)&&Ce(t,a,d[a]);return t},Q=(t,d)=>Be(t,He(d));var ie=(t,d,a)=>new Promise((o,r)=>{var u=m=>{try{l(a.next(m))}catch(n){r(n)}},s=m=>{try{l(a.throw(m))}catch(n){r(n)}},l=m=>m.done?o(m.value):Promise.resolve(m.value).then(u,s);l((a=a.apply(t,d)).next())});import{d as O,u as Z,r as y,j as e,g as Ye,f as Ie,b as je,F as ae,L as ze,a1 as ue,l as J,z as ee,am as ke,D as he,y as te,a9 as Ae,Y as Pe,B as pe,w as xe,E as $e,V as re,a6 as se,O as X,a7 as Ke,R as Re,M as oe,e as ge,P as Ee,an as Ge,K as Xe,G as ce,S as Ze,ao as le,Q as Je,a4 as et,ap as Ue,X as tt,N as st,H as at,a3 as rt,aq as lt,a as nt,ah as it,ab as dt,ar as ot,q as ct}from"./index-BXN-gaEy.js";import{C as xt}from"./CourseCard-uZsExVwk.js";import{C as mt}from"./ClassCard-BBTr9XzW.js";import{Q as ut}from"./QuizCard-COBKBKhv.js";import{E as ht}from"./EventCard-Smhp_CKP.js";import{E as ye,Q as pt,T as gt}from"./TimeTable-BJ2hd5rK.js";import me from"./html2canvas.esm-CiaFdv3w.js";import{P as bt}from"./PaymentMethodSelector-CJgtkeLh.js";import{M as ft,A as jt}from"./MyExamsSection-DJubUmUf.js";import{x as kt,f as yt}from"./vendor-firebase-CLtQg3ae.js";import{C as Nt}from"./ConfirmationModal-CVK0Y9X0.js";import"./StarRating-BeOC4AZb.js";import"./slug-Be7lxzw5.js";import"./ExamCard-DZTlommE.js";import"./Countdown-tuRDrQvi.js";const vt=({user:t,isOwnerView:d=!1})=>{const{sales:a,teachers:o}=O(),{handleNavigate:r}=Z(),u=y.useMemo(()=>{if(!t)return console.warn("MyCourses component rendered without a user prop."),[];const l=a.filter(n=>n.studentId===t.id&&n.itemType==="course"&&n.status==="completed"),m=[];return l.forEach(n=>{var i;const x=o.find(k=>k.id===n.teacherId);if(!x)return;const c=x.courses.find(k=>k.id===n.itemId);let h;if(c){const k=n.itemSnapshot.lectures,N=c.lectures,C=new Set(k.map(S=>S.id)),b=N.filter(S=>!C.has(S.id)),f=[...k,...b];h=Q(W({},c),{lectures:f})}else h=Q(W({},n.itemSnapshot),{isDeleted:!0});const j=((i=t.watchHistory)==null?void 0:i[h.id])||{},p=Object.keys(j).length,w=h.lectures.length,g=w>0?p/w*100:0;m.push({course:h,teacher:x,completionPercentage:g})}),Array.from(new Map(m.reverse().map(n=>[n.course.id,n])).values()).reverse()},[t,a,o]),s=d?"You haven't enrolled in any courses yet.":"This student hasn't enrolled in any courses yet.";return u.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:u.map(({course:l,teacher:m,completionPercentage:n})=>e.jsx(xt,{course:l,teacher:m,viewMode:"public",isOwnerView:!0,completionPercentage:n,onView:()=>r({name:"course_detail",courseId:l.id})},l.id))}):e.jsx("p",{className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:s})},wt=({user:t,isOwnerView:d=!1,filter:a="all"})=>{const{sales:o,teachers:r}=O(),{handleNavigate:u}=Z(),s=y.useMemo(()=>{if(!t)return console.warn("MyClasses component rendered without a user prop."),[];const n=o.filter(c=>c.studentId===t.id&&c.itemType==="class"),x=[];return n.forEach(c=>{const h=r.find(j=>j.id===c.teacherId);if(h)if(c.status==="completed"){const j=h.individualClasses.find(p=>p.id===c.itemId);j?x.push({classInfo:j,teacher:h}):x.push({classInfo:Q(W({},c.itemSnapshot),{isDeleted:!0}),teacher:h})}else c.status==="refunded"&&x.push({classInfo:Q(W({},c.itemSnapshot),{status:"canceled"}),teacher:h})}),Array.from(new Map(x.reverse().map(c=>[c.classInfo.id,c])).values()).reverse()},[t,o,r]),l=y.useMemo(()=>{let n=[...s];return a==="upcoming"&&(n=n.filter(({classInfo:x})=>{const c=Ye(x);return c==="scheduled"||c==="live"}),n.sort((x,c)=>{var p,w;const h=((p=Ie(x.classInfo))==null?void 0:p.getTime())||1/0,j=((w=Ie(c.classInfo))==null?void 0:w.getTime())||1/0;return h-j})),n},[s,a]),m=d?a==="upcoming"?"You have no upcoming classes scheduled.":"You haven't enrolled in any classes yet.":"This student has no classes matching the filter.";return e.jsxs("div",{children:[a==="upcoming"&&e.jsxs("div",{className:"mb-6 p-4 bg-primary/10 rounded-lg border border-primary/20",children:[e.jsx("h3",{className:"font-bold text-lg text-primary",children:"Showing Upcoming & Live Classes"}),e.jsx("p",{className:"text-sm text-primary/80",children:"Sorted by the next session date."})]}),l.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(({classInfo:n,teacher:x})=>e.jsx(mt,{classInfo:n,teacher:x,viewMode:"public",isOwnerView:!0,onView:()=>u({name:"class_detail",classId:n.id})},n.id))}):e.jsx("p",{className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:m})]})},St=({user:t,isOwnerView:d=!1})=>{const{sales:a,teachers:o}=O(),{handleNavigate:r}=Z(),{currentUser:u}=je(),s=y.useMemo(()=>{if(!t)return console.warn("MyQuizzes component rendered without a user prop."),[];const m=a.filter(x=>x.studentId===t.id&&x.itemType==="quiz"&&x.status==="completed"),n=[];return m.forEach(x=>{const c=o.find(p=>p.id===x.teacherId);if(!c)return;const h=c.quizzes.find(p=>p.id===x.itemId),j=x.itemSnapshot;h||(j.isDeleted=!0),n.push({quiz:j,teacher:c})}),Array.from(new Map(n.reverse().map(x=>[`${x.quiz.id}-${x.quiz.instanceStartDate}`,x])).values()).reverse()},[t,a,o]),l=d?"You haven't enrolled in any quizzes yet.":"This student hasn't enrolled in any quizzes yet.";return s.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(({quiz:m,teacher:n})=>e.jsx(ut,{quiz:m,teacher:n,viewMode:"public",isOwnerView:!0,currentUser:u,onView:x=>r({name:"quiz_detail",quizId:x.id,instanceId:x.instanceStartDate})},`${m.id}-${m.instanceStartDate||""}`))}):e.jsx("p",{className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:l})},Ct=({user:t})=>{const{sales:d,tuitionInstitutes:a,teachers:o}=O(),{handleNavigate:r}=Z(),u=y.useMemo(()=>t?d.filter(l=>l.studentId===t.id&&l.itemType==="event"&&l.status==="completed").map(l=>{let m=a.find(n=>n.id===l.instituteId);if(!m&&l.teacherId&&(m=o.find(n=>n.id===l.teacherId)),!m){const n=l.itemSnapshot;n&&n.organizerId&&(m=a.find(x=>x.id===n.organizerId)||o.find(x=>x.id===n.organizerId))}return{event:l.itemSnapshot,organizer:m}}).filter(l=>l.organizer):[],[t,d,a,o]);return u.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:u.map(({event:s,organizer:l})=>e.jsx(ht,{event:s,organizer:l,onView:m=>r({name:"event_detail",eventId:m.id})},s.id))}):e.jsx("p",{className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:"This student hasn't registered for any events yet."})},It=({isOpen:t,onClose:d,saleData:a})=>{const o=y.useRef(null),r=()=>{const l=o.current;l&&a&&me(l,{scale:2}).then(m=>{const n=m.toDataURL("image/png"),x=new ye("p","mm","a4"),c=x.internal.pageSize.getWidth(),h=m.height*c/m.width;x.addImage(n,"PNG",0,0,c,h),x.save(`invoice-${a.id}.pdf`)})};if(!t||!a)return null;const u=new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR"}),s=a.totalAmount+a.amountPaidFromBalance;return e.jsx(ae,{isOpen:t,onClose:d,title:`Invoice #${a.id}`,children:e.jsxs("div",{children:[e.jsxs("div",{ref:o,className:"p-6 space-y-6 text-sm bg-light-surface dark:bg-dark-surface text-light-text dark:text-dark-text",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ze,{className:"h-8 w-8"}),e.jsxs("span",{className:"text-xl font-bold",children:["clazz.",e.jsx("span",{className:"text-primary",children:"lk"})]})]}),e.jsx("p",{className:"text-light-subtle dark:text-dark-subtle",children:"Your learning partner."})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-lg",children:"INVOICE"}),e.jsxs("p",{children:["Date: ",new Date(a.saleDate).toLocaleDateString()]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Billed To:"}),e.jsxs("p",{children:["Student ID: ",a.studentId]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-light-background dark:bg-dark-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-4 py-2 text-right font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Amount"})]})}),e.jsx("tbody",{className:"text-light-text dark:text-dark-text",children:e.jsxs("tr",{className:"border-b border-light-border dark:border-dark-border",children:[e.jsxs("td",{className:"px-4 py-2",children:[e.jsx("p",{className:"font-semibold",children:a.itemName}),e.jsxs("p",{className:"text-xs text-light-subtle dark:text-dark-subtle capitalize",children:[a.itemType," Purchase"]})]}),e.jsx("td",{className:"px-4 py-2 text-right",children:u.format(s)})]})})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"w-full max-w-xs space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-light-text dark:text-dark-text",children:[e.jsx("span",{className:"text-light-subtle dark:text-dark-subtle",children:"Subtotal"}),e.jsx("span",{children:u.format(s)})]}),a.amountPaidFromBalance>0&&e.jsxs("div",{className:"flex justify-between text-green-600 dark:text-green-400",children:[e.jsx("span",{children:"Paid from Account Balance"}),e.jsxs("span",{children:["- ",u.format(a.amountPaidFromBalance)]})]}),a.totalAmount>0&&e.jsxs("div",{className:"flex justify-between text-light-text dark:text-dark-text",children:[e.jsx("span",{className:"text-light-subtle dark:text-dark-subtle",children:"Paid via Gateway"}),e.jsx("span",{children:u.format(a.totalAmount)})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg pt-2 border-t border-light-border dark:border-dark-border text-light-text dark:text-dark-text",children:[e.jsx("span",{children:"Total Paid"}),e.jsx("span",{children:u.format(s)})]})]})}),e.jsx("p",{className:"text-center text-xs text-light-subtle dark:text-dark-subtle pt-4",children:"Thank you for your purchase! If you have any questions, please contact support."})]}),e.jsx("div",{className:"p-4 bg-light-background dark:bg-dark-background border-t border-light-border dark:border-dark-border flex justify-end",children:e.jsxs("button",{onClick:r,className:"flex items-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary-dark transition-colors",children:[e.jsx(ue,{className:"w-4 h-4"}),e.jsx("span",{children:"Download PDF"})]})})]})})},R=({icon:t,label:d,value:a})=>e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 w-5 h-5 text-light-subtle dark:text-dark-subtle mt-1",children:t}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-light-subtle dark:text-dark-subtle",children:d}),e.jsx("div",{className:"text-md font-semibold text-light-text dark:text-dark-text",children:a||"-"})]})]}),Dt=(t,d)=>{const a=new Date(t.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});return e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-light-text dark:text-dark-text",children:t.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-light-border dark:border-dark-border",children:[e.jsx(R,{icon:e.jsx(ee,{}),label:"Fee",value:d.format(t.fee)}),e.jsx(R,{icon:e.jsx(ke,{}),label:"Target Audience",value:t.targetAudience}),e.jsx(R,{icon:e.jsx(he,{}),label:t.recurrence==="weekly"?`Weekly on ${new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{weekday:"long"})}s`:"Date",value:t.recurrence!=="weekly"?a:`Starts ${a}`}),e.jsx(R,{icon:e.jsx(te,{}),label:"Time",value:`${t.startTime} - ${t.endTime}`}),e.jsx(R,{icon:e.jsx(Ae,{}),label:"Mode",value:t.mode}),(t.mode==="Physical"||t.mode==="Both")&&e.jsx(R,{icon:e.jsx(Pe,{}),label:"Location",value:[t.institute,t.town,t.district].filter(Boolean).join(", ")})]})]})},Tt=(t,d)=>{const a=t.lectures.reduce((o,r)=>o+r.durationMinutes,0)/60;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-light-text dark:text-dark-text",children:t.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4 border-t border-light-border dark:border-dark-border",children:[e.jsx(R,{icon:e.jsx(ee,{}),label:"Fee",value:d.format(t.fee)}),e.jsx(R,{icon:e.jsx(pe,{}),label:"Lectures",value:t.lectures.length}),e.jsx(R,{icon:e.jsx(te,{}),label:"Total Duration",value:`${a.toFixed(1)} hours`})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mt-4 mb-2 text-light-text dark:text-dark-text",children:"Lectures"}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:t.lectures.map((o,r)=>e.jsxs("div",{className:"flex items-start p-2 bg-light-background dark:bg-dark-background rounded-md",children:[e.jsx("span",{className:"font-bold text-sm text-light-subtle dark:text-dark-subtle mr-3 mt-0.5",children:r+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-light-text dark:text-dark-text",children:o.title}),e.jsxs("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:[o.durationMinutes," mins"]})]})]},o.id))})]})]})},Mt=(t,d)=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-light-text dark:text-dark-text",children:t.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-light-border dark:border-dark-border",children:[e.jsx(R,{icon:e.jsx(ee,{}),label:"Fee",value:d.format(t.fee)}),e.jsx(R,{icon:e.jsx(xe,{}),label:"Questions",value:`${t.questions.length} questions`}),e.jsx(R,{icon:e.jsx(he,{}),label:"Date",value:new Date(t.date).toLocaleDateString()}),e.jsx(R,{icon:e.jsx(te,{}),label:"Time",value:`${t.startTime} (${t.durationMinutes} mins)`})]})]}),zt=(t,d)=>{const a=new Date(t.startDate).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"});return e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-light-text dark:text-dark-text",children:t.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-light-border dark:border-dark-border",children:[e.jsx(R,{icon:e.jsx(ee,{}),label:"Price",value:d.format(t.tickets.price)}),e.jsx(R,{icon:e.jsx(ke,{}),label:"Category",value:t.category}),e.jsx(R,{icon:e.jsx(he,{}),label:"Date",value:`${a}`}),e.jsx(R,{icon:e.jsx(te,{}),label:"Time",value:`${t.startTime} - ${t.endTime}`}),e.jsx(R,{icon:e.jsx(Ae,{}),label:"Mode",value:t.mode}),(t.mode==="Physical"||t.mode==="Hybrid")&&e.jsx(R,{icon:e.jsx(Pe,{}),label:"Venue",value:t.venue})]})]})},At=({isOpen:t,onClose:d,item:a,teacher:o})=>{const r=new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR"});let u=null,s=null,l="";return"organizerId"in a?(u=zt(a,r),s=e.jsx($e,{className:"w-6 h-6"}),l="Event Details"):"lectures"in a?(u=Tt(a,r),s=e.jsx(pe,{className:"w-6 h-6"}),l="Course Details"):"questions"in a?(u=Mt(a,r),s=e.jsx(xe,{className:"w-6 h-6"}),l="Quiz Details"):(u=Dt(a,r),s=e.jsx(re,{className:"w-6 h-6"}),l="Class Details"),e.jsx(ae,{isOpen:t,onClose:d,title:"Purchased Item Details",size:"3xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"p-4 bg-light-background dark:bg-dark-background rounded-lg border border-light-border dark:border-dark-border",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"flex items-center px-3 py-1 text-sm font-semibold rounded-full bg-primary/10 text-primary-dark dark:text-primary-light uppercase tracking-wider",children:[s,e.jsx("span",{className:"ml-2",children:l})]}),e.jsx("h2",{className:"mt-2 text-2xl font-bold text-light-text dark:text-dark-text",children:a.title})]}),e.jsxs("div",{className:"text-right flex-shrink-0 ml-4",children:[e.jsx("img",{src:J(o.avatar,48,48),alt:o.name,className:"w-12 h-12 rounded-full ml-auto shadow-md"}),e.jsx("p",{className:"text-sm font-semibold mt-1 text-light-text dark:text-dark-text",children:o.name}),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:"Purchased Version"})]})]})}),u]})})},Pt=({status:t})=>{const a={completed:{icon:e.jsx(X,{className:"w-4 h-4 mr-1.5"}),text:"Completed",classes:"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300"},refunded:{icon:e.jsx(se,{className:"w-4 h-4 mr-1.5"}),text:"Refunded",classes:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"},hold:{icon:e.jsx(Ke,{className:"w-4 h-4 mr-1.5"}),text:"On Hold",classes:"bg-yellow-100 text-yellow-800 dark:bg-yellow-800/50 dark:text-yellow-300"},failed:{icon:e.jsx(se,{className:"w-4 h-4 mr-1.5"}),text:"Failed",classes:"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300"},cleared:{icon:e.jsx(X,{className:"w-4 h-4 mr-1.5"}),text:"Cleared",classes:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"},canceled:{icon:e.jsx(se,{className:"w-4 h-4 mr-1.5"}),text:"Canceled",classes:"bg-orange-100 text-orange-800 dark:bg-orange-900/50 dark:text-orange-300"}}[t];if(!a)return null;const{icon:o,text:r,classes:u}=a;return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${u}`,children:[o,r]})},$t=({status:t})=>{const d={approved:{icon:e.jsx(X,{className:"w-4 h-4 mr-1.5"}),text:"Approved",classes:"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300"},pending:{icon:e.jsx(te,{className:"w-4 h-4 mr-1.5"}),text:"Pending",classes:"bg-yellow-100 text-yellow-800 dark:bg-yellow-800/50 dark:text-yellow-300"},rejected:{icon:e.jsx(se,{className:"w-4 h-4 mr-1.5"}),text:"Rejected",classes:"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300"}},{icon:a,text:o,classes:r}=d[t];return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${r}`,children:[a,o]})},Rt=({user:t})=>{const{sales:d,teachers:a,users:o,tuitionInstitutes:r,topUpRequests:u}=O(),[s,l]=y.useState(null),[m,n]=y.useState(null),x=y.useCallback(()=>l(null),[]),c=y.useCallback(()=>n(null),[]),h=(g,i)=>{n({item:g,person:i})},j=y.useMemo(()=>t?d.filter(g=>g.studentId===t.id).sort((g,i)=>new Date(i.saleDate).getTime()-new Date(g.saleDate).getTime()):[],[d,t]),p=y.useMemo(()=>{if(!t)return[];const g=u.filter(N=>N.studentId===t.id&&N.status==="pending"),i=t.topUpHistory||[];return[...g,...i].sort((N,C)=>new Date(C.requestedAt).getTime()-new Date(N.requestedAt).getTime())},[t,u]),w=new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR"});return t?e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-4 rounded-lg shadow-md overflow-x-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 px-2",children:"Purchase History"}),j.length>0?e.jsxs("table",{className:"min-w-full divide-y divide-light-border dark:divide-dark-border text-sm",children:[e.jsx("thead",{className:"bg-light-background dark:bg-dark-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Item"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Total Amount"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-light-border dark:divide-dark-border",children:j.map(g=>{let i=null,k=!0;if(g.itemType==="event"){const C=r.find(b=>b.id===g.instituteId);if(C){const b=o.find(f=>f.id===C.userId);b&&(i={name:C.name,avatar:b.avatar},k=!1)}}else{const C=a.find(b=>b.id===g.teacherId);C&&(i=C,k=!1)}const N=g.itemSnapshot&&["course","class","quiz","event"].includes(g.itemType);return e.jsxs("tr",{className:"text-light-text dark:text-dark-text",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:new Date(g.saleDate).toLocaleDateString()}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("button",{onClick:()=>i&&N&&h(g.itemSnapshot,i),disabled:k||!N,className:"font-medium text-primary hover:underline text-left disabled:no-underline disabled:text-light-subtle disabled:cursor-default",title:k?"Original creator is no longer available":"View purchased item details",children:g.itemName}),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle capitalize",children:g.itemType.replace("_"," ")})]}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-right",children:[e.jsx("p",{className:"font-semibold",children:w.format(g.totalAmount+g.amountPaidFromBalance)}),g.paymentMethod==="manual_at_venue"?e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:"Paid at Venue"}):g.amountPaidFromBalance>0?e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400",children:["From Balance: ",w.format(g.amountPaidFromBalance)]}),g.totalAmount>0&&e.jsxs("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:["From Gateway: ",w.format(g.totalAmount)]})]}):null]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx(Pt,{status:g.status})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:g.status==="completed"?e.jsx("button",{onClick:()=>l(g),className:"text-primary hover:underline",children:"View Invoice"}):e.jsx("span",{className:"text-light-subtle dark:text-dark-subtle",children:"-"})})]},g.id)})})]}):e.jsx("p",{className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:"This student has no purchase history."})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-4 rounded-lg shadow-md overflow-x-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 px-2",children:"Top-Up History"}),p.length>0?e.jsxs("table",{className:"min-w-full divide-y divide-light-border dark:divide-dark-border text-sm",children:[e.jsx("thead",{className:"bg-light-background dark:bg-dark-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Method"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-light-border dark:divide-dark-border",children:p.map(g=>e.jsxs("tr",{className:"text-light-text dark:text-dark-text",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:new Date(g.requestedAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap capitalize",children:g.method}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right font-semibold",children:w.format(g.amount)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx($t,{status:g.status})})]},g.id))})]}):e.jsx("p",{className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:"This student has no top-up history."})]}),e.jsx(It,{isOpen:!!s,onClose:x,saleData:s}),m&&e.jsx(At,{isOpen:!!m,onClose:c,item:m.item,teacher:m.person})]}):null},Et=Re.forwardRef(({user:t,tagline:d},a)=>{var o,r;return e.jsxs("div",{ref:a,className:"bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-slate-800 dark:to-slate-900 rounded-xl shadow-lg p-6 max-w-md mx-auto border border-light-border dark:border-dark-border",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ze,{className:"h-8 w-8 text-primary"}),e.jsxs("span",{className:"text-xl font-bold text-light-text dark:text-dark-text",children:["clazz.",e.jsx("span",{className:"text-primary",children:"lk"})]})]}),e.jsx("div",{className:"px-3 py-1 bg-primary text-white text-xs font-bold rounded-full",children:"STUDENT ID"})]}),e.jsxs("div",{className:"mt-6 flex items-center space-x-4",children:[t.avatar?e.jsx("img",{src:J(t.avatar,80,80),alt:"Profile",className:"w-20 h-20 rounded-full object-cover border-2 border-white dark:border-dark-surface",crossOrigin:"anonymous"}):e.jsx("div",{className:"w-20 h-20 rounded-full bg-primary flex items-center justify-center text-white font-bold text-3xl border-2 border-white dark:border-dark-surface",children:e.jsxs("span",{children:[(o=t.firstName)==null?void 0:o.charAt(0),(r=t.lastName)==null?void 0:r.charAt(0)]})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold text-light-text dark:text-dark-text",children:[t.firstName," ",t.lastName]}),e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle font-mono",children:t.id})]})]}),e.jsx("div",{className:"mt-4 flex justify-center h-32 w-32 mx-auto p-1 bg-white rounded-md shadow-sm",children:e.jsx(pt,{data:t.id,logoSrc:"/Logo3.png",size:128,crossOrigin:"anonymous",className:"w-full h-full object-contain"})}),e.jsx("div",{className:"mt-4 pt-4 border-t border-primary/20 text-center",children:e.jsxs("p",{className:"text-sm italic text-light-subtle dark:text-dark-subtle",children:['"',d,'"']})})]})}),De=Re.forwardRef(({children:t},d)=>e.jsx("div",{ref:d,className:"a4-page bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-200 shadow-lg my-4 mx-auto overflow-hidden print:shadow-none print:my-0 print:mx-0",children:t})),Ut=()=>{var x,c,h,j,p,w,g;const{currentUser:t}=je(),{sales:d,teachers:a,submissions:o}=O(),r=y.useRef(null),u=y.useRef(null),s=t,l=y.useMemo(()=>{if(!s)return null;const i=d.filter(N=>N.studentId===s.id&&N.itemType==="course"&&N.status==="completed").map(N=>{const C=a.find(b=>b.id===N.teacherId);return`${N.itemName} (by ${(C==null?void 0:C.name)||"..."})`}),k=o.filter(N=>N.studentId===s.id).map(N=>{const C=d.find(S=>{var z;return S.itemId===N.quizId&&S.itemType==="quiz"&&((z=S.itemSnapshot)==null?void 0:z.instanceStartDate)===N.quizInstanceId});if(!C)return null;const b=C.itemSnapshot,f=`${N.score}/${b.questions.length}`;return`${b.title} - Score: ${f}`}).filter(Boolean);return{enrolledCourses:i,quizResults:k}},[s,d,a,o]);if(!s)return e.jsx("p",{children:"Loading user data..."});const m=()=>ie(void 0,null,function*(){var v,D,A,_,P;const i=r.current,k=u.current;if(!i)return;const N=new ye("p","mm","a4"),C=N.internal.pageSize.getWidth(),b=yield me(i,{scale:3,useCORS:!0,backgroundColor:null}),f=b.toDataURL("image/png"),S=b.height*C/b.width;N.addImage(f,"PNG",0,0,C,S);const z=((v=s.projects)==null?void 0:v.length)||((D=s.achievements)==null?void 0:D.length)||(l==null?void 0:l.enrolledCourses.length)||(l==null?void 0:l.quizResults.length)||((A=s.hobbies)==null?void 0:A.length)||((_=s.certifications)==null?void 0:_.length)||((P=s.references)==null?void 0:P.length);if(k&&z){const V=yield me(k,{scale:3,useCORS:!0,backgroundColor:null});N.addPage();const B=V.toDataURL("image/png"),H=V.height*C/V.width;N.addImage(B,"PNG",0,0,C,H)}N.save(`CV_${s.firstName}_${s.lastName}.pdf`)}),n=((x=s.projects)==null?void 0:x.length)||((c=s.achievements)==null?void 0:c.length)||(l==null?void 0:l.enrolledCourses)&&l.enrolledCourses.length>0||(l==null?void 0:l.quizResults)&&l.quizResults.length>0||((h=s.hobbies)==null?void 0:h.length)||((j=s.certifications)==null?void 0:j.length)||((p=s.references)==null?void 0:p.length);return e.jsxs("div",{className:"bg-light-background dark:bg-dark-background p-4 rounded-lg",children:[e.jsx("style",{children:`
                .a4-page {
                    width: 210mm;
                    min-height: 297mm;
                    display: grid;
                    grid-template-columns: 1fr 2fr;
                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                }
                .cv-left-column { background: #23395d; color: white; padding: 30px; }
                .cv-right-column { padding: 40px; }
                .cv-left-column h3, .cv-right-column h3 { color: #a8c0ff; border-bottom: 2px solid #a8c0ff; display: inline-block; padding-bottom: 5px; font-size: 1.1em; font-weight: bold; margin-bottom: 0.75rem;}
                .cv-right-column h3 { color: #23395d; }
                .dark .cv-right-column h3 { color: #a8c0ff; }
             `}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsxs("button",{onClick:m,className:"flex items-center space-x-2 px-6 py-2 border border-primary text-primary rounded-md font-semibold hover:bg-primary/10 transition-colors",children:[e.jsx(ue,{className:"w-5 h-5"}),e.jsx("span",{children:"Download CV as PDF"})]})}),e.jsxs(De,{ref:r,children:[e.jsxs("div",{className:"cv-left-column",children:[s.avatar&&e.jsx("img",{src:J(s.avatar,300,300),alt:"Profile",className:"w-[150px] h-[150px] object-cover rounded-full mx-auto mb-6 border-4 border-white/50",crossOrigin:"anonymous"}),e.jsxs("h2",{className:"text-2xl font-bold",children:[s.firstName," ",s.lastName]}),e.jsx("p",{className:"text-blue-200",children:s.targetAudience}),e.jsxs("div",{className:"mt-8 text-left text-sm space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Contact"}),s.contactNumber&&e.jsxs("p",{className:"mt-2",children:["ðŸ“ž ",s.contactNumber]}),s.email&&e.jsxs("p",{children:["âœ‰ï¸ ",s.email]}),((w=s.address)==null?void 0:w.city)&&e.jsxs("p",{children:["ðŸŒ ",s.address.city,", ",s.address.country]})]}),s.technicalSkills&&s.technicalSkills.length>0&&e.jsxs("div",{children:[e.jsx("h3",{children:"Technical Skills"}),s.technicalSkills.map(i=>e.jsx("p",{className:"mt-2 text-blue-100",children:i},i))]}),s.softSkills&&s.softSkills.length>0&&e.jsxs("div",{children:[e.jsx("h3",{children:"Soft Skills"}),s.softSkills.map(i=>e.jsx("p",{className:"mt-2 text-blue-100",children:i},i))]}),s.languages&&s.languages.length>0&&e.jsxs("div",{children:[e.jsx("h3",{children:"Languages"}),s.languages.map(i=>e.jsx("p",{className:"mt-2 text-blue-100",children:i},i))]}),s.hobbies&&s.hobbies.length>0&&e.jsxs("div",{children:[e.jsx("h3",{children:"Hobbies & Interests"}),e.jsx("ul",{className:"mt-2 space-y-1 list-disc list-inside text-blue-100",children:s.hobbies.map(i=>e.jsx("li",{children:i},i))})]}),s.references&&s.references.length>0&&e.jsxs("div",{children:[e.jsx("h3",{children:"References"}),e.jsx("div",{className:"mt-2 space-y-3",children:s.references.map(i=>e.jsxs("div",{className:"text-xs",children:[e.jsx("p",{className:"font-bold",children:i.name}),e.jsx("p",{children:i.title}),e.jsx("p",{children:i.organization}),i.email&&e.jsx("p",{children:i.email}),i.phone&&e.jsx("p",{children:i.phone})]},i.id))})]})]})]}),e.jsxs("div",{className:"cv-right-column",children:[s.profileSummary&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{children:"Profile Summary"}),e.jsx(oe,{content:s.profileSummary||"",className:"mt-3 text-sm leading-relaxed prose-sm prose-p:my-0"})]}),s.experience&&s.experience.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{children:"Work Experience"}),e.jsx("div",{className:"mt-3 space-y-4",children:s.experience.map(i=>e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-md",children:[i.role," at ",i.organization]}),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:i.period}),e.jsx(oe,{content:i.description||"",className:"mt-1 text-sm leading-relaxed prose-sm prose-p:my-0"})]},i.id))})]}),s.education&&s.education.length>0&&e.jsxs("div",{children:[e.jsx("h3",{children:"Education"}),e.jsx("div",{className:"mt-3 space-y-4",children:s.education.map(i=>e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-md",children:i.qualification}),e.jsx("p",{className:"text-sm",children:i.institution}),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:i.period})]},i.id))})]})]})]}),n&&e.jsxs(De,{ref:u,children:[e.jsx("div",{className:"cv-left-column",children:e.jsxs("div",{className:"mt-8 text-left text-sm space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Contact"}),s.contactNumber&&e.jsxs("p",{className:"mt-2",children:["ðŸ“ž ",s.contactNumber]}),s.email&&e.jsxs("p",{children:["âœ‰ï¸ ",s.email]}),((g=s.address)==null?void 0:g.city)&&e.jsxs("p",{children:["ðŸŒ ",s.address.city,", ",s.address.country]})]}),s.technicalSkills&&s.technicalSkills.length>0&&e.jsxs("div",{children:[e.jsx("h3",{children:"Technical Skills"}),s.technicalSkills.map(i=>e.jsx("p",{className:"mt-2 text-blue-100",children:i},i))]}),s.softSkills&&s.softSkills.length>0&&e.jsxs("div",{children:[e.jsx("h3",{children:"Soft Skills"}),s.softSkills.map(i=>e.jsx("p",{className:"mt-2 text-blue-100",children:i},i))]}),s.languages&&s.languages.length>0&&e.jsxs("div",{children:[e.jsx("h3",{children:"Languages"}),s.languages.map(i=>e.jsx("p",{className:"mt-2 text-blue-100",children:i},i))]}),s.hobbies&&s.hobbies.length>0&&e.jsxs("div",{children:[e.jsx("h3",{children:"Hobbies & Interests"}),e.jsx("ul",{className:"mt-2 space-y-1 list-disc list-inside text-blue-100",children:s.hobbies.map(i=>e.jsx("li",{children:i},i))})]}),s.references&&s.references.length>0&&e.jsxs("div",{children:[e.jsx("h3",{children:"References"}),e.jsx("div",{className:"mt-2 space-y-3",children:s.references.map(i=>e.jsxs("div",{className:"text-xs",children:[e.jsx("p",{className:"font-bold",children:i.name}),e.jsx("p",{children:i.title}),e.jsx("p",{children:i.organization}),i.email&&e.jsx("p",{children:i.email}),i.phone&&e.jsx("p",{children:i.phone})]},i.id))})]})]})}),e.jsxs("div",{className:"cv-right-column",children:[s.projects&&s.projects.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{children:"Projects"}),e.jsx("div",{className:"mt-3 space-y-4",children:s.projects.map(i=>e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-md",children:i.name}),e.jsx(oe,{content:i.description||"",className:"text-sm leading-relaxed prose-sm prose-p:my-0"})]},i.id))})]}),s.certifications&&s.certifications.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{children:"Certifications & Trainings"}),e.jsx("ul",{className:"mt-3 space-y-2 list-disc list-inside text-sm",children:s.certifications.map(i=>e.jsx("li",{children:i},i))})]}),s.achievements&&s.achievements.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{children:"Awards & Achievements"}),e.jsx("ul",{className:"mt-3 space-y-2 list-disc list-inside text-sm",children:s.achievements.map(i=>e.jsx("li",{children:i},i))})]}),l&&l.enrolledCourses.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{children:"Completed Courses on Clazz.lk"}),e.jsx("ul",{className:"mt-3 space-y-2 list-disc list-inside text-sm",children:l.enrolledCourses.map(i=>e.jsx("li",{children:i},i))})]}),l&&l.quizResults.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{children:"Quiz Results on Clazz.lk"}),e.jsx("ul",{className:"mt-3 space-y-2 list-disc list-inside text-sm",children:l.quizResults.map(i=>e.jsx("li",{children:i},i))})]})]})]})]})},q=({label:t,value:d})=>e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:t}),e.jsx("p",{className:"text-md font-medium text-light-text dark:text-dark-text",children:d||"-"})]}),Lt=({user:t,isAdminView:d=!1})=>{var h,j,p,w,g;const{setModalState:a,openImageUploadModal:o}=ge(),{handleUpdateUser:r}=O(),{studentCardTaglines:u}=Z(),[s,l]=y.useState("Your journey to academic excellence starts here."),m=y.useRef(null);y.useEffect(()=>{var C;if(!t||!u||u.length===0)return;const i=2*24*60*60*1e3,k=new Date,N=(C=t.studentCardState)!=null&&C.lastUpdated?new Date(t.studentCardState.lastUpdated):null;if(!N||k.getTime()-N.getTime()>i){const b=u[Math.floor(Math.random()*u.length)];l(b);const f={tagline:b,lastUpdated:k.toISOString()};r({id:t.id,studentCardState:f})}else l(t.studentCardState.tagline)},[t,u,r]);const n=()=>{const i=m.current;!i||!t||me(i,{useCORS:!0,backgroundColor:null,scale:3}).then(k=>{const N=k.toDataURL("image/png"),C=k.width/k.height,b=85.6,f=b/C,S=new ye({orientation:b>f?"landscape":"portrait",unit:"mm",format:[b,f]});S.addImage(N,"PNG",0,0,b,f),S.save(`clazz_lk_student_card_${t.id}.pdf`)})},x=()=>{d||a({name:"edit_student_profile"})};if(!t)return null;const c=t.address?[t.address.line1,t.address.line2,t.address.city,t.address.state,t.address.postalCode,t.address.country].filter(Boolean).join(", "):null;return e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 sm:mb-0",children:"Profile Information"}),!d&&e.jsxs("button",{onClick:x,className:"flex items-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary-dark transition-colors self-start sm:self-center",children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsx("span",{children:"Edit Details"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 items-start",children:[e.jsx("div",{className:"lg:col-span-1 flex flex-col items-center",children:e.jsxs("div",{className:"relative w-32 h-32 group",children:[t.avatar?e.jsx("img",{src:J(t.avatar,200,200),alt:`${t.firstName} ${t.lastName}`,className:"w-full h-full rounded-full object-cover shadow-lg",crossOrigin:"anonymous"}):e.jsx("div",{className:"w-full h-full rounded-full bg-primary flex items-center justify-center text-white font-bold text-5xl shadow-lg",children:e.jsxs("span",{children:[((h=t.firstName)==null?void 0:h.charAt(0))||"",((j=t.lastName)==null?void 0:j.charAt(0))||""]})}),!d&&e.jsx("button",{onClick:()=>o("student_profile"),className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center text-white opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"Change profile picture",children:e.jsx(Ge,{className:"w-8 h-8"})})]})}),e.jsxs("div",{className:"lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-6",children:[e.jsx(q,{label:"First Name",value:t.firstName}),e.jsx(q,{label:"Last Name",value:t.lastName}),e.jsx(q,{label:"Gender",value:t.gender}),e.jsx(q,{label:"Date of Birth",value:t.dateOfBirth?new Date(t.dateOfBirth).toLocaleDateString("en-CA"):null}),e.jsx(q,{label:"Preferred Language",value:t.preferredLanguage}),e.jsx(q,{label:"Student ID",value:t.id}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(q,{label:"Student Category",value:t.targetAudience})}),e.jsx(q,{label:"Email Address",value:t.email}),e.jsx(q,{label:"Contact Number",value:t.contactNumber}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(q,{label:"Address",value:c})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(q,{label:"Schools",value:(p=t.schools)==null?void 0:p.join(", ")})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(q,{label:"Learning Institutes",value:(w=t.learningInstitutes)==null?void 0:w.join(", ")})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(q,{label:"Achievements",value:(g=t.achievements)==null?void 0:g.join(", ")})}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:"Career Aspirations"}),e.jsx("div",{className:"text-md font-medium text-light-text dark:text-dark-text",children:e.jsx(oe,{content:t.careerAspirations||"-",className:"prose-sm prose-p:my-0"})})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("h3",{className:"text-md font-medium text-light-text dark:text-dark-text border-b border-light-border dark:border-dark-border pb-2 mb-3",children:"My Personal Exams"}),t.customExams&&t.customExams.length>0?e.jsx("ul",{className:"space-y-2 list-disc list-inside text-sm",children:t.customExams.map(i=>e.jsxs("li",{className:"text-light-text dark:text-dark-text",children:[e.jsx("strong",{children:i.name})," on ",new Date(i.date).toLocaleDateString()]},i.id))}):d?e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle italic",children:"No personal exams added."}):e.jsxs("button",{onClick:()=>a({name:"edit_student_profile",initialStep:3}),className:"flex items-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary-dark transition-colors",children:[e.jsx(Xe,{className:"w-4 h-4"}),e.jsx("span",{children:"Add Exam Countdown"})]})]})]})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-light-border dark:border-dark-border",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-center",children:"Student ID Card"}),e.jsx(Et,{ref:m,user:t,tagline:s}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsxs("button",{onClick:n,className:"flex items-center space-x-2 px-6 py-2 border border-primary text-primary rounded-md font-semibold hover:bg-primary/10 transition-colors",children:[e.jsx(ue,{className:"w-5 h-5"}),e.jsx("span",{children:"Download Card (PDF)"})]})})]}),e.jsxs("div",{className:"mt-12 pt-6 border-t border-light-border dark:border-dark-border",children:[e.jsx("h3",{className:"text-2xl font-bold mb-4 text-center",children:"Curriculum Vitae (CV)"}),e.jsx(Ut,{})]})]})},Ot=({status:t})=>{switch(t){case"paid":return e.jsx("span",{title:"Paid via Platform",children:e.jsx(X,{className:"w-5 h-5 text-green-500"})});case"paid_at_venue":return e.jsx("span",{title:"Paid at Venue",children:e.jsx(ee,{className:"w-5 h-5 text-blue-500"})});case"unpaid":return e.jsx("span",{title:"Unpaid",children:e.jsx(se,{className:"w-5 h-5 text-red-500"})});default:return null}},Ft=({user:t})=>{const{teachers:d}=O(),a=y.useMemo(()=>{if(!t)return[];const o=[];return d.forEach(r=>{r.individualClasses.forEach(u=>{u.attendance&&u.attendance.forEach(s=>{s.studentId===t.id&&o.push(Q(W({},s),{classTitle:u.title,classSubject:u.subject}))})})}),o.sort((r,u)=>new Date(u.attendedAt).getTime()-new Date(r.attendedAt).getTime())},[t,d]);return e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-4 rounded-lg shadow-md overflow-x-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 px-2",children:"My Attendance Log"}),a.length>0?e.jsxs("table",{className:"min-w-full divide-y divide-light-border dark:divide-dark-border text-sm",children:[e.jsx("thead",{className:"bg-light-background dark:bg-dark-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Class"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Time"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Payment Status"})]})}),e.jsx("tbody",{className:"divide-y divide-light-border dark:divide-dark-border",children:a.map((o,r)=>e.jsxs("tr",{className:"text-light-text dark:text-dark-text",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:"font-medium",children:o.classTitle}),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:o.classSubject})]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:new Date(o.attendedAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:new Date(o.attendedAt).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx(Ot,{status:o.paymentStatus})})]},`${o.studentId}-${o.attendedAt}-${r}`))})]}):e.jsx("p",{className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:"This student has no attendance records yet."})]})},qt=({isOpen:t,onClose:d})=>{const{handleTopUpWithGateway:a,handleTopUpWithSlip:o,handleRedeemVoucher:r}=O(),[u,s]=y.useState("gateway"),[l,m]=y.useState(""),[n,x]=y.useState(null),[c,h]=y.useState(""),[j,p]=y.useState(""),[w,g]=y.useState(!1),[i,k]=y.useState(!1),N=v=>{v.preventDefault();const D=parseFloat(l);if(isNaN(D)||D<=0){p("Please enter a valid amount.");return}k(!0)},C=v=>{const D=parseFloat(l);a(D,v),k(!1),d()},b=v=>{v.preventDefault();const D=parseFloat(l);if(isNaN(D)||D<=0){p("Please enter a valid amount.");return}if(!n){p("Please upload an image of your deposit slip.");return}o(D,n),d()},f=v=>ie(void 0,null,function*(){if(v.preventDefault(),p(""),!c.trim()){p("Please enter a voucher code.");return}g(!0);const D=yield r(c);g(!1),D&&d()}),S=()=>{switch(u){case"gateway":return e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-center text-light-subtle dark:text-dark-subtle",children:"Enter the amount you wish to add to your account balance."}),e.jsx(ce,{label:"Amount (LKR)",name:"amount",type:"number",value:l,onChange:v=>m(v.target.value),required:!0,min:100}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{type:"submit",className:"w-full bg-primary text-white font-bold py-3 rounded-md hover:bg-primary-dark transition-colors",children:"Continue to Payment"})})]});case"deposit":return e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/30 border-l-4 border-blue-400 rounded-r-md text-blue-800 dark:text-blue-200 text-sm",children:[e.jsx("h4",{className:"font-bold",children:"Instructions:"}),e.jsxs("ol",{className:"list-decimal list-inside mt-2 space-y-1",children:[e.jsxs("li",{children:["Deposit your desired amount to our bank account:",e.jsx("br",{}),e.jsx("strong",{className:"font-mono",children:"Bank:"})," Sampath Bank",e.jsx("br",{}),e.jsx("strong",{className:"font-mono",children:"Account Name:"})," PANORALINK BUSINESS SOLUTIONS (PVT) LTD",e.jsx("br",{}),e.jsx("strong",{className:"font-mono",children:"Account Number:"})," ",e.jsx("span",{style:{color:"#d32f2f",fontWeight:"bold"},children:"004610004410"}),e.jsx("br",{})]}),e.jsx("li",{children:"Upload a clear photo or screenshot of the deposit slip/confirmation."}),e.jsx("li",{children:"Enter the exact amount you deposited below."})]})]}),e.jsx(ce,{label:"Deposited Amount (LKR)",name:"amount",type:"number",value:l,onChange:v=>m(v.target.value),required:!0}),e.jsx(Je,{label:"Upload Deposit Slip",currentImage:n,onImageChange:x,aspectRatio:"aspect-video"}),e.jsx("div",{className:"pt-2",children:e.jsxs("button",{type:"submit",disabled:!n||!l,className:"w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-primary hover:bg-primary-dark transition-colors disabled:opacity-50",children:[e.jsx(et,{className:"w-5 h-5 mr-2"}),"Submit for Verification"]})})]});case"voucher":return e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-center text-light-subtle dark:text-dark-subtle",children:"Enter the code from your gift voucher to redeem its value to your account balance."}),e.jsx(ce,{label:"Voucher Code",name:"voucherCode",type:"text",value:c,onChange:v=>h(v.target.value.toUpperCase()),required:!0,placeholder:"GIFTXXXX"}),e.jsx("div",{className:"pt-2",children:e.jsxs("button",{type:"submit",disabled:w,className:"w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-primary hover:bg-primary-dark transition-colors disabled:opacity-50",children:[w?e.jsx(Ze,{className:"w-5 h-5 mr-2"}):e.jsx(le,{className:"w-5 h-5 mr-2"}),w?"Redeeming...":"Redeem Voucher"]})})]})}},z=[{id:"gateway",label:"Online Payment"},{id:"deposit",label:"Bank Deposit"},{id:"voucher",label:"Redeem Voucher"}];return e.jsxs(e.Fragment,{children:[e.jsx(ae,{isOpen:t&&!i,onClose:d,title:"Top Up Your Account Balance",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"border-b border-light-border dark:border-dark-border",children:e.jsx("nav",{className:"-mb-px flex justify-center space-x-4","aria-label":"Tabs",children:z.map(v=>e.jsx("button",{onClick:()=>{s(v.id),p("")},className:`whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm transition-colors ${u===v.id?"border-primary text-primary":"border-transparent text-light-subtle dark:text-dark-subtle hover:text-light-text"}`,children:v.label},v.id))})}),j&&e.jsx("p",{className:"text-sm text-red-500 text-center -mb-2",children:j}),e.jsx("div",{children:S()})]})}),i&&e.jsx(ae,{isOpen:!0,onClose:()=>k(!1),title:"Select Payment Method",children:e.jsx(bt,{onSelect:C})})]})},de=[{name:"Order Placed",status:"pending"},{name:"Processing",status:"processing"},{name:"Shipped",status:"shipped"},{name:"Delivered",status:"delivered"}],_t=({status:t})=>{const d=de.findIndex(a=>a.status===t);return e.jsx("div",{className:"w-full",children:e.jsx("nav",{"aria-label":"Progress",children:e.jsx("ol",{role:"list",className:"flex items-center",children:de.map((a,o)=>e.jsxs("li",{className:`relative ${o!==de.length-1?"flex-1":""}`,children:[e.jsx("div",{className:"flex items-center text-sm font-medium",children:o<=d?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full bg-primary group-hover:bg-primary-dark",children:e.jsx(X,{className:"h-5 w-5 text-white","aria-hidden":"true"})}),e.jsx("span",{className:"ml-2 text-xs sm:text-sm font-semibold text-primary",children:a.name})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full border-2 border-light-border dark:border-dark-border",children:e.jsx("span",{className:"h-2 w-2 rounded-full bg-light-border dark:bg-dark-border"})}),e.jsx("span",{className:"ml-2 text-xs sm:text-sm font-medium text-light-subtle dark:text-dark-subtle",children:a.name})]})}),o!==de.length-1?e.jsx("div",{className:"absolute top-4 left-4 -ml-px h-0.5 w-full bg-light-border dark:bg-dark-border","aria-hidden":"true",style:{marginLeft:"1rem",paddingRight:"1rem"},children:e.jsx("div",{className:`h-full w-full transition-colors duration-500 ${o<d?"bg-primary":"bg-transparent"}`})}):null]},a.name))})})})},Vt=({item:t})=>{var u,s;const d=new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR",minimumFractionDigits:0}),a=y.useMemo(()=>J(t.photo.url_thumb||"",150),[t.photo.url_thumb]),o=()=>{let l="",m=t.photo.id||"photo";if(t.type==="photo_download_highres"&&t.photo.url_highres)l=t.photo.url_highres;else if(t.photo.url_thumb)l=t.photo.url_thumb.replace(/=s\d+$/,"=s1600");else if(t.photo.id&&/^[A-Za-z0-9_-]{20,}$/.test(t.photo.id))l=`https://drive.google.com/uc?export=download&id=${encodeURIComponent(t.photo.id)}`;else{alert("No download link available for this photo.");return}const n=l.replace(/&amp;/g,"&");Ue(n,`clazz_lk_${m}.png`)},r=(t.price||0)*t.quantity;return e.jsxs("div",{className:"flex items-center gap-4 p-2 bg-light-surface dark:bg-dark-surface rounded-md",children:[e.jsx("img",{src:a||"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 150' fill='%23e2e8f0'%3E%3Crect width='150' height='150'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='16px' fill='%2364748b'%3ENo Photo%3C/text%3E%3C/svg%3E",alt:"thumbnail",className:"w-16 h-16 rounded-md object-cover",loading:"lazy"}),e.jsxs("div",{className:"flex-grow",children:[e.jsxs("p",{className:"font-semibold text-sm text-light-text dark:text-dark-text",children:["Photo #",((u=t.photo.id)==null?void 0:u.slice(-6))||"N/A"]}),e.jsxs("p",{className:"text-xs capitalize text-light-subtle dark:text-dark-subtle",children:[t.type.replace("photo_","").replace("_"," "),t.type==="photo_print"&&` (${(s=t.printOption)==null?void 0:s.size})`,t.quantity>1&&` x ${t.quantity}`]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-sm text-light-text dark:text-dark-text",children:d.format(r)}),(t.type==="photo_download"||t.type==="photo_download_highres")&&e.jsx("button",{onClick:o,className:"text-xs text-primary hover:underline",children:"Re-download"})]})]})},Te=({item:t})=>{const d=new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR",minimumFractionDigits:0}),{teachers:a}=O(),{handleNavigate:o}=Z(),r=t.product,u=y.useMemo(()=>{var p;const h=(r==null?void 0:r.teacherId)||(r==null?void 0:r.sellerId);if(!h||!(r!=null&&r.id))return null;const j=a.find(w=>w.id===h);return(p=j==null?void 0:j.products)==null?void 0:p.find(w=>w.id===r.id)},[a,r]),s=(u==null?void 0:u.title)||r.title,l=y.useMemo(()=>{let h;const j=r.coverImages,p=r.coverImage;return Array.isArray(j)&&j.length>0&&j[0]?h=j[0]:typeof p=="string"&&p?h=p:typeof j=="string"&&j&&(h=j),J(h||"",150)},[t.product]),m=r.downloadUrl||r.digitalFileUrl,n=r.type,x=h=>{if(h.stopPropagation(),n==="digital"&&m){const j=s.replace(/[^a-zA-Z0-9.-]/g,"_")||"download",p=m.replace(/&amp;/g,"&");Ue(p,j)}},c=()=>{r.id&&o({name:"product_detail",productId:r.id})};return e.jsxs("div",{className:"flex items-center gap-4 p-2 bg-light-surface dark:bg-dark-surface rounded-md",children:[e.jsxs("button",{onClick:c,className:"flex items-center gap-4 flex-grow text-left hover:opacity-80 transition-opacity rounded-md focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("img",{src:l||"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 150' fill='%23e2e8f0'%3E%3Crect width='150' height='150'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='16px' fill='%2364748b'%3ENo Image%3C/text%3E%3C/svg%3E",alt:s,className:"w-16 h-16 rounded-md object-cover flex-shrink-0",loading:"lazy"}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"font-semibold text-sm text-light-text dark:text-dark-text",children:s}),e.jsxs("p",{className:"text-xs capitalize text-light-subtle dark:text-dark-subtle",children:[n," ",t.quantity>1&&` x ${t.quantity}`]})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:"font-semibold text-sm text-light-text dark:text-dark-text",children:d.format(r.price*t.quantity)}),n==="digital"&&m&&e.jsxs("button",{onClick:x,className:"text-xs text-primary hover:underline flex items-center justify-end gap-1 mt-1",children:[e.jsx(ue,{className:"w-3 h-3"})," Re-download"]})]})]})},Bt=({user:t})=>{const{sales:d}=O(),a=y.useMemo(()=>t?d.filter(r=>r.studentId===t.id&&r.status==="completed"&&(r.itemType==="photo_purchase"||r.itemType==="marketplace_purchase")).sort((r,u)=>new Date(u.saleDate).getTime()-new Date(r.saleDate).getTime()):[],[t,d]),o=new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR"});return a.length>0?e.jsx("div",{className:"space-y-6",children:a.map(r=>{const u=r.cartItems&&r.cartItems.length>0,s=!u&&r.itemSnapshot&&"price"in r.itemSnapshot&&!("lectures"in r.itemSnapshot);return!u&&!s?null:e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface rounded-lg shadow-md overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-light-background dark:bg-dark-background border-b border-light-border dark:border-dark-border flex flex-col sm:flex-row justify-between sm:items-center gap-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:["Order ID: ",r.id]}),e.jsxs("p",{className:"font-semibold text-light-text dark:text-dark-text",children:["Order Date: ",new Date(r.saleDate).toLocaleDateString()]})]}),e.jsx("div",{className:"text-left sm:text-right",children:e.jsx("p",{className:"font-bold text-lg text-primary",children:o.format(r.totalAmount+r.amountPaidFromBalance)})})]}),(r.photoOrderStatus||r.physicalOrderStatus)&&e.jsx("div",{className:"p-6 border-b border-light-border dark:border-dark-border",children:e.jsx(_t,{status:r.photoOrderStatus||r.physicalOrderStatus})}),r.shippingAddress&&e.jsxs("div",{className:"p-4 text-sm border-b border-light-border dark:border-dark-border",children:[e.jsx("h4",{className:"font-semibold mb-1 text-light-text dark:text-dark-text",children:"Shipping to:"}),e.jsxs("address",{className:"not-italic text-light-subtle dark:text-dark-subtle text-xs",children:[r.shippingAddress.line1,e.jsx("br",{}),r.shippingAddress.line2&&e.jsxs(e.Fragment,{children:[r.shippingAddress.line2,e.jsx("br",{})]}),r.shippingAddress.city,", ",r.shippingAddress.state," ",r.shippingAddress.postalCode,e.jsx("br",{}),r.shippingAddress.country]})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[u&&r.cartItems.map((l,m)=>l.type.startsWith("photo")?e.jsx(Vt,{item:l},`${l.id}-${m}`):l.type==="product"?e.jsx(Te,{item:l},`${l.id}-${m}`):null),s&&e.jsx(Te,{item:{type:"product",id:r.id,product:r.itemSnapshot,quantity:1}})]})]},r.id)})}):e.jsx("p",{className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:"This student has not purchased any products or photos yet."})},Ht=({isOpen:t,onClose:d,onSave:a,classInfo:o,instanceDate:r,existingSubmissionLink:u})=>{const[s,l]=y.useState(""),[m,n]=y.useState("");y.useEffect(()=>{t&&(l(u||""),n(""))},[t,u]);const x=c=>{if(c.preventDefault(),n(""),!(!o||!r)){try{new URL(s)}catch(h){n("Please enter a valid URL (e.g., https://...).");return}a(o.id,r,s)}};return!o||!r?null:e.jsx(ae,{isOpen:t,onClose:d,title:`Submit Homework for "${o.title}" on ${new Date(r).toLocaleDateString()}`,children:e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:"Upload your homework files to a service like Google Drive, make sure the link is accessible ('Anyone with the link can view'), and paste the link below."}),e.jsx(ce,{label:"Homework Link (e.g., Google Drive)",name:"homeworkLink",type:"url",value:s,onChange:c=>l(c.target.value),required:!0,placeholder:"https://drive.google.com/..."}),m&&e.jsx("p",{className:"text-red-500 text-sm text-center",children:m}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-3",children:[e.jsxs("button",{type:"button",onClick:d,className:"inline-flex items-center justify-center px-4 py-2 border border-light-border dark:border-dark-border text-sm font-medium rounded-md shadow-sm",children:[e.jsx(tt,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark",children:[e.jsx(st,{className:"w-4 h-4 mr-2"}),u?"Update Submission":"Submit Homework"]})]})]})})},Wt=({user:t,isOwnerView:d=!1})=>{var i,k,N,C;const{sales:a,teachers:o,handleSaveHomeworkSubmission:r}=O(),{setVideoPlayerState:u}=ge(),[s,l]=y.useState({isOpen:!1,classInfo:null,instanceDate:null}),[m,n]=y.useState(null);y.useRef(null);const x=y.useMemo(()=>{if(!t)return console.warn("MyPastClasses component rendered without a user prop."),[];const b=a.filter(v=>v.studentId===t.id&&v.itemType==="class"&&v.status==="completed"),f=[],S=new Date,z=v=>{const D=v.getFullYear(),A=String(v.getMonth()+1).padStart(2,"0"),_=String(v.getDate()).padStart(2,"0");return`${D}-${A}-${_}`};return b.forEach(v=>{const D=o.find(P=>P.id===v.teacherId);if(!D)return;let A;const _=D.individualClasses.find(P=>P.id===v.itemId);if(_)A=_;else if(v.itemSnapshot&&"recurrence"in v.itemSnapshot)A=Q(W({},v.itemSnapshot),{isDeleted:!0});else return;if(A.recurrence==="weekly"){let P=new Date(A.date+"T00:00:00");const V=A.endDate?new Date(A.endDate+"T23:59:59"):S,[B,H]=A.endTime.split(":").map(Number);for(;P<=V;){const ne=new Date(P);if(ne.setHours(B,H,59,999),ne<S&&f.push({classInfo:A,teacher:D,instanceDate:z(P)}),P>S&&P>V)break;P.setDate(P.getDate()+7)}}else new Date(`${A.date}T${A.endTime}`)<S&&f.push({classInfo:A,teacher:D,instanceDate:A.date})}),f.sort((v,D)=>new Date(D.instanceDate).getTime()-new Date(v.instanceDate).getTime())},[t,a,o]),c=(b,f,S,z)=>{var A;const v={id:`rec_${f.id}_${z}`,title:`Recording for ${f.title}`,description:`Session from ${new Date(z).toLocaleDateString()}`,videoUrl:b,durationMinutes:0,isFreePreview:!1},D={id:`cls_${f.id}`,teacherId:S.id,title:f.title,lectures:[v],description:f.description,subject:f.subject,coverImage:((A=S.coverImages)==null?void 0:A[0])||"",fee:f.fee,currency:"LKR",type:"recorded",isPublished:f.isPublished,ratings:[],adminApproval:"approved"};u({isOpen:!0,lecture:v,course:D,isEnrolled:!0})},h=(b,f)=>{l({isOpen:!0,classInfo:b,instanceDate:f})},j=()=>{l({isOpen:!1,classInfo:null,instanceDate:null})},p=(b,f,S)=>{var v;const z=(v=x.find(D=>D.classInfo.id===b))==null?void 0:v.classInfo;z&&r(z.teacherId,b,f,S),j()},w=b=>{n(f=>f===b?null:b)},g=d?"You have no past classes with available recordings.":"This student has no past classes with available recordings.";return x.length===0?e.jsxs("div",{className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:[e.jsx("p",{children:g}),e.jsx("p",{className:"text-sm",children:"Recordings for finished classes will appear here once uploaded by the teacher."})]}):e.jsxs("div",{className:"space-y-4",children:[x.map(({classInfo:b,teacher:f,instanceDate:S},z)=>{var _,P,V;const v=(_=b.recordingUrls)==null?void 0:_[S],D=(V=(P=b.homeworkSubmissions)==null?void 0:P[S])==null?void 0:V.find(B=>B.studentId===(t==null?void 0:t.id)),A=`${b.id}-${S}`;return e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-light-surface dark:bg-dark-surface rounded-lg shadow-sm border border-light-border dark:border-dark-border",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:J(f.avatar,48,48),alt:f.name,className:"w-12 h-12 rounded-full object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-light-text dark:text-dark-text",children:b.title}),e.jsxs("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:["Session Date: ",new Date(S).toLocaleDateString()]}),e.jsxs("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:["with ",f.name]})]})]}),e.jsxs("div",{className:"mt-4 sm:mt-0 w-full sm:w-auto flex flex-col sm:flex-row gap-2",children:[e.jsx("div",{className:"relative",children:v&&v.length>0?v.length===1?e.jsxs("button",{onClick:()=>c(v[0],b,f,S),className:"w-full sm:w-auto flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary-dark transition-colors",children:[e.jsx(re,{className:"w-5 h-5"}),"Watch Recording"]}):e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>w(A),className:"w-full sm:w-auto flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary-dark transition-colors",children:[e.jsx(re,{className:"w-5 h-5"}),"Watch Recordings (",v.length,")"]}),m===A&&e.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-light-surface dark:bg-dark-surface rounded-md shadow-lg border border-light-border dark:border-dark-border z-10",children:v.map((B,H)=>e.jsxs("button",{onClick:()=>c(B,b,f,S),className:"block w-full text-left px-4 py-2 text-sm text-light-text dark:text-dark-text hover:bg-light-border dark:hover:bg-dark-border",children:["Recording Part ",H+1]},H))})]}):e.jsx("div",{className:"w-full sm:w-auto text-center px-4 py-2 text-sm font-medium text-light-subtle dark:text-dark-subtle bg-light-background dark:bg-dark-background rounded-md",children:"Recording not available"})}),e.jsxs("button",{onClick:()=>h(b,S),className:"w-full sm:w-auto flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium border border-primary text-primary rounded-md hover:bg-primary/10 transition-colors",children:[e.jsx(Ee,{className:"w-4 h-4"}),D?"Edit Submission":"Submit Homework"]})]})]},`${b.id}-${S}-${z}`)}),e.jsx(Ht,{isOpen:s.isOpen,onClose:j,onSave:p,classInfo:s.classInfo,instanceDate:s.instanceDate,existingSubmissionLink:(C=(N=(k=(i=s.classInfo)==null?void 0:i.homeworkSubmissions)==null?void 0:k[s.instanceDate])==null?void 0:N.find(b=>b.studentId===(t==null?void 0:t.id)))==null?void 0:C.link})]})},Qt=({data:t,y1Label:d,y2Label:a,y1Color:o="#3b82f6",y2Color:r="#8b5cf6",yAxisLabel:u="Score %"})=>{var g,i;const[s,l]=y.useState(null),m=500,n=300,x={top:20,right:20,bottom:50,left:50},{xScale:c,yScale:h,points:j,points2:p}=y.useMemo(()=>{t.map(S=>S.x);const k=100,N=S=>x.left+S/(t.length-1)*(m-x.left-x.right),C=S=>n-x.bottom-S/k*(n-x.top-x.bottom),b=t.map((S,z)=>`${N(z)},${C(S.y)}`).join(" "),f=a?t.map((S,z)=>{var v;return`${N(z)},${C((v=S.y2)!=null?v:0)}`}).join(" "):"";return{xScale:N,yScale:C,points:b,points2:f}},[t,m,n,x,a]),w=k=>{var S;const N=k.currentTarget,C=N.createSVGPoint();C.x=k.clientX,C.y=k.clientY;const b=C.matrixTransform((S=N.getScreenCTM())==null?void 0:S.inverse()),f=Math.round((b.x-x.left)/(m-x.left-x.right)*(t.length-1));if(f>=0&&f<t.length){const z=t[f];l({x:c(f),y:h(z.y),data:z})}};return e.jsxs("div",{className:"relative",children:[e.jsxs("svg",{viewBox:`0 0 ${m} ${n}`,onMouseMove:w,onMouseLeave:()=>l(null),className:"w-full h-auto",children:[e.jsx("line",{x1:x.left,y1:x.top,x2:x.left,y2:n-x.bottom,stroke:"currentColor",className:"text-light-border dark:text-dark-border"}),[0,25,50,75,100].map(k=>e.jsxs("g",{children:[e.jsx("text",{x:x.left-8,y:h(k)+3,textAnchor:"end",className:"text-xs fill-current text-light-subtle dark:text-dark-subtle",children:k}),e.jsx("line",{x1:x.left,x2:m-x.right,y1:h(k),y2:h(k),strokeDasharray:"2",className:"stroke-current text-light-border dark:text-dark-border"})]},k)),e.jsx("text",{transform:`translate(15, ${n/2}) rotate(-90)`,textAnchor:"middle",className:"text-xs fill-current font-semibold text-light-subtle dark:text-dark-subtle",children:u}),e.jsx("line",{x1:x.left,y1:n-x.bottom,x2:m-x.right,y2:n-x.bottom,stroke:"currentColor",className:"text-light-border dark:text-dark-border"}),t.map((k,N)=>e.jsx("text",{x:c(N),y:n-x.bottom+15,textAnchor:"middle",className:"text-xs fill-current text-light-subtle dark:text-dark-subtle",children:k.x},N)),a&&e.jsx("polyline",{fill:"none",stroke:r,strokeWidth:"2",points:p}),e.jsx("polyline",{fill:"none",stroke:o,strokeWidth:"2",points:j}),s&&e.jsxs("g",{children:[e.jsx("line",{x1:s.x,y1:x.top,x2:s.x,y2:n-x.bottom,strokeDasharray:"3",className:"stroke-current text-light-subtle dark:text-dark-subtle"}),e.jsx("circle",{cx:s.x,cy:h(s.data.y),r:"4",fill:o}),a&&e.jsx("circle",{cx:s.x,cy:h((g=s.data.y2)!=null?g:0),r:"4",fill:r})]})]}),s&&e.jsxs("div",{className:"absolute p-3 bg-light-surface dark:bg-dark-surface shadow-lg rounded-lg pointer-events-none transition-transform duration-100 text-sm",style:{left:s.x+10,top:s.y-60},children:[e.jsx("p",{className:"font-bold",children:s.data.details.title}),e.jsx("p",{className:"text-light-subtle dark:text-dark-subtle text-xs mb-2",children:s.data.x}),e.jsxs("p",{style:{color:o},children:[e.jsxs("span",{className:"font-semibold",children:[d,":"]})," ",s.data.details.studentScore,"/",s.data.details.maxMark," (",s.data.y.toFixed(1),"%)"]}),a&&e.jsxs("p",{style:{color:r},children:[e.jsxs("span",{className:"font-semibold",children:[a,":"]})," ",s.data.details.classAverage.toFixed(1),"/",s.data.details.maxMark," (",(i=s.data.y2)==null?void 0:i.toFixed(1),"%)"]})]}),e.jsxs("div",{className:"flex justify-center items-center space-x-4 mt-4 text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:o}}),d]}),a&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:r}}),a]})]})]})},Yt=({data:t,label1:d,label2:a,color1:o="#3b82f6",color2:r="#a78bfa"})=>{const l={top:20,right:20,bottom:50,left:50},m=Math.max(...t.map(h=>h.max),0)||100,n=(500-l.left-l.right)/t.length*.8,x=(500-l.left-l.right)/t.length*.2,c=h=>300-l.bottom-h/m*(300-l.top-l.bottom);return e.jsxs("div",{children:[e.jsxs("svg",{viewBox:"0 0 500 300",className:"w-full h-auto",children:[e.jsx("line",{x1:l.left,y1:l.top,x2:l.left,y2:300-l.bottom,stroke:"currentColor",className:"text-light-border dark:text-dark-border"}),[0,.25,.5,.75,1].map(h=>e.jsxs("g",{children:[e.jsx("text",{x:l.left-8,y:c(h*m)+3,textAnchor:"end",className:"text-xs fill-current text-light-subtle dark:text-dark-subtle",children:h*m}),e.jsx("line",{x1:l.left,x2:500-l.right,y1:c(h*m),y2:c(h*m),strokeDasharray:"2",className:"stroke-current text-light-border dark:text-dark-border"})]},h)),e.jsx("line",{x1:l.left,y1:300-l.bottom,x2:500-l.right,y2:300-l.bottom,stroke:"currentColor",className:"text-light-border dark:text-dark-border"}),t.map((h,j)=>{const p=l.left+j*(n+x)+x/2;return e.jsxs("g",{className:"group",children:[e.jsx("rect",{x:p,y:c(h.value2),width:n/2,height:300-l.bottom-c(h.value2),fill:r,rx:"2",className:"transition-opacity opacity-70 group-hover:opacity-100"}),e.jsx("rect",{x:p+n/2,y:c(h.value1),width:n/2,height:300-l.bottom-c(h.value1),fill:o,rx:"2",className:"transition-opacity opacity-90 group-hover:opacity-100"}),e.jsx("text",{x:p+n/2,y:300-l.bottom+15,textAnchor:"middle",className:"text-[10px] fill-current text-light-subtle dark:text-dark-subtle",children:h.label}),e.jsx("g",{className:"opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs("text",{x:p+n/2,y:c(Math.max(h.value1,h.value2))-5,textAnchor:"middle",className:"text-xs font-bold fill-current text-light-text dark:text-dark-text",children:[h.label,": ",h.value1,"/",h.max," vs Avg: ",h.value2.toFixed(1),"/",h.max]})})]},j)})]}),e.jsxs("div",{className:"flex justify-center items-center space-x-4 mt-4 text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:o}}),d]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:r}}),a]})]})]})},Kt=({data:t,size:d=300})=>{if(t.length<3)return e.jsx("div",{className:"text-center p-4 text-light-subtle dark:text-dark-subtle",children:"Need at least 3 subjects to draw a radar chart."});const a=d/2,o=d*.4,r=4,u=Math.PI*2/t.length,s=t.map((x,c)=>{const h=u*c-Math.PI/2,j=o*(x.score/100);return`${a+j*Math.cos(h)},${a+j*Math.sin(h)}`}).join(" "),l=t.map((x,c)=>{const h=u*c-Math.PI/2;return{x1:a,y1:a,x2:a+o*Math.cos(h),y2:a+o*Math.sin(h)}}),m=t.map((x,c)=>{const h=u*c-Math.PI/2,j=o*1.1;return{x:a+j*Math.cos(h),y:a+j*Math.sin(h),label:x.subject}}),n=Array.from({length:r},(x,c)=>{const h=o*((c+1)/r);return t.map((p,w)=>{const g=u*w-Math.PI/2;return`${a+h*Math.cos(g)},${a+h*Math.sin(g)}`}).join(" ")});return e.jsxs("svg",{viewBox:`0 0 ${d} ${d}`,className:"w-full max-w-sm mx-auto h-auto",children:[e.jsxs("g",{className:"text-light-border dark:text-dark-border",children:[n.map((x,c)=>e.jsx("polygon",{points:x,fill:"none",stroke:"currentColor",strokeWidth:"0.5"},c)),l.map((x,c)=>e.jsx("line",Q(W({},x),{stroke:"currentColor",strokeWidth:"0.5"}),c))]}),m.map((x,c)=>e.jsx("text",{x:x.x,y:x.y,textAnchor:x.x>a?"start":x.x<a?"end":"middle",dominantBaseline:"middle",className:"text-xs font-semibold fill-current text-light-subtle dark:text-dark-subtle",children:x.label},c)),e.jsxs("g",{children:[e.jsx("polygon",{points:s,fill:"#3b82f6",fillOpacity:"0.3",stroke:"#3b82f6",strokeWidth:"2"}),t.map((x,c)=>{const h=s.split(" ")[c].split(",");return e.jsx("circle",{cx:parseFloat(h[0]),cy:parseFloat(h[1]),r:"3",fill:"#3b82f6"},c)})]})]})},Gt=({user:t})=>{const{teachers:d,submissions:a,sales:o}=O(),[r,u]=y.useState("all"),[s,l]=y.useState("all"),m=y.useMemo(()=>{if(!t)return[];const p=[];return d.forEach(w=>{w.individualClasses.forEach(g=>{g.grades&&Object.entries(g.grades).forEach(([i,k])=>{const N=k.studentScores.find(C=>C.studentId===t.id);if(N){const C=k.studentScores.reduce((f,S)=>f+S.score,0),b=k.studentScores.length>0?C/k.studentScores.length:0;p.push({id:`${g.id}-${i}`,title:g.title,subject:g.subject,date:i,studentScore:N.score,maxMark:k.maxMark,classAverage:b,type:"class"})}})})}),a.filter(w=>w.studentId===t.id).forEach(w=>{const g=o.find(b=>{var f;return b.itemId===w.quizId&&b.itemType==="quiz"&&((f=b.itemSnapshot)==null?void 0:f.instanceStartDate)===w.quizInstanceId});if(!g||!g.itemSnapshot)return;const i=g.itemSnapshot;if(!i.questions)return;const k=a.filter(b=>b.quizId===i.id&&b.quizInstanceId===i.instanceStartDate),N=k.reduce((b,f)=>b+f.score,0),C=k.length>0?N/k.length:0;p.push({id:`${i.id}-${i.instanceStartDate}`,title:i.title,subject:i.subject,date:i.date,studentScore:w.score,maxMark:i.questions.length,classAverage:C,type:"quiz"})}),p.sort((w,g)=>new Date(w.date).getTime()-new Date(g.date).getTime())},[t,d,a,o]),n=y.useMemo(()=>m.filter(p=>(r==="all"||p.type===r)&&(s==="all"||p.subject===s)),[m,r,s]),x=y.useMemo(()=>{const p=new Set(m.map(w=>w.subject));return["all",...Array.from(p)]},[m]),c=y.useMemo(()=>n.map(p=>({x:new Date(p.date).toLocaleDateString("en-CA"),y:p.studentScore/p.maxMark*100,y2:p.classAverage/p.maxMark*100,details:p})),[n]),h=y.useMemo(()=>n.slice(-10).map(p=>({label:p.title.substring(0,15)+"...",value1:p.studentScore,value2:p.classAverage,max:p.maxMark})),[n]),j=y.useMemo(()=>{const p={};return m.forEach(w=>{p[w.subject]||(p[w.subject]={total:0,count:0});const g=w.studentScore/w.maxMark*100;p[w.subject].total+=g,p[w.subject].count+=1}),Object.entries(p).map(([w,g])=>({subject:w,score:g.total/g.count}))},[m]);return m.length===0?e.jsx("p",{className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:"No graded assignments or quizzes found."}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-4 rounded-lg shadow-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Performance Overview"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("select",{value:r,onChange:p=>u(p.target.value),className:"w-full p-2 border rounded-md bg-light-background dark:bg-dark-background border-light-border dark:border-dark-border",children:[e.jsx("option",{value:"all",children:"All Assessments"}),e.jsx("option",{value:"class",children:"Graded Classes"}),e.jsx("option",{value:"quiz",children:"Quizzes"})]}),e.jsx("select",{value:s,onChange:p=>l(p.target.value),className:"w-full p-2 border rounded-md bg-light-background dark:bg-dark-background border-light-border dark:border-dark-border",children:x.map(p=>e.jsx("option",{value:p,children:p==="all"?"All Subjects":p},p))})]})]}),n.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Score Over Time"}),e.jsx(Qt,{data:c,y1Label:"Your Score",y2Label:"Class Average"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Recent Performance vs. Average"}),e.jsx(Yt,{data:h,label1:"Your Score",label2:"Class Average"})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h4",{className:"font-semibold mb-4 text-lg",children:"Average Performance by Subject"}),e.jsx(Kt,{data:j})]})]})]}):e.jsx("p",{className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:"No data available for the selected filters."})]})},Xt=({activeTab:t,setActiveTab:d,counts:a})=>{const[o,r]=y.useState(!1),u=[{id:"overview",label:"Overview",icon:at},{id:"my_vouchers",label:"My Vouchers",icon:le},{id:"timetable",label:"My Timetable",icon:he},{id:"courses",label:"My Courses",icon:pe},{id:"classes",label:"My Classes",icon:re},{id:"past_classes",label:"Past Classes",icon:te},{id:"quizzes",label:"My Quizzes",icon:xe},{id:"score_card",label:"Score Card",icon:rt},{id:"my_events",label:"My Events",icon:$e},{id:"my_orders",label:"My Orders",icon:lt},{id:"attendance",label:"My Attendance",icon:xe},{id:"history",label:"Transaction History",icon:ee},{id:"profile",label:"My Profile",icon:ke}],s=m=>{switch(m){case"courses":return a.courses;case"classes":return a.classes;case"quizzes":return a.quizzes;case"my_events":return a.events;case"my_orders":return a.orders;case"history":return a.history;default:return 0}},l=(m,n)=>{m.stopPropagation(),window.innerWidth<768&&!o?r(!0):(d(n),r(!1))};return e.jsxs(e.Fragment,{children:[o&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-[990] md:hidden",onClick:()=>r(!1)}),e.jsx("div",{className:`
                    fixed md:relative top-16 md:top-0 left-0 bottom-0 md:bottom-auto
                    z-[1000] md:z-auto
                    bg-light-surface dark:bg-dark-surface
                    border-r md:border-r-0 md:border md:border-light-border md:dark:border-dark-border
                    md:rounded-lg md:shadow-sm
                    transition-all duration-300 ease-in-out
                    flex flex-col
                    ${o?"w-64 shadow-2xl":"w-16 md:w-full"}
                `,onClick:()=>!o&&r(!0),children:e.jsx("nav",{className:"flex flex-col flex-1 overflow-y-auto py-2 md:py-0",children:u.map(m=>{const n=t===m.id,x=s(m.id);return e.jsxs("button",{onClick:c=>l(c,m.id),className:`
                                    relative flex items-center
                                    py-3 md:py-3 transition-all duration-200
                                    md:border-l-4 md:border-r-0 md:px-4
                                    ${n?"text-primary bg-primary/5 md:bg-primary/10 md:border-primary":"text-light-subtle dark:text-dark-subtle hover:text-light-text dark:hover:text-dark-text hover:bg-gray-50 dark:hover:bg-white/5 md:border-transparent"}
                                    ${o?"px-4 justify-start":"px-0 justify-center md:justify-start"}
                                `,title:m.label,children:[e.jsx("div",{className:"flex items-center justify-center flex-shrink-0",children:e.jsx(m.icon,{className:`w-6 h-6 md:w-5 md:h-5 ${n?"text-primary":"text-light-subtle dark:text-dark-subtle group-hover:text-light-text dark:group-hover:text-dark-text"}`})}),e.jsx("span",{className:`
                                    ml-3 font-medium text-sm whitespace-nowrap
                                    ${o?"block opacity-100":"hidden md:block"}
                                `,children:m.label}),x>0&&e.jsx("span",{className:`
                                        ml-auto text-xs font-semibold px-2 py-0.5 rounded-full
                                        ${n?"bg-primary/20 text-primary":"bg-light-border dark:bg-dark-border text-light-subtle dark:text-dark-subtle"}
                                        ${o?"block":"hidden md:block"}
                                    `,children:x}),n&&e.jsx("span",{className:"hidden md:block text-primary ml-auto",children:e.jsx(nt,{className:"w-4 h-4"})})]},m.id)})})})]})},Me=({voucher:t,onCollect:d})=>{const a=new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR",minimumFractionDigits:0}),o=new Date(t.expiresAt)<new Date;return e.jsxs("div",{className:`relative p-5 rounded-lg shadow-md border-l-4 transition-all duration-300 ${o?"border-gray-400 bg-gray-50 dark:bg-gray-800":t.isUsed?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-primary bg-light-surface dark:bg-dark-surface"}`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-light-text dark:text-dark-text",children:t.title||"Gift Voucher"}),e.jsx("p",{className:"text-2xl font-bold text-primary mt-1",children:a.format(t.amount)})]}),e.jsx("div",{className:"text-right",children:t.isUsed?e.jsxs("span",{className:"flex items-center text-xs font-bold text-green-600 dark:text-green-400",children:[e.jsx(X,{className:"w-4 h-4 mr-1"}),"Used"]}):o?e.jsxs("span",{className:"flex items-center text-xs font-bold text-gray-500",children:[e.jsx(te,{className:"w-4 h-4 mr-1"}),"Expired"]}):e.jsxs("span",{className:"flex items-center text-xs font-bold text-primary",children:[e.jsx(le,{className:"w-4 h-4 mr-1"}),"Active"]})})]}),t.redemptionRules&&e.jsxs("div",{className:"mt-3 text-sm text-light-subtle dark:text-dark-subtle bg-light-background dark:bg-dark-background p-2 rounded border border-light-border dark:border-dark-border",children:[e.jsx("p",{className:"font-semibold text-xs mb-1",children:"Rules:"}),t.redemptionRules]}),e.jsx("div",{className:"mt-4 border-t border-light-border dark:border-dark-border pt-4",children:t.isCollected?e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle mb-1",children:"Voucher Code"}),e.jsx("div",{className:"bg-light-background dark:bg-dark-background border border-dashed border-primary p-2 rounded-md font-mono text-lg font-bold tracking-widest text-primary select-all",children:t.code}),e.jsxs("p",{className:"text-[10px] text-light-subtle dark:text-dark-subtle mt-2",children:["Expires: ",new Date(t.expiresAt).toLocaleDateString()]})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle mb-2",children:"You have a new voucher!"}),e.jsx("button",{onClick:()=>d(t.id),className:"w-full bg-primary text-white font-bold py-2 rounded-md hover:bg-primary-dark transition-colors animate-pulse",children:"Collect Voucher"})]})})]})},Zt=({user:t})=>{const{vouchers:d}=O(),{addToast:a}=ge(),[o,r]=y.useState(null),u=y.useMemo(()=>d.filter(n=>n.assignedToUserId===t.id).sort((n,x)=>!n.isCollected&&x.isCollected?-1:n.isCollected&&!x.isCollected?1:new Date(x.purchasedAt).getTime()-new Date(n.purchasedAt).getTime()),[d,t.id]),s=n=>ie(void 0,null,function*(){try{yield kt(yt(it,"vouchers",n),{isCollected:!0}),a("Voucher collected! Code revealed.","success")}catch(x){console.error(x),a("Failed to collect voucher.","error")}});if(u.length===0)return e.jsxs("div",{className:"text-center py-16 text-light-subtle dark:text-dark-subtle",children:[e.jsx(le,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-semibold",children:"No Vouchers Yet"}),e.jsx("p",{children:"Check back later for gifts and rewards."})]});const l=u.filter(n=>!n.isCollected),m=u.filter(n=>n.isCollected);return e.jsxs("div",{className:"space-y-8",children:[l.length>0&&e.jsxs("section",{children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center text-primary",children:[e.jsxs("span",{className:"relative flex h-3 w-3 mr-2",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-primary"})]}),"New Vouchers Waiting"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(n=>e.jsx(Me,{voucher:n,onCollect:()=>r(n.id)},n.id))})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"My Voucher Wallet"}),m.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map(n=>e.jsx(Me,{voucher:n,onCollect:()=>{}},n.id))}):e.jsx("p",{className:"text-light-subtle dark:text-dark-subtle italic",children:"You haven't collected any vouchers yet."})]}),e.jsx("div",{className:"mt-8 p-4 bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-500 rounded-r-md text-sm text-blue-800 dark:text-blue-200",children:e.jsxs("p",{children:[e.jsx("strong",{children:"How to Redeem:"}),' Go to "Overview", click on "Top Up" under your Account Balance, select "Redeem Voucher", and enter the code shown above.']})}),e.jsx(Nt,{isOpen:!!o,onClose:()=>r(null),onConfirm:()=>{o&&s(o),r(null)},title:"Collect Voucher",message:"Are you ready to reveal your gift voucher code?",confirmText:"Yes, Reveal Code"})]})},fe=({title:t,value:d,icon:a,onAction:o,actionLabel:r})=>{const u="bg-light-surface dark:bg-dark-surface p-4 rounded-lg shadow-sm border border-light-border dark:border-dark-border",s=e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-primary/10 text-primary rounded-lg mr-4",children:a}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-light-subtle dark:text-dark-subtle",children:t}),e.jsx("div",{className:"text-xl font-bold text-light-text dark:text-dark-text",children:d})]})]}),o&&r&&e.jsx("button",{onClick:l=>{l.stopPropagation(),o()},className:"px-3 py-1 text-xs font-medium text-white bg-primary rounded-md hover:bg-primary-dark transition-colors",children:r})]});return o&&!r?e.jsx("button",{onClick:o,className:`${u} w-full text-left hover:border-primary transition-colors h-full`,children:s}):e.jsx("div",{className:`${u} h-full`,children:s})},ps=({userId:t,isAdminView:d=!1})=>{const{currentUser:a}=je(),{sales:o,users:r,teachers:u,vouchers:s}=O(),{pageState:l,handleNavigate:m}=Z(),{setModalState:n}=ge(),{enableNotifications:x}=dt(),c=y.useMemo(()=>d&&t?r.find(E=>E.id===t):a,[d,t,r,a]),h=l.name==="student_dashboard"&&l.initialTab?l.initialTab:"overview",[j,p]=y.useState(h),[w,g]=y.useState(!1),[i,k]=y.useState("all"),N=E=>{E!=="classes"&&k("all"),p(E)},C=()=>{k("upcoming"),p("classes")},b=y.useCallback(()=>g(!1),[]),{percentage:f}=ot(c),{enrolledCoursesCount:S,enrolledClassesCount:z,enrolledQuizzesCount:v,enrolledEventsCount:D,purchaseHistoryCount:A,topUpHistoryCount:_,myOrdersCount:P,uncollectedVouchersCount:V}=y.useMemo(()=>{var $;if(!c)return{enrolledCoursesCount:0,enrolledClassesCount:0,enrolledQuizzesCount:0,enrolledEventsCount:0,purchaseHistoryCount:0,topUpHistoryCount:0,myOrdersCount:0,uncollectedVouchersCount:0};const E=o.filter(I=>I.studentId===c.id),F=new Set(E.filter(I=>I.itemType==="course").map(I=>I.itemId)),Y=new Set(E.filter(I=>I.itemType==="class").map(I=>I.itemId)),K=new Set(E.filter(I=>I.itemType==="quiz").map(I=>I.itemId)),G=new Set(E.filter(I=>I.itemType==="event").map(I=>I.itemId)),Ne=E.filter(I=>I.status==="completed"&&(I.itemType==="photo_purchase"||I.itemType==="marketplace_purchase"||I.itemSnapshot&&"coverImages"in I.itemSnapshot&&!I.cartItems)).length,ve=s.filter(I=>I.assignedToUserId===c.id&&!I.isCollected).length;return{enrolledCoursesCount:F.size,enrolledClassesCount:Y.size,enrolledQuizzesCount:K.size,enrolledEventsCount:G.size,purchaseHistoryCount:E.length,topUpHistoryCount:(($=c.topUpHistory)==null?void 0:$.length)||0,myOrdersCount:Ne,uncollectedVouchersCount:ve}},[c,o,s]),[B,H]=y.useState(0),{weekStart:ne,weekEnd:Le,scheduleForWeek:Oe}=y.useMemo(()=>{if(!c)return{weekStart:new Date,weekEnd:new Date,scheduleForWeek:[]};const E=$=>{const I=new Date,T=I.getDay(),U=I.getDate()-T+(T===0?-6:1),M=new Date(new Date(I.setDate(U+$*7)).setHours(0,0,0,0)),L=new Date(M);return L.setDate(M.getDate()+6),L.setHours(23,59,59,999),{weekStart:M,weekEnd:L}},F=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],{weekStart:Y,weekEnd:K}=E(B),G=[];return o.filter($=>$.studentId===c.id&&$.itemType==="class"&&$.status==="completed").forEach($=>{const I=u.find(U=>U.id===$.teacherId),T=I==null?void 0:I.individualClasses.find(U=>U.id===$.itemId);if(T){if(T.status==="canceled"||T.isDeleted)return;const U=new Date(T.date);if(U.setMinutes(U.getMinutes()+U.getTimezoneOffset()),T.recurrence==="weekly"){const M=new Date(T.date).getDay(),L=F[M],be=new Date(T.date),we=T.endDate?new Date(T.endDate):null;be<=K&&(!we||we>=Y)&&G.push({id:T.id,type:"class",day:L,subject:T.subject,title:T.title,startTime:T.startTime,endTime:T.endTime})}else if(T.recurrence==="flexible"&&T.flexibleDates)T.flexibleDates.forEach(M=>{const L=new Date(M.date);if(L.setMinutes(L.getMinutes()+L.getTimezoneOffset()),L>=Y&&L<=K){const be=F[L.getDay()];G.push({id:T.id,type:"class",day:be,subject:T.subject,title:T.title,startTime:M.startTime,endTime:M.endTime})}});else{const M=new Date(T.date);if(M.setMinutes(M.getMinutes()+M.getTimezoneOffset()),M>=Y&&M<=K){const L=F[M.getDay()];G.push({id:T.id,type:"class",day:L,subject:T.subject,title:T.title,startTime:T.startTime,endTime:T.endTime})}}}}),o.filter($=>$.studentId===c.id&&$.itemType==="quiz"&&$.status==="completed").forEach($=>{const I=u.find(M=>M.id===$.teacherId),U=(I==null?void 0:I.quizzes.find(M=>M.id===$.itemId))||$.itemSnapshot;if(U&&U.status==="scheduled"){const M=new Date(U.date);if(M.setMinutes(M.getMinutes()+M.getTimezoneOffset()),M>=Y&&M<=K){const L=F[M.getDay()];G.push({id:U.id,type:"quiz",day:L,subject:U.subject,title:U.title,startTime:U.startTime,endTime:""})}}}),{weekStart:Y,weekEnd:K,scheduleForWeek:G}},[c,B,o,u]),Fe=new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR"});if(!c)return e.jsx("div",{children:"User not found or you are not logged in."});const qe=()=>{const E=!d;switch(j){case"overview":return e.jsxs("div",{className:"space-y-8 animate-fadeIn",children:[e.jsxs("div",{className:"mb-8 flex flex-col md:flex-row justify-between items-start md:items-end gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold",children:["Welcome",d?"":" back",", ",c.firstName,"!"]}),e.jsx("p",{className:"text-light-subtle dark:text-dark-subtle mt-1",children:d?`Viewing dashboard for ${c.firstName} ${c.lastName} (${c.id})`:"Here's a summary of your learning activities."})]}),!d&&"Notification"in window&&Notification.permission==="default"&&e.jsxs("button",{onClick:()=>x(),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg shadow-md hover:shadow-lg transition-all animate-pulse",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"})}),"Turn on Notifications"]})]}),V>0&&!d&&e.jsx("div",{className:"mb-6 animate-fadeIn",children:e.jsxs("button",{onClick:()=>p("my_vouchers"),className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white p-4 rounded-lg shadow-lg flex items-center justify-between hover:scale-[1.01] transition-transform",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-full animate-bounce",children:e.jsx(le,{className:"w-6 h-6"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"font-bold text-lg",children:"You have a Gift Voucher!"}),e.jsx("p",{className:"text-sm opacity-90",children:"Someone has sent you a voucher. Click here to collect it."})]})]}),e.jsxs("div",{className:"bg-white text-primary font-bold px-3 py-1 rounded-full text-sm",children:[V," Waiting"]})]})}),f===100?e.jsx("div",{className:"mb-6 animate-fadeIn",children:e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/30 border-l-4 border-green-500 p-3 rounded-r-lg shadow-sm flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),e.jsxs("p",{className:"text-sm font-medium text-green-800 dark:text-green-200",children:["Great job, ",c.firstName,"! Your profile is 100% complete."]})]}),e.jsx("button",{onClick:()=>n({name:"edit_student_profile",userToEdit:c}),className:"text-xs px-3 py-1.5 bg-white dark:bg-green-800 border border-green-200 dark:border-green-700 text-green-700 dark:text-green-100 font-medium rounded hover:bg-green-50 dark:hover:bg-green-700 transition-colors",children:"Edit Details"})]})}):(f<100||d)&&e.jsx("div",{className:"mb-6 animate-fadeIn",children:e.jsxs("div",{className:"bg-yellow-100 dark:bg-yellow-900/50 border-l-4 border-yellow-500 text-yellow-800 dark:text-yellow-200 p-4 rounded-r-lg shadow-lg flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsxs("p",{className:"font-bold",children:["Complete ",d?"this student's":"your"," profile for a better experience!"]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsx(ct,{value:f,max:100}),e.jsxs("span",{className:"font-bold text-sm flex-shrink-0",children:[f,"%"]})]})]}),e.jsx("button",{onClick:()=>n({name:"edit_student_profile",userToEdit:c}),className:"bg-yellow-500 text-white font-bold py-2 px-4 rounded-md hover:bg-yellow-600 transition-colors flex-shrink-0 w-full sm:w-auto",children:"Complete Profile"})]})}),e.jsx(ft,{user:c}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Dashboard Overview"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(fe,{title:"Enrolled Courses",value:S,icon:e.jsx(pe,{className:"w-6 h-6"}),onAction:()=>N("courses")}),e.jsx(fe,{title:"Active Classes",value:z,icon:e.jsx(re,{className:"w-6 h-6"}),onAction:C}),e.jsx(fe,{title:"Account Balance",value:Fe.format(c.accountBalance),icon:e.jsx(ee,{className:"w-6 h-6"}),onAction:d?void 0:()=>g(!0),actionLabel:"Top Up"})]})]}),e.jsx(jt,{currentUser:c})]});case"timetable":return e.jsxs("div",{className:"animate-fadeIn",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("button",{onClick:()=>H(F=>F-1),className:"px-4 py-2 text-sm font-medium border border-light-border dark:border-dark-border rounded-md hover:bg-light-border dark:hover:bg-dark-border transition-colors",children:"< Previous Week"}),e.jsxs("span",{className:"font-semibold text-lg",children:[ne.toLocaleDateString()," - ",Le.toLocaleDateString()]}),e.jsx("button",{onClick:()=>H(F=>F+1),className:"px-4 py-2 text-sm font-medium border border-light-border dark:border-dark-border rounded-md hover:bg-light-border dark:hover:bg-dark-border transition-colors",children:"Next Week >"})]}),e.jsx("div",{className:"bg-light-surface dark:bg-dark-surface p-4 rounded-lg shadow-md",children:e.jsx(gt,{schedule:Oe,onItemClick:F=>m(F.type==="class"?{name:"class_detail",classId:F.id}:{name:"quiz_detail",quizId:F.id}),title:"My Class Schedule"})})]});case"courses":return e.jsx(vt,{user:c,isOwnerView:E});case"classes":return e.jsx(wt,{user:c,isOwnerView:E,filter:i});case"past_classes":return e.jsx(Wt,{user:c,isOwnerView:E});case"quizzes":return e.jsx(St,{user:c,isOwnerView:E});case"my_events":return e.jsx(Ct,{user:c});case"history":return e.jsx(Rt,{user:c});case"attendance":return e.jsx(Ft,{user:c});case"profile":return e.jsx(Lt,{user:c,isAdminView:d});case"my_orders":return e.jsx(Bt,{user:c});case"score_card":return e.jsx(Gt,{user:c});case"my_vouchers":return e.jsx(Zt,{user:c});default:return null}},_e={courses:S,classes:z,quizzes:v,events:D,orders:P,history:A+_};return e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"md:w-64 flex-shrink-0 order-1 md:order-1 relative z-20",children:e.jsx("div",{className:"sticky top-24",children:e.jsx(Xt,{activeTab:j,setActiveTab:N,counts:_e})})}),e.jsx("div",{className:"flex-1 min-w-0 order-2 md:order-2 pl-16 md:pl-0 animate-slideInUp relative z-0",children:qe()})]}),!d&&w&&e.jsx(qt,{isOpen:w,onClose:b})]})};export{ps as default};
