var K=Object.defineProperty,Q=Object.defineProperties;var U=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var A=(r,s,a)=>s in r?K(r,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[s]=a,v=(r,s)=>{for(var a in s||(s={}))Y.call(s,a)&&A(r,a,s[a]);if(P)for(var a of P(s))Z.call(s,a)&&A(r,a,s[a]);return r},N=(r,s)=>Q(r,U(s));var j=(r,s,a)=>new Promise((p,g)=>{var i=d=>{try{u(a.next(d))}catch(c){g(c)}},h=d=>{try{u(a.throw(d))}catch(c){g(c)}},u=d=>d.done?p(d.value):Promise.resolve(d.value).then(i,h);u((a=a.apply(r,s)).next())});import{u as ee,b as te,ab as se,e as ae,r as l,_ as re,j as e,aA as le,aH as oe,X as ne,v as ie,ah as m}from"./index-BXN-gaEy.js";import{x as M,f as y,q as de,O as ce,j as C,o as ue,A as he,P as z}from"./vendor-firebase-CLtQg3ae.js";const S=r=>e.jsx("svg",N(v({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.8,stroke:"currentColor"},r),{children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 01.865-.501 48.172 48.172 0 003.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z"})})),xe=r=>e.jsx("svg",N(v({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},r),{children:e.jsx("path",{d:"M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z"})})),fe=()=>{const{supportSettings:r}=ee(),{currentUser:s}=te(),{fcmToken:a}=se(),{isChatWidgetOpen:p,setChatWidgetOpen:g}=ae(),[i,h]=l.useState("minimised"),[u,d]=l.useState("en"),[c,b]=l.useState(!0),[I,B]=l.useState(""),[q,H]=l.useState(""),[W,G]=l.useState(!1),[k,V]=l.useState([]),[f,E]=l.useState(""),[n,_]=l.useState(null),T=l.useRef(null);l.useEffect(()=>{p&&(R(),b(!0))},[p]),l.useEffect(()=>{const t=sessionStorage.getItem("supportChatId");t&&_(t)},[]),l.useEffect(()=>{n&&a&&M(y(m,"supportChats",n),{fcmToken:a}).catch(t=>console.log("Error linking token:",t))},[n,a]),l.useEffect(()=>{if(i==="live_chat"&&n){const t=de(C(m,"supportChats",n,"messages"),ce("timestamp","asc")),x=ue(t,w=>{const J=w.docs.map(D=>v({id:D.id},D.data()));V(J)});return()=>x()}},[i,n]),l.useEffect(()=>{var t;(t=T.current)==null||t.scrollIntoView({behavior:"smooth"})},[k]);const L=()=>{h("minimised"),b(!0),g(!1)},O=t=>{d(t),h("type_select")},$=t=>j(void 0,null,function*(){t.preventDefault();try{yield z(C(m,"supportRequests"),{name:I,phone:q,language:u,timestamp:new Date().toISOString(),status:"pending",userId:(s==null?void 0:s.id)||"guest"}),G(!0),setTimeout(()=>L(),3e3)}catch(x){console.error("Error submitting request",x)}}),R=()=>j(void 0,null,function*(){let t=n;t?a&&(yield M(y(m,"supportChats",t),{fcmToken:a})):(t=re(),_(t),sessionStorage.setItem("supportChatId",t),yield he(y(m,"supportChats",t),{createdAt:new Date().toISOString(),lastUpdated:new Date().toISOString(),status:"active",language:u,userId:(s==null?void 0:s.id)||"guest",fcmToken:a})),h("live_chat")}),F=t=>j(void 0,null,function*(){if(t.preventDefault(),!f.trim()||!n)return;const x=f;E("");try{yield z(C(m,"supportChats",n,"messages"),{text:x,sender:"user",timestamp:new Date().toISOString()}),yield fetch("https://telegrambot-gde2vv2rxa-el.a.run.app/sendMessageToTelegram",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:n,text:x,userLanguage:u,userId:(s==null?void 0:s.id)||"Guest"})})}catch(w){console.error("Error sending message",w)}}),o={en:{header:"Support",welcome:"How can we help you today?",reqCall:"Request a Call",liveChat:"Live Chat",name:"Name",phone:"Phone Number",submit:"Submit",sent:"Request sent! We will call you shortly.",typePlaceholder:"Type a message...",waiting:"An agent will be with you shortly."},si:{header:"සහාය",welcome:"අපට ඔබට කෙසේද උදව් කළ හැක්කේ?",reqCall:"ඇමතුමක් ඉල්ලන්න",liveChat:"සජීවී කතාබහ",name:"නම",phone:"දුරකථන අංකය",submit:"යවන්න",sent:"ඉල්ලීම යැව්වා! අපි ළඟදීම ඔබට කතා කරන්නෙමු.",typePlaceholder:"පණිවිඩයක් ලියන්න...",waiting:"නියෝජිතයෙකු ළඟදීම සම්බන්ධ වනු ඇත."}}[u];if(!r.isEnabled)return null;if(i==="minimised")return e.jsxs("div",{className:"fixed bottom-20 md:bottom-8 right-6 z-[60] flex flex-col items-end group",children:[e.jsxs("span",{className:"absolute flex h-4 w-4 -top-1 -right-1 z-[61]",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-4 w-4 bg-red-500 border-2 border-white"})]}),e.jsxs("button",{onClick:()=>h("language_select"),className:"flex items-center p-4 bg-gradient-to-tr from-primary to-blue-500 text-white rounded-2xl shadow-xl hover:shadow-primary/40 transition-all duration-300 transform hover:scale-110 active:scale-95","aria-label":"Chat Now",children:[e.jsx(S,{className:"w-8 h-8 group-hover:rotate-12 transition-transform duration-300"}),e.jsx("span",{className:"max-w-0 overflow-hidden group-hover:max-w-xs group-hover:ml-3 transition-all duration-500 ease-in-out whitespace-nowrap font-bold",children:"Chat with us"})]})]});const X=c?"w-[90vw] sm:w-96 h-[550px]":"w-72 h-16";return e.jsxs("div",{className:`fixed bottom-20 md:bottom-8 right-6 z-[60] bg-white dark:bg-dark-surface rounded-2xl shadow-[0_20px_50px_rgba(0,0,0,0.2)] border border-slate-200 dark:border-dark-border flex flex-col transition-all duration-500 ease-in-out ${X}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-primary to-primary-dark text-white rounded-t-2xl flex-shrink-0 cursor-pointer shadow-md",onClick:()=>!c&&b(!0),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white/20 p-2 rounded-xl backdrop-blur-md",children:e.jsx(S,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-sm leading-tight",children:o.header}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-[10px] text-white/80 uppercase tracking-widest font-bold",children:"Online"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),b(!c)},className:"p-1.5 hover:bg-white/10 rounded-lg transition-colors",children:c?e.jsx(le,{className:"w-5 h-5"}):e.jsx(oe,{className:"w-5 h-5"})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),L()},className:"p-1.5 hover:bg-white/10 rounded-lg transition-colors text-white/80 hover:text-white",children:e.jsx(ne,{className:"w-5 h-5"})})]})]}),c&&e.jsxs("div",{className:"flex-1 overflow-y-auto p-5 flex flex-col bg-slate-50/30 dark:bg-transparent",children:[i==="language_select"&&e.jsxs("div",{className:"flex flex-col gap-4 h-full justify-center",children:[e.jsx("p",{className:"text-center font-bold text-slate-600 dark:text-slate-300 mb-2",children:"Select Language / භාෂාව තෝරන්න"}),e.jsx("button",{onClick:()=>O("en"),className:"p-4 bg-white dark:bg-dark-background border border-slate-200 dark:border-dark-border rounded-xl font-bold hover:border-primary hover:text-primary hover:shadow-md transition-all",children:"English"}),e.jsx("button",{onClick:()=>O("si"),className:"p-4 bg-white dark:bg-dark-background border border-slate-200 dark:border-dark-border rounded-xl font-bold hover:border-primary hover:text-primary hover:shadow-md transition-all text-lg",children:"සිංහල"})]}),i==="type_select"&&e.jsxs("div",{className:"flex flex-col gap-4 h-full justify-center",children:[e.jsx("p",{className:"text-center font-bold text-xl text-slate-800 dark:text-white mb-4",children:o.welcome}),e.jsxs("button",{onClick:()=>h("request_call"),className:"group flex items-center gap-4 p-5 bg-white dark:bg-dark-background border border-slate-200 dark:border-dark-border rounded-2xl hover:border-primary hover:shadow-lg transition-all",children:[e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 text-primary rounded-xl group-hover:bg-primary group-hover:text-white transition-all",children:e.jsx(ie,{className:"w-6 h-6"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-bold",children:o.reqCall}),e.jsx("p",{className:"text-xs text-slate-500",children:"Fast callback support"})]})]}),e.jsxs("button",{onClick:R,className:"group flex items-center gap-4 p-5 bg-white dark:bg-dark-background border border-slate-200 dark:border-dark-border rounded-2xl hover:border-primary hover:shadow-lg transition-all",children:[e.jsx("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 text-green-600 rounded-xl group-hover:bg-green-600 group-hover:text-white transition-all",children:e.jsx(S,{className:"w-6 h-6"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-bold",children:o.liveChat}),e.jsx("p",{className:"text-xs text-slate-500",children:"Chat with an agent"})]})]})]}),i==="request_call"&&e.jsx("div",{className:"h-full flex flex-col justify-center",children:W?e.jsxs("div",{className:"text-center space-y-3 p-6 bg-green-50 dark:bg-green-900/10 rounded-2xl border border-green-100 dark:border-green-900/30",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-green-500 text-white rounded-full text-2xl",children:"✓"}),e.jsx("p",{className:"font-bold text-green-700 dark:text-green-400",children:o.sent})]}):e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsx("h4",{className:"font-bold text-center text-lg mb-2",children:o.reqCall}),e.jsx("input",{type:"text",placeholder:o.name,value:I,onChange:t=>B(t.target.value),className:"w-full p-3 border rounded-xl dark:bg-dark-background dark:border-dark-border focus:ring-2 focus:ring-primary/20 outline-none transition-all",required:!0}),e.jsx("input",{type:"tel",placeholder:o.phone,value:q,onChange:t=>H(t.target.value),className:"w-full p-3 border rounded-xl dark:bg-dark-background dark:border-dark-border focus:ring-2 focus:ring-primary/20 outline-none transition-all",required:!0}),e.jsx("button",{type:"submit",className:"w-full bg-primary text-white py-3 rounded-xl font-bold shadow-lg shadow-primary/30 hover:bg-primary-dark transition-all transform active:scale-95",children:o.submit})]})}),i==="live_chat"&&e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto mb-4 space-y-4 pr-1",children:[k.length===0&&e.jsx("div",{className:"text-center text-[12px] text-slate-400 dark:text-slate-500 mt-4 bg-slate-100/50 dark:bg-slate-800/50 p-2 rounded-lg italic",children:o.waiting}),k.map(t=>e.jsx("div",{className:`flex ${t.sender==="user"?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[85%] p-3.5 rounded-2xl text-sm shadow-sm ${t.sender==="user"?"bg-primary text-white rounded-tr-none":"bg-white dark:bg-slate-800 text-slate-800 dark:text-slate-200 rounded-tl-none border border-slate-100 dark:border-slate-700"}`,children:t.text})},t.id)),e.jsx("div",{ref:T})]}),e.jsxs("form",{onSubmit:F,className:"flex gap-2 p-2 bg-white dark:bg-dark-background border border-slate-200 dark:border-dark-border rounded-2xl shadow-inner focus-within:border-primary transition-all",children:[e.jsx("input",{type:"text",value:f,onChange:t=>E(t.target.value),placeholder:o.typePlaceholder,className:"flex-1 bg-transparent px-2 py-1 focus:outline-none text-sm"}),e.jsx("button",{type:"submit",disabled:!f.trim(),className:"p-2.5 bg-primary text-white rounded-xl disabled:opacity-40 hover:scale-105 active:scale-95 transition-all",children:e.jsx(xe,{className:"w-5 h-5"})})]})]})]})]})};export{fe as default};
