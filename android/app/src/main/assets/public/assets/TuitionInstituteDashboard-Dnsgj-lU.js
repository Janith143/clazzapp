var Ae=Object.defineProperty,De=Object.defineProperties;var Re=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var ie=(s,c,d)=>c in s?Ae(s,c,{enumerable:!0,configurable:!0,writable:!0,value:d}):s[c]=d,E=(s,c)=>{for(var d in c||(c={}))oe.call(c,d)&&ie(s,d,c[d]);if(J)for(var d of J(c))ce.call(c,d)&&ie(s,d,c[d]);return s},A=(s,c)=>De(s,Re(c));var me=(s,c)=>{var d={};for(var m in s)oe.call(s,m)&&c.indexOf(m)<0&&(d[m]=s[m]);if(s!=null&&J)for(var m of J(s))c.indexOf(m)<0&&ce.call(s,m)&&(d[m]=s[m]);return d};var te=(s,c,d)=>new Promise((m,b)=>{var g=t=>{try{N(d.next(t))}catch(f){b(f)}},j=t=>{try{N(d.throw(t))}catch(f){b(f)}},N=t=>t.done?m(t.value):Promise.resolve(t.value).then(g,j);N((d=d.apply(s,c)).next())});import{u as ne,d as V,r as h,t as Pe,n as se,s as ae,j as e,F as Oe,G as R,I as L,J as Le,X as $e,N as ge,i as Fe,l as Be,D as ze,y as Ye,U as qe,ak as _e,al as Ue,P as Ke,T as Ge,R as We,K as pe,b as He,C as Je,z as re,V as ue,w as Ve,am as Xe,e as Ze}from"./index-BXN-gaEy.js";import{S as le}from"./SearchableSelect-Dgx7XP55.js";import{T as Qe,A as et}from"./AttendanceSummaryTable-DaIVNjyM.js";import{C as tt}from"./ClassCard-BBTr9XzW.js";import{C as he}from"./ConfirmationModal-CVK0Y9X0.js";import"./vendor-firebase-CLtQg3ae.js";import"./StarRating-BeOC4AZb.js";import"./slug-Be7lxzw5.js";const xe={teacherId:"",title:"",subject:"",description:"",date:"",startTime:"",endTime:"",fee:0,currency:"LKR",targetAudience:"",mode:"Online",recurrence:"none",status:"scheduled",isPublished:!1,paymentMethod:"platform",documentLink:"",medium:"",grade:""},st=({isOpen:s,onClose:c,onSave:d,instituteId:m,initialData:b})=>{const{subjects:g}=ne(),{teachers:j,tuitionInstitutes:N}=V(),[t,f]=h.useState({}),[w,k]=h.useState(""),p=h.useMemo(()=>N.find(a=>a.id===m),[N,m]),z=p==null?void 0:p.name,P=h.useMemo(()=>j.find(a=>a.id===t.teacherId),[j,t.teacherId]),S=(P==null?void 0:P.teachingItems)||[],C=S.length>0,X=h.useMemo(()=>j.filter(a=>a.registrationStatus==="approved").map(a=>({value:a.id,label:`${a.name} (${a.id})`})),[j]),K=h.useMemo(()=>{if(C){const a=Array.from(new Set(S.map(n=>n.audience))).map(n=>({value:n,label:n}));return t.targetAudience&&!a.some(n=>n.value===t.targetAudience)&&a.push({value:t.targetAudience,label:t.targetAudience}),a}return Pe},[C,S,t.targetAudience]),$=h.useMemo(()=>{if(C){const n=Array.from(new Set(S.filter(l=>l.audience===t.targetAudience).map(l=>l.subject))).map(l=>({value:l,label:l}));return t.subject&&!n.some(l=>l.value===t.subject)&&n.push({value:t.subject,label:t.subject}),n}return g[t.targetAudience||""]||[]},[C,S,t.targetAudience,g,t.subject]),Z=h.useMemo(()=>{if(C){const a=new Set;S.filter(l=>l.audience===t.targetAudience&&l.subject===t.subject).forEach(l=>l.mediums.forEach(T=>a.add(T)));const n=Array.from(a).map(l=>({value:l,label:l}));return t.medium&&!n.some(l=>l.value===t.medium)&&n.push({value:t.medium,label:t.medium}),n}return[]},[C,S,t.targetAudience,t.subject,t.medium]),Y=h.useMemo(()=>{if(C){const a=new Set;S.filter(l=>l.audience===t.targetAudience&&l.subject===t.subject).forEach(l=>l.grades.forEach(T=>a.add(T)));const n=Array.from(a).map(l=>({value:l,label:l}));return t.grade&&!n.some(l=>l.value===t.grade)&&n.push({value:t.grade,label:t.grade}),n}return[]},[C,S,t.targetAudience,t.subject,t.grade]);h.useEffect(()=>{var a;if(s)if(k(""),b)f(A(E({},b),{fee:b.fee.toString(),institute:b.institute||z,medium:b.medium||"",grade:b.grade||""}));else{let n="",l="";if(p!=null&&p.address){const T=p.address.state,v=p.address.city;if(se.includes(T))n=T,(a=ae[n])!=null&&a.includes(v)&&(l=v);else{const o=se.find(B=>{var W;return(W=ae[B])==null?void 0:W.includes(v)});o&&(n=o,l=v)}}f(A(E({},xe),{instituteId:m,institute:z,fee:"",district:n,town:l}))}},[s,b,m,z,p]);const u=a=>{const{name:n,value:l}=a.target;f(T=>{const v=A(E({},T),{[n]:l});return n==="mode"&&l==="Online"&&(v.paymentMethod="platform"),n==="targetAudience"&&C&&(v.subject="",v.medium="",v.grade=""),n==="subject"&&C&&(v.medium="",v.grade=""),v})},q=a=>{f(n=>A(E({},n),{teacherId:a,targetAudience:"",subject:"",medium:"",grade:""}))},G=a=>{f(n=>A(E({},n),{district:a,town:""}))},F=h.useMemo(()=>{if(!t.district)return[];const a=ae[t.district]||[];return[{value:"",label:"Select a town"},...a.map(n=>({value:n,label:n}))]},[t.district]),Q=a=>{if(a.preventDefault(),k(""),!t.teacherId){k("You must select a teacher.");return}if(p&&P&&P.commissionRate>p.commissionRate){k(`Institute commission rate (${p.commissionRate}%) cannot be lower than the teacher's base rate (${P.commissionRate}%).`);return}d(A(E(E({},xe),t),{id:(b==null?void 0:b.id)||Date.now(),fee:parseFloat(t.fee)||0}))},_=b?"Edit Class Details":"Schedule New Class for Institute";return e.jsx(Oe,{isOpen:s,onClose:c,title:_,size:"3xl",children:e.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[e.jsx(le,{label:"Select Teacher",options:X,value:t.teacherId||"",onChange:q,placeholder:"Search for a registered teacher by name or ID...",disabled:!!b}),e.jsx(R,{label:"Class Title",name:"title",value:t.title||"",onChange:u,required:!0}),e.jsx(L,{label:"Target Audience",name:"targetAudience",value:t.targetAudience||"",onChange:u,options:K,required:!0}),e.jsx(L,{label:"Subject",name:"subject",value:t.subject||"",onChange:u,options:$,required:!0}),C&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(L,{label:"Medium",name:"medium",value:t.medium||"",onChange:u,options:[{value:"",label:"Select Medium"},...Z]}),e.jsx(L,{label:"Grade",name:"grade",value:t.grade||"",onChange:u,options:[{value:"",label:"Select Grade"},...Y]})]}),e.jsx(Le,{label:"Description",id:"ti-class-description",name:"description",value:t.description||"",onChange:u,rows:3,placeholder:"Briefly describe the class"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(L,{label:"Recurrence",name:"recurrence",value:t.recurrence||"none",onChange:u,options:[{value:"none",label:"One-time"},{value:"weekly",label:"Weekly"}],required:!0}),e.jsx(R,{label:t.recurrence==="weekly"?"Start Date":"Date",name:"date",type:"date",value:t.date||"",onChange:u,required:!0})]}),t.recurrence==="weekly"&&e.jsx(R,{label:"End Date (Optional)",name:"endDate",type:"date",value:t.endDate||"",onChange:u}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(R,{label:"Start Time",name:"startTime",type:"time",value:t.startTime||"",onChange:u,required:!0}),e.jsx(R,{label:"End Time",name:"endTime",type:"time",value:t.endTime||"",onChange:u,required:!0}),e.jsxs("div",{children:[e.jsx(R,{label:"Fee (LKR)",name:"fee",type:"number",value:t.fee||"",onChange:u,required:!0}),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle mt-1",children:"Fee is per session. For recurring classes, this will be charged for each weekly session."})]})]}),e.jsx(L,{label:"Mode",name:"mode",value:t.mode||"Online",onChange:u,options:[{value:"Online",label:"Online"},{value:"Physical",label:"Physical"},{value:"Both",label:"Online & Physical"}],required:!0}),(t.mode==="Physical"||t.mode==="Both")&&e.jsxs("div",{className:"p-4 border border-light-border dark:border-dark-border rounded-md space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Physical Location & Payment"}),e.jsx(R,{label:"Institute / Hall Name",name:"institute",value:t.institute||"",onChange:u,disabled:!0}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(le,{label:"District",options:se.map(a=>({value:a,label:a})),value:t.district||"",onChange:G,placeholder:"Select a district"}),e.jsx(le,{label:"Town",options:F,value:t.town||"",onChange:a=>f(n=>A(E({},n),{town:a})),placeholder:"Select a district first",disabled:!t.district})]}),e.jsx(L,{label:"Payment Collection Method",name:"paymentMethod",value:t.paymentMethod||"platform",onChange:u,options:[{value:"platform",label:"Collect through clazz.lk (Recommended)"},{value:"manual",label:"Collect manually at venue"}],required:!0})]}),(t.mode==="Online"||t.mode==="Both")&&e.jsxs("div",{className:"p-4 border border-light-border dark:border-dark-border rounded-md space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Online Details"}),e.jsx(R,{label:"Online Joining Link (Zoom, Meet, etc.)",name:"joiningLink",type:"url",value:t.joiningLink||"",onChange:u,placeholder:"e.g., https://zoom.us/j/1234567890"}),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle -mt-3",children:"This link will only become visible to enrolled students after the class starts."}),e.jsx(R,{label:"Shared Document Link (Google Drive, etc.)",name:"documentLink",type:"url",value:t.documentLink||"",onChange:u,placeholder:"e.g., https://drive.google.com/drive/folders/..."}),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle -mt-3",children:"This link will be visible to students immediately after they enroll."})]}),w&&e.jsx("p",{className:"text-red-500 text-sm text-center",children:w}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-3",children:[e.jsxs("button",{type:"button",onClick:c,className:"inline-flex items-center justify-center px-4 py-2 border border-light-border dark:border-dark-border text-sm font-medium rounded-md shadow-sm text-light-text dark:text-dark-text bg-light-surface dark:bg-dark-surface hover:bg-light-border dark:hover:bg-dark-border/50",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark",children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Save Class"]})]})]})})},at=({status:s})=>{const c={scheduled:"bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300",live:"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300 animate-pulse",finished:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",canceled:"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300"};return e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full ${c[s]}`,children:s.charAt(0).toUpperCase()+s.slice(1)})},rt=({event:s,organizer:c,enrollmentCount:d,onView:m,onEdit:b,onCancel:g,onTogglePublish:j})=>{const N=new Date(s.startDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),t=Fe(s);return e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface rounded-lg shadow-md overflow-hidden flex flex-col group animate-fadeIn transition-transform duration-300 hover:-translate-y-1 hover:shadow-xl",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:Be(s.flyerImage,400),alt:s.title,className:"w-full h-40 object-cover"}),e.jsxs("div",{className:"absolute top-2 left-2 flex items-center gap-2",children:[e.jsx(at,{status:t}),!s.isPublished&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300",children:"Unpublished"})]})]}),e.jsxs("div",{className:"p-4 flex-grow flex flex-col",children:[e.jsx("h3",{className:"text-md font-bold text-light-text dark:text-dark-text",children:s.title}),e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-indigo-500 dark:text-indigo-400",children:s.category}),e.jsxs("div",{className:"mt-3 space-y-2 text-sm text-light-subtle dark:text-dark-subtle flex-grow",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ze,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:N})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),e.jsxs("span",{children:[s.startTime," - ",s.endTime]})]}),e.jsxs("div",{className:"flex items-center",title:`${d} enrolled students`,children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),e.jsxs("span",{children:[d," Enrolled"]})]})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-light-border dark:border-dark-border flex justify-between items-center",children:[e.jsx("button",{onClick:()=>m(s),className:"text-sm font-medium text-primary hover:underline",children:"View Details"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{onClick:()=>j(s.id),disabled:t!=="scheduled",className:"p-2 text-light-subtle dark:text-dark-subtle hover:text-primary dark:hover:text-primary-light transition-colors disabled:opacity-50",title:t!=="scheduled"?"Can only change publish status for scheduled events":s.isPublished?"Unpublish Event":"Publish Event","aria-label":s.isPublished?"Unpublish event":"Publish event",children:s.isPublished?e.jsx(_e,{className:"h-4 w-4"}):e.jsx(Ue,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>b(s),disabled:t==="canceled",className:"p-2 text-light-subtle dark:text-dark-subtle hover:text-primary dark:hover:text-primary-light transition-colors disabled:opacity-50",title:"Edit Event",children:e.jsx(Ke,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>g(s.id),disabled:t!=="scheduled",className:"p-2 text-red-500 hover:text-red-700 dark:hover:text-red-400 transition-colors disabled:opacity-50",title:t!=="scheduled"?"Cannot cancel an event that is not scheduled.":"Cancel event & refund students",children:e.jsx(Ge,{className:"h-4 w-4"})})]})]})]})]})},lt=({institute:s,onScheduleNew:c,onEdit:d,onCancel:m,onTogglePublish:b})=>{var f;const{sales:g}=V(),{handleNavigate:j}=ne(),N=We.useMemo(()=>{const w={};return g.filter(k=>k.instituteId===s.id&&k.status==="completed"&&k.itemType==="event").forEach(k=>{const p=`event_${k.itemId}`;w[p]=(w[p]||0)+1}),w},[g,s.id]),t=((f=s.events)==null?void 0:f.filter(w=>!w.isDeleted))||[];return e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("button",{onClick:c,className:"flex items-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary-dark transition-colors",children:[e.jsx(pe,{className:"h-4 h-4"}),e.jsx("span",{children:"Schedule New Event"})]})}),t.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(w=>e.jsx(rt,{event:w,organizer:s,enrollmentCount:N[`event_${w.id}`]||0,onView:k=>j({name:"event_detail",eventId:k.id}),onEdit:d,onCancel:m,onTogglePublish:b},w.id))}):e.jsxs("div",{className:"text-center py-16 text-light-subtle dark:text-dark-subtle",children:[e.jsx("p",{className:"text-xl font-semibold",children:"No events scheduled yet."}),e.jsx("p",{children:'Click "Schedule New Event" to get started.'})]})]})},nt=s=>e.jsx("svg",A(E({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor"},s),{children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0h18M12 12.75h.008v.008H12v-.008z"})})),be=({title:s,value:c,icon:d})=>e.jsx("div",{className:"bg-light-surface dark:bg-dark-surface p-5 rounded-lg shadow-md border border-light-border dark:border-dark-border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-primary/10 text-primary rounded-lg mr-4",children:d}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-light-subtle dark:text-dark-subtle",children:s}),e.jsx("p",{className:"text-3xl font-bold text-light-text dark:text-dark-text",children:c})]})]})}),dt=({institute:s})=>{const{updateTuitionInstitute:c}=V(),{addToast:d}=Ze(),[m,b]=h.useState(s.commissionRate.toString()),[g,j]=h.useState(!1),N=()=>te(void 0,null,function*(){const t=parseFloat(m);if(isNaN(t)){d("Please enter a valid number for commission rate.","error");return}if(t<s.platformMarkupRate){d(`Your class commission rate must be at least ${s.platformMarkupRate}% to cover platform fees.`,"error");return}j(!0);try{yield c(s.id,{commissionRate:t}),d("Settings updated successfully!","success")}catch(f){d("Failed to update settings.","error")}finally{j(!1)}});return e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md max-w-lg mx-auto",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Institute Settings"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"commissionRate",className:"block text-sm font-medium text-light-text dark:text-dark-text mb-1",children:"Your Revenue % (for Classes)"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"commissionRate",type:"number",value:m,onChange:t=>b(t.target.value),min:s.platformMarkupRate,step:"0.5",className:"w-full px-3 py-2 border border-light-border dark:border-dark-border placeholder-light-subtle dark:placeholder-dark-subtle text-light-text dark:text-dark-text bg-light-background dark:bg-dark-background rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"}),e.jsx("span",{className:"ml-2 text-lg font-medium",children:"%"})]}),e.jsxs("p",{className:"text-xs text-light-subtle dark:text-dark-subtle mt-1",children:["Your earnings from platform class sales. Platform markup is ",s.platformMarkupRate,"%."]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:N,disabled:g||m===s.commissionRate.toString(),className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark disabled:opacity-50",children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),g?"Saving...":"Save Changes"]})})]})]})},pt=({instituteId:s,isAdminView:c=!1})=>{const{currentUser:d}=He(),{tuitionInstitutes:m,teachers:b,sales:g,users:j,handleSaveClass:N,handleCancelItem:t,handleTogglePublishState:f,handleResetTeacherBalance:w,processMonthlyPayouts:k,handleSaveEvent:p,handleCancelEvent:z,handleToggleEventPublishState:P}=V(),{handleNavigate:S}=ne(),[C,X]=h.useState("overview"),[K,$]=h.useState(!1),[Z,Y]=h.useState(null),[u,q]=h.useState(null),[G,F]=h.useState(!1),[Q,_]=h.useState(null),[a,n]=h.useState(null),[l,T]=h.useState(null),v=h.useRef(!1),o=h.useMemo(()=>c&&s?m.find(r=>r.id===s):m.find(r=>r.userId===(d==null?void 0:d.id)),[m,d,c,s]);h.useEffect(()=>{o!=null&&o.id&&!v.current&&(k("institute",o.id),v.current=!0)},[o==null?void 0:o.id,k]);const B=h.useMemo(()=>o?b.flatMap(r=>r.individualClasses.filter(x=>x.instituteId===o.id).map(x=>A(E({},x),{teacher:r}))).sort((r,x)=>new Date(x.date).getTime()-new Date(r.date).getTime()):[],[o,b]),W=h.useMemo(()=>{if(!o)return{};const r={};return g.filter(x=>x.instituteId===o.id&&x.status==="completed"&&x.itemType==="class").forEach(x=>{const i=`class_${x.itemId}`;r[i]=(r[i]||0)+1}),r},[g,o]),fe=r=>{N(r),$(!1),Y(null)},je=r=>{p(r),F(!1),_(null)},ke=r=>{_(r),F(!0)},ve=r=>{Y(r),$(!0)},de=(r,x)=>{q({id:r,type:x})},ye=()=>{if(!(!u||!o)){if(u.type==="class"){const r=B.find(x=>x.id===u.id);r&&t(r.teacherId,u.id,"class")}else u.type==="event"&&z(o.id,u.id);q(null)}},Ne=(r,x)=>{T({teacherId:r,teacherName:x})},we=()=>te(void 0,null,function*(){l&&o&&(yield w(o.id,l.teacherId),T(null))}),D=new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR"}),{last3MonthsEarnings:Ce,currentMonthEarnings:Se}=h.useMemo(()=>{if(!o)return{last3MonthsEarnings:[],currentMonthEarnings:0};const r=new Date,x=new Map;g.filter(y=>y.instituteId===o.id&&y.status==="completed").forEach(y=>{const O=new Date(y.saleDate),H=`${O.getFullYear()}-${O.getMonth()}`,ee=x.get(H)||0;x.set(H,ee+(y.instituteCommission||0))});const I=`${r.getFullYear()}-${r.getMonth()}`,M=x.get(I)||0,U=[];for(let y=1;y<=3;y++){const O=new Date(r.getFullYear(),r.getMonth()-y,1),H=O.getFullYear(),ee=O.getMonth(),Me=O.toLocaleString("default",{month:"long",year:"numeric"}),Ee=`${H}-${ee}`;U.push({monthName:Me,earnings:x.get(Ee)||0})}return{last3MonthsEarnings:U.reverse(),currentMonthEarnings:M}},[o,g]);if(!o)return e.jsx("div",{className:"p-8 text-center",children:"Loading institute data or profile not found..."});const Te=()=>{switch(C){case"classes":return e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("button",{onClick:()=>{Y(null),$(!0)},className:"flex items-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary-dark transition-colors",children:[e.jsx(pe,{className:"h-4 h-4"}),e.jsx("span",{children:"Schedule New Class"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:B.map(M=>{var U=M,{teacher:i}=U,I=me(U,["teacher"]);return e.jsx(tt,{classInfo:I,teacher:i,viewMode:"teacher",enrollmentCount:W[`class_${I.id}`]||0,onView:y=>S({name:"class_detail",classId:y.id}),onEdit:ve,onDelete:(y,O)=>de(y,"class"),onTogglePublish:y=>f(I.teacherId,y,"class")},I.id)})})]});case"events":return e.jsx(lt,{institute:o,onScheduleNew:()=>{_(null),F(!0)},onEdit:ke,onCancel:i=>de(i,"event"),onTogglePublish:i=>P(o.id,i)});case"attendance":return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Select a Class"}),e.jsx("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto pr-2",children:B.filter(i=>i.status==="scheduled").map(i=>e.jsxs("button",{onClick:()=>n(i),className:`w-full text-left p-3 border rounded-lg transition-colors ${(a==null?void 0:a.id)===i.id?"bg-primary/10 border-primary":"border-light-border dark:border-dark-border hover:bg-light-border dark:hover:bg-dark-border"}`,children:[e.jsx("p",{className:"font-bold",children:i.title}),e.jsxs("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:[i.subject," - ",new Date(i.date).toLocaleDateString()]})]},i.id))})]}),e.jsx("div",{className:"md:col-span-2",children:a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Attendance for: ",a.title]}),e.jsx("button",{onClick:()=>S({name:"attendance_scanner",classId:a.id}),className:"px-4 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary-dark",children:"Open Scanner"})]}),e.jsx(et,{classInfo:a})]}):e.jsx("div",{className:"h-full flex items-center justify-center text-center p-8 bg-light-background dark:bg-dark-background rounded-lg",children:e.jsx("p",{className:"text-light-subtle dark:text-dark-subtle",children:"Select a class from the left to view attendance records and open the scanner."})})})]});case"earnings":const r=g.filter(i=>i.instituteId===o.id&&i.paymentMethod==="manual_at_venue"),x=o.teacherManualBalances?Object.entries(o.teacherManualBalances):[];return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-light-text dark:text-dark-text",children:"Balances Owed to Teachers (from Manual Collections)"}),e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle mb-4",children:"This balance is settled directly between you and the teacher. After paying, use the reset button to clear their balance on the platform."}),x.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-light-border dark:divide-dark-border text-sm",children:[e.jsx("thead",{className:"bg-light-background dark:bg-dark-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Teacher"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Balance Owed"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Last Paid"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-light-border dark:divide-dark-border",children:x.map(([i,I])=>{const M=I;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap font-medium text-light-text dark:text-dark-text",children:M.teacherName}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right font-bold text-lg text-primary",children:D.format(M.balance)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-light-text dark:text-dark-text",children:M.lastReset?new Date(M.lastReset).toLocaleDateString():"Never"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx("button",{disabled:M.balance<=0,onClick:()=>Ne(i,M.teacherName),className:"px-3 py-1 text-xs font-medium text-white bg-primary rounded-md hover:bg-primary-dark disabled:bg-gray-400",children:"Pay & Reset Balance"})})]},i)})})]})}):e.jsx("p",{className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:"No outstanding balances with teachers from manual collections."})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-light-text dark:text-dark-text",children:"Manual Collections Log"}),r.length>0?e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"min-w-full divide-y divide-light-border dark:divide-dark-border text-sm",children:[e.jsx("thead",{className:"bg-light-background dark:bg-dark-background sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Class"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Collected"}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Teacher's Share"}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Your Income"}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Platform Fee"})]})}),e.jsx("tbody",{className:"divide-y divide-light-border dark:divide-dark-border",children:r.map(i=>{const I=j.find(M=>M.id===i.studentId);return e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-light-text dark:text-dark-text",children:new Date(i.saleDate).toLocaleDateString()}),e.jsx("td",{className:"px-3 py-3 text-light-text dark:text-dark-text",children:i.itemName}),e.jsx("td",{className:"px-3 py-3 text-light-text dark:text-dark-text",children:I?`${I.firstName} ${I.lastName}`:"N/A"}),e.jsx("td",{className:"px-3 py-3 text-right font-semibold text-light-text dark:text-dark-text",children:D.format(i.amountPaidFromBalance)}),e.jsx("td",{className:"px-3 py-3 text-right text-light-text dark:text-dark-text",children:D.format(i.teacherCommission||0)}),e.jsx("td",{className:"px-3 py-3 text-right text-green-600 font-semibold",children:D.format(i.instituteCommission||0)}),e.jsx("td",{className:"px-3 py-3 text-right text-red-600",children:D.format(i.platformCommission||0)})]},i.id)})})]})}):e.jsx("p",{className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:"No manual payments have been recorded yet."})]})]});case"profile":return e.jsx(dt,{institute:o});case"overview":default:return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 items-start",children:[e.jsxs("div",{className:"lg:col-span-1 bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Available Funds"}),e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:"Accumulated balance from previous months."}),e.jsx("p",{className:"text-4xl font-bold text-primary mt-2",children:D.format(o.earnings.available)})]}),e.jsxs("div",{className:"pt-4 border-t border-light-border dark:border-dark-border",children:[e.jsx("h3",{className:"font-semibold text-light-text dark:text-dark-text",children:"This Month's Earnings (Pending)"}),e.jsx("p",{className:"text-2xl font-bold",children:D.format(Se)}),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle mt-1",children:"Available to withdraw on 15th of next month."})]}),e.jsxs("div",{className:"pt-4 border-t border-light-border dark:border-dark-border",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Withdraw Your Funds"}),e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:"To withdraw your available balance, please contact our finance department."}),e.jsxs("div",{className:"mt-4 p-3 bg-light-background dark:bg-dark-background rounded-md text-center border border-light-border dark:border-dark-border",children:[e.jsx("p",{className:"font-semibold text-md",children:"Contact for Withdrawals:"}),e.jsx("a",{href:"tel:0720768100",className:"text-xl font-bold text-primary tracking-wider hover:underline",children:"072-0768100"})]})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Recent Monthly Earnings"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Ce.map(i=>e.jsxs("div",{className:"p-4 bg-light-background dark:bg-dark-background rounded-lg text-center",children:[e.jsx("p",{className:"text-sm font-medium text-light-subtle dark:text-dark-subtle",children:i.monthName}),e.jsx("p",{className:"text-2xl font-bold text-light-text dark:text-dark-text mt-1",children:D.format(i.earnings)})]},i.monthName))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(be,{title:"Total Classes Scheduled",value:B.length,icon:e.jsx(ue,{className:"w-6 h-6"})}),e.jsx(be,{title:"Total Lifetime Earnings",value:D.format(o.earnings.total),icon:e.jsx(re,{className:"w-6 h-6"})})]})]})]})}},Ie=[{id:"overview",label:"Overview",icon:e.jsx(re,{className:"w-5 h-5 mr-2"})},{id:"classes",label:"Classes",icon:e.jsx(ue,{className:"w-5 h-5 mr-2"})},{id:"events",label:"Events",icon:e.jsx(nt,{className:"w-5 h-5 mr-2"})},{id:"attendance",label:"Attendance",icon:e.jsx(Ve,{className:"w-5 h-5 mr-2"})},{id:"earnings",label:"Earnings",icon:e.jsx(re,{className:"w-5 h-5 mr-2"})},{id:"profile",label:"Profile",icon:e.jsx(Xe,{className:"w-5 h-5 mr-2"})}];return e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8 animate-slideInUp",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("button",{onClick:()=>S({name:c?"admin_dashboard":"home"}),className:"flex items-center space-x-2 text-sm font-medium text-primary hover:text-primary-dark",children:[e.jsx(Je,{className:"h-5 h-5"}),e.jsxs("span",{children:["Back to ",c?"Admin Dashboard":"Home"]})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Institute Dashboard"}),e.jsxs("p",{className:"text-light-subtle dark:text-dark-subtle mt-1",children:["Welcome, ",o.name,"!"]})]}),e.jsx("div",{className:"border-b border-light-border dark:border-dark-border mb-8",children:e.jsx("nav",{className:"-mb-px flex space-x-8 overflow-x-auto","aria-label":"Tabs",children:Ie.map(r=>e.jsxs("button",{onClick:()=>X(r.id),className:`${C===r.id?"border-primary text-primary":"border-transparent text-light-subtle dark:text-dark-subtle hover:text-light-text dark:hover:text-dark-text hover:border-light-border dark:hover:border-dark-border"} flex items-center whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors`,children:[r.icon,r.label]},r.id))})}),e.jsx("div",{children:Te()}),K&&e.jsx(st,{isOpen:K,onClose:()=>$(!1),onSave:fe,instituteId:o.id,initialData:Z}),G&&e.jsx(Qe,{isOpen:G,onClose:()=>F(!1),onSave:je,organizerId:o.id,organizerType:"tuition_institute",initialData:Q}),u&&e.jsx(he,{isOpen:!0,onClose:()=>q(null),onConfirm:ye,title:`Cancel ${u.type}`,message:`Are you sure you want to cancel this ${u.type}? This will refund all enrolled students.`,confirmText:"Yes, Cancel"}),l&&e.jsx(he,{isOpen:!0,onClose:()=>T(null),onConfirm:we,title:`Reset Balance for ${l.teacherName}`,message:"This confirms you have paid the teacher their share of manual collections. It will reset their balance on the platform to zero. This cannot be undone.",confirmText:"Yes, I've Paid & Reset"})]})};export{pt as default};
