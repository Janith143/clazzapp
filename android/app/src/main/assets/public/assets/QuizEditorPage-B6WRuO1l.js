var U=Object.defineProperty,z=Object.defineProperties;var _=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var v=(t,n,r)=>n in t?U(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,l=(t,n)=>{for(var r in n||(n={}))I.call(n,r)&&v(t,r,n[r]);if(k)for(var r of k(n))C.call(n,r)&&v(t,r,n[r]);return t},o=(t,n)=>z(t,_(n));var Q=(t,n)=>{var r={};for(var i in t)I.call(t,i)&&n.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&k)for(var i of k(t))n.indexOf(i)<0&&C.call(t,i)&&(r[i]=t[i]);return r};var w=(t,n,r)=>new Promise((i,x)=>{var h=c=>{try{u(r.next(c))}catch(b){x(b)}},f=c=>{try{u(r.throw(c))}catch(b){x(b)}},u=c=>c.done?i(c.value):Promise.resolve(c.value).then(h,f);u((r=r.apply(t,n)).next())});import{j as e,T as D,Q as T,X as y,K as S,r as A,d as E,S as $,N as P}from"./index-BXN-gaEy.js";import"./vendor-firebase-CLtQg3ae.js";const R=({question:t,questionNumber:n,onChange:r,onDelete:i})=>{const x=d=>{r(o(l({},t),{text:d.target.value}))},h=d=>{r(o(l({},t),{imageUrl:d}))},f=()=>{const s=t,{imageUrl:d}=s,m=Q(s,["imageUrl"]);r(m)},u=(d,m)=>{const s=t.answers.map(a=>a.id===d?o(l({},a),{text:m}):a);r(o(l({},t),{answers:s}))},c=(d,m)=>{const s=t.answers.map(a=>a.id===d?o(l({},a),{isCorrect:m}):a);r(o(l({},t),{answers:s}))},b=()=>{if(t.answers.length>=6)return;const d={id:`a_${Date.now()}`,text:"",isCorrect:!1};r(o(l({},t),{answers:[...t.answers,d]}))},j=d=>{if(t.answers.length<=2)return;const m=t.answers.filter(s=>s.id!==d);r(o(l({},t),{answers:m}))};return e.jsxs("div",{className:"bg-light-background dark:bg-dark-background p-4 rounded-lg border border-light-border dark:border-dark-border",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("label",{className:"font-bold text-lg text-light-text dark:text-dark-text",children:["Question ",n]}),e.jsx("button",{type:"button",onClick:i,className:"p-1 text-red-500 hover:text-red-700 dark:hover:text-red-400",children:e.jsx(D,{className:"w-5 h-5"})})]}),e.jsx(T,{label:"Question Image (Optional)",currentImage:t.imageUrl||null,onImageChange:h,aspectRatio:"aspect-video"}),t.imageUrl&&e.jsx("button",{type:"button",onClick:f,className:"text-xs text-red-500 hover:underline mt-1",children:"Remove Image"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-light-text dark:text-dark-text mb-1",children:"Question Text"}),e.jsx("textarea",{value:t.text,onChange:x,placeholder:"Type your question here...",rows:3,className:"w-full p-2 border border-light-border dark:border-dark-border rounded-md bg-light-surface dark:bg-dark-surface focus:outline-none focus:ring-primary focus:border-primary"})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Answers (check the correct one/s)"}),t.answers.map((d,m)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:d.isCorrect,onChange:s=>c(d.id,s.target.checked),className:"h-5 w-5 text-primary focus:ring-primary border-light-border dark:border-dark-border rounded"}),e.jsx("input",{type:"text",value:d.text,onChange:s=>u(d.id,s.target.value),placeholder:`Answer ${m+1}`,className:"flex-grow p-2 border border-light-border dark:border-dark-border rounded-md bg-light-surface dark:bg-dark-surface focus:outline-none focus:ring-primary focus:border-primary"}),t.answers.length>2&&e.jsx("button",{type:"button",onClick:()=>j(d.id),className:"p-1 text-light-subtle dark:text-dark-subtle hover:text-red-500",children:e.jsx(y,{className:"w-4 h-4"})})]},d.id))]}),t.answers.length<6&&e.jsx("div",{className:"mt-4",children:e.jsxs("button",{type:"button",onClick:b,className:"flex items-center space-x-2 text-sm text-primary hover:text-primary-dark",children:[e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{children:"Add Answer"})]})})]})},F=({quizData:t,teacherId:n,onSave:r,onCancel:i})=>{const[x,h]=A.useState(t),{handleImageSave:f}=E(),[u,c]=A.useState(!1),b=s=>{h(a=>o(l({},a),{questions:a.questions.map(g=>g.id===s.id?s:g)}))},j=()=>{const s={id:`q_${Date.now()}`,text:"",answers:[{id:`a_${Date.now()}_1`,text:"",isCorrect:!1},{id:`a_${Date.now()}_2`,text:"",isCorrect:!1}]};h(a=>o(l({},a),{questions:[...a.questions,s]}))},d=s=>{h(a=>o(l({},a),{questions:a.questions.filter(g=>g.id!==s)}))},m=s=>w(void 0,null,function*(){s.preventDefault(),c(!0);try{const a=yield Promise.all(x.questions.map(p=>w(void 0,null,function*(){if(p.imageUrl&&p.imageUrl.startsWith("data:image")){const N=yield f(p.imageUrl,"quiz_question_image",{quizId:x.id,questionId:p.id});if(N)return o(l({},p),{imageUrl:N})}return p}))),g=o(l({},x),{questions:a});yield r(g),i()}catch(a){console.error("Failed to save quiz with images:",a)}finally{c(!1)}});return e.jsx("div",{className:"max-w-4xl mx-auto animate-slideInUp p-4",children:e.jsxs("form",{onSubmit:m,children:[e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-8 rounded-lg shadow-md",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-light-text dark:text-dark-text",children:"Quiz Editor"}),e.jsx("p",{className:"text-lg text-primary mt-1",children:x.title}),e.jsx("p",{className:"text-light-subtle dark:text-dark-subtle mt-1",children:"Add, edit, and arrange questions for your quiz."})]}),e.jsx("button",{type:"button",onClick:i,className:"inline-flex items-center justify-center p-2 rounded-full text-light-subtle dark:text-dark-subtle hover:bg-light-border dark:hover:bg-dark-border transition-colors",children:e.jsx(y,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"space-y-6",children:x.questions.map((s,a)=>e.jsx(R,{question:s,questionNumber:a+1,onChange:b,onDelete:()=>d(s.id)},s.id))}),e.jsx("div",{className:"mt-6",children:e.jsxs("button",{type:"button",onClick:j,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 text-sm font-medium text-primary border-2 border-dashed border-primary/50 rounded-md hover:bg-primary/10 transition-colors",children:[e.jsx(S,{className:"h-5 h-5"}),e.jsx("span",{children:"Add Question"})]})})]}),e.jsxs("div",{className:"mt-8 pt-6 flex justify-end space-x-4",children:[e.jsxs("button",{type:"button",onClick:i,className:"inline-flex items-center justify-center px-6 py-2 border border-light-border dark:border-dark-border text-sm font-medium rounded-md shadow-sm text-light-text dark:text-dark-text bg-light-surface dark:bg-dark-surface hover:bg-light-border dark:hover:bg-dark-border/50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-light transition-colors",children:[e.jsx(y,{className:"w-5 h-5 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:u,className:"inline-flex items-center justify-center px-6 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-light transition-colors disabled:opacity-50",children:[u?e.jsx($,{className:"w-5 h-5 mr-2"}):e.jsx(P,{className:"w-5 h-5 mr-2"}),u?"Saving...":"Save Quiz"]})]})]})})};export{F as default};
