var be=Object.defineProperty,xe=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var O=(l,o,d)=>o in l?be(l,o,{enumerable:!0,configurable:!0,writable:!0,value:d}):l[o]=d,c=(l,o)=>{for(var d in o||(o={}))pe.call(o,d)&&O(l,d,o[d]);if(G)for(var d of G(o))fe.call(o,d)&&O(l,d,o[d]);return l},h=(l,o)=>xe(l,ge(o));var K=(l,o,d)=>new Promise((y,x)=>{var S=n=>{try{v(d.next(n))}catch(k){x(k)}},g=n=>{try{v(d.throw(n))}catch(k){x(k)}},v=n=>n.done?y(n.value):Promise.resolve(n.value).then(S,g);v((d=d.apply(l,o)).next())});import{r as j,j as e,F as ve,G as f,J as B,N as J,u as je,d as ye,X as W,I as $,Q as ke,K as we,P as Ne,T as Y,S as Se,_ as Ce}from"./index-BXN-gaEy.js";import"./vendor-firebase-CLtQg3ae.js";const H={title:"",description:"",videoUrl:"",resourcesUrl:"",durationMinutes:0,isFreePreview:!1},Me=({isOpen:l,onClose:o,onSave:d,lecture:y})=>{const[x,S]=j.useState(H);j.useEffect(()=>{l&&S(y||H)},[l,y]);const g=n=>{const{name:k,value:L,type:I}=n.target;if(I==="checkbox"){const{checked:M}=n.target;S(s=>h(c({},s),{[k]:M}))}else S(M=>h(c({},M),{[k]:L}))},v=n=>{n.preventDefault(),d(h(c({},x),{id:(y==null?void 0:y.id)||`l_${Date.now()}`,durationMinutes:Number(x.durationMinutes)||0}))};return e.jsx(ve,{isOpen:l,onClose:o,title:y?"Edit Lecture":"Add New Lecture",children:e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsx(f,{label:"Lecture Title",name:"title",value:x.title,onChange:g,required:!0}),e.jsx(B,{label:"Description",id:"description",name:"description",value:x.description,onChange:g,rows:3}),e.jsx(f,{label:"Video URL",name:"videoUrl",value:x.videoUrl,onChange:g,placeholder:"e.g., https://vimeo.com/12345"}),e.jsx(f,{label:"Resources URL (Google Drive, etc.)",name:"resourcesUrl",value:x.resourcesUrl||"",onChange:g,placeholder:"e.g., https://drive.google.com/..."}),e.jsx(f,{label:"Duration (minutes)",name:"durationMinutes",type:"number",value:x.durationMinutes.toString(),onChange:g}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"isFreePreview",name:"isFreePreview",type:"checkbox",checked:x.isFreePreview,onChange:g,className:"h-4 w-4 text-primary focus:ring-primary border-light-border dark:border-dark-border rounded"}),e.jsx("label",{htmlFor:"isFreePreview",className:"ml-2 block text-sm text-light-text dark:text-dark-text",children:"Make this a free preview lecture"})]}),e.jsx("div",{className:"pt-4 flex justify-end",children:e.jsxs("button",{type:"submit",className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-light transition-colors",children:[e.jsx(J,{className:"w-5 h-5 mr-2"}),y?"Save Changes":"Add Lecture"]})})]})})},Pe=({courseData:l,teacherId:o,onSave:d,onCancel:y})=>{var R;const{allSubjects:x}=je(),{teachers:S}=ye(),g=j.useMemo(()=>S.find(t=>t.id===o),[S,o]),v=(g==null?void 0:g.teachingItems)||[],n=v.length>0,k=(g==null?void 0:g.subjects)||[],L=k.length>0,I=n?v[0].subject:L?k[0]:((R=x[0])==null?void 0:R.value)||"",M={id:`c_${Date.now()}`,teacherId:o,title:"",description:"",subject:I,coverImage:"",fee:0,currency:"LKR",type:"recorded",paymentPlan:"full",lectures:[],liveSessions:[],isPublished:!1,ratings:[],adminApproval:"not_requested",medium:"",grade:""},[s,C]=j.useState(l?c(c({},M),l):M),[V,F]=j.useState(!1),[X,E]=j.useState(null),[P,U]=j.useState(!1),[u,T]=j.useState({startDate:"",startTime:"",durationMinutes:60,weekCount:4,days:[]});j.useEffect(()=>{l&&l.type==="live"&&l.scheduleConfig&&T(l.scheduleConfig)},[l]);const Q=j.useMemo(()=>{let t=[];return n?t=Array.from(new Set(v.map(r=>r.subject))).map(r=>({value:r,label:r})):L?t=k.map(a=>({value:a,label:a})):t=x,s.subject&&!t.some(a=>a.value===s.subject)&&t.push({value:s.subject,label:s.subject}),t},[n,v,L,k,x,s.subject]),z=j.useMemo(()=>{if(n){const t=new Set;v.filter(r=>r.subject===s.subject).forEach(r=>r.mediums.forEach(i=>t.add(i)));const a=Array.from(t).map(r=>({value:r,label:r}));return s.medium&&!a.some(r=>r.value===s.medium)&&a.push({value:s.medium,label:s.medium}),a}return[]},[n,v,s.subject,s.medium]),Z=j.useMemo(()=>{if(n){const t=new Set;v.filter(r=>r.subject===s.subject).forEach(r=>r.grades.forEach(i=>t.add(i)));const a=Array.from(t).map(r=>({value:r,label:r}));return s.grade&&!a.some(r=>r.value===s.grade)&&a.push({value:s.grade,label:s.grade}),a}return[]},[n,v,s.subject,s.grade]),ee=j.useCallback(()=>{F(!1),E(null)},[]),w=t=>{const{name:a,value:r}=t.target;C(i=>{const b=h(c({},i),{[a]:a==="fee"?parseFloat(r)||0:r});return a==="subject"&&n&&(b.medium="",b.grade=""),b})},te=t=>{C(a=>h(c({},a),{coverImage:t}))},A=t=>{E(t),F(!0)},se=t=>{const a=s.lectures.findIndex(i=>i.id===t.id);let r=[...s.lectures];a>-1?r[a]=t:r.push(t),C(i=>h(c({},i),{lectures:r})),F(!1),E(null)},ae=t=>{C(a=>h(c({},a),{lectures:a.lectures.filter(r=>r.id!==t)}))},re=t=>{T(a=>{const r=a.days.includes(t)?a.days.filter(i=>i!==t):[...a.days,t].sort();return h(c({},a),{days:r})})},le=()=>{if(!u.startDate||!u.startTime||u.days.length===0){alert("Please fill in Start Date, Time and select at least one Day.");return}const t=[],a=new Date(`${u.startDate}T${u.startTime}`),r=u.durationMinutes*6e4,i=u.weekCount*7;let b=1;for(let p=0;p<i;p++){const N=new Date(a);if(N.setDate(a.getDate()+p),u.days.includes(N.getDay())){const ie=N.getFullYear(),oe=String(N.getMonth()+1).padStart(2,"0"),de=String(N.getDate()).padStart(2,"0"),ce=`${ie}-${oe}-${de}`,_=new Date(N.getTime()+r),ue=String(_.getHours()).padStart(2,"0"),me=String(_.getMinutes()).padStart(2,"0"),he=`${ue}:${me}`,m=s.liveSessions&&s.liveSessions[b-1];t.push({id:(m==null?void 0:m.id)||Ce(),title:(m==null?void 0:m.title)||`Session ${b}: [Topic]`,description:(m==null?void 0:m.description)||"",date:ce,startTime:u.startTime,endTime:he,status:"scheduled",resourceLink:(m==null?void 0:m.resourceLink)||"",joinLink:(m==null?void 0:m.joinLink)||"",recordingLink:(m==null?void 0:m.recordingLink)||""}),b++}}C(p=>h(c({},p),{liveSessions:t,scheduleConfig:u}))},D=(t,a,r)=>{C(i=>h(c({},i),{liveSessions:(i.liveSessions||[]).map(b=>b.id===t?h(c({},b),{[a]:r}):b)}))},ne=t=>K(void 0,null,function*(){if(t.preventDefault(),!P){if(s.type==="live"&&(!s.liveSessions||s.liveSessions.length===0)){alert("Please generate a schedule for your live course.");return}U(!0);try{yield d(s)}catch(a){U(!1)}}}),q=j.useMemo(()=>{if(s.type!=="live"||s.fee<=0)return null;const t="LKR",a=u.days.length||1,r=u.weekCount||1,i=a*r,b=s.liveSessions&&s.liveSessions.length>0?s.liveSessions.length:i;switch(s.paymentPlan){case"monthly":{const p=Math.max(1,r/4),N=Math.round(s.fee/p);return{text:`Based on a ${r}-week duration (~${p.toFixed(1)} months), the student will pay approximately ${N} ${t} per month.`,amount:N}}case"per_session":{const p=Math.round(s.fee/b);return{text:`Based on ${b} total sessions, the student will pay ${p} ${t} per class.`,amount:p}}case"installments_2":{const p=Math.round(s.fee/2);return{text:`The student will pay ${p} ${t} now (50%), and ${p} ${t} later.`,amount:p}}case"full":default:return{text:`The student will pay the full amount of ${s.fee} ${t} upfront to enroll.`,amount:s.fee}}},[s.fee,s.paymentPlan,s.liveSessions,u,s.type]);return e.jsxs("div",{className:"max-w-4xl mx-auto animate-slideInUp p-4",children:[e.jsxs("form",{onSubmit:ne,children:[e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-8 rounded-lg shadow-md mb-8",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-light-text dark:text-dark-text",children:l?"Edit Course":"Create a New Course"}),e.jsx("p",{className:"text-light-subtle dark:text-dark-subtle mt-1",children:"Fill in the details below to set up your course."})]}),e.jsx("button",{type:"button",onClick:y,className:"inline-flex items-center justify-center p-2 rounded-full text-light-subtle dark:text-dark-subtle hover:bg-light-border dark:hover:bg-dark-border transition-colors",children:e.jsx(W,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-primary/5 rounded-lg border border-primary/20",children:[e.jsx("label",{className:"block text-sm font-medium text-light-text dark:text-dark-text mb-3",children:"Course Type"}),e.jsxs("div",{className:"flex space-x-6",children:[e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"type",value:"recorded",checked:s.type==="recorded",onChange:w,className:"w-4 h-4 text-primary focus:ring-primary border-gray-300"}),e.jsx("span",{className:"ml-2 text-sm font-medium",children:"Recorded (Video Lessons)"})]}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"type",value:"live",checked:s.type==="live",onChange:w,className:"w-4 h-4 text-primary focus:ring-primary border-gray-300"}),e.jsx("span",{className:"ml-2 text-sm font-medium",children:"Live Classes (Scheduled Sessions)"})]})]})]}),e.jsx(f,{label:"Course Title",name:"title",value:s.title,onChange:w,placeholder:"e.g., Mastering Mechanics for A/L Physics",required:!0}),e.jsx($,{label:"Subject",name:"subject",value:s.subject,onChange:w,options:Q,required:!0}),n&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx($,{label:"Medium",name:"medium",value:s.medium||"",onChange:w,options:[{value:"",label:"Select Medium"},...z]}),e.jsx($,{label:"Grade",name:"grade",value:s.grade||"",onChange:w,options:[{value:"",label:"Select Grade"},...Z]})]}),e.jsx(B,{label:"Description",id:"description",name:"description",value:s.description,onChange:w,rows:4,placeholder:"A brief summary of what students will learn."}),e.jsx(ke,{label:"Cover Image",currentImage:s.coverImage,onImageChange:te,aspectRatio:"aspect-video"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-start",children:[s.type==="live"&&e.jsx($,{label:"Student Payment Plan",name:"paymentPlan",value:s.paymentPlan||"full",onChange:w,options:[{value:"full",label:"One-time Full Payment"},{value:"monthly",label:"Monthly Payments"},{value:"per_session",label:"Pay Per Session"},{value:"installments_2",label:"2 Installments (50% now, 50% later)"}]}),e.jsxs("div",{children:[e.jsx(f,{label:"Total Course Fee (LKR)",name:"fee",type:"number",value:s.fee.toString(),onChange:w,required:!0}),q&&e.jsx("p",{className:"text-xs mt-2 p-3 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 rounded-md font-medium border border-blue-100 dark:border-blue-800",children:q.text})]})]})]})]}),s.type==="recorded"?e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-8 rounded-lg shadow-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Lectures"}),e.jsxs("button",{type:"button",onClick:()=>A(null),className:"flex items-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary-dark transition-colors",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx("span",{children:"Add Lecture"})]})]}),e.jsx("div",{className:"space-y-3",children:s.lectures.length>0?s.lectures.map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-light-background dark:bg-dark-background rounded-md border border-light-border dark:border-dark-border",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm font-bold text-light-subtle dark:text-dark-subtle mr-4",children:a+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-light-text dark:text-dark-text",children:t.title}),e.jsxs("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:[t.durationMinutes," mins ",t.isFreePreview&&e.jsx("span",{className:"text-green-500 font-medium",children:"(Free Preview)"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>A(t),className:"p-2 text-light-subtle dark:text-dark-subtle hover:text-primary dark:hover:text-primary-light transition-colors",children:e.jsx(Ne,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>ae(t.id),className:"p-2 text-red-500 hover:text-red-700 dark:hover:text-red-400 transition-colors",children:e.jsx(Y,{className:"h-4 w-4"})})]})]},t.id)):e.jsx("div",{className:"text-center py-8 border-2 border-dashed border-light-border dark:border-dark-border rounded-lg",children:e.jsx("p",{className:"text-light-subtle dark:text-dark-subtle",children:"No lectures added yet."})})})]}):e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-8 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Live Class Schedule"}),e.jsxs("div",{className:"p-4 border border-light-border dark:border-dark-border rounded-lg mb-8",children:[e.jsx("h3",{className:"font-semibold mb-4 text-lg",children:"Schedule Generator"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[e.jsx(f,{label:"Start Date",name:"startDate",type:"date",value:u.startDate,onChange:t=>T(a=>h(c({},a),{startDate:t.target.value}))}),e.jsx(f,{label:"Time",name:"startTime",type:"time",value:u.startTime,onChange:t=>T(a=>h(c({},a),{startTime:t.target.value}))}),e.jsx(f,{label:"Duration (Mins)",name:"duration",type:"number",value:u.durationMinutes.toString(),onChange:t=>T(a=>h(c({},a),{durationMinutes:parseInt(t.target.value)}))}),e.jsx(f,{label:"Number of Weeks",name:"weeks",type:"number",value:u.weekCount.toString(),onChange:t=>T(a=>h(c({},a),{weekCount:parseInt(t.target.value)}))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-light-text dark:text-dark-text mb-2",children:"Days of Week"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map((t,a)=>e.jsx("button",{type:"button",onClick:()=>re(a),className:`px-3 py-1 text-sm rounded-full border ${u.days.includes(a)?"bg-primary text-white border-primary":"bg-white dark:bg-dark-background text-light-text dark:text-dark-text border-light-border dark:border-dark-border"}`,children:t},t))})]}),e.jsx("button",{type:"button",onClick:le,className:"w-full py-2 bg-primary/10 text-primary font-semibold rounded-md hover:bg-primary/20 transition-colors",children:"Generate / Update Session List"})]}),e.jsxs("div",{className:"space-y-4",children:[s.liveSessions&&s.liveSessions.map((t,a)=>e.jsxs("div",{className:"p-4 bg-light-background dark:bg-dark-background rounded-md border border-light-border dark:border-dark-border",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("span",{className:"font-bold text-light-text dark:text-dark-text",children:["Session ",a+1]}),e.jsx("button",{type:"button",onClick:()=>{C(r=>{var i;return h(c({},r),{liveSessions:(i=r.liveSessions)==null?void 0:i.filter(b=>b.id!==t.id)})})},className:"text-red-500 hover:bg-red-100 dark:hover:bg-red-900/50 rounded p-1",children:e.jsx(Y,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsx(f,{label:"Date",name:`date-${a}`,type:"date",value:t.date,onChange:r=>D(t.id,"date",r.target.value),required:!0}),e.jsx(f,{label:"Start Time",name:`start-${a}`,type:"time",value:t.startTime,onChange:r=>D(t.id,"startTime",r.target.value),required:!0}),e.jsx(f,{label:"End Time",name:`end-${a}`,type:"time",value:t.endTime,onChange:r=>D(t.id,"endTime",r.target.value),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(f,{label:"Topic / Title",name:`topic-${a}`,value:t.title,onChange:r=>D(t.id,"title",r.target.value)}),e.jsx(f,{label:"Resource Link (Optional)",name:`res-${a}`,value:t.resourceLink||"",onChange:r=>D(t.id,"resourceLink",r.target.value),placeholder:"e.g. Google Drive PDF"})]})]},t.id)),(!s.liveSessions||s.liveSessions.length===0)&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-light-subtle dark:text-dark-subtle",children:"Use the generator above to create your class schedule."})})]})]}),e.jsxs("div",{className:"mt-8 p-4 bg-yellow-50 dark:bg-yellow-900/30 border-l-4 border-yellow-400 rounded-r-md text-yellow-800 dark:text-yellow-200",children:[e.jsx("h4",{className:"font-bold",children:"Course Publication & Deletion Policy"}),e.jsxs("ul",{className:"text-sm mt-2 list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Admin Review:"})," All new courses must be reviewed and approved by an administrator before they can be published for the first time. You can request publication after saving your course."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Unpublishing:"})," You can unpublish a course at any time to prevent new enrollments. Students who have already purchased the course will still have access."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Deletion:"})," A course cannot be deleted if it has one or more enrolled students. You can only unpublish it."]})]})]}),e.jsxs("div",{className:"mt-8 pt-6 flex justify-end space-x-4",children:[e.jsxs("button",{type:"button",onClick:y,className:"inline-flex items-center justify-center px-6 py-2 border border-light-border dark:border-dark-border text-sm font-medium rounded-md shadow-sm text-light-text dark:text-dark-text bg-light-surface dark:bg-dark-surface hover:bg-light-border dark:hover:bg-dark-border/50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-light transition-colors",children:[e.jsx(W,{className:"w-5 h-5 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:P,className:"inline-flex items-center justify-center px-6 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-light transition-colors disabled:opacity-50",children:[P?e.jsx(Se,{className:"w-5 h-5 mr-2"}):e.jsx(J,{className:"w-5 h-5 mr-2"}),P?"Saving...":"Save Course"]})]})]}),e.jsx(Me,{isOpen:V,onClose:ee,onSave:se,lecture:X})]})};export{Pe as default};
