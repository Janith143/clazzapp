var we=Object.defineProperty,Ne=Object.defineProperties;var Se=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var R=(l,i,n)=>i in l?we(l,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[i]=n,Q=(l,i)=>{for(var n in i||(i={}))V.call(i,n)&&R(l,n,i[n]);if(F)for(var n of F(i))H.call(i,n)&&R(l,n,i[n]);return l},$=(l,i)=>Ne(l,Se(i));var K=(l,i)=>{var n={};for(var d in l)V.call(l,d)&&i.indexOf(d)<0&&(n[d]=l[d]);if(l!=null&&F)for(var d of F(l))i.indexOf(d)<0&&H.call(l,d)&&(n[d]=l[d]);return n};import{d as Fe,u as Ce,r,s as Me,g as U,j as e,C as Ae,t as Oe,n as De}from"./index-BXN-gaEy.js";import{C as Pe}from"./ClassCard-BBTr9XzW.js";import{S as Le}from"./SearchBar-WR6MAao9.js";import{S as q}from"./SearchableSelect-Dgx7XP55.js";import{s as Te}from"./slug-Be7lxzw5.js";import"./vendor-firebase-CLtQg3ae.js";import"./StarRating-BeOC4AZb.js";const O=9,_e=[{value:"newest",label:"Newest First"},{value:"date_asc",label:"Date: Upcoming First"},{value:"date_desc",label:"Date: Latest First"},{value:"fee_low",label:"Fee: Low to High"},{value:"fee_high",label:"Fee: High to Low"}],qe=()=>{const{teachers:l}=Fe(),{handleNavigate:i,allSubjects:n,subjects:d,pageState:z}=Ce(),h=z.options,[g,G]=r.useState(""),[c,I]=r.useState("all"),[f,D]=r.useState("all"),[m,J]=r.useState("all"),[p,P]=r.useState("all"),[v,W]=r.useState("all"),[k,X]=r.useState("all"),[x,Y]=r.useState("all"),[w,Z]=r.useState("date_asc"),[u,ee]=r.useState(!1),[te,Ee]=r.useState(!0),[C,L]=r.useState(O),M=r.useRef(!1),T=r.useRef(null),se=(t,a)=>i({name:"class_detail_slug",slug:Te(t.title)}),re=()=>i({name:"home"}),b=r.useMemo(()=>l.filter(t=>t.registrationStatus==="approved"),[l]),{maxPrice:N}=r.useMemo(()=>{const t=b.flatMap(s=>s.individualClasses);let a=0;return t.forEach(s=>{s.fee>a&&(a=s.fee)}),{maxPrice:Math.ceil(a/500)*500}},[b]),[j,_]=r.useState(N);r.useEffect(()=>{_(N)},[N]);const ae=r.useMemo(()=>{if(c==="all")return[];const t=Me[c]||[];return[{value:"all",label:"All Towns"},...t.map(a=>({value:a,label:a}))]},[c]),le=r.useMemo(()=>m==="all"?n:d[m]||[],[m,n,d]),ie=r.useMemo(()=>b.some(t=>t.individualClasses.some(a=>a.isPublished&&(a.mode==="Online"||a.mode==="Both")&&U(a)==="live")),[b]),ne=t=>{I(t),D("all")},oe=t=>{J(t),P("all")},S=r.useMemo(()=>[...b.flatMap(s=>s.individualClasses.filter(o=>o.isPublished&&o.status!=="canceled").map(o=>$(Q({},o),{teacher:s}))).filter(s=>{var B;const o=U(s);if(u){const ye=s.mode==="Online"||s.mode==="Both";if(o!=="live"||!ye)return!1}else if(o==="finished")return!1;const A=g.toLowerCase(),he=[s.title,s.description,s.subject,s.teacher.name,s.teacher.id,s.teacher.username,(B=s.teacher.contact)==null?void 0:B.location,s.institute,s.town,s.district].filter(Boolean).join(" ").toLowerCase(),xe=!g.trim()||he.includes(A),be=k==="all"||s.mode===k||s.mode==="Both",ge=c==="all"||s.district===c,fe=f==="all"||s.town===f,pe=x==="all"||x==="platform"&&(s.paymentMethod==="platform"||!s.paymentMethod)||x==="manual"&&s.paymentMethod==="manual",ve=m==="all"||s.targetAudience===m,ke=p==="all"||s.subject===p,je=v==="all"||s.medium===v;return s.fee>j?!1:xe&&be&&ge&&fe&&pe&&ve&&ke&&je})].sort((s,o)=>{switch(w){case"newest":return o.id-s.id;case"date_desc":return new Date(o.date).getTime()-new Date(s.date).getTime();case"fee_high":return o.fee-s.fee;case"fee_low":return s.fee-o.fee;case"date_asc":default:return new Date(s.date).getTime()-new Date(o.date).getTime()}}),[b,g,w,k,c,f,u,x,j,m,p,v]);r.useEffect(()=>{L(O)},[g,w,k,c,f,u,x,j,m,p,v]);const y=r.useMemo(()=>S.slice(0,C),[S,C]),de=y.length<S.length,E=r.useCallback(t=>{t[0].isIntersecting&&!M.current&&(M.current=!0,L(s=>s+O))},[]);r.useEffect(()=>{M.current=!1},[C]),r.useEffect(()=>{const t=new IntersectionObserver(E,{root:null,rootMargin:"200px",threshold:0}),a=T.current;return a&&t.observe(a),()=>{a&&t.unobserve(a)}},[E,y]);const ce=h!=null&&h.ongoingOnly&&u?"Ongoing Live Classes":"Explore All Classes",ue=h!=null&&h.ongoingOnly&&u?"Join these classes happening right now!":"Find individual and group classes that fit your schedule.",me=new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR",minimumFractionDigits:0});return e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8 animate-slideInUp",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("button",{onClick:re,className:"flex items-center space-x-2 text-sm font-medium text-primary hover:text-primary-dark transition-colors",children:[e.jsx(Ae,{className:"h-5 w-5"}),e.jsx("span",{children:"Back to Home"})]})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold",children:ce}),e.jsx("p",{className:"mt-2 text-lg text-light-subtle dark:text-dark-subtle",children:ue})]}),e.jsx("div",{className:`sticky top-16 z-20 py-4 bg-light-background/80 dark:bg-dark-background/80 backdrop-blur-sm -mx-4 sm:-mx-6 lg:-mx-8 px-4 sm:px-6 lg:px-8 mb-8 transition-transform duration-300 ${te?"translate-y-0":"-translate-y-full"}`,children:e.jsxs("div",{className:"max-w-5xl mx-auto space-y-4",children:[e.jsx(Le,{searchQuery:g,setSearchQuery:G}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"filter-audience",className:"block text-sm font-medium text-light-text dark:text-dark-text mb-1",children:"Audience"}),e.jsxs("select",{id:"filter-audience",value:m,onChange:t=>oe(t.target.value),className:"w-full px-3 py-2 border border-light-border dark:border-dark-border text-light-text dark:text-dark-text bg-light-surface dark:bg-dark-surface rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm",children:[e.jsx("option",{value:"all",children:"All Audiences"}),Oe.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"filter-subject",className:"block text-sm font-medium text-light-text dark:text-dark-text mb-1",children:"Subject"}),e.jsxs("select",{id:"filter-subject",value:p,onChange:t=>P(t.target.value),className:"w-full px-3 py-2 border border-light-border dark:border-dark-border text-light-text dark:text-dark-text bg-light-surface dark:bg-dark-surface rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm",children:[e.jsx("option",{value:"all",children:"All Subjects"}),le.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"filter-medium",className:"block text-sm font-medium text-light-text dark:text-dark-text mb-1",children:"Medium"}),e.jsxs("select",{id:"filter-medium",value:v,onChange:t=>W(t.target.value),className:"w-full px-3 py-2 border border-light-border dark:border-dark-border text-light-text dark:text-dark-text bg-light-surface dark:bg-dark-surface rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm",children:[e.jsx("option",{value:"all",children:"All Mediums"}),e.jsx("option",{value:"Sinhala",children:"Sinhala"}),e.jsx("option",{value:"English",children:"English"}),e.jsx("option",{value:"Tamil",children:"Tamil"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sort-classes",className:"block text-sm font-medium text-light-text dark:text-dark-text mb-1",children:"Sort by"}),e.jsx("select",{id:"sort-classes",value:w,onChange:t=>Z(t.target.value),className:"w-full px-3 py-2 border border-light-border dark:border-dark-border text-light-text dark:text-dark-text bg-light-surface dark:bg-dark-surface rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm",children:_e.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"filter-mode",className:"block text-sm font-medium text-light-text dark:text-dark-text mb-1",children:"Mode"}),e.jsxs("select",{id:"filter-mode",value:k,onChange:t=>X(t.target.value),className:"w-full px-3 py-2 border border-light-border dark:border-dark-border text-light-text dark:text-dark-text bg-light-surface dark:bg-dark-surface rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm",children:[e.jsx("option",{value:"all",children:"All Modes"}),e.jsx("option",{value:"Online",children:"Online"}),e.jsx("option",{value:"Physical",children:"Physical"})]})]}),e.jsx(q,{label:"District",options:[{value:"all",label:"All Districts"},...De.map(t=>({value:t,label:t}))],value:c,onChange:ne,placeholder:"Filter by District"}),e.jsx(q,{label:"Town",options:ae,value:f,onChange:D,placeholder:"Select District First",disabled:c==="all"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"filter-payment",className:"block text-sm font-medium text-light-text dark:text-dark-text mb-1",children:"Payment"}),e.jsxs("select",{id:"filter-payment",value:x,onChange:t=>Y(t.target.value),className:"w-full px-3 py-2 border border-light-border dark:border-dark-border text-light-text dark:text-dark-text bg-light-surface dark:bg-dark-surface rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm",children:[e.jsx("option",{value:"all",children:"All Methods"}),e.jsx("option",{value:"platform",children:"Platform"}),e.jsx("option",{value:"manual",children:"Manual"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"filter-price",className:"block text-sm font-medium text-light-text dark:text-dark-text mb-1",children:["Max Price: ",e.jsx("span",{className:"font-bold text-primary",children:me.format(j)})]}),e.jsx("input",{id:"filter-price",type:"range",min:"0",max:N,step:250,value:j,onChange:t=>_(Number(t.target.value)),className:"w-full h-2 bg-light-border dark:bg-dark-border rounded-lg appearance-none cursor-pointer accent-primary"})]}),ie&&e.jsx("div",{className:"flex flex-col justify-end md:col-span-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>ee(!u),className:`${u?"bg-red-600":"bg-gray-200 dark:bg-gray-600"} relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2`,role:"switch","aria-checked":u,children:e.jsx("span",{"aria-hidden":"true",className:`${u?"translate-x-5":"translate-x-0"} pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out`})}),e.jsx("label",{htmlFor:"live-only-toggle",className:"text-sm font-medium whitespace-nowrap",children:"Live Only"})]})})]})]})}),y.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-light-subtle dark:text-dark-subtle mb-6",children:["Showing ",y.length," of ",S.length," classes."]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:y.map(s=>{var o=s,{teacher:t}=o,a=K(o,["teacher"]);return e.jsx(Pe,{classInfo:a,teacher:t,viewMode:"public",onView:A=>se(A)},a.id)})}),de&&e.jsx("div",{ref:T,className:"flex justify-center items-center h-20",children:e.jsx("div",{className:"w-8 h-8 border-4 border-dashed rounded-full animate-spin border-primary"})})]}):e.jsxs("div",{className:"text-center py-16 text-light-subtle dark:text-dark-subtle",children:[e.jsx("p",{className:"text-xl font-semibold",children:"No classes found"}),e.jsx("p",{children:"Try adjusting your search query or filters."})]})]})};export{qe as default};
