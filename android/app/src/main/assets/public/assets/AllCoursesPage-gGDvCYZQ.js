var q=Object.defineProperty,G=Object.defineProperties;var U=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var M=(s,a,o)=>a in s?q(s,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[a]=o,O=(s,a)=>{for(var o in a||(a={}))P.call(a,o)&&M(s,o,a[o]);if(k)for(var o of k(a))L.call(a,o)&&M(s,o,a[o]);return s},R=(s,a)=>G(s,U(a));var I=(s,a)=>{var o={};for(var i in s)P.call(s,i)&&a.indexOf(i)<0&&(o[i]=s[i]);if(s!=null&&k)for(var i of k(s))a.indexOf(i)<0&&L.call(s,i)&&(o[i]=s[i]);return o};import{d as J,u as W,r as l,k as T,j as e,C as X,t as Y}from"./index-BXN-gaEy.js";import{C as $}from"./CourseCard-uZsExVwk.js";import{S as ee}from"./SearchBar-WR6MAao9.js";import{s as te}from"./slug-Be7lxzw5.js";import{u as re}from"./useSEO-BjUGcIuA.js";import"./vendor-firebase-CLtQg3ae.js";import"./StarRating-BeOC4AZb.js";const C=9,se=[{value:"newest",label:"Newest First"},{value:"rating_desc",label:"Highest Rated"},{value:"title_asc",label:"Title: A-Z"},{value:"title_desc",label:"Title: Z-A"},{value:"fee_low",label:"Price: Low to High"},{value:"fee_high",label:"Price: High to Low"}],me=()=>{const{teachers:s}=J(),{handleNavigate:a,allSubjects:o,subjects:i}=W(),[u,B]=l.useState(""),[d,H]=l.useState("all"),[m,w]=l.useState("all"),[f,z]=l.useState("newest"),[y,S]=l.useState(C),N=l.useRef(!1),A=l.useRef(null);re("All Courses | clazz.lk","Explore our comprehensive list of online courses to enhance your knowledge.");const D=(t,c)=>a({name:"course_detail_slug",slug:te(t.title)}),Q=()=>a({name:"home"}),g=l.useMemo(()=>s.filter(t=>t.registrationStatus==="approved"),[s]),{maxPrice:b}=l.useMemo(()=>{const t=g.flatMap(r=>r.courses);let c=0;return t.forEach(r=>{r.fee>c&&(c=r.fee)}),{maxPrice:Math.ceil(c/1e3)*1e3}},[g]),[x,F]=l.useState(b);l.useEffect(()=>{F(b)},[b]);const V=l.useMemo(()=>d==="all"?o:i[d]||[],[d,o,i]),K=t=>{H(t),w("all")},p=l.useMemo(()=>[...g.flatMap(r=>r.courses.map(n=>R(O({},n),{teacher:r}))).filter(r=>{var n,v;if(!r.isPublished)return!1;if(u.trim()){const j=u.toLowerCase();if(![r.title,r.description,r.subject,r.teacher.name,r.teacher.id,r.teacher.username,(n=r.teacher.contact)==null?void 0:n.location].filter(Boolean).join(" ").toLowerCase().includes(j))return!1}if(d!=="all"){const j=(v=i[d])==null?void 0:v.map(E=>E.value);if(!j||!j.includes(r.subject))return!1}return!(m!=="all"&&r.subject!==m||r.fee>x)})].sort((r,n)=>{switch(f){case"newest":return n.id.localeCompare(r.id);case"rating_desc":return T(n.ratings).average-T(r.ratings).average;case"title_desc":return n.title.localeCompare(r.title);case"fee_high":return n.fee-r.fee;case"fee_low":return r.fee-n.fee;case"title_asc":default:return r.title.localeCompare(n.title)}}),[g,u,f,m,x,d,i]);l.useEffect(()=>{S(C)},[u,f,m,x,d]);const h=l.useMemo(()=>p.slice(0,y),[p,y]),_=l.useCallback(t=>{t[0].isIntersecting&&!N.current&&(N.current=!0,S(r=>r+C))},[]);l.useEffect(()=>{N.current=!1},[y]),l.useEffect(()=>{const t=new IntersectionObserver(_,{root:null,rootMargin:"200px",threshold:0}),c=A.current;return c&&t.observe(c),()=>{c&&t.unobserve(c)}},[_,h]);const Z=new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR",minimumFractionDigits:0});return e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8 animate-slideInUp",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("button",{onClick:Q,className:"flex items-center space-x-2 text-sm font-medium text-primary hover:text-primary-dark transition-colors",children:[e.jsx(X,{className:"h-5 w-5"}),e.jsx("span",{children:"Back to Home"})]})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold",children:"Explore All Courses"}),e.jsx("p",{className:"mt-2 text-lg text-light-subtle dark:text-dark-subtle",children:"Deepen your knowledge with structured courses from top educators."})]}),e.jsx("div",{className:"sticky top-16 z-20 py-4 bg-light-background/80 dark:bg-dark-background/80 backdrop-blur-sm -mx-4 sm:px-6 lg:-mx-8 px-4 sm:px-6 lg:px-8 mb-8",children:e.jsxs("div",{className:"max-w-5xl mx-auto space-y-4",children:[e.jsx(ee,{searchQuery:u,setSearchQuery:B}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"filter-audience",className:"block text-sm font-medium text-light-text dark:text-dark-text mb-1",children:"Audience"}),e.jsxs("select",{id:"filter-audience",value:d,onChange:t=>K(t.target.value),className:"w-full px-3 py-2 border border-light-border dark:border-dark-border text-light-text dark:text-dark-text bg-light-surface dark:bg-dark-surface rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm",children:[e.jsx("option",{value:"all",children:"All Audiences"}),Y.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"filter-subject",className:"block text-sm font-medium text-light-text dark:text-dark-text mb-1",children:"Subject"}),e.jsxs("select",{id:"filter-subject",value:m,onChange:t=>w(t.target.value),className:"w-full px-3 py-2 border border-light-border dark:border-dark-border text-light-text dark:text-dark-text bg-light-surface dark:bg-dark-surface rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm",children:[e.jsx("option",{value:"all",children:"All Subjects"}),V.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sort-courses",className:"block text-sm font-medium text-light-text dark:text-dark-text mb-1",children:"Sort by"}),e.jsx("select",{id:"sort-courses",value:f,onChange:t=>z(t.target.value),className:"w-full px-3 py-2 border border-light-border dark:border-dark-border text-light-text dark:text-dark-text bg-light-surface dark:bg-dark-surface rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm",children:se.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"",children:[e.jsxs("label",{htmlFor:"filter-price",className:"block text-sm font-medium text-light-text dark:text-dark-text mb-1",children:["Max Price: ",e.jsx("span",{className:"font-bold text-primary",children:Z.format(x)})]}),e.jsx("input",{id:"filter-price",type:"range",min:"0",max:b,step:500,value:x,onChange:t=>F(Number(t.target.value)),className:"w-full h-2 bg-light-border dark:bg-dark-border rounded-lg appearance-none cursor-pointer accent-primary"})]})]})]})}),h.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-light-subtle dark:text-dark-subtle mb-6",children:["Showing ",h.length," of ",p.length," courses."]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:h.map(r=>{var n=r,{teacher:t}=n,c=I(n,["teacher"]);return e.jsx($,{course:c,teacher:t,viewMode:"public",onView:v=>D(v)},c.id)})}),h.length<p.length&&e.jsx("div",{ref:A,className:"flex justify-center items-center h-20",children:e.jsx("div",{className:"w-8 h-8 border-4 border-dashed rounded-full animate-spin border-primary"})})]}):e.jsxs("div",{className:"text-center py-16 text-light-subtle dark:text-dark-subtle",children:[e.jsx("p",{className:"text-xl font-semibold",children:"No courses found"}),e.jsx("p",{children:"Try adjusting your search query or filters."})]})]})};export{me as default};
