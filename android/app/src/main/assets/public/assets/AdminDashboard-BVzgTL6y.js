var Yt=Object.defineProperty,Ht=Object.defineProperties;var Jt=Object.getOwnPropertyDescriptors;var dt=Object.getOwnPropertySymbols;var Wt=Object.prototype.hasOwnProperty,Xt=Object.prototype.propertyIsEnumerable;var it=(l,n,s)=>n in l?Yt(l,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[n]=s,_=(l,n)=>{for(var s in n||(n={}))Wt.call(n,s)&&it(l,s,n[s]);if(dt)for(var s of dt(n))Xt.call(n,s)&&it(l,s,n[s]);return l},F=(l,n)=>Ht(l,Jt(n));var W=(l,n,s)=>new Promise((T,i)=>{var m=t=>{try{f(s.next(t))}catch(d){i(d)}},b=t=>{try{f(s.throw(t))}catch(d){i(d)}},f=t=>t.done?T(t.value):Promise.resolve(t.value).then(m,b);f((s=s.apply(l,n)).next())});import{b as qe,r as c,j as e,a3 as pt,at as gt,au as bt,B as ft,z as et,av as Qt,aw as Zt,ao as qt,ai as jt,ax as es,a5 as kt,ay as ts,az as ss,U as Nt,F as je,l as tt,O as xe,N as he,e as ie,G as E,X as yt,d as Z,u as ue,a1 as vt,o as as,p as rs,a6 as le,y as st,M as We,aa as ot,V as ls,w as ns,T as Se,K as fe,R as be,aA as at,I as wt,P as St,a7 as ct,aB as ds,t as $e,J as is,Q as Ct,W as mt,_ as xt,ah as Xe,aC as os}from"./index-BXN-gaEy.js";import{I as cs,a as ms,R as xs,S as Ge}from"./StudentDetailsModal-NtkdRNK3.js";import{C as rt}from"./ConfirmationModal-CVK0Y9X0.js";import{f as Qe,I as Ze,A as hs}from"./vendor-firebase-CLtQg3ae.js";const ht=l=>e.jsx("svg",F(_({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor"},l),{children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.658-.463 1.243-1.119 1.243H4.51c-.656 0-1.19-.585-1.119-1.243L4.644 8.507A3.75 3.75 0 018.25 4.5h7.5a3.75 3.75 0 013.606 3.993z"})})),us=({activeView:l,setActiveView:n})=>{const{currentUser:s}=qe(),T=c.useMemo(()=>{const i=[{id:"analytics",label:"Analytics",icon:e.jsx(pt,{className:"w-5 h-5 mr-3"})},{id:"users",label:"User Management",icon:e.jsx(gt,{className:"w-5 h-5 mr-3"})},{id:"staff",label:"Team & Permissions",icon:e.jsx(bt,{className:"w-5 h-5 mr-3"})},{id:"content",label:"Content (Legacy)",icon:e.jsx(ft,{className:"w-5 h-5 mr-3"})},{id:"products",label:"Products",icon:e.jsx(ht,{className:"w-5 h-5 mr-3"})},{id:"allsales",label:"All Sales",icon:e.jsx(et,{className:"w-5 h-5 mr-3"})},{id:"photo_orders",label:"Photo Orders",icon:e.jsx(Qt,{className:"w-5 h-5 mr-3"})},{id:"physical_orders",label:"Physical Orders",icon:e.jsx(ht,{className:"w-5 h-5 mr-3"})},{id:"revenue",label:"Revenue & Payouts",icon:e.jsx(Zt,{className:"w-5 h-5 mr-3"})},{id:"vouchers",label:"Voucher Management",icon:e.jsx(qt,{className:"w-5 h-5 mr-3"})},{id:"referrals",label:"Referral System",icon:e.jsx(jt,{className:"w-5 h-5 mr-3"})},{id:"payment_gateways",label:"Payment Gateways",icon:e.jsx(es,{className:"w-5 h-5 mr-3"})},{id:"site_content",label:"Site Content",icon:e.jsx(kt,{className:"w-5 h-5 mr-3"})},{id:"calculation_guide",label:"Calculation Guide",icon:e.jsx(ts,{className:"w-5 h-5 mr-3"})},{id:"developer",label:"Developer",icon:e.jsx(ss,{className:"w-5 h-5 mr-3"})}];return!(s!=null&&s.permissions)||s.permissions.includes("all")?i:i.filter(m=>s.permissions.includes(m.id))},[s]);return e.jsxs("aside",{className:"w-full md:w-64 flex-shrink-0 bg-light-surface dark:bg-dark-surface p-4 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-lg font-bold mb-4 px-2",children:"Admin Menu"}),e.jsx("nav",{className:"flex flex-col gap-2",children:T.map(i=>e.jsxs("button",{onClick:()=>n(i.id),className:`w-full flex items-center text-left px-3 py-2.5 rounded-md text-sm font-medium transition-colors ${l===i.id?"bg-primary text-white":"text-light-text dark:text-dark-text hover:bg-light-border dark:hover:bg-dark-border"}`,children:[i.icon,i.label]},i.id))})]})},Ke=({title:l,value:n,icon:s})=>e.jsx("div",{className:"bg-light-surface dark:bg-dark-surface p-5 rounded-lg shadow-md border border-light-border dark:border-dark-border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-primary/10 text-primary rounded-lg mr-4",children:s}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-light-subtle dark:text-dark-subtle",children:l}),e.jsx("p",{className:"text-3xl font-bold text-light-text dark:text-dark-text",children:n})]})]})}),ps=({teachers:l,users:n,sales:s})=>{const T=c.useMemo(()=>{const m=s.filter(d=>d.status==="completed").reduce((d,u)=>d+(u.totalAmount+u.amountPaidFromBalance),0),b=n.length,f=l.length,t=s.length;return{totalRevenue:m,totalUsers:b,totalTeachers:f,totalSales:t}},[l,n,s]),i=new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR",minimumFractionDigits:0,maximumFractionDigits:0});return e.jsxs("div",{className:"space-y-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Analytics Overview"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(Ke,{title:"Total Revenue",value:i.format(T.totalRevenue),icon:e.jsx(et,{className:"w-7 h-7"})}),e.jsx(Ke,{title:"Total Users",value:T.totalUsers,icon:e.jsx(gt,{className:"w-7 h-7"})}),e.jsx(Ke,{title:"Total Teachers",value:T.totalTeachers,icon:e.jsx(Nt,{className:"w-7 h-7"})}),e.jsx(Ke,{title:"Total Sales",value:T.totalSales,icon:e.jsx(pt,{className:"w-7 h-7"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"User Growth"}),e.jsx("div",{className:"mt-6 h-64 bg-light-border dark:bg-dark-border rounded-md flex items-center justify-center",children:e.jsx("p",{className:"text-light-subtle dark:text-dark-subtle",children:"User Growth Chart (Mock)"})})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Monthly Revenue"}),e.jsx("div",{className:"mt-6 h-64 bg-light-border dark:bg-dark-border rounded-md flex items-center justify-center",children:e.jsx("p",{className:"text-light-subtle dark:text-dark-subtle",children:"Revenue Chart (Mock)"})})]})]})]})},gs=({isOpen:l,onClose:n,teacher:s,onSave:T,defaultCoverImages:i})=>{const[m,b]=c.useState(null),f=()=>{m&&T(s.id,m)};return e.jsx(je,{isOpen:l,onClose:n,title:`Set Default Cover for ${s.name}`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:"This teacher has not uploaded any cover images. Select a default image to display on their profile."}),e.jsx("div",{className:"grid grid-cols-2 gap-4 max-h-96 overflow-y-auto p-2 bg-light-background dark:bg-dark-background rounded-md",children:i.map(t=>e.jsxs("div",{className:"relative cursor-pointer group",onClick:()=>b(t),children:[e.jsx("img",{src:tt(t,400),alt:"Default cover",className:"w-full h-auto rounded-md"}),e.jsx("div",{className:`absolute inset-0 bg-primary/50 rounded-md border-4 border-primary flex items-center justify-center text-white transition-opacity ${m===t?"opacity-100":"opacity-0 group-hover:opacity-50"}`,children:m===t&&e.jsx(xe,{className:"h-12 w-12"})})]},t))}),e.jsx("div",{className:"pt-4 flex justify-end",children:e.jsxs("button",{type:"button",onClick:f,disabled:!m,className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark disabled:opacity-50",children:[e.jsx(he,{className:"w-5 h-5 mr-2"}),"Set Cover Image"]})})]})})},bs=({isOpen:l,onClose:n,user:s,onAssign:T})=>{const{addToast:i}=ie(),[m,b]=c.useState(""),[f,t]=c.useState(!1),[d,u]=c.useState(""),N=S=>W(void 0,null,function*(){S.preventDefault(),u(""),t(!0);try{yield T(s.id,m),b(""),n()}catch(v){u(v.message||"Failed to assign referral code."),i(v.message||"Failed to assign referral code.","error")}finally{t(!1)}});return e.jsx(je,{isOpen:l,onClose:n,title:"Assign Referrer",children:e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-md border border-blue-200 dark:border-blue-800 text-sm text-blue-800 dark:text-blue-200",children:[e.jsxs("p",{children:["Assigning a referrer to ",e.jsxs("strong",{children:[s.firstName," ",s.lastName]}),"."]}),e.jsxs("p",{className:"mt-1",children:["Enter the ",e.jsx("strong",{children:"Referral Code"})," of the user who invited them."]})]}),e.jsx(E,{label:"Referral Code",name:"referralCode",value:m,onChange:S=>b(S.target.value.toUpperCase()),placeholder:"e.g. PASAN123",required:!0}),d&&e.jsx("p",{className:"text-red-500 text-sm text-center",children:d}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-2",children:[e.jsxs("button",{type:"button",onClick:n,className:"flex items-center px-4 py-2 border border-light-border dark:border-dark-border rounded-md text-sm hover:bg-light-background dark:hover:bg-dark-background transition-colors",disabled:f,children:[e.jsx(yt,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",className:"flex items-center px-4 py-2 bg-primary text-white rounded-md text-sm hover:bg-primary-dark transition-colors disabled:opacity-50",disabled:f||!m.trim(),children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),f?"Assigning...":"Assign"]})]})]})})},fs=({teachers:l,users:n,onUpdateTeacher:s,onViewTeacher:T,onViewStudentDashboard:i,defaultCoverImages:m})=>{const{tuitionInstitutes:b,updateTuitionInstitute:f,handleAssignReferralCode:t}=Z(),{handleNavigate:d}=ue(),{setModalState:u}=ie(),[N,S]=c.useState("teachers"),[v,g]=c.useState(""),[w,y]=c.useState("all"),[G,V]=c.useState(""),[r,A]=c.useState(!1),[h,R]=c.useState(null),[k,M]=c.useState({}),[L,a]=c.useState({}),[D,U]=c.useState({}),[z,K]=c.useState({}),[P,q]=c.useState(!1),[H,ae]=c.useState(null),ee=c.useMemo(()=>{const o=new Map(n.map(p=>[p.id,p]));let x=[...l];if(w!=="all"&&(x=x.filter(p=>p.registrationStatus===w)),G!==""&&(x=x.filter(p=>p.commissionRate.toString()===G)),v.trim()){const p=v.toLowerCase();x=x.filter($=>{const O=$.teachingLocations?$.teachingLocations.map(B=>`${B.instituteName} ${B.town} ${B.district}`).join(" "):"";return $.name.toLowerCase().includes(p)||$.id.toLowerCase().includes(p)||$.email.toLowerCase().includes(p)||O.toLowerCase().includes(p)})}return x.sort((p,$)=>{const O=o.get(p.userId),B=o.get($.userId);return O!=null&&O.createdAt&&(B!=null&&B.createdAt)?new Date(B.createdAt).getTime()-new Date(O.createdAt).getTime():O!=null&&O.createdAt?-1:B!=null&&B.createdAt?1:0})},[l,n,v,w,G]),ne=c.useMemo(()=>ee.filter(o=>o.registrationStatus==="approved"),[ee]),de=c.useMemo(()=>{let o=n.filter(x=>x.role==="student");if(v.trim()){const x=v.toLowerCase();o=o.filter(p=>`${p.firstName} ${p.lastName}`.toLowerCase().includes(x)||p.id.toLowerCase().includes(x)||p.email&&p.email.toLowerCase().includes(x))}return o.sort((x,p)=>x.createdAt&&p.createdAt?new Date(p.createdAt).getTime()-new Date(x.createdAt).getTime():x.createdAt?-1:p.createdAt?1:0)},[n,v]),oe=c.useMemo(()=>{const o=new Map(n.map(p=>[p.id,p]));let x=[...b];if(v.trim()){const p=v.toLowerCase();x=x.filter($=>{var O;return $.name.toLowerCase().includes(p)||$.id.toLowerCase().includes(p)||((O=$.contact)==null?void 0:O.email)&&$.contact.email.toLowerCase().includes(p)})}return x.sort((p,$)=>{const O=o.get(p.userId),B=o.get($.userId);return O!=null&&O.createdAt&&(B!=null&&B.createdAt)?new Date(B.createdAt).getTime()-new Date(O.createdAt).getTime():O!=null&&O.createdAt?-1:B!=null&&B.createdAt?1:0})},[b,n,v]),Le=()=>{const o=[];de.forEach(p=>{o.push({Role:"Student",Name:`${p.firstName} ${p.lastName}`,Email:p.email,ContactNumber:p.contactNumber||""})}),ee.forEach(p=>{var $;o.push({Role:"Teacher",Name:p.name,Email:p.email,ContactNumber:(($=p.contact)==null?void 0:$.phone)||""})}),oe.forEach(p=>{var $,O;o.push({Role:"Institute",Name:p.name,Email:(($=p.contact)==null?void 0:$.email)||"",ContactNumber:((O=p.contact)==null?void 0:O.phone)||""})}),((p,$)=>{if(p.length===0){alert("No contact data to download.");return}const O=Object.keys(p[0]),B=[O.join(","),...p.map(De=>O.map(Pe=>{let X=De[Pe]===null||De[Pe]===void 0?"":String(De[Pe]);return(X.includes(",")||X.includes('"')||X.includes(`
`))&&(X=`"${X.replace(/"/g,'""')}"`),X}).join(","))].join(`
`),te=new Blob([B],{type:"text/csv;charset=utf-8;"}),me=document.createElement("a"),Ve=URL.createObjectURL(te);me.setAttribute("href",Ve),me.setAttribute("download",$),me.style.visibility="hidden",document.body.appendChild(me),me.click(),document.body.removeChild(me)})(o,`clazz_lk_contact_data_${new Date().toISOString().split("T")[0]}.csv`)},Me=(o,x)=>{M(p=>F(_({},p),{[o]:x}))},Ce=o=>{const x=parseFloat(k[o]);if(!isNaN(x)){s(o,{commissionRate:x}),alert(`Commission for this teacher has been updated to ${x}%.`);const p=_({},k);delete p[o],M(p)}},Ie=(o,x)=>{a(p=>F(_({},p),{[o]:x}))},ce=o=>{const x=parseFloat(L[o]);if(!isNaN(x)){f(o,{commissionRate:x}),alert(`Commission for this institute has been updated to ${x}%.`);const p=_({},L);delete p[o],a(p)}},Fe=(o,x)=>{U(p=>F(_({},p),{[o]:x}))},Te=o=>{const x=parseFloat(D[o]);if(!isNaN(x)){f(o,{platformMarkupRate:x}),alert(`Platform markup for this institute has been updated to ${x}%.`);const p=_({},D);delete p[o],U(p)}},ke=(o,x)=>{K(p=>F(_({},p),{[o]:x}))},Ae=o=>{const x=parseFloat(z[o]);if(!isNaN(x)&&x>=0&&x<=100){f(o,{photoCommissionRate:x}),alert(`Institute's photo commission has been updated to ${x}%.`);const p=_({},z);delete p[o],K(p)}else alert("Please enter a valid percentage between 0 and 100.")},Ne=(o,x)=>{s(o.id,{coverImages:[x]}),A(!1),R(null)},ye=o=>{u({name:"edit_student_profile",userToEdit:o})},pe=(o,x)=>{s(o,{registrationStatus:x}),alert(`Teacher status has been updated to ${x}.`)},Re=(o,x)=>{f(o,{registrationStatus:x}),alert(`Institute has been ${x}.`)},_e=o=>{ae(o),q(!0)},J=({status:o})=>{const x={verified:{icon:e.jsx(xe,{className:"w-5 h-5 text-green-500 dark:text-green-400"}),text:"Verified"},pending:{icon:e.jsx(st,{className:"w-5 h-5 text-yellow-500 dark:text-yellow-400"}),text:"Pending"},rejected:{icon:e.jsx(le,{className:"w-5 h-5 text-red-500 dark:text-red-400"}),text:"Rejected"},unverified:{icon:e.jsx(kt,{className:"w-5 h-5 text-gray-400 dark:text-gray-500"}),text:"Unverified"}},{icon:p,text:$}=x[o];return e.jsx("span",{title:$,children:p})},Ee=({status:o})=>{const x={approved:"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300",pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-800/50 dark:text-yellow-300",rejected:"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300"};return e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full ${x[o]}`,children:o.charAt(0).toUpperCase()+o.slice(1)})},ge=o=>e.jsx("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-light-border dark:divide-dark-border text-sm",children:[e.jsx("thead",{className:"bg-light-background dark:bg-dark-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Teacher ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Registered Date"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Verification (ID/Bank)"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Profile %"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Commission"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-light-border dark:divide-dark-border",children:o.map(x=>{var O;const p=n.find(B=>B.id===x.userId),{percentage:$}=rs(x);return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap font-medium text-light-text dark:text-dark-text",children:x.name}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-light-text dark:text-dark-text",children:x.id}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx(Ee,{status:x.registrationStatus})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-light-text dark:text-dark-text",children:p!=null&&p.createdAt?new Date(p.createdAt).toLocaleDateString():"N/A"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex justify-center items-center space-x-2",children:[e.jsx(J,{status:x.verification.id.status}),e.jsx("span",{className:"text-light-subtle dark:text-dark-subtle",children:"/"}),e.jsx(J,{status:x.verification.bank.status})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsxs("span",{className:`font-bold ${$===100?"text-green-600 dark:text-green-400":$>=50?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"}`,children:[$,"%"]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"number",value:(O=k[x.id])!=null?O:x.commissionRate,onChange:B=>Me(x.id,B.target.value),className:"w-20 px-2 py-1 border border-light-border dark:border-dark-border rounded-md bg-light-background dark:bg-dark-background text-light-text dark:text-dark-text"}),e.jsx("span",{className:"ml-1 text-light-text dark:text-dark-text",children:"%"}),k[x.id]!==void 0&&e.jsx("button",{onClick:()=>Ce(x.id),className:"ml-2 text-xs text-primary hover:underline",children:"Save"})]})}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-center space-x-2",children:[x.registrationStatus==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>pe(x.id,"approved"),className:"px-2 py-1 text-xs text-white bg-green-600 rounded-md hover:bg-green-700",children:"Approve"}),e.jsx("button",{onClick:()=>pe(x.id,"rejected"),className:"px-2 py-1 text-xs text-white bg-red-600 rounded-md hover:bg-red-700",children:"Reject"})]}),x.registrationStatus==="approved"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>pe(x.id,"pending"),className:"px-2 py-1 text-xs text-white bg-yellow-600 rounded-md hover:bg-yellow-700",children:"Unpublish"}),x.coverImages.length===0&&e.jsx("button",{onClick:()=>{R(x),A(!0)},className:"px-2 py-1 text-xs text-white bg-blue-500 rounded-md hover:bg-blue-600",children:"Set Default"})]}),x.registrationStatus==="rejected"&&e.jsx("button",{onClick:()=>pe(x.id,"approved"),className:"px-2 py-1 text-xs text-white bg-green-600 rounded-md hover:bg-green-700",children:"Re-Approve"}),p&&!p.referrerId&&e.jsx("button",{onClick:()=>_e(p),className:"text-primary hover:underline text-xs font-semibold px-2",children:"Assign Referrer"}),e.jsx("button",{onClick:()=>T(x.id),className:"text-primary hover:underline text-xs font-semibold",children:"View Profile"})]})]},x.id)})})]})}),Oe=()=>e.jsx("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-light-border dark:divide-dark-border text-sm",children:[e.jsx("thead",{className:"bg-light-background dark:bg-dark-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Student ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Registered Date"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Account Balance"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-light-border dark:divide-dark-border",children:de.map(o=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap font-medium text-light-text dark:text-dark-text",children:[o.firstName," ",o.lastName]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-light-text dark:text-dark-text",children:o.id}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-light-text dark:text-dark-text",children:o.email}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-light-text dark:text-dark-text",children:o.createdAt?new Date(o.createdAt).toLocaleDateString():"N/A"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-light-text dark:text-dark-text",children:new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR"}).format(o.accountBalance)}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:[!o.referrerId&&e.jsx("button",{onClick:()=>_e(o),className:"text-primary hover:underline text-xs font-semibold mr-4",children:"Assign Referrer"}),e.jsx("button",{onClick:()=>i(o.id),className:"text-primary hover:underline text-xs font-semibold",children:"View Dashboard"}),e.jsx("button",{onClick:()=>ye(o),className:"text-primary hover:underline text-xs font-semibold ml-4",children:"Edit Profile"})]})]},o.id))})]})}),ve=()=>e.jsx("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-light-border dark:divide-dark-border text-sm",children:[e.jsx("thead",{className:"bg-light-background dark:bg-dark-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Institute ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Registered"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Class Comm."}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Platform Markup"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Photo Comm."}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-light-border dark:divide-dark-border",children:oe.map(o=>{var p,$,O,B;const x=n.find(te=>te.id===o.userId);return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap font-medium",children:o.name}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:o.id}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx(Ee,{status:o.registrationStatus})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:x!=null&&x.createdAt?new Date(x.createdAt).toLocaleDateString():"N/A"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"number",value:(p=L[o.id])!=null?p:o.commissionRate,onChange:te=>Ie(o.id,te.target.value),className:"w-20 px-2 py-1 border rounded-md bg-light-background dark:bg-dark-background"}),e.jsx("span",{className:"ml-1",children:"%"}),L[o.id]!==void 0&&e.jsx("button",{onClick:()=>ce(o.id),className:"ml-2 text-xs text-primary hover:underline",children:"Save"})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"number",value:($=D[o.id])!=null?$:o.platformMarkupRate,onChange:te=>Fe(o.id,te.target.value),className:"w-20 px-2 py-1 border rounded-md bg-light-background dark:bg-dark-background"}),e.jsx("span",{className:"ml-1",children:"%"}),D[o.id]!==void 0&&e.jsx("button",{onClick:()=>Te(o.id),className:"ml-2 text-xs text-primary hover:underline",children:"Save"})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"number",value:(B=(O=z[o.id])!=null?O:o.photoCommissionRate)!=null?B:60,onChange:te=>ke(o.id,te.target.value),min:"0",max:"100",className:"w-20 px-2 py-1 border rounded-md bg-light-background dark:bg-dark-background"}),e.jsx("span",{className:"ml-1",children:"%"}),z[o.id]!==void 0&&e.jsx("button",{onClick:()=>Ae(o.id),className:"ml-2 text-xs text-primary hover:underline",children:"Save"})]})}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-center space-x-2",children:[o.registrationStatus==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Re(o.id,"approved"),className:"px-2 py-1 text-xs text-white bg-green-600 rounded-md hover:bg-green-700",children:"Approve"}),e.jsx("button",{onClick:()=>Re(o.id,"rejected"),className:"px-2 py-1 text-xs text-white bg-red-600 rounded-md hover:bg-red-700",children:"Reject"})]}),e.jsx("button",{onClick:()=>d({name:"admin_ti_dashboard",instituteId:o.id}),className:"text-primary hover:underline text-xs font-semibold",children:"View Dashboard"})]})]},o.id)})})]})});return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"User Management"}),e.jsxs("button",{onClick:Le,className:"flex items-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary-dark transition-colors",children:[e.jsx(vt,{className:"w-4 h-4"}),e.jsx("span",{children:"Download All Contacts"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-4",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx("input",{type:"text",placeholder:"Search by name, ID, or email...",value:v,onChange:o=>g(o.target.value),className:"w-full pl-10 pr-4 py-2 border border-light-border dark:border-dark-border placeholder-light-subtle dark:placeholder-dark-subtle text-light-text dark:text-dark-text bg-light-background dark:bg-dark-background rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"}),e.jsx(as,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-light-subtle dark:text-dark-subtle"})]}),(N==="teachers"||N==="approved_teachers")&&e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:w,onChange:o=>y(o.target.value),className:"w-full md:w-48 px-3 py-2 border border-light-border dark:border-dark-border text-light-text dark:text-dark-text bg-light-background dark:bg-dark-background rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"rejected",children:"Rejected"})]}),e.jsx("input",{type:"number",placeholder:"Comm. %",value:G,onChange:o=>V(o.target.value),className:"w-full md:w-32 px-3 py-2 border border-light-border dark:border-dark-border placeholder-light-subtle dark:placeholder-dark-subtle text-light-text dark:text-dark-text bg-light-background dark:bg-dark-background rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"})]})]}),e.jsx("div",{className:"border-b border-light-border dark:border-dark-border",children:e.jsxs("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:[e.jsxs("button",{onClick:()=>S("teachers"),className:`${N==="teachers"?"border-primary text-primary":"border-transparent text-light-subtle dark:text-dark-subtle hover:text-light-text"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:["All Teachers (",ee.length,")"]}),e.jsxs("button",{onClick:()=>S("approved_teachers"),className:`${N==="approved_teachers"?"border-primary text-primary":"border-transparent text-light-subtle dark:text-dark-subtle hover:text-light-text"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:["Approved Teachers (",ne.length,")"]}),e.jsxs("button",{onClick:()=>S("students"),className:`${N==="students"?"border-primary text-primary":"border-transparent text-light-subtle dark:text-dark-subtle hover:text-light-text"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:["Students (",de.length,")"]}),e.jsxs("button",{onClick:()=>S("institutes"),className:`${N==="institutes"?"border-primary text-primary":"border-transparent text-light-subtle dark:text-dark-subtle hover:text-light-text"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:["Institutes (",oe.length,")"]})]})}),N==="teachers"?ge(ee):N==="approved_teachers"?ge(ne):N==="students"?Oe():ve(),h&&e.jsx(gs,{isOpen:r,onClose:()=>{A(!1),R(null)},teacher:h,onSave:(o,x)=>Ne(h,x),defaultCoverImages:m}),H&&e.jsx(bs,{isOpen:P,onClose:()=>{q(!1),ae(null)},user:H,onAssign:t})]})},js=({isOpen:l,onClose:n,course:s,teacher:T,onApprove:i,onReject:m})=>{const b=new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR"}),f=s.lectures.reduce((t,d)=>t+d.durationMinutes,0)/60;return e.jsx(je,{isOpen:l,onClose:n,title:"Review Course Content",size:"4xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-6",children:[e.jsx("img",{src:tt(s.coverImage,400),alt:s.title,className:"w-full sm:w-1/3 h-auto object-cover rounded-lg shadow-md",crossOrigin:"anonymous"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-2xl font-bold",children:s.title}),e.jsxs("p",{className:"text-sm text-light-subtle dark:text-dark-subtle mt-1",children:["by ",T.name]}),e.jsx("div",{className:"mt-4 text-light-text dark:text-dark-text",children:e.jsx(We,{content:s.description})}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-x-6 gap-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-semibold mr-2",children:"Fee:"})," ",b.format(s.fee)]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-semibold mr-2",children:"Lectures:"})," ",s.lectures.length]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-semibold mr-2",children:"Total Duration:"})," ",f.toFixed(1)," hours"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-3 border-b border-light-border dark:border-dark-border pb-2",children:"Lectures"}),e.jsx("div",{className:"space-y-3 max-h-[40vh] overflow-y-auto pr-2",children:s.lectures.length>0?s.lectures.map((t,d)=>e.jsxs("div",{className:"p-3 bg-light-background dark:bg-dark-background rounded-md border border-light-border dark:border-dark-border",children:[e.jsxs("p",{className:"font-semibold text-light-text dark:text-dark-text",children:[d+1,". ",t.title]}),e.jsx("div",{className:"text-xs text-light-subtle dark:text-dark-subtle mt-1",children:e.jsx(We,{content:t.description,className:"prose-sm prose-p:my-0"})}),e.jsxs("div",{className:"mt-2 text-xs flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center text-light-subtle dark:text-dark-subtle",children:[e.jsx(st,{className:"w-3 h-3 mr-1"})," ",t.durationMinutes," minutes"]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[t.resourcesUrl&&e.jsxs("a",{href:t.resourcesUrl,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-primary hover:underline",children:[e.jsx(ot,{className:"w-3 h-3 mr-1"})," View Resources"]}),t.videoUrl&&e.jsxs("a",{href:t.videoUrl,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-primary hover:underline",children:[e.jsx(ot,{className:"w-3 h-3 mr-1"})," View Video"]})]})]})]},t.id)):e.jsx("p",{className:"text-light-subtle dark:text-dark-subtle",children:"This course has no lectures yet."})})]}),e.jsxs("div",{className:"pt-6 flex justify-end space-x-3 border-t border-light-border dark:border-dark-border",children:[e.jsxs("button",{onClick:m,className:"flex items-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700",children:[e.jsx(le,{className:"w-5 h-5"}),e.jsx("span",{children:"Reject"})]}),e.jsxs("button",{onClick:i,className:"flex items-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700",children:[e.jsx(xe,{className:"w-5 h-5"}),e.jsx("span",{children:"Approve"})]})]})]})})},Ye=({title:l,value:n,icon:s})=>e.jsx("div",{className:"bg-light-surface dark:bg-dark-surface p-5 rounded-lg shadow-md border border-light-border dark:border-dark-border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-primary/10 text-primary rounded-lg mr-4",children:s}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-light-subtle dark:text-dark-subtle",children:l}),e.jsx("p",{className:"text-3xl font-bold text-light-text dark:text-dark-text",children:n})]})]})}),ks=({teachers:l,defaultCoverImages:n,onAddDefaultCoverImage:s,onRemoveDefaultCoverImage:T,onCourseApproval:i})=>{const[m,b]=c.useState(null),f=l.reduce((v,g)=>{var w;return v+(((w=g.courses)==null?void 0:w.length)||0)},0),t=l.reduce((v,g)=>{var w;return v+(((w=g.individualClasses)==null?void 0:w.length)||0)},0),d=l.reduce((v,g)=>{var w;return v+(((w=g.quizzes)==null?void 0:w.length)||0)},0),u=c.useMemo(()=>l.flatMap(v=>(v.courses||[]).filter(g=>g.adminApproval==="pending").map(g=>({course:g,teacher:v}))),[l]),N=()=>{m&&(i(m.teacher.id,m.course.id,"approved"),b(null))},S=()=>{m&&(i(m.teacher.id,m.course.id,"rejected"),b(null))};return e.jsxs("div",{className:"space-y-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Content Management"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(Ye,{title:"Total Courses",value:f,icon:e.jsx(ft,{className:"w-7 h-7"})}),e.jsx(Ye,{title:"Total Classes",value:t,icon:e.jsx(ls,{className:"w-7 h-7"})}),e.jsx(Ye,{title:"Total Quizzes",value:d,icon:e.jsx(ns,{className:"w-7 h-7"})})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:["Courses Pending Review (",u.length,")"]}),u.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-light-border dark:divide-dark-border text-sm",children:[e.jsx("thead",{className:"bg-light-background dark:bg-dark-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Course Title"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Teacher"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-light-border dark:divide-dark-border",children:u.map(({course:v,teacher:g})=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap font-medium",children:e.jsx("button",{onClick:()=>b({course:v,teacher:g}),className:"text-primary hover:underline text-left",children:v.title})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:g.name}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-center space-x-2",children:[e.jsxs("button",{onClick:()=>i(g.id,v.id,"approved"),className:"px-3 py-1 text-xs font-medium text-white bg-green-600 rounded-md hover:bg-green-700 inline-flex items-center",children:[e.jsx(xe,{className:"w-4 h-4 mr-1"}),"Approve"]}),e.jsxs("button",{onClick:()=>i(g.id,v.id,"rejected"),className:"px-3 py-1 text-xs font-medium text-white bg-red-600 rounded-md hover:bg-red-700 inline-flex items-center",children:[e.jsx(le,{className:"w-4 h-4 mr-1"}),"Reject"]})]})]},v.id))})]})}):e.jsx("p",{className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:"No courses are currently pending review."})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Manage Default Teacher Cover Images"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[n.map(v=>e.jsxs("div",{className:"relative group aspect-video",children:[e.jsx("img",{src:v,alt:"Default cover",className:"w-full h-full object-cover rounded-md"}),e.jsx("div",{className:"absolute inset-0 bg-black/60 rounded-md flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("button",{onClick:()=>T(v),className:"text-white p-2 bg-red-500/80 rounded-full hover:bg-red-600 transition-colors","aria-label":"Remove image",children:e.jsx(Se,{className:"w-5 h-5"})})})]},v)),e.jsxs("button",{onClick:s,className:"aspect-video flex flex-col items-center justify-center p-6 border-2 border-dashed border-light-border dark:border-dark-border rounded-lg hover:border-primary dark:hover:border-primary-light hover:text-primary dark:hover:text-primary-light transition-colors",children:[e.jsx(fe,{className:"w-8 h-8 mb-2"}),e.jsx("span",{className:"font-semibold text-sm text-center",children:"Add New Image"})]})]})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Content Moderation"}),e.jsx("p",{className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:"(A section for reviewing/flagging content would be here)"})]}),m&&e.jsx(js,{isOpen:!!m,onClose:()=>b(null),course:m.course,teacher:m.teacher,onApprove:N,onReject:S})]})},Ns=({isOpen:l,onClose:n,product:s,teacher:T,onApprove:i,onReject:m})=>{const b=new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR"}),[f,t]=be.useState(0);return e.jsx(je,{isOpen:l,onClose:n,title:"Review Product",size:"4xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"rounded-lg shadow-lg overflow-hidden",children:e.jsx(cs,{images:s.coverImages,isEditable:!1,currentIndex:f,onIndexChange:t,onEditImage:()=>{},onRemoveImage:()=>{}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-2xl font-bold",children:s.title}),e.jsxs("p",{className:"text-sm text-light-subtle dark:text-dark-subtle mt-1",children:["by ",T.name]}),e.jsx("div",{className:"my-4",children:e.jsx("p",{className:"text-3xl font-bold text-primary",children:b.format(s.price)})}),e.jsxs("div",{className:"mt-4 space-y-3 text-sm border-t border-light-border dark:border-dark-border pt-4",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",e.jsx("span",{className:"capitalize",children:s.type})]}),s.type==="digital"&&s.downloadUrl&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("strong",{className:"mr-2",children:"Download Link:"}),e.jsxs("a",{href:s.downloadUrl,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline truncate flex items-center gap-1",children:[e.jsx(vt,{className:"w-4 h-4"}),e.jsx("span",{children:"Click to verify"})]})]}),s.type==="physical"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Stock:"})," ",s.stock!==void 0&&s.stock>=0?`${s.stock} available`:"Unlimited"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Lead Time:"})," ",s.orderLeadTime||"Not specified"]})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-3 border-b border-light-border dark:border-dark-border pb-2",children:"Description"}),e.jsx("div",{className:"max-h-[30vh] overflow-y-auto pr-2",children:e.jsx(We,{content:s.description})})]}),e.jsxs("div",{className:"pt-6 flex justify-end space-x-3 border-t border-light-border dark:border-dark-border",children:[e.jsxs("button",{onClick:m,className:"flex items-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700",children:[e.jsx(le,{className:"w-5 h-5"}),e.jsx("span",{children:"Reject"})]}),e.jsxs("button",{onClick:i,className:"flex items-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700",children:[e.jsx(xe,{className:"w-5 h-5"}),e.jsx("span",{children:"Approve"})]})]})]})})},ys=({teachers:l,onProductApproval:n})=>{const[s,T]=c.useState(null),i=c.useMemo(()=>l.flatMap(t=>(t.products||[]).filter(d=>d.adminApproval==="pending").map(d=>({product:d,teacher:t}))),[l]),m=new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR"}),b=()=>{s&&(n(s.teacher.id,s.product.id,"approved"),T(null))},f=()=>{s&&(n(s.teacher.id,s.product.id,"rejected"),T(null))};return e.jsxs("div",{className:"space-y-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Product Management"}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:["Products Pending Review (",i.length,")"]}),i.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-light-border dark:divide-dark-border text-sm",children:[e.jsx("thead",{className:"bg-light-background dark:bg-dark-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Teacher"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-light-border dark:divide-dark-border",children:i.map(({product:t,teacher:d})=>{var u;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:((u=t.coverImages)==null?void 0:u[0])||"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 150' fill='%23e2e8f0'%3E%3Crect width='150' height='150'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='16px' fill='%2364748b'%3ENo Img%3C/text%3E%3C/svg%3E",alt:t.title,className:"w-12 h-12 object-cover rounded-md mr-4"}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>T({product:t,teacher:d}),className:"font-semibold text-primary hover:underline text-left",children:t.title}),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:t.id})]})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:d.name}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right font-semibold",children:m.format(t.price)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center capitalize",children:t.type}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-center space-x-2",children:[e.jsx("button",{onClick:()=>n(d.id,t.id,"approved"),className:"px-3 py-1 text-xs font-medium text-white bg-green-600 rounded-md hover:bg-green-700",children:"Approve"}),e.jsx("button",{onClick:()=>n(d.id,t.id,"rejected"),className:"px-3 py-1 text-xs font-medium text-white bg-red-600 rounded-md hover:bg-red-700",children:"Reject"})]})]},t.id)})})]})}):e.jsx("p",{className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:"No products are currently pending review."})]}),s&&e.jsx(Ns,{isOpen:!!s,onClose:()=>T(null),product:s.product,teacher:s.teacher,onApprove:b,onReject:f})]})},vs=({teachers:l,allUsers:n,topUpRequests:s,onUpdateWithdrawal:T,handleTopUpDecision:i,onViewTeacher:m})=>{const[b,f]=be.useState(!1),[t,d]=be.useState(null),[u,N]=be.useState(null),[S,v]=c.useState(null),[g,w]=c.useState({}),[y,G]=c.useState(!1),V=be.useMemo(()=>{const a=l.flatMap(U=>U.withdrawalHistory.filter(z=>z.status==="pending").map(z=>F(_({},z),{user:n.find(K=>K.id===U.userId),userType:"Teacher"}))),D=n.filter(U=>U.role!=="teacher"&&U.withdrawalHistory&&U.withdrawalHistory.length>0).flatMap(U=>U.withdrawalHistory.filter(z=>z.status==="pending").map(z=>F(_({},z),{user:U,userType:"Affiliate"})));return[...a,...D].sort((U,z)=>new Date(U.requestedAt).getTime()-new Date(z.requestedAt).getTime())},[l,n]),r=be.useMemo(()=>s.filter(a=>a.status==="pending").map(a=>F(_({},a),{student:n.find(D=>D.id===a.studentId)})).sort((a,D)=>new Date(a.requestedAt).getTime()-new Date(D.requestedAt).getTime()),[s,n]),A=be.useMemo(()=>{const a=s.filter(K=>K.status==="approved"&&K.method==="slip"),D=n.flatMap(K=>(K.topUpHistory||[]).filter(P=>P.status==="approved"&&P.method==="slip").map(P=>F(_({},P),{studentId:K.id}))),U=[...a,...D],z=new Map;return U.forEach(K=>{z.has(K.id)||z.set(K.id,F(_({},K),{student:n.find(P=>P.id===K.studentId)}))}),Array.from(z.values()).sort((K,P)=>new Date(P.processedAt||P.requestedAt).getTime()-new Date(K.processedAt||K.requestedAt).getTime())},[s,n]),h=new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR"}),R=a=>{d(a),f(!0)},k=a=>{t&&i(t.id,"rejected",a),f(!1),d(null)},M=a=>{a&&(a.role==="teacher"?m(a.id):v(a))},L=(a,D)=>{w(U=>F(_({},U),{[a]:D}))};return e.jsxs("div",{className:"space-y-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Revenue & Payouts"}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Pending Top-Up Requests"}),r.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-light-border dark:divide-dark-border text-sm",children:[e.jsx("thead",{className:"bg-light-background dark:bg-dark-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium uppercase tracking-wider",children:"Amount (LKR)"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Requested On"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-light-border dark:divide-dark-border",children:r.map(a=>{const D=g[a.id],U=D!==void 0&&parseFloat(D)!==a.amount,z=D!=null?D:a.amount.toString();return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:a.student?e.jsxs("button",{onClick:()=>v(a.student),className:"text-left group",children:[e.jsxs("p",{className:"font-medium group-hover:underline",children:[a.student.firstName," ",a.student.lastName]}),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:a.student.id})]}):"Unknown"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right",children:e.jsx("input",{type:"number",value:z,onChange:K=>L(a.id,K.target.value),className:"w-28 px-2 py-1 border rounded-md text-right bg-light-background dark:bg-dark-background border-light-border dark:border-dark-border",step:"0.01"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:new Date(a.requestedAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-center space-x-2",children:[e.jsx("button",{onClick:()=>a.imageUrl&&N({url:a.imageUrl,title:"Payment Slip"}),className:"px-3 py-1 text-xs font-medium text-primary hover:underline",children:"View Slip"}),U?e.jsx("button",{onClick:()=>i(a.id,"approved",void 0,parseFloat(g[a.id])),className:"px-3 py-1 text-xs font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700",children:"Update & Approve"}):e.jsx("button",{onClick:()=>i(a.id,"approved"),className:"px-3 py-1 text-xs font-medium text-white bg-green-600 rounded-md hover:bg-green-700",children:"Approve"}),e.jsx("button",{onClick:()=>R(a),className:"px-3 py-1 text-xs font-medium text-white bg-red-600 rounded-md hover:bg-red-700",children:"Reject"})]})]},a.id)})})]})}):e.jsx("p",{className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:"No pending top-up requests."})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsxs("button",{onClick:()=>G(!y),className:"w-full flex justify-between items-center text-left",children:[e.jsxs("h2",{className:"text-xl font-bold",children:["Approved Payment Slips (",A.length,")"]}),e.jsx(at,{className:`w-6 h-6 transition-transform ${y?"rotate-180":""}`})]}),y&&e.jsx("div",{className:"mt-4 overflow-x-auto animate-fadeIn",children:A.length>0?e.jsxs("table",{className:"min-w-full divide-y divide-light-border dark:divide-dark-border text-sm",children:[e.jsx("thead",{className:"bg-light-background dark:bg-dark-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Processed On"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Requested On"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-light-border dark:divide-dark-border",children:A.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:a.student?e.jsxs("button",{onClick:()=>v(a.student),className:"text-left group",children:[e.jsxs("p",{className:"font-medium group-hover:underline",children:[a.student.firstName," ",a.student.lastName]}),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:a.student.id})]}):"Unknown"}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-right",children:[e.jsx("p",{className:"font-semibold",children:h.format(a.amount)}),a.originalAmount&&a.originalAmount!==a.amount&&e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle line-through",children:h.format(a.originalAmount)})]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:a.processedAt?new Date(a.processedAt).toLocaleString():"N/A"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:new Date(a.requestedAt).toLocaleString()}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx("button",{onClick:()=>a.imageUrl&&N({url:a.imageUrl,title:"Payment Slip"}),className:"px-3 py-1 text-xs font-medium text-primary hover:underline",children:"View Slip"})})]},a.id))})]}):e.jsx("p",{className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:"No approved payment slips found."})})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Pending Withdrawal Requests"}),V.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-light-border dark:divide-dark-border text-sm",children:[e.jsx("thead",{className:"bg-light-background dark:bg-dark-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"User Type"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Requested On"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-light-border dark:divide-dark-border",children:V.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:a.user?e.jsxs("button",{onClick:()=>M(a.user),className:"text-left group",children:[e.jsxs("p",{className:"font-medium group-hover:underline",children:[a.user.firstName," ",a.user.lastName]}),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:a.user.id})]}):"N/A"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:a.userType}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right font-semibold",children:h.format(a.amount)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:new Date(a.requestedAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-center space-x-2",children:[e.jsx("button",{onClick:()=>T(a.userId,a.id,"completed"),className:"px-3 py-1 text-xs font-medium text-white bg-green-600 rounded-md hover:bg-green-700",children:"Mark as Completed"}),e.jsx("button",{onClick:()=>T(a.userId,a.id,"failed","Admin rejected."),className:"px-3 py-1 text-xs font-medium text-white bg-red-600 rounded-md hover:bg-red-700",children:"Mark as Failed"})]})]},a.id))})]})}):e.jsx("p",{className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:"No pending withdrawal requests."})]}),u&&e.jsx(ms,{isOpen:!!u,onClose:()=>N(null),imageUrl:u.url,title:u.title}),e.jsx(xs,{isOpen:b,onClose:()=>f(!1),onSubmit:k}),S&&e.jsx(Ge,{isOpen:!!S,onClose:()=>v(null),student:S})]})},ws=({isOpen:l,onClose:n})=>{const{users:s,handleGenerateVouchers:T}=Z(),[i,m]=c.useState("specific_students"),[b,f]=c.useState([]),[t,d]=c.useState(""),[u,N]=c.useState(""),[S,v]=c.useState(""),[g,w]=c.useState("6"),[y,G]=c.useState(""),[V,r]=c.useState(!1),A=c.useMemo(()=>s.filter(a=>a.role==="student"),[s]),h=c.useMemo(()=>{if(!y)return A.slice(0,50);const a=y.toLowerCase();return A.filter(D=>`${D.firstName} ${D.lastName}`.toLowerCase().includes(a)||D.email.toLowerCase().includes(a)||D.id.toLowerCase().includes(a))},[A,y]),R=a=>{f(D=>D.includes(a)?D.filter(U=>U!==a):[...D,a])},k=()=>{const a=h.map(U=>U.id),D=new Set([...b,...a]);f(Array.from(D))},M=()=>f([]),L=a=>W(void 0,null,function*(){a.preventDefault();let D=[];if(i==="all_students"){if(!window.confirm(`Are you surely you want to generate a voucher for ALL ${A.length} students?`))return;D=A.map(K=>K.id)}else{if(b.length===0){alert("Please select at least one student.");return}D=b}const U=parseFloat(t);if(isNaN(U)||U<=0){alert("Please enter a valid amount.");return}r(!0);const z=new Date;z.setMonth(z.getMonth()+parseInt(g));try{yield T(D,U,{title:u,rules:S,expiryDate:z.toISOString()}),n()}catch(K){console.error(K)}finally{r(!1)}});return e.jsx(je,{isOpen:l,onClose:n,title:"Generate Free Gift Vouchers",children:e.jsxs("form",{onSubmit:L,className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-light-background dark:bg-dark-background border border-light-border dark:border-dark-border rounded-md",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"1. Select Recipients"}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"targetType",checked:i==="specific_students",onChange:()=>m("specific_students"),className:"text-primary focus:ring-primary"}),e.jsx("span",{children:"Select Students"})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"targetType",checked:i==="all_students",onChange:()=>m("all_students"),className:"text-primary focus:ring-primary"}),e.jsxs("span",{children:["All Students (",A.length,")"]})]})]}),i==="specific_students"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",placeholder:"Search by name, ID or email...",value:y,onChange:a=>G(a.target.value),className:"w-full p-2 text-sm border border-light-border dark:border-dark-border rounded bg-light-surface dark:bg-dark-surface focus:ring-primary focus:border-primary"}),e.jsxs("div",{className:"flex justify-between text-xs text-light-subtle dark:text-dark-subtle",children:[e.jsxs("span",{children:[b.length," selected"]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{type:"button",onClick:k,className:"hover:text-primary",children:"Select All Visible"}),e.jsx("button",{type:"button",onClick:M,className:"hover:text-red-500",children:"Clear Selection"})]})]}),e.jsxs("div",{className:"max-h-48 overflow-y-auto border border-light-border dark:border-dark-border rounded bg-light-surface dark:bg-dark-surface p-2 space-y-1",children:[h.map(a=>e.jsxs("div",{onClick:()=>R(a.id),className:`flex items-center justify-between p-2 rounded cursor-pointer ${b.includes(a.id)?"bg-primary/10 border border-primary/20":"hover:bg-light-background dark:hover:bg-dark-background"}`,children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"font-semibold",children:[a.firstName," ",a.lastName]}),e.jsxs("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:[a.email,"  ",a.id]})]}),b.includes(a.id)&&e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full"})]},a.id)),h.length===0&&e.jsx("p",{className:"text-center text-sm py-2",children:"No students found."})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(E,{label:"Voucher Amount (LKR)",name:"amount",type:"number",value:t,onChange:a=>d(a.target.value),required:!0,placeholder:"e.g. 1000"}),e.jsx(wt,{label:"Valid For",name:"expiry",value:g,onChange:a=>w(a.target.value),options:[{value:"1",label:"1 Month"},{value:"3",label:"3 Months"},{value:"6",label:"6 Months"},{value:"12",label:"1 Year"}]})]}),e.jsx(E,{label:"Voucher Title (Optional)",name:"title",value:u,onChange:a=>N(a.target.value),placeholder:"e.g. New Year Gift"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Redemption Rules / Description"}),e.jsx("textarea",{value:S,onChange:a=>v(a.target.value),rows:3,className:"w-full p-2 border border-light-border dark:border-dark-border rounded bg-light-surface dark:bg-dark-surface focus:outline-none focus:ring-primary focus:border-primary text-sm",placeholder:"e.g. Valid only for Physics Revision classes. Enter code at checkout."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 border border-light-border dark:border-dark-border rounded text-sm hover:bg-light-background dark:hover:bg-dark-background",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:V,className:"flex items-center gap-2 px-6 py-2 bg-primary text-white rounded hover:bg-primary-dark disabled:opacity-50",children:V?"Generating...":e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-4 h-4"})," Generate"]})})]})]})})},Ss=({isOpen:l,onClose:n,voucher:s,onSave:T})=>{var u,N;const[i,m]=c.useState({}),[b,f]=c.useState(!1);c.useEffect(()=>{l&&s&&m({amount:s.amount,title:s.title,redemptionRules:s.redemptionRules,expiresAt:s.expiresAt?new Date(s.expiresAt).toISOString().split("T")[0]:""})},[l,s]);const t=S=>{const{name:v,value:g}=S.target;m(w=>F(_({},w),{[v]:g}))},d=S=>W(void 0,null,function*(){S.preventDefault(),f(!0);try{yield T(s.id,F(_({},i),{amount:Number(i.amount),expiresAt:i.expiresAt?new Date(i.expiresAt).toISOString():s.expiresAt})),n()}finally{f(!1)}});return e.jsx(je,{isOpen:l,onClose:n,title:"Edit Voucher",children:e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsx(E,{label:"Title",name:"title",value:i.title||"",onChange:t}),e.jsx(E,{label:"Amount",name:"amount",type:"number",value:((u=i.amount)==null?void 0:u.toString())||"",onChange:t}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-light-text dark:text-dark-text",children:"Redemption Rules"}),e.jsx("textarea",{name:"redemptionRules",value:i.redemptionRules||"",onChange:t,className:"w-full p-2 border border-light-border dark:border-dark-border rounded-md bg-light-background dark:bg-dark-background text-light-text dark:text-dark-text",rows:3})]}),e.jsx(E,{label:"Expiry Date",name:"expiresAt",type:"date",value:((N=i.expiresAt)==null?void 0:N.split("T")[0])||"",onChange:t}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsxs("button",{type:"button",onClick:n,className:"px-4 py-2 border border-light-border dark:border-dark-border rounded-md text-light-text dark:text-dark-text hover:bg-light-background dark:hover:bg-dark-background flex items-center",children:[e.jsx(yt,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:b,className:"px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark flex items-center",children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Save"]})]})]})})},Cs=({voucher:l})=>l.isUsed?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",children:[e.jsx(le,{className:"w-4 h-4 mr-1.5 text-gray-500 dark:text-gray-400"}),"Used"]}):new Date>new Date(l.expiresAt)?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300",children:[e.jsx(st,{className:"w-4 h-4 mr-1.5"}),"Expired"]}):e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300",children:[e.jsx(xe,{className:"w-4 h-4 mr-1.5"}),"Available"]}),Is=({vouchers:l,users:n})=>{const{handleDeleteVoucher:s,handleUpdateVoucher:T}=Z(),[i,m]=c.useState(""),[b,f]=c.useState(null),[t,d]=c.useState(!1),[u,N]=c.useState(null),[S,v]=c.useState(null),[g,w]=c.useState(!1),y=new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR"}),G=c.useMemo(()=>{let h=l.map(R=>{const k=R.usedBy?n.find(M=>M.id===R.usedBy):null;return F(_({},R),{redeemedByUser:k,redeemedByName:k?`${k.firstName} ${k.lastName}`:R.usedBy})});if(i.trim()){const R=i.toLowerCase();h=h.filter(k=>k.code.toLowerCase().includes(R)||k.redeemedByName&&k.redeemedByName.toLowerCase().includes(R))}return h.sort((R,k)=>new Date(k.purchasedAt).getTime()-new Date(R.purchasedAt).getTime())},[l,n,i]),V=h=>{if(h.isUsed){alert("Cannot delete a voucher that has already been used.");return}N(h)},r=()=>W(void 0,null,function*(){u&&(yield s(u.id),N(null))}),A=h=>{v(h),w(!0)};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Voucher Management"}),e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center space-x-2 px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark transition-colors shadow-md",children:[e.jsx(fe,{className:"w-5 h-5"}),e.jsx("span",{children:"Generate Free Vouchers"})]})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"All Vouchers"}),e.jsx("input",{type:"text",placeholder:"Search by code or student...",value:i,onChange:h=>m(h.target.value),className:"w-full max-w-xs px-3 py-2 border border-light-border dark:border-dark-border placeholder-light-subtle dark:placeholder-dark-subtle text-light-text dark:text-dark-text bg-light-background dark:bg-dark-background rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-light-border dark:divide-dark-border text-sm",children:[e.jsx("thead",{className:"bg-light-background dark:bg-dark-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Code"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Redeemed By"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Purchaser"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Purchased"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Expires"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-light-border dark:divide-dark-border",children:G.map(h=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap font-mono font-semibold",children:h.code}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right font-medium",children:y.format(h.amount)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx(Cs,{voucher:h})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-xs",children:h.generatedByAdmin?e.jsx("span",{className:"text-purple-600 dark:text-purple-400 font-semibold bg-purple-50 dark:bg-purple-900/20 px-2 py-0.5 rounded",children:"Admin Gift"}):"Purchased"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:h.isUsed?h.redeemedByUser?e.jsxs("button",{onClick:()=>f(h.redeemedByUser),className:"text-left group",children:[e.jsx("p",{className:"font-medium group-hover:underline",children:h.redeemedByName}),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:h.usedBy}),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:h.usedAt?new Date(h.usedAt).toLocaleDateString():""})]}):e.jsxs("div",{children:[e.jsx("p",{children:h.redeemedByName}),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:h.usedAt?new Date(h.usedAt).toLocaleDateString():""})]}):h.assignedToUserId?e.jsx("span",{className:"text-xs text-blue-500",children:"Assigned to user"}):"-"}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap",children:[h.billingFirstName," ",h.billingLastName]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:new Date(h.purchasedAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:new Date(h.expiresAt).toLocaleDateString()}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-center space-x-2",children:[e.jsx("button",{onClick:()=>A(h),className:"text-primary hover:underline",title:"Edit Voucher",children:e.jsx(St,{className:"w-4 h-4"})}),!h.isUsed&&e.jsx("button",{onClick:()=>V(h),className:"text-red-500 hover:underline",title:"Delete Voucher",children:e.jsx(Se,{className:"w-4 h-4"})})]})]},h.code))})]})})]}),b&&e.jsx(Ge,{isOpen:!!b,onClose:()=>f(null),student:b}),e.jsx(ws,{isOpen:t,onClose:()=>d(!1)}),u&&e.jsx(rt,{isOpen:!0,onClose:()=>N(null),onConfirm:r,title:"Delete Voucher",message:`Are you sure you want to delete voucher ${u.code}? This action cannot be undone.`,confirmText:"Delete"}),S&&e.jsx(Ss,{isOpen:g,onClose:()=>{w(!1),v(null)},voucher:S,onSave:T})]})},He=({title:l,value:n,icon:s})=>e.jsx("div",{className:"bg-light-surface dark:bg-dark-surface p-5 rounded-lg shadow-md border border-light-border dark:border-dark-border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-primary/10 text-primary rounded-lg mr-4",children:s}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-light-subtle dark:text-dark-subtle",children:l}),e.jsx("p",{className:"text-3xl font-bold text-light-text dark:text-dark-text",children:n})]})]})}),Ts=({users:l,teachers:n,sales:s,onViewTeacher:T})=>{const[i,m]=c.useState(null),b=new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR",minimumFractionDigits:0}),f=d=>{d.role==="teacher"?T(d.id):m(d)},t=c.useMemo(()=>{const S=l.filter(w=>l.some(y=>y.referrerId===w.id)),v=l.filter(w=>w.referrerId).length,g=S.map(w=>{const y=l.filter(L=>L.referrerId===w.id),G=y.filter(L=>L.role==="student").length,V=y.filter(L=>L.role==="teacher"),r=new Set(V.map(L=>L.id)),A=n.filter(L=>L.registrationStatus==="approved"&&r.has(L.userId));let h=0,R=0;const k=new Map;return s.filter(L=>A.some(a=>a.id===L.teacherId)&&L.status==="completed").sort((L,a)=>new Date(L.saleDate).getTime()-new Date(a.saleDate).getTime()).forEach(L=>{const a=n.find(ne=>ne.id===L.teacherId);if(!a)return;const D=L.totalAmount+L.amountPaidFromBalance,U=D*(a.commissionRate/100),z=D*.04,K=D*.04,P=U-z-K;if(P<=0)return;h+=P;const q=k.get(a.id)||0;if(q>=1e5)return;const H=P*.04,ae=1e5-q,ee=Math.min(H,ae);k.set(a.id,q+ee)}),R=Array.from(k.values()).reduce((L,a)=>L+a,0),F(_({},w),{referredStudentsCount:G,referredTeachersCount:A.length,totalNetPlatformIncomeFromReferrals:h,totalEarningsForReferrer:R})});return{totalReferrers:S.length,totalReferredUsers:v,referrerDetails:g.sort((w,y)=>y.totalEarningsForReferrer-w.totalEarningsForReferrer)}},[l,n,s]);return e.jsxs("div",{className:"space-y-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Referral System Overview"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(He,{title:"Total Referrers",value:t.totalReferrers,icon:e.jsx(jt,{className:"w-7 h-7"})}),e.jsx(He,{title:"Total Referred Users",value:t.totalReferredUsers,icon:e.jsx(Nt,{className:"w-7 h-7"})}),e.jsx(He,{title:"Total Est. Payouts",value:b.format(t.referrerDetails.reduce((d,u)=>d+u.totalEarningsForReferrer,0)),icon:e.jsx(et,{className:"w-7 h-7"})})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Referrer Leaderboard"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-light-border dark:divide-dark-border text-sm",children:[e.jsx("thead",{className:"bg-light-background dark:bg-dark-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-light-subtle dark:text-dark-subtle",children:"Referrer"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-light-subtle dark:text-dark-subtle",children:"Code"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium uppercase tracking-wider text-light-subtle dark:text-dark-subtle",children:"Ref. Students"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium uppercase tracking-wider text-light-subtle dark:text-dark-subtle",children:"Ref. Teachers"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium uppercase tracking-wider text-light-subtle dark:text-dark-subtle",children:"Net Platform Income"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium uppercase tracking-wider text-light-subtle dark:text-dark-subtle",children:"Total Earnings"})]})}),e.jsx("tbody",{className:"divide-y divide-light-border dark:divide-dark-border",children:t.referrerDetails.map(d=>{var u,N;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("button",{onClick:()=>f(d),className:"flex items-center group",children:[d.avatar?e.jsx("img",{src:d.avatar,alt:`${d.firstName} ${d.lastName}`,className:"w-8 h-8 rounded-full mr-3",crossOrigin:"anonymous"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary flex-shrink-0 flex items-center justify-center text-white text-sm font-bold mr-3",children:e.jsxs("span",{children:[((u=d.firstName)==null?void 0:u.charAt(0))||"",((N=d.lastName)==null?void 0:N.charAt(0))||""]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-light-text dark:text-dark-text group-hover:underline",children:[d.firstName," ",d.lastName]}),e.jsx("p",{className:"text-xs text-left text-light-subtle dark:text-dark-subtle",children:d.id})]})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap font-mono text-light-text dark:text-dark-text",children:d.referralCode}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center font-medium text-light-text dark:text-dark-text",children:d.referredStudentsCount}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center font-medium text-light-text dark:text-dark-text",children:d.referredTeachersCount}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-light-text dark:text-dark-text",children:b.format(d.totalNetPlatformIncomeFromReferrals)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right font-bold text-green-600 dark:text-green-400",children:b.format(d.totalEarningsForReferrer)})]},d.id)})})]})})]}),i&&e.jsx(Ge,{isOpen:!!i,onClose:()=>m(null),student:i})]})},As=({allSales:l,allUsers:n,allTeachers:s,onViewTeacher:T,onUpdateSaleStatus:i,onRefundSale:m})=>{const[b,f]=c.useState(""),[t,d]=c.useState("all"),[u,N]=c.useState(null),[S,v]=c.useState(null),g=c.useMemo(()=>l.map(r=>{const A=s.find(R=>R.id===r.teacherId),h=n.find(R=>R.id===r.studentId);return F(_({},r),{teacher:A,student:h})}).sort((r,A)=>new Date(A.saleDate).getTime()-new Date(r.saleDate).getTime()),[l,n,s]),w=c.useMemo(()=>g.filter(r=>{const A=t==="all"||r.status===t,h=b.toLowerCase(),R=!b.trim()||r.itemName.toLowerCase().includes(h)||r.student&&`${r.student.firstName} ${r.student.lastName}`.toLowerCase().includes(h)||r.teacher&&r.teacher.name.toLowerCase().includes(h)||r.id.toLowerCase().includes(h);return A&&R}),[g,b,t]),y=new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR"}),G=({status:r})=>{const h={completed:{icon:e.jsx(xe,{className:"w-4 h-4 mr-1.5"}),text:"Completed",classes:"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300"},refunded:{icon:e.jsx(le,{className:"w-4 h-4 mr-1.5"}),text:"Refunded",classes:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"},hold:{icon:e.jsx(ct,{className:"w-4 h-4 mr-1.5"}),text:"On Hold",classes:"bg-yellow-100 text-yellow-800 dark:bg-yellow-800/50 dark:text-yellow-300"},failed:{icon:e.jsx(le,{className:"w-4 h-4 mr-1.5"}),text:"Failed",classes:"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300"},cleared:{icon:e.jsx(xe,{className:"w-4 h-4 mr-1.5"}),text:"Cleared",classes:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"},canceled:{icon:e.jsx(le,{className:"w-4 h-4 mr-1.5"}),text:"Canceled",classes:"bg-orange-100 text-orange-800 dark:bg-orange-900/50 dark:text-orange-300"}}[r];if(!h)return null;const{icon:R,text:k,classes:M}=h;return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${M}`,children:[R,k]})},V=()=>{if(u){switch(u.action){case"hold":i(u.sale.id,"hold");break;case"unhold":i(u.sale.id,"completed");break;case"cancel":i(u.sale.id,"canceled");break;case"refund":m(u.sale.id);break}N(null)}};return e.jsxs("div",{className:"space-y-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"All Sales Transactions"}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Search by item, student, teacher, or ID...",value:b,onChange:r=>f(r.target.value),className:"w-full sm:flex-grow px-3 py-2 border border-light-border dark:border-dark-border placeholder-light-subtle dark:placeholder-dark-subtle text-light-text dark:text-dark-text bg-light-background dark:bg-dark-background rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"}),e.jsxs("select",{value:t,onChange:r=>d(r.target.value),className:"w-full sm:w-auto px-3 py-2 border border-light-border dark:border-dark-border text-light-text dark:text-dark-text bg-light-background dark:bg-dark-background rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"hold",children:"On Hold"}),e.jsx("option",{value:"refunded",children:"Refunded"}),e.jsx("option",{value:"failed",children:"Failed"}),e.jsx("option",{value:"canceled",children:"Canceled"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-light-border dark:divide-dark-border text-sm",children:[e.jsx("thead",{className:"bg-light-background dark:bg-dark-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Student & Teacher"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Item"}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-medium uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-medium uppercase tracking-wider",children:"Platform"}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-medium uppercase tracking-wider",children:"Teacher"}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-medium uppercase tracking-wider",children:"Institute"}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-medium uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-medium uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-light-border dark:divide-dark-border",children:w.map(r=>e.jsxs("tr",{className:`${r.status==="refunded"?"bg-gray-50 dark:bg-gray-800/50 text-light-subtle dark:text-dark-subtle":"text-light-text dark:text-dark-text"}`,children:[e.jsx("td",{className:"px-3 py-3 whitespace-nowrap",children:new Date(r.saleDate).toLocaleDateString()}),e.jsxs("td",{className:"px-3 py-3 whitespace-nowrap",children:[r.student?e.jsxs("button",{onClick:()=>v(r.student),className:"text-left group w-full",children:[e.jsxs("p",{className:"font-medium group-hover:underline",children:[r.student.firstName," ",r.student.lastName]}),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:r.student.id})]}):"N/A",r.teacher?e.jsx("button",{onClick:()=>T(r.teacher.id),className:"text-left group w-full mt-1",children:e.jsx("p",{className:"text-primary group-hover:underline text-xs",children:r.teacher.name})}):e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle mt-1",children:"N/A"})]}),e.jsxs("td",{className:"px-3 py-3",children:[e.jsx("p",{className:"font-medium",children:r.itemName}),e.jsx("p",{className:"text-xs capitalize",children:r.itemType})]}),e.jsx("td",{className:`px-3 py-3 whitespace-nowrap text-right font-semibold ${r.status==="refunded"&&"line-through"}`,children:y.format(r.totalAmount+r.amountPaidFromBalance)}),e.jsx("td",{className:`px-3 py-3 whitespace-nowrap text-right ${r.status==="refunded"&&"line-through"}`,children:y.format(r.platformCommission||0)}),e.jsx("td",{className:`px-3 py-3 whitespace-nowrap text-right ${r.status==="refunded"&&"line-through"}`,children:y.format(r.teacherCommission||0)}),e.jsx("td",{className:`px-3 py-3 whitespace-nowrap text-right ${r.status==="refunded"&&"line-through"}`,children:y.format(r.instituteCommission||0)}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-center",children:e.jsx(G,{status:r.status})}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-center",children:e.jsxs("div",{className:"relative inline-block text-left group",children:[e.jsx("button",{className:"px-2 py-1 text-xs font-medium border border-light-border dark:border-dark-border rounded-md hover:bg-light-border dark:hover:bg-dark-border",children:"Actions "}),e.jsx("div",{className:"absolute right-0 bottom-full w-40 origin-bottom-right bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-md shadow-lg invisible group-hover:visible z-10",children:e.jsxs("div",{className:"py-1",children:[r.status==="completed"&&e.jsxs("button",{onClick:()=>N({sale:r,action:"hold"}),className:"w-full text-left flex items-center px-4 py-2 text-sm hover:bg-light-border dark:hover:bg-dark-border",children:[e.jsx(ct,{className:"w-4 h-4 mr-2"}),"Hold"]}),r.status==="hold"&&e.jsxs("button",{onClick:()=>N({sale:r,action:"unhold"}),className:"w-full text-left flex items-center px-4 py-2 text-sm hover:bg-light-border dark:hover:bg-dark-border",children:[e.jsx(ds,{className:"w-4 h-4 mr-2"}),"Mark as Completed"]}),r.status==="hold"&&e.jsxs("button",{onClick:()=>N({sale:r,action:"cancel"}),className:"w-full text-left flex items-center px-4 py-2 text-sm hover:bg-light-border dark:hover:bg-dark-border",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Cancel"]}),r.status!=="refunded"&&r.status!=="canceled"&&e.jsxs("button",{onClick:()=>N({sale:r,action:"refund"}),className:"w-full text-left flex items-center px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/50",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Refund"]})]})})]})})]},r.id))})]})})]}),u&&e.jsx(rt,{isOpen:!0,onClose:()=>N(null),onConfirm:V,title:`Confirm Action: ${u.action.charAt(0).toUpperCase()+u.action.slice(1)}`,message:`Are you sure you want to ${u.action} this transaction for "${u.sale.itemName}"?`,confirmText:`Yes, ${u.action}`}),S&&e.jsx(Ge,{isOpen:!!S,onClose:()=>v(null),student:S})]})},ut=[{id:"facebook",name:"Facebook",icon:"FacebookIcon"},{id:"twitter",name:"Twitter",icon:"TwitterIcon"},{id:"linkedin",name:"LinkedIn",icon:"LinkedInIcon"},{id:"instagram",name:"Instagram",icon:"InstagramIcon"},{id:"youtube",name:"YouTube",icon:"YouTubeIcon"},{id:"whatsapp",name:"WhatsApp",icon:"WhatsAppIcon"}],Rs=({initialKey:l})=>{const{handleUpdateStaticContent:n,handleUpdateHomeSlides:s,handleUpdateSocialMediaLinks:T,handleUpdateSubjects:i,handleUpdateStudentCardTaglines:m,handleUpdateTeacherCardTaglines:b,handleUpdateHomePageCardCounts:f,handleUpdateUpcomingExams:t,handleUpdatePhotoPrintOptions:d,handleUpdateOgImage:u,handleImageSave:N,handleUpdateTeacherDashboardMessage:S,handleUpdateFinancialSettings:v,handleUpdateSupportSettings:g}=Z(),{staticPageContent:w,homeSlides:y,socialMediaLinks:G,subjects:V,studentCardTaglines:r,teacherCardTaglines:A,homePageCardCounts:h,upcomingExams:R,photoPrintOptions:k,ogImageUrl:M,teacherDashboardMessage:L,financialSettings:a,supportSettings:D}=ue(),{addToast:U}=ie();if(!w)return e.jsx("div",{children:"Loading content..."});const K=[...Object.keys(w).sort(),"home_slides","social_media_links","subjects","student_card_taglines","teacher_card_taglines","home_page_layout","upcoming_exams","photo_print_options","og_image","teacher_dashboard_message","financial_settings","support_settings"],[P,q]=c.useState(K[0]||"home_slides"),[H,ae]=c.useState({title:"",content:""}),[ee,ne]=c.useState([]),[de,oe]=c.useState([]),[Le,Me]=c.useState({}),[Ce,Ie]=c.useState([]),[ce,Fe]=c.useState({teachers:3,courses:3,classes:3,quizzes:3,events:3}),[Te,ke]=c.useState([]),[Ae,Ne]=c.useState([]),[ye,pe]=c.useState(null),[Re,_e]=c.useState(""),[J,Ee]=c.useState(a),[ge,Oe]=c.useState(D),[ve,o]=c.useState($e[0].value),[x,p]=c.useState(!1);c.useEffect(()=>{if(l){const j=K.find(C=>C===l);j&&q(j)}},[l]),c.useEffect(()=>{P==="home_slides"?ne(y?JSON.parse(JSON.stringify(y)):[]):P==="social_media_links"?oe(G?JSON.parse(JSON.stringify(G)):[]):P==="subjects"?Me(V?JSON.parse(JSON.stringify(V)):{}):P==="student_card_taglines"?Ie(r?[...r]:[]):P==="teacher_card_taglines"?Ie(A?[...A]:[]):P==="home_page_layout"?Fe(h||{teachers:3,courses:3,classes:3,quizzes:3,events:3}):P==="upcoming_exams"?ke(R?JSON.parse(JSON.stringify(R)):[]):P==="photo_print_options"?Ne(k?JSON.parse(JSON.stringify(k)):[]):P==="og_image"?pe(M):P==="teacher_dashboard_message"?_e(L||""):P==="financial_settings"?Ee(a?_({},a):{}):P==="support_settings"?Oe(D?_({},D):{telegramBotToken:"",telegramChatId:"",isEnabled:!0}):w[P]?ae(JSON.parse(JSON.stringify(w[P]))):ae({title:"",content:""})},[P,w,y,G,V,r,A,h,R,k,M,L,a,D]);const $=j=>{ae(C=>F(_({},C),{[j.target.name]:j.target.value}))},O=(j,C,I)=>{const Y=[...ee];Y[j]=F(_({},Y[j]),{[C]:I}),ne(Y)},B=()=>{ne(j=>[...j,{image:"",title:"",subtitle:"",ctaText:""}])},te=j=>{ne(C=>C.filter((I,Y)=>Y!==j))},me=(j,C)=>{const I=[...de];I[j].url=C,oe(I)},Ve=j=>{const C=ut.find(I=>I.id===j);C&&!de.some(I=>I.id===j)&&oe(I=>[...I,F(_({},C),{url:""})])},De=j=>{oe(C=>C.filter((I,Y)=>Y!==j))},Pe=j=>{const C=j.map(I=>({value:I,label:I}));Me(I=>F(_({},I),{[ve]:C}))},X=j=>{const{name:C,value:I}=j.target;Fe(Y=>F(_({},Y),{[C]:parseInt(I,10)||0}))},Ue=(j,C,I)=>{const Y=[...Te];Y[j][C]=I,ke(Y)},It=()=>{ke(j=>[...j,{id:xt(),name:"",date:"",targetAudience:$e[0].value,isHighPriority:!1}])},Tt=j=>{ke(C=>C.filter((I,Y)=>Y!==j))},lt=(j,C,I)=>{const Y=[...Ae];Y[j][C]=C==="price"?parseFloat(I)||0:I,Ne(Y)},At=()=>{Ne(j=>[...j,{id:xt(),size:"",price:0}])},Rt=j=>{Ne(C=>C.filter((I,Y)=>Y!==j))},_t=j=>{_e(j.target.value)},se=j=>{const{name:C,value:I}=j.target;Ee(Y=>F(_({},Y),{[C]:parseFloat(I)||0}))},Be=j=>{const{name:C,value:I,type:Y,checked:ze}=j.target;Oe(zt=>F(_({},zt),{[C]:Y==="checkbox"?ze:I}))},Et=()=>W(void 0,null,function*(){p(!0);try{if(P==="home_slides")yield s(ee);else if(P==="social_media_links")yield T(de);else if(P==="subjects")yield i(Le);else if(P==="student_card_taglines")yield m(Ce);else if(P==="teacher_card_taglines")yield b(Ce);else if(P==="home_page_layout")yield f(ce);else if(P==="upcoming_exams")yield t(Te);else if(P==="photo_print_options")yield d(Ae);else if(P==="teacher_dashboard_message")yield S(Re);else if(P==="financial_settings")yield v(J);else if(P==="support_settings")yield g(ge);else if(P==="og_image"){if(ye&&ye.startsWith("data:image")){const j=yield N(ye,"og_image");if(j)yield u(j);else throw new Error("Image upload failed.")}}else yield n(P,H);U("Content saved successfully!","success")}catch(j){U("Failed to save content.","error"),console.error(j)}finally{p(!1)}}),Dt=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx(E,{label:"Page Title",name:"title",value:H.title,onChange:$}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-light-text dark:text-dark-text mb-1",children:"Content (HTML)"}),e.jsx("textarea",{name:"content",value:H.content,onChange:$,rows:20,className:"w-full p-2 border border-light-border dark:border-dark-border rounded-md bg-light-background dark:bg-dark-background focus:outline-none focus:ring-primary focus:border-primary font-mono text-sm",placeholder:"Enter HTML content here..."}),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle mt-1",children:"You can use basic HTML tags like <p>, <h2>, <ul>, <li>, <strong>, and <a> for formatting."})]})]}),Pt=()=>e.jsxs("div",{className:"space-y-6",children:[ee.map((j,C)=>e.jsxs("div",{className:"p-4 border border-light-border dark:border-dark-border rounded-lg relative",children:[e.jsxs("h3",{className:"font-semibold mb-2",children:["Slide ",C+1]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(E,{label:"Image URL",name:"image",value:j.image,onChange:I=>O(C,"image",I.target.value)}),e.jsx(E,{label:"Title",name:"title",value:j.title,onChange:I=>O(C,"title",I.target.value)}),e.jsx(E,{label:"Subtitle",name:"subtitle",value:j.subtitle,onChange:I=>O(C,"subtitle",I.target.value)}),e.jsx(E,{label:"CTA Button Text",name:"ctaText",value:j.ctaText,onChange:I=>O(C,"ctaText",I.target.value)})]}),e.jsx("button",{onClick:()=>te(C),className:"absolute top-2 right-2 p-1 text-red-500 hover:bg-red-100 dark:hover:bg-red-900/50 rounded-full",children:e.jsx(Se,{className:"w-5 h-5"})})]},C)),e.jsxs("button",{onClick:B,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 text-sm font-medium text-primary border-2 border-dashed border-primary/50 rounded-md hover:bg-primary/10 transition-colors",children:[e.jsx(fe,{className:"h-5 h-5"}),e.jsx("span",{children:"Add Slide"})]})]}),Lt=()=>{const j=new Set(de.map(I=>I.id)),C=ut.filter(I=>!j.has(I.id));return e.jsxs("div",{className:"space-y-4",children:[de.map((I,Y)=>e.jsxs("div",{className:"flex items-end gap-4 p-4 border border-light-border dark:border-dark-border rounded-lg",children:[e.jsx("div",{className:"flex-grow",children:e.jsx(E,{label:I.name,name:`url-${I.id}`,value:I.url,onChange:ze=>me(Y,ze.target.value),placeholder:"https://..."})}),e.jsx("button",{onClick:()=>De(Y),className:"p-2 text-red-500 hover:bg-red-100 dark:hover:bg-red-900/50 rounded-md",children:e.jsx(Se,{className:"w-5 h-5"})})]},I.id)),C.length>0&&e.jsx("div",{className:"flex items-end gap-4 p-4 border-2 border-dashed border-light-border dark:border-dark-border rounded-lg",children:e.jsxs("div",{className:"flex-grow",children:[e.jsx("label",{className:"block text-sm font-medium text-light-text dark:text-dark-text mb-1",children:"Add New Platform"}),e.jsxs("select",{onChange:I=>Ve(I.target.value),className:"w-full px-3 py-2 border border-light-border dark:border-dark-border text-light-text dark:text-dark-text bg-light-background dark:bg-dark-background rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm",children:[e.jsx("option",{value:"",children:"Select a platform..."}),C.map(I=>e.jsx("option",{value:I.id,children:I.name},I.id))]})]})})]})},Mt=()=>{var j;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:"This list populates the 'Subject' dropdown menu when teachers create classes."}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"audience-select",className:"block text-sm font-medium text-light-text dark:text-dark-text mb-1",children:"Select Target Audience to Edit"}),e.jsx("select",{id:"audience-select",value:ve,onChange:C=>o(C.target.value),className:"w-full px-3 py-2 border border-light-border dark:border-dark-border text-light-text dark:text-dark-text bg-light-background dark:bg-dark-background rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm",children:$e.map(C=>e.jsx("option",{value:C.value,children:C.label},C.value))})]}),e.jsx("div",{className:"mt-4",children:e.jsx(mt,{label:`Subjects for "${ve}"`,tags:((j=Le[ve])==null?void 0:j.map(C=>C.value))||[],onTagsChange:Pe})})]})},nt=j=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:j}),e.jsx(mt,{label:"Taglines",tags:Ce,onTagsChange:Ie})]}),Ft=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:"Control how many items appear in each featured section on the home page."}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 pt-4",children:[e.jsx(E,{label:"Featured Teachers",name:"teachers",type:"number",min:1,max:12,value:ce.teachers.toString(),onChange:X}),e.jsx(E,{label:"Popular Courses",name:"courses",type:"number",min:1,max:12,value:ce.courses.toString(),onChange:X}),e.jsx(E,{label:"Upcoming Classes",name:"classes",type:"number",min:1,max:12,value:ce.classes.toString(),onChange:X}),e.jsx(E,{label:"Latest Quizzes",name:"quizzes",type:"number",min:1,max:12,value:ce.quizzes.toString(),onChange:X}),e.jsx(E,{label:"Upcoming Events",name:"events",type:"number",min:1,max:12,value:(ce.events||3).toString(),onChange:X})]})]}),Ot=()=>e.jsxs("div",{className:"space-y-6",children:[Te.map((j,C)=>e.jsxs("div",{className:"p-4 border border-light-border dark:border-dark-border rounded-lg relative space-y-3",children:[e.jsxs("h3",{className:"font-semibold mb-2",children:["Exam ",C+1]}),e.jsx(E,{label:"Exam Name",name:"name",value:j.name,onChange:I=>Ue(C,"name",I.target.value)}),e.jsx(E,{label:"Date",name:"date",type:"date",value:j.date,onChange:I=>Ue(C,"date",I.target.value)}),e.jsx(wt,{label:"Target Audience",name:"targetAudience",value:j.targetAudience,onChange:I=>Ue(C,"targetAudience",I.target.value),options:$e}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:`priority-${C}`,checked:j.isHighPriority,onChange:I=>Ue(C,"isHighPriority",I.target.checked),className:"h-4 w-4 text-primary focus:ring-primary border-light-border dark:border-dark-border rounded"}),e.jsx("label",{htmlFor:`priority-${C}`,className:"text-sm font-medium text-light-text dark:text-dark-text",children:"Mark as High Priority"})]}),e.jsx("button",{onClick:()=>Tt(C),className:"absolute top-2 right-2 p-1 text-red-500 hover:bg-red-100 dark:hover:bg-red-900/50 rounded-full",children:e.jsx(Se,{className:"w-5 h-5"})})]},j.id)),e.jsxs("button",{onClick:It,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 text-sm font-medium text-primary border-2 border-dashed border-primary/50 rounded-md hover:bg-primary/10 transition-colors",children:[e.jsx(fe,{className:"h-5 h-5"}),e.jsx("span",{children:"Add Exam"})]})]}),Ut=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:"Manage the available sizes and prices for photo prints that users can purchase from event galleries."}),e.jsx("div",{className:"space-y-4",children:Ae.map((j,C)=>e.jsxs("div",{className:"flex items-end gap-4 p-4 border border-light-border dark:border-dark-border rounded-lg",children:[e.jsxs("div",{className:"flex-grow grid grid-cols-2 gap-4",children:[e.jsx(E,{label:"Print Size (e.g., 4x6, A4)",name:`size-${C}`,value:j.size,onChange:I=>lt(C,"size",I.target.value)}),e.jsx(E,{label:"Price (LKR)",name:`price-${C}`,type:"number",min:0,value:j.price.toString(),onChange:I=>lt(C,"price",I.target.value)})]}),e.jsx("button",{onClick:()=>Rt(C),className:"p-2 text-red-500 hover:bg-red-100 dark:hover:bg-red-900/50 rounded-md",children:e.jsx(Se,{className:"w-5 h-5"})})]},j.id))}),e.jsxs("button",{onClick:At,className:"mt-4 w-full flex items-center justify-center space-x-2 px-4 py-3 text-sm font-medium text-primary border-2 border-dashed border-primary/50 rounded-md hover:bg-primary/10 transition-colors",children:[e.jsx(fe,{className:"h-5 h-5"}),e.jsx("span",{children:"Add Print Option"})]})]}),$t=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:"This image (also known as an OG Image) is what appears on social media platforms like Facebook, Twitter, and WhatsApp when someone shares a link to your site. Recommended size: 1200x630 pixels."}),e.jsx(Ct,{label:"Site Share Image",currentImage:ye,onImageChange:pe,aspectRatio:"aspect-video"})]}),Kt=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:"The message entered here will be displayed at the top of every teacher's dashboard. Use this for announcements, maintenance updates, or general news for your educators."}),e.jsx(is,{label:"Teacher Dashboard Announcement",id:"teacherDashboardMsg",name:"teacherDashboardMsg",value:Re,onChange:_t,rows:6,placeholder:"Enter an announcement for all teachers..."})]}),Gt=()=>{const j=J.manualPaymentPlatformFee!==void 0?J.manualPaymentPlatformFee:50;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:"Adjust platform-wide financial variables used in revenue calculations."}),e.jsx("h3",{className:"font-semibold text-lg border-b border-light-border dark:border-dark-border pb-2",children:"Manual Payments"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx(E,{label:"Platform Fee (LKR) per Manual Transaction",name:"manualPaymentPlatformFee",type:"number",value:j.toString(),onChange:se})}),e.jsx("h3",{className:"font-semibold text-lg border-b border-light-border dark:border-dark-border pb-2",children:"Referral System Base Rates"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(E,{label:"Gateway Fee Rate (0.04 = 4%)",name:"referralGatewayFeeRate",type:"number",step:.01,value:J.referralGatewayFeeRate.toString(),onChange:se}),e.jsx(E,{label:"Platform Costs Rate (0.04 = 4%)",name:"referralPlatformCostRate",type:"number",step:.01,value:J.referralPlatformCostRate.toString(),onChange:se}),e.jsx(E,{label:"Max Earning per Teacher (LKR)",name:"referralMaxEarning",type:"number",value:J.referralMaxEarning.toString(),onChange:se}),e.jsx(E,{label:"Base Commission Rate (Tier 1)",name:"referralBaseRate",type:"number",step:.01,value:J.referralBaseRate.toString(),onChange:se})]}),e.jsx("h3",{className:"font-semibold text-lg border-b border-light-border dark:border-dark-border pb-2",children:"Referral Tiers"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(E,{label:"Tier 1 Threshold (LKR)",name:"referralTier1Threshold",type:"number",value:J.referralTier1Threshold.toString(),onChange:se}),e.jsx(E,{label:"Tier 1 Rate",name:"referralTier1Rate",type:"number",step:.01,value:J.referralTier1Rate.toString(),onChange:se})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(E,{label:"Tier 2 Threshold (LKR)",name:"referralTier2Threshold",type:"number",value:J.referralTier2Threshold.toString(),onChange:se}),e.jsx(E,{label:"Tier 2 Rate",name:"referralTier2Rate",type:"number",step:.01,value:J.referralTier2Rate.toString(),onChange:se})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(E,{label:"Tier 3 Threshold (LKR)",name:"referralTier3Threshold",type:"number",value:J.referralTier3Threshold.toString(),onChange:se}),e.jsx(E,{label:"Tier 3 Rate",name:"referralTier3Rate",type:"number",step:.01,value:J.referralTier3Rate.toString(),onChange:se})]})]})]})},Vt=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:"Configure settings for the support chat widget, including Telegram integration."}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("input",{type:"checkbox",id:"supportEnabled",name:"isEnabled",checked:ge.isEnabled,onChange:Be,className:"h-4 w-4 text-primary focus:ring-primary border-light-border dark:border-dark-border rounded"}),e.jsx("label",{htmlFor:"supportEnabled",className:"ml-2 block text-sm text-light-text dark:text-dark-text",children:"Enable Chat Widget"})]}),e.jsx(E,{label:"Telegram Bot Token",name:"telegramBotToken",value:ge.telegramBotToken,onChange:Be,placeholder:"e.g. 123456789:AbC..."}),e.jsx(E,{label:"Telegram Chat ID",name:"telegramChatId",value:ge.telegramChatId,onChange:Be,placeholder:"e.g. -100123456789"}),e.jsxs("p",{className:"text-xs text-light-subtle dark:text-dark-subtle italic",children:["* To get these, create a bot via @BotFather on Telegram, create a group, add the bot, and get the Chat ID. Set your webhook URL to: ",e.jsx("code",{children:"https://telegram-bot-service-[PROJECT_ID].cloudfunctions.net/telegramWebhook"})]})]}),Bt=()=>{switch(P){case"home_slides":return Pt();case"social_media_links":return Lt();case"subjects":return Mt();case"student_card_taglines":return nt("Manage the list of random taglines that appear on the student ID card.");case"teacher_card_taglines":return nt("Manage the list of random taglines for new teacher profiles.");case"home_page_layout":return Ft();case"upcoming_exams":return Ot();case"photo_print_options":return Ut();case"og_image":return $t();case"teacher_dashboard_message":return Kt();case"financial_settings":return Gt();case"support_settings":return Vt();default:return Dt()}};return e.jsxs("div",{className:"space-y-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Site Content Management"}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"content-select",className:"block text-sm font-medium text-light-text dark:text-dark-text mb-1",children:"Select Content to Edit"}),e.jsx("select",{id:"content-select",value:P,onChange:j=>q(j.target.value),className:"w-full sm:w-64 px-3 py-2 border border-light-border dark:border-dark-border text-light-text dark:text-dark-text bg-light-background dark:bg-dark-background rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm",children:K.map(j=>e.jsx("option",{value:j,children:j.replace(/_/g," ").replace(/(^\w|\s\w)/g,C=>C.toUpperCase())},j))})]}),e.jsxs("button",{onClick:Et,disabled:x,className:"w-full sm:w-auto flex items-center justify-center space-x-2 px-6 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark disabled:opacity-50",children:[e.jsx(he,{className:"w-5 h-5"}),e.jsx("span",{children:x?"Saving...":"Save Changes"})]})]}),e.jsx("div",{className:"mt-6 border-t border-light-border dark:border-dark-border pt-6",children:Bt()})]})]})},re=({children:l,className:n})=>e.jsx("div",{className:`p-4 border border-light-border dark:border-dark-border rounded-lg bg-light-background dark:bg-dark-background shadow-sm ${n}`,children:l}),we=({label:l})=>e.jsxs("div",{className:"flex flex-col items-center my-2 text-light-subtle dark:text-dark-subtle",children:[e.jsx("div",{className:"text-2xl",children:""}),l&&e.jsx("div",{className:"text-xs -mt-1 font-semibold",children:l})]}),Q=({name:l,value:n,onLinkClick:s})=>e.jsxs("div",{className:"flex justify-between items-center text-sm py-1 border-b border-light-border/50 dark:border-dark-border/50",children:[e.jsx("code",{className:"text-light-text dark:text-dark-text",children:l}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-primary",children:n}),s&&e.jsx("button",{onClick:s,className:"text-xs font-semibold text-blue-500 hover:underline",children:"[Edit]"})]})]}),_s=({setActiveView:l,onNavigateToContent:n})=>{const{financialSettings:s}=ue(),{teachers:T,tuitionInstitutes:i}=Z(),m=new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR",minimumFractionDigits:0}),b=T.find(u=>u.registrationStatus==="approved")||T[0],f=i.find(u=>u.registrationStatus==="approved")||i[0],t=()=>{n?n("financial_settings"):l("site_content")},d=()=>l("users");return e.jsxs("div",{className:"space-y-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Calculation Guide"}),e.jsx("p",{className:"text-light-subtle dark:text-dark-subtle -mt-4",children:"This guide explains how various financial calculations are performed on the platform."}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"1. Referral Partner Earnings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Calculation Flow"}),e.jsx(re,{children:"Sale by Referred Teacher"}),e.jsx(we,{label:"Calculate Net Platform Income (NPI)"}),e.jsx(re,{children:e.jsx("p",{children:"NPI = (Sale Value * Teacher Commission %) - Gateway Fee - Platform Costs"})}),e.jsx(we,{label:"Apply Monthly Tiered Commission"}),e.jsxs(re,{children:[e.jsx("p",{children:"Referral Earning = NPI * Your Tier Rate"}),e.jsx("p",{className:"text-xs mt-1 text-light-subtle dark:text-dark-subtle",children:"(Capped per referred teacher)"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Variables"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{name:"Gateway Fee Rate",value:`${s.referralGatewayFeeRate*100}%`,onLinkClick:t}),e.jsx(Q,{name:"Platform Costs Rate",value:`${s.referralPlatformCostRate*100}%`,onLinkClick:t}),e.jsx(Q,{name:"Max Earning per Teacher",value:m.format(s.referralMaxEarning),onLinkClick:t}),e.jsx(Q,{name:"Base Rate (Tier 1)",value:`${s.referralBaseRate*100}%`,onLinkClick:t}),e.jsx(Q,{name:"Tier 2 Rate (>{currencyFormatter.format(financialSettings.referralTier1Threshold)})",value:`${s.referralTier1Rate*100}%`,onLinkClick:t}),e.jsx(Q,{name:"Tier 3 Rate (>{currencyFormatter.format(financialSettings.referralTier2Threshold)})",value:`${s.referralTier2Rate*100}%`,onLinkClick:t}),e.jsx(Q,{name:"Tier 4 Rate (>{currencyFormatter.format(financialSettings.referralTier3Threshold)})",value:`${s.referralTier3Rate*100}%`,onLinkClick:t})]})]})]})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"2. Teacher-Direct Platform Sale"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Calculation Flow"}),e.jsx(re,{children:"Student Pays Class/Course Fee"}),e.jsx(we,{}),e.jsxs(re,{children:[e.jsx("p",{children:"Teacher Earning = Sale Value * (100 - Platform Commission) %"}),e.jsx("p",{children:"Platform Earning = Sale Value * Platform Commission %"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Variables"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{name:"Platform Commission Rate",value:`${(b==null?void 0:b.commissionRate)||25}% (example)`,onLinkClick:d}),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle mt-1",children:"This is set per teacher in User Management."})]})]})]})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"3. Institute Manual (Pay at Venue) Sale"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Calculation Flow"}),e.jsx(re,{children:"Student Pays Class Fee at Venue"}),e.jsx(we,{label:"Institute records payment via Scanner"}),e.jsxs(re,{children:[e.jsx("p",{children:"Institute Gross Earning = Sale Value * Institute Commission %"}),e.jsx("p",{className:"font-bold text-green-600",children:"Institute Net Earning = Institute Gross Earning - Platform Fee"}),e.jsx("p",{className:"font-bold text-blue-600",children:"Teacher's Share = Sale Value - Institute Gross Earning"})]}),e.jsx("p",{className:"text-xs mt-2 text-center text-light-subtle dark:text-dark-subtle",children:"(Teacher's share is settled by the institute directly)"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Variables"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{name:"Platform Fee (per transaction)",value:m.format(s.manualPaymentPlatformFee),onLinkClick:t}),e.jsx(Q,{name:"Institute Commission Rate",value:`${(f==null?void 0:f.commissionRate)||25}% (example)`,onLinkClick:d})]})]})]})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"4. Institute Platform Sale"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Calculation Flow"}),e.jsx(re,{children:"Student Pays Class Fee on Platform"}),e.jsx(we,{}),e.jsxs(re,{children:[e.jsx("p",{className:"font-bold text-blue-600",children:"Teacher's Earning = Sale Value * (100 - Institute Commission) %"}),e.jsx("p",{className:"mt-2",children:"Institute Gross Earning = Sale Value * Institute Commission %"})]}),e.jsx(we,{label:"Platform takes its cut from Institute's share"}),e.jsxs(re,{children:[e.jsx("p",{className:"font-bold text-green-600",children:"Institute Net Earning = Institute Gross Earning - (Sale Value * Platform Markup %)"}),e.jsx("p",{className:"font-bold text-purple-600",children:"Platform Earning = Sale Value * Platform Markup %"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Variables"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{name:"Institute Commission Rate",value:`${(f==null?void 0:f.commissionRate)||25}% (example)`,onLinkClick:d}),e.jsx(Q,{name:"Platform Markup Rate",value:`${(f==null?void 0:f.platformMarkupRate)||15}% (example)`,onLinkClick:d}),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle mt-1",children:"Both rates are set per institute in User Management."})]})]})]})]})]})},Es=({item:l})=>{var n;return e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-light-surface dark:bg-dark-surface rounded",children:[e.jsx("img",{src:tt(l.photo.url_thumb,100),alt:"thumbnail",className:"w-12 h-12 rounded object-cover"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-xs",children:["Photo #",l.photo.id.slice(-6)]}),e.jsxs("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:["Print (",(n=l.printOption)==null?void 0:n.size,") x",l.quantity]})]})]})},Ds=()=>{const{sales:l,users:n,handleUpdatePhotoOrderStatus:s}=Z(),[T,i]=c.useState(null),m=c.useMemo(()=>l.filter(t=>t.itemType==="photo_purchase"&&t.photoOrderStatus&&t.photoOrderStatus!=="delivered").map(t=>F(_({},t),{student:n.find(d=>d.id===t.studentId)})).sort((t,d)=>new Date(t.saleDate).getTime()-new Date(d.saleDate).getTime()),[l,n]),b=(t,d)=>{s(t,d)},f=t=>{i(d=>d===t?null:t)};return e.jsxs("div",{className:"space-y-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Photo Print Order Management"}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:["Active Print Orders (",m.length,")"]}),m.length>0?e.jsx("div",{className:"space-y-3",children:m.map(t=>{var u,N,S,v,g,w;const d=((u=t.cartItems)==null?void 0:u.filter(y=>y.type==="photo_print"))||[];return e.jsxs("div",{className:"border border-light-border dark:border-dark-border rounded-lg",children:[e.jsxs("button",{onClick:()=>f(t.id),className:"w-full flex items-center justify-between p-4 text-left",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold",children:[(N=t.student)==null?void 0:N.firstName," ",(S=t.student)==null?void 0:S.lastName]}),e.jsxs("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:["ID: ",t.id," | Date: ",new Date(t.saleDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{value:t.photoOrderStatus,onChange:y=>b(t.id,y.target.value),onClick:y=>y.stopPropagation(),className:"px-3 py-2 border border-light-border dark:border-dark-border rounded-md bg-light-background dark:bg-dark-background focus:ring-primary focus:border-primary",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"})]}),e.jsx(at,{className:`w-5 h-5 transition-transform ${T===t.id?"rotate-180":""}`})]})]}),T===t.id&&e.jsx("div",{className:"p-4 border-t border-light-border dark:border-dark-border bg-light-background dark:bg-dark-background",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-sm mb-2",children:["Items to Print (",d.length,"):"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-2 gap-2 max-h-48 overflow-y-auto",children:d.map((y,G)=>e.jsx(Es,{item:y},`${y.photo.id}-${G}`))})]}),t.shippingAddress&&e.jsxs("div",{className:"pt-4 md:pt-0 md:border-l md:border-light-border md:dark:border-dark-border md:pl-4",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Shipping Address:"}),e.jsxs("address",{className:"not-italic text-xs text-light-subtle dark:text-dark-subtle",children:[e.jsxs("p",{className:"font-medium text-light-text dark:text-dark-text",children:[(v=t.student)==null?void 0:v.firstName," ",(g=t.student)==null?void 0:g.lastName]}),e.jsx("p",{children:t.shippingAddress.line1}),t.shippingAddress.line2&&e.jsx("p",{children:t.shippingAddress.line2}),e.jsxs("p",{children:[t.shippingAddress.city,t.shippingAddress.state&&`, ${t.shippingAddress.state}`," ",t.shippingAddress.postalCode]}),e.jsx("p",{className:"mt-2 font-semibold text-light-text dark:text-dark-text",children:(w=t.student)==null?void 0:w.contactNumber})]})]})]})})]},t.id)})}):e.jsx("p",{className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:"No active print orders."})]})]})},Ps=({item:l})=>{var n;return e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-light-surface dark:bg-dark-surface rounded",children:[e.jsx("img",{src:((n=l.product.coverImages)==null?void 0:n[0])||"https://via.placeholder.com/150.png?text=No+Img",alt:l.product.title,className:"w-12 h-12 rounded object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-xs",children:l.product.title}),e.jsxs("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:["Qty: ",l.quantity]})]})]})},Ls=()=>{const{sales:l,users:n,handleUpdatePhysicalOrderStatus:s}=Z(),[T,i]=c.useState(null),m=c.useMemo(()=>l.filter(t=>t.itemType==="marketplace_purchase"&&t.physicalOrderStatus&&t.physicalOrderStatus!=="delivered").map(t=>F(_({},t),{student:n.find(d=>d.id===t.studentId)})).sort((t,d)=>new Date(t.saleDate).getTime()-new Date(d.saleDate).getTime()),[l,n]),b=(t,d)=>{s(t,d)},f=t=>{i(d=>d===t?null:t)};return e.jsxs("div",{className:"space-y-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Physical Product Order Management"}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:["Active Physical Orders (",m.length,")"]}),m.length>0?e.jsx("div",{className:"space-y-3",children:m.map(t=>{var u,N,S,v,g,w;const d=((u=t.cartItems)==null?void 0:u.filter(y=>y.type==="product"&&y.product.type==="physical"))||[];return d.length===0?null:e.jsxs("div",{className:"border border-light-border dark:border-dark-border rounded-lg",children:[e.jsxs("button",{onClick:()=>f(t.id),className:"w-full flex items-center justify-between p-4 text-left",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold",children:[(N=t.student)==null?void 0:N.firstName," ",(S=t.student)==null?void 0:S.lastName]}),e.jsxs("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:["ID: ",t.id," | Date: ",new Date(t.saleDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{value:t.physicalOrderStatus,onChange:y=>b(t.id,y.target.value),onClick:y=>y.stopPropagation(),className:"px-3 py-2 border border-light-border dark:border-dark-border rounded-md bg-light-background dark:bg-dark-background focus:ring-primary focus:border-primary",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"})]}),e.jsx(at,{className:`w-5 h-5 transition-transform ${T===t.id?"rotate-180":""}`})]})]}),T===t.id&&e.jsx("div",{className:"p-4 border-t border-light-border dark:border-dark-border bg-light-background dark:bg-dark-background",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-sm mb-2",children:["Items (",d.length,"):"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 max-h-48 overflow-y-auto",children:d.map((y,G)=>e.jsx(Ps,{item:y},`${y.product.id}-${G}`))})]}),t.shippingAddress&&e.jsxs("div",{className:"pt-4 md:pt-0 md:border-l md:border-light-border md:dark:border-dark-border md:pl-4",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Shipping Address:"}),e.jsxs("address",{className:"not-italic text-xs text-light-subtle dark:text-dark-subtle",children:[e.jsxs("p",{className:"font-medium text-light-text dark:text-dark-text",children:[(v=t.student)==null?void 0:v.firstName," ",(g=t.student)==null?void 0:g.lastName]}),e.jsx("p",{children:t.shippingAddress.line1}),t.shippingAddress.line2&&e.jsx("p",{children:t.shippingAddress.line2}),e.jsxs("p",{children:[t.shippingAddress.city,", ",t.shippingAddress.state," ",t.shippingAddress.postalCode]}),e.jsx("p",{className:"mt-2 font-semibold text-light-text dark:text-dark-text",children:(w=t.student)==null?void 0:w.contactNumber})]})]})]})})]},t.id)})}):e.jsx("p",{className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:"No active physical product orders."})]})]})},Ms=()=>{const{paymentGatewaySettings:l}=ue(),{handleUpdatePaymentGatewaySettings:n,handleImageSave:s}=Z(),{addToast:T}=ie(),[i,m]=c.useState("live"),[b,f]=c.useState(null),[t,d]=c.useState(!1),u={activePaymentGateway:"webxpay",methodMapping:{card:"marxipg",ezcash:"webxpay",mcash:"webxpay",frimi:"webxpay",qr:"webxpay",direct_bank:"webxpay"},methodLogos:{},gateways:{webxpay:{secretKey:"",publicKey:"",baseUrl:"https://webxpay.com/index.php?route=checkout/billing"},marxipg:{apiKey:"",baseUrl:"https://payment.v4.api.marx.lk/api/v4/ipg"}}};c.useEffect(()=>{W(void 0,null,function*(){var A,h;try{const R=Qe(Xe,"settings","environments"),k=yield Ze(R);if(k.exists()){const M=k.data();f({live:((A=M.live)==null?void 0:A.paymentGatewaySettings)||_(_({},u),l),staging:((h=M.staging)==null?void 0:h.paymentGatewaySettings)||JSON.parse(JSON.stringify(u))}),(M.activeEnvironment==="live"||M.activeEnvironment==="staging")&&m(M.activeEnvironment)}else f({live:_(_({},u),l),staging:JSON.parse(JSON.stringify(u))})}catch(R){console.error("Error loading payment environments:",R),T("Failed to load environment settings.","error")}})},[]);const N=b?b[i]:u,S=r=>{b&&f(A=>F(_({},A),{[i]:r(A[i])}))},v=(r,A)=>{S(h=>F(_({},h),{methodMapping:F(_({},h.methodMapping),{[r]:A})}))},g=(r,A,h)=>{S(R=>F(_({},R),{gateways:F(_({},R.gateways),{[r]:F(_({},R.gateways[r]),{[A]:h})})}))},w=(r,A)=>W(void 0,null,function*(){try{const h=yield s(A,"payment_method_logo",{methodId:r});h&&(S(R=>F(_({},R),{methodLogos:F(_({},R.methodLogos),{[r]:h})})),T(`${r} logo uploaded successfully. Save settings to apply.`,"info"))}catch(h){T("Failed to upload logo.","error")}}),y=()=>W(void 0,null,function*(){if(b){d(!0);try{const r=Qe(Xe,"settings","environments"),A=yield Ze(r),h=A.exists()?A.data():{},R=F(_({},h),{activeEnvironment:i,live:F(_({},h.live||{}),{paymentGatewaySettings:b.live}),staging:F(_({},h.staging||{}),{paymentGatewaySettings:b.staging})});yield hs(r,R),yield n(b[i]),T(`Saved & Activated ${i.toUpperCase()} Payment Settings!`,"success")}catch(r){T("Failed to save settings.","error"),console.error(r)}finally{d(!1)}}}),G={card:"Visa / Mastercard",ezcash:"eZ Cash",mcash:"mCash",frimi:"FriMi",qr:"Bank QR (LANKAQR)",direct_bank:"Direct Bank Transfer"},V=["ezcash","frimi","mcash"];return b?e.jsxs("div",{className:"space-y-8 pb-20",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Payment Gateway Management"}),e.jsxs("div",{className:"flex bg-gray-200 dark:bg-gray-700 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>m("live"),className:`px-6 py-2 rounded-md text-sm font-semibold transition-all ${i==="live"?"bg-red-600 text-white shadow-md":"text-gray-600 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:"LIVE"}),e.jsx("button",{onClick:()=>m("staging"),className:`px-6 py-2 rounded-md text-sm font-semibold transition-all ${i==="staging"?"bg-green-600 text-white shadow-md":"text-gray-600 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:"STAGING"})]})]}),e.jsxs("div",{className:`p-4 rounded-lg border-l-4 mb-4 ${i==="live"?"bg-red-50 dark:bg-red-900/20 border-red-500":"bg-green-50 dark:bg-green-900/20 border-green-500"}`,children:[e.jsxs("h3",{className:`text-lg font-bold ${i==="live"?"text-red-700 dark:text-red-400":"text-green-700 dark:text-green-400"}`,children:[i.toUpperCase()," Environment"]}),e.jsxs("p",{className:"text-sm opacity-80",children:["Configuring payment gateways for ",e.jsx("strong",{children:i}),'. Clicking "Save & Activate" will apply these settings to the application.']})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Payment Method Routing"}),e.jsxs("p",{className:"text-sm text-light-subtle dark:text-dark-subtle mb-6",children:["Select which gateway handles each specific payment method for ",i,"."]}),e.jsx("div",{className:"space-y-4",children:Object.keys(N.methodMapping).map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-light-background dark:bg-dark-background rounded-md",children:[e.jsx("span",{className:"font-semibold text-sm",children:G[r]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:`mapping-${r}`,value:"webxpay",checked:N.methodMapping[r]==="webxpay",onChange:()=>v(r,"webxpay"),className:"h-4 w-4 text-primary focus:ring-primary"}),e.jsx("span",{className:"ml-2 text-sm",children:"WebXPay"})]}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:`mapping-${r}`,value:"marxipg",checked:N.methodMapping[r]==="marxipg",onChange:()=>v(r,"marxipg"),className:"h-4 w-4 text-primary focus:ring-primary"}),e.jsx("span",{className:"ml-2 text-sm",children:"Marx IPG"})]})]})]},r))})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Payment Method Branding"}),e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle mb-6",children:"Upload custom logos for mobile payment methods. Recommended: PNG with transparent background."}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6",children:V.map(r=>{var A;return e.jsx("div",{className:"space-y-2",children:e.jsx(Ct,{label:G[r],currentImage:((A=N.methodLogos)==null?void 0:A[r])||null,onImageChange:h=>w(r,h),aspectRatio:"aspect-square"})},r)})})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:["WebXPay Credentials (",i,")"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(E,{label:"Secret Key",name:"webxpay_secret",value:N.gateways.webxpay.secretKey,onChange:r=>g("webxpay","secretKey",r.target.value),type:"password"}),e.jsx(E,{label:"Base URL (Form Action)",name:"webxpay_base_url",placeholder:"https://webxpay.com/index.php?route=checkout/billing",value:N.gateways.webxpay.baseUrl||"",onChange:r=>g("webxpay","baseUrl",r.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Public Key"}),e.jsx("textarea",{value:N.gateways.webxpay.publicKey,onChange:r=>g("webxpay","publicKey",r.target.value),rows:6,className:"w-full p-2 border rounded-md bg-light-background dark:bg-dark-background font-mono text-xs"})]})]})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:["Marx IPG Credentials (",i,")"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(E,{label:"API Key",name:"marxipg_api",value:N.gateways.marxipg.apiKey,onChange:r=>g("marxipg","apiKey",r.target.value),type:"password"}),e.jsx(E,{label:"Base URL (API Endpoint)",name:"marx_base_url",placeholder:"https://payment.v4.api.marx.lk/api/v4/ipg",value:N.gateways.marxipg.baseUrl||"",onChange:r=>g("marxipg","baseUrl",r.target.value)})]})]}),e.jsx("div",{className:"fixed bottom-6 right-8 z-50",children:e.jsxs("button",{onClick:y,disabled:t,className:"flex items-center space-x-2 px-8 py-4 border border-transparent text-lg font-bold rounded-full shadow-xl text-white bg-primary hover:bg-primary-dark disabled:opacity-50 transform hover:scale-105 transition-all",children:[e.jsx(he,{className:"w-6 h-6"}),e.jsx("span",{children:t?"Activating...":`Save & Activate ${i.toUpperCase()}`})]})}),e.jsx("div",{className:"flex justify-end mt-8",children:e.jsxs("button",{onClick:y,disabled:t,className:"flex items-center space-x-2 px-6 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark disabled:opacity-50",children:[e.jsx(he,{className:"w-5 h-5"}),e.jsx("span",{children:t?"Activating...":`Save & Activate ${i.toUpperCase()}`})]})})]}):e.jsx("div",{children:"Loading Payment Settings..."})},Je=[{key:"analytics",label:"Analytics"},{key:"users",label:"User Management"},{key:"staff",label:"Team & Permissions"},{key:"content",label:"Content Management"},{key:"products",label:"Product Management"},{key:"allsales",label:"Sales History"},{key:"photo_orders",label:"Photo Orders"},{key:"physical_orders",label:"Physical Orders"},{key:"revenue",label:"Revenue & Payouts"},{key:"vouchers",label:"Voucher Management"},{key:"referrals",label:"Referral System"},{key:"payment_gateways",label:"Payment Gateways"},{key:"site_content",label:"Site Content"},{key:"calculation_guide",label:"Calculation Guide"}],Fs=({users:l,onUpdatePermissions:n})=>{const{addUser:s}=Z(),{handleRegister:T}=qe(),{addToast:i}=ie(),[m,b]=c.useState(!1),[f,t]=c.useState(null),[d,u]=c.useState({firstName:"",lastName:"",email:"",password:""}),[N,S]=c.useState([]),[v,g]=c.useState(!1),[w,y]=c.useState(!1),G=c.useMemo(()=>l.filter(k=>k.role==="admin"),[l]),V=k=>{k?(t(k),u({firstName:k.firstName,lastName:k.lastName,email:k.email,password:""}),!k.permissions||k.permissions.includes("all")?(g(!0),S(Je.map(M=>M.key))):(g(!1),S(k.permissions))):(t(null),u({firstName:"",lastName:"",email:"",password:""}),g(!1),S([])),b(!0)},r=k=>{v||S(M=>M.includes(k)?M.filter(L=>L!==k):[...M,k])},A=k=>{g(k.target.checked),k.target.checked?S(Je.map(M=>M.key)):S([])},h=k=>{u(M=>F(_({},M),{[k.target.name]:k.target.value}))},R=k=>W(void 0,null,function*(){k.preventDefault(),y(!0);try{const M=v?["all"]:N;if(f)n(f.id,M),i("Staff permissions updated.","success");else{if(!d.password||d.password.length<6){i("Password must be at least 6 characters.","error"),y(!1);return}const L=yield T(d.email,d.password);if(L){const D={id:`ADM${Date.now().toString().slice(-4)}${Math.random().toString(36).substring(2,4).toUpperCase()}`,uid:L.uid,firstName:d.firstName,lastName:d.lastName,email:d.email,role:"admin",avatar:"",status:"active",accountBalance:0,referralCode:Math.random().toString(36).substring(2,10).toUpperCase(),isEmailVerified:!0,createdAt:new Date().toISOString(),permissions:M};yield s(D),i("New staff account created.","success")}}b(!1)}catch(M){console.error(M),i(M.message||"Operation failed.","error")}finally{y(!1)}});return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Team & Permissions"}),e.jsxs("button",{onClick:()=>V(),className:"flex items-center space-x-2 px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark transition-colors",children:[e.jsx(fe,{className:"w-5 h-5"}),e.jsx("span",{children:"Add Staff Member"})]})]}),e.jsx("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-light-border dark:divide-dark-border text-sm",children:[e.jsx("thead",{className:"bg-light-background dark:bg-dark-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Role Type"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Access Areas"}),e.jsx("th",{className:"px-4 py-3 text-center font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-light-border dark:divide-dark-border",children:G.map(k=>{var a;const M=!k.permissions||k.permissions.includes("all"),L=k.permissions?k.permissions.length:"All";return e.jsxs("tr",{children:[e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap font-medium text-light-text dark:text-dark-text",children:[k.firstName," ",k.lastName]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-light-text dark:text-dark-text",children:k.email}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:M?e.jsx("span",{className:"px-2 py-1 text-xs font-bold bg-purple-100 text-purple-800 dark:bg-purple-900/50 dark:text-purple-300 rounded-full",children:"Super Admin"}):e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300 rounded-full",children:"Sub-Admin"})}),e.jsx("td",{className:"px-4 py-3 max-w-xs truncate text-light-subtle dark:text-dark-subtle",title:(a=k.permissions)==null?void 0:a.join(", "),children:M?"Full Access":`${L} section(s)`}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("button",{onClick:()=>V(k),className:"text-primary hover:underline flex items-center justify-center w-full",children:[e.jsx(St,{className:"w-4 h-4 mr-1"})," Edit"]})})]},k.id)})})]})}),e.jsx(je,{isOpen:m,onClose:()=>b(!1),title:f?"Edit Permissions":"Add New Staff",children:e.jsxs("form",{onSubmit:R,className:"space-y-6",children:[!f&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(E,{label:"First Name",name:"firstName",value:d.firstName,onChange:h,required:!0}),e.jsx(E,{label:"Last Name",name:"lastName",value:d.lastName,onChange:h,required:!0}),e.jsx(E,{label:"Email",name:"email",type:"email",value:d.email,onChange:h,required:!0}),e.jsx(E,{label:"Password",name:"password",type:"password",value:d.password,onChange:h,required:!0,placeholder:"Min 6 chars"})]}),f&&e.jsxs("div",{className:"bg-light-background dark:bg-dark-background p-3 rounded-md border border-light-border dark:border-dark-border",children:[e.jsxs("p",{className:"font-bold",children:[f.firstName," ",f.lastName]}),e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:f.email})]}),e.jsxs("div",{className:"border-t border-light-border dark:border-dark-border pt-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(bt,{className:"w-5 h-5 mr-2 text-primary"}),"Access Control"]}),e.jsxs("div",{className:"flex items-center mb-6 p-3 bg-purple-50 dark:bg-purple-900/20 rounded-md border border-purple-200 dark:border-purple-800",children:[e.jsx("input",{type:"checkbox",id:"superAdmin",checked:v,onChange:A,className:"h-5 w-5 text-purple-600 focus:ring-purple-500 border-gray-300 rounded"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("label",{htmlFor:"superAdmin",className:"block text-sm font-bold text-gray-900 dark:text-gray-100",children:"Super Admin Access"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Grants full access to all current and future sections."})]})]}),e.jsx("div",{className:`grid grid-cols-1 sm:grid-cols-2 gap-3 ${v?"opacity-50 pointer-events-none":""}`,children:Je.map(k=>e.jsxs("label",{className:"flex items-center p-3 border border-light-border dark:border-dark-border rounded-md hover:bg-light-background dark:hover:bg-dark-background cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:N.includes(k.key),onChange:()=>r(k.key),disabled:v,className:"h-4 w-4 text-primary focus:ring-primary border-light-border dark:border-dark-border rounded"}),e.jsx("span",{className:"ml-3 text-sm font-medium text-light-text dark:text-dark-text",children:k.label})]},k.key))})]}),e.jsxs("div",{className:"flex justify-end pt-4 space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"px-4 py-2 border border-light-border dark:border-dark-border rounded-md text-light-text dark:text-dark-text hover:bg-light-background dark:hover:bg-dark-background",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:w,className:"flex items-center px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark disabled:opacity-50",children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),w?"Saving...":"Save Changes"]})]})]})})]})},Os=()=>{const{genAiKey:l,gDriveFetcherApiKey:n,functionUrls:s}=ue(),{handleUpdateDeveloperSettings:T}=Z(),{addToast:i}=ie(),[m,b]=c.useState({genAiKey:"",gDriveFetcherApiKey:"",functionUrls:{},EMAIL_USER:"",EMAIL_PASS:"",NOTIFY_LK_USER_ID:"",NOTIFY_LK_API_KEY:"",NOTIFY_LK_SENDER_ID:"",GOOGLE_CLIENT_ID:"",GOOGLE_CLIENT_SECRET:""}),[f,t]=c.useState(!1),[d,u]=c.useState(!1);c.useEffect(()=>{d||W(void 0,null,function*(){try{const w=yield Ze(Qe(Xe,"settings","system_config")),y=w.exists()?w.data():{};b({genAiKey:l||"",gDriveFetcherApiKey:n||"",functionUrls:s||{},EMAIL_USER:y.EMAIL_USER||"",EMAIL_PASS:y.EMAIL_PASS||"",NOTIFY_LK_USER_ID:y.NOTIFY_LK_USER_ID||"",NOTIFY_LK_API_KEY:y.NOTIFY_LK_API_KEY||"",NOTIFY_LK_SENDER_ID:y.NOTIFY_LK_SENDER_ID||"",GOOGLE_CLIENT_ID:y.GOOGLE_CLIENT_ID||"",GOOGLE_CLIENT_SECRET:y.GOOGLE_CLIENT_SECRET||""}),u(!0)}catch(w){console.error("Failed to load settings:",w),i("Failed to load settings.","error")}})},[l,s,d]);const N=(g,w)=>{b(y=>F(_({},y),{[g]:w}))},S=(g,w)=>{b(y=>F(_({},y),{functionUrls:F(_({},y.functionUrls),{[g]:w})}))},v=()=>W(void 0,null,function*(){t(!0);try{yield T({genAiKey:m.genAiKey,gDriveFetcherApiKey:m.gDriveFetcherApiKey,functionUrls:m.functionUrls,EMAIL_USER:m.EMAIL_USER,EMAIL_PASS:m.EMAIL_PASS,NOTIFY_LK_USER_ID:m.NOTIFY_LK_USER_ID,NOTIFY_LK_API_KEY:m.NOTIFY_LK_API_KEY,NOTIFY_LK_SENDER_ID:m.NOTIFY_LK_SENDER_ID,GOOGLE_CLIENT_ID:m.GOOGLE_CLIENT_ID,GOOGLE_CLIENT_SECRET:m.GOOGLE_CLIENT_SECRET}),i("Settings updated successfully.","success")}catch(g){console.error("Error saving settings:",g),i("Failed to save settings.","error")}finally{t(!1)}});return d?e.jsxs("div",{className:"space-y-8 animate-fadeIn pb-20",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Developer Settings"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Configure global application keys and endpoints."}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Cloud Function URLs"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.keys(m.functionUrls).length>0?Object.keys(m.functionUrls).map(g=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[g.replace(/([A-Z])/g," $1").trim()," URL"]}),e.jsx(E,{label:"",name:g,value:m.functionUrls[g]||"",onChange:w=>S(g,w.target.value)})]},g)):e.jsx("p",{children:"No function URLs configured."})})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Global API Keys"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(E,{label:"Google GenAI Key (Gemini)",name:"genAiKey",value:m.genAiKey,onChange:g=>N("genAiKey",g.target.value),type:"password"}),e.jsx(E,{label:"Google Drive Fetcher API Key",name:"gDriveKey",value:m.gDriveFetcherApiKey,onChange:g=>N("gDriveFetcherApiKey",g.target.value),type:"password"})]})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Backend Secrets"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(E,{label:"Gmail User",name:"EMAIL_USER",value:m.EMAIL_USER,onChange:g=>N("EMAIL_USER",g.target.value)}),e.jsx(E,{label:"Gmail App Password",name:"EMAIL_PASS",value:m.EMAIL_PASS,onChange:g=>N("EMAIL_PASS",g.target.value),type:"password"}),e.jsx(E,{label:"Notify.lk User ID",name:"NOTIFY_LK_USER_ID",value:m.NOTIFY_LK_USER_ID,onChange:g=>N("NOTIFY_LK_USER_ID",g.target.value)}),e.jsx(E,{label:"Notify.lk API Key",name:"NOTIFY_LK_API_KEY",value:m.NOTIFY_LK_API_KEY,onChange:g=>N("NOTIFY_LK_API_KEY",g.target.value),type:"password"}),e.jsx(E,{label:"Google Client ID",name:"GOOGLE_CLIENT_ID",value:m.GOOGLE_CLIENT_ID,onChange:g=>N("GOOGLE_CLIENT_ID",g.target.value)}),e.jsx(E,{label:"Google Client Secret",name:"GOOGLE_CLIENT_SECRET",value:m.GOOGLE_CLIENT_SECRET,onChange:g=>N("GOOGLE_CLIENT_SECRET",g.target.value),type:"password"})]})]}),e.jsx("div",{className:"fixed bottom-6 right-8",children:e.jsxs("button",{onClick:v,disabled:f,className:"flex items-center space-x-2 px-8 py-4 border border-transparent text-lg font-bold rounded-full shadow-xl text-white bg-primary hover:bg-primary-dark disabled:opacity-50 transform hover:scale-105 transition-all",children:[e.jsx(he,{className:"w-6 h-6"}),e.jsx("span",{children:f?"Saving...":"Save Settings"})]})})]}):e.jsx("div",{className:"p-8",children:"Loading Settings..."})},Us=()=>{const{users:l,teachers:n}=Z(),{addTeacher:s}=os({currentUser:null,ui:ie(),users:l,nav:ue()}),{addToast:T}=ie(),{teacherCardTaglines:i}=ue(),[m,b]=c.useState(!1),f=new Set(n.map(u=>u.userId)),t=l.filter(u=>u.role==="teacher"&&!f.has(u.id)),d=()=>W(void 0,null,function*(){b(!0);let u=0,N=0;for(const S of t)try{const g=(G=>{const V=G.toLowerCase().replace(/\s+/g,"").replace(/[^a-z0-9]/g,""),r=new Set(n.map(R=>R.username));if(!r.has(V))return V;let A=2,h=`${V}${A}`;for(;r.has(h);)A++,h=`${V}${A}`;return h})(`${S.firstName} ${S.lastName}`),w=i&&i.length>0?i[Math.floor(Math.random()*i.length)]:"Passionate Educator Ready to Inspire",y={id:S.id,userId:S.id,name:`${S.firstName} ${S.lastName}`,username:g,email:S.email,profileImage:S.avatar||"",avatar:S.avatar||"",coverImages:[],tagline:w,bio:"",subjects:[],exams:[],qualifications:[],languages:[],experienceYears:0,contact:{phone:S.contactNumber||"",email:S.email,location:"",onlineAvailable:!0},timetable:[],individualClasses:[],courses:[],quizzes:[],achievements:[],registrationStatus:"pending",earnings:{total:0,withdrawn:0,available:0},withdrawalHistory:[],payoutDetails:null,commissionRate:25,verification:{id:{status:"unverified"},bank:{status:"unverified"}},ratings:[]};console.log(`Fixing teacher: ${y.name} (${y.id})`),yield s(y),u++}catch(v){console.error(`Failed to fix user ${S.id}:`,v),N++}T(`Repaired ${u} profiles. ${N>0?`${N} failed.`:""}`,N>0?"error":"success"),b(!1)});return t.length===0?null:e.jsxs("div",{className:"mb-8 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-bold text-yellow-800 dark:text-yellow-200 mb-2",children:" Data Integrity Issue Detected"}),e.jsxs("p",{className:"text-yellow-700 dark:text-yellow-300 mb-4",children:["Found ",e.jsx("strong",{children:t.length}),' users with "Teacher" role but no associated Teacher Profile. They will not appear in the admin panel or store.']}),e.jsx("ul",{className:"list-disc pl-5 mb-4 text-sm text-yellow-600 dark:text-yellow-400 max-h-40 overflow-y-auto",children:t.map(u=>e.jsxs("li",{children:[u.firstName," ",u.lastName," (",u.email,")"]},u.id))}),e.jsx("button",{onClick:d,disabled:m,className:"px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-md font-medium disabled:opacity-50",children:m?"Repairing...":"Fix Missing Profiles"})]})},zs=()=>{const{teachers:l,users:n,sales:s,defaultCoverImages:T,vouchers:i,topUpRequests:m,handleUpdateTeacher:b,handleUpdateWithdrawal:f,handleRemoveDefaultCoverImage:t,handleTopUpDecision:d,handleUpdateSaleStatus:u,handleRefundSale:N,handleCourseApproval:S,handleProductApproval:v,handleUpdateUser:g}=Z(),{currentUser:w}=qe(),{handleNavigate:y}=ue(),{openImageUploadModal:G}=ie(),[V,r]=c.useState("analytics"),[A,h]=c.useState(void 0),[R,k]=c.useState(null);c.useEffect(()=>{w&&w.permissions&&!w.permissions.includes("all")&&!w.permissions.includes(V)&&w.permissions.length>0&&r(w.permissions[0])},[w]);const M=c.useCallback(()=>k(null),[]),L=H=>y({name:"teacher_profile",teacherId:H}),a=H=>y({name:"admin_view_student_dashboard",userId:H}),D=()=>{G("admin_default_cover")},U=H=>{k(H)},z=()=>{R&&(t(R),k(null))},K=(H,ae)=>{g({id:H,permissions:ae})},P=H=>{h(H),r("site_content")},q=()=>{switch(V){case"analytics":return e.jsx(ps,{teachers:l,users:n,sales:s});case"users":return e.jsx(fs,{teachers:l,users:n,onUpdateTeacher:b,onViewTeacher:L,onViewStudentDashboard:a,defaultCoverImages:T});case"staff":return e.jsx(Fs,{users:n,onUpdatePermissions:K});case"content":return e.jsx(ks,{teachers:l,defaultCoverImages:T,onAddDefaultCoverImage:D,onRemoveDefaultCoverImage:U,onCourseApproval:S});case"products":return e.jsx(ys,{teachers:l,onProductApproval:v});case"allsales":return e.jsx(As,{allSales:s,allUsers:n,allTeachers:l,onViewTeacher:L,onUpdateSaleStatus:u,onRefundSale:N});case"photo_orders":return e.jsx(Ds,{});case"physical_orders":return e.jsx(Ls,{});case"revenue":return e.jsx(vs,{teachers:l,allUsers:n,topUpRequests:m,onUpdateWithdrawal:f,handleTopUpDecision:d,onViewTeacher:L});case"vouchers":return e.jsx(Is,{vouchers:i,users:n});case"referrals":return e.jsx(Ts,{users:n,teachers:l,sales:s,onViewTeacher:L});case"payment_gateways":return e.jsx(Ms,{});case"site_content":return e.jsx(Rs,{initialKey:A});case"calculation_guide":return e.jsx(_s,{setActiveView:r,onNavigateToContent:P});case"developer":return e.jsx(Os,{});default:return e.jsx("div",{children:"Select a view"})}};return e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8 animate-slideInUp",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx(us,{activeView:V,setActiveView:r}),e.jsxs("main",{className:"flex-1",children:[e.jsx(Us,{}),q()]})]}),R&&e.jsx(rt,{isOpen:!0,onClose:M,onConfirm:z,title:"Confirm Deletion",message:"Are you sure you want to remove this default cover image?",confirmText:"Yes, Remove"})]})};export{zs as default};
