var Os=Object.defineProperty,zs=Object.defineProperties;var Es=Object.getOwnPropertyDescriptors;var Bt=Object.getOwnPropertySymbols;var Rs=Object.prototype.hasOwnProperty,$s=Object.prototype.propertyIsEnumerable;var Vt=(t,l,n)=>l in t?Os(t,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[l]=n,L=(t,l)=>{for(var n in l||(l={}))Rs.call(l,n)&&Vt(t,n,l[n]);if(Bt)for(var n of Bt(l))$s.call(l,n)&&Vt(t,n,l[n]);return t},F=(t,l)=>zs(t,Es(l));var we=(t,l,n)=>new Promise((r,o)=>{var j=u=>{try{c(n.next(u))}catch(s){o(s)}},p=u=>{try{c(n.throw(u))}catch(s){o(s)}},c=u=>u.done?r(u.value):Promise.resolve(u.value).then(j,p);c((n=n.apply(t,l)).next())});import{R as Dt,d as Ne,k as Fs,c as qs,p as Mt,r as a,j as e,l as Pt,P as pt,U as ss,q as At,L as Lt,v as yt,H as _s,V as as,B as Us,w as rs,x as Gs,E as Bs,y as tt,z as ns,A as Vs,D as Ws,a as Ot,u as Fe,b as zt,t as ft,s as St,F as Se,G as E,I as ge,J as ct,T as ot,K as $e,n as ls,X as Be,S as Ct,N as We,e as is,C as Hs,O as Ae,Q as et,W as Wt,Y as It,Z as Qs,_ as Ht,$ as Ys,a0 as Ks,a1 as jt,a2 as Js,h as ds,a3 as Xs,a4 as Zs,a5 as ea,a6 as dt,a7 as ta,a8 as os,a9 as sa,aa,ab as ra,ac as na,M as Qt,ad as la,ae as ia,af as da,ag as oa,g as ca,ah as Xe}from"./index-BXN-gaEy.js";import{I as ma,S as ua,R as xa,a as cs}from"./StudentDetailsModal-NtkdRNK3.js";import{S as ha}from"./StarRating-BeOC4AZb.js";import{Q as Et,E as Rt,T as ga}from"./TimeTable-BJ2hd5rK.js";import{S as kt}from"./SearchableSelect-Dgx7XP55.js";import{C as Tt}from"./ConfirmationModal-CVK0Y9X0.js";import{S as ba}from"./SEOHead-fOquVp0s.js";import{B as pa,f as it,H as wt,q as fa,O as ja,w as ka,j as ya,o as va}from"./vendor-firebase-CLtQg3ae.js";import{s as Ze}from"./slug-Be7lxzw5.js";import{T as wa,A as Na}from"./AttendanceSummaryTable-DaIVNjyM.js";import{C as Sa}from"./ClassCard-BBTr9XzW.js";import{C as Ca}from"./CourseCard-uZsExVwk.js";import $t from"./html2canvas.esm-CiaFdv3w.js";import{Q as Ia}from"./QuizCard-COBKBKhv.js";import{P as Ta}from"./ProductCard-BOy-eRLr.js";import{E as Da}from"./EventCard-Smhp_CKP.js";const ms=Dt.forwardRef(({teacher:t,isOwnProfile:l,onEditProfile:n,onEditImage:r,onRemoveCoverImage:o,coverImageIndex:j,setCoverImageIndex:p,followerCount:c},u)=>{var w,P,K,J;const{defaultCoverImages:s}=Ne(),h=t.username?`${window.location.origin}/${t.username}`:`${window.location.origin}/?teacherId=${t.id}`,f=Fs(t.ratings),g=t.profileImage?qs(t.profileImage,[160,320]):void 0,{percentage:m}=Mt(t),x=a.useMemo(()=>(t.coverImages||[]).filter(N=>N&&!N.includes("default-cover-images")),[t.coverImages]),k=a.useMemo(()=>x.length>0?x:s||[],[x,s]);return e.jsxs("div",{ref:u,className:"bg-light-surface dark:bg-dark-surface rounded-lg shadow-2xl mb-8 animate-fadeIn overflow-hidden border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"relative w-full h-64",children:e.jsx(ma,{images:k,isEditable:l,currentIndex:j,onIndexChange:p,onEditImage:r,onRemoveImage:o})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 relative",children:[e.jsxs("div",{className:"md:col-span-2 flex flex-col sm:flex-row items-center sm:items-start text-center sm:text-left",children:[e.jsxs("div",{className:"relative flex-shrink-0 -mt-24 border-4 border-light-surface dark:border-dark-surface shadow-lg",style:{width:"10rem",height:"10rem",overflow:"hidden",borderRadius:"9999px",clipPath:"circle(50% at 50% 50%)"},children:[t.profileImage?e.jsx("img",{src:Pt(t.profileImage,160,160),srcSet:g,sizes:"160px",alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsxs("div",{style:{width:"100%",height:"100%",backgroundColor:"#3b82f6",display:"flex",alignItems:"center",justifyContent:"center",color:"#ffffff",fontWeight:"bold",fontSize:"3rem"},children:[((P=(w=t.name)==null?void 0:w.split(" ")[0])==null?void 0:P.charAt(0))||"",((J=(K=t.name)==null?void 0:K.split(" ")[1])==null?void 0:J.charAt(0))||""]}),l&&e.jsx("button",{onClick:()=>r("profile"),className:"absolute bottom-2 right-2 bg-white/80 dark:bg-black/60 rounded-full p-2 text-light-text dark:text-dark-text hover:bg-primary hover:text-white transition-colors download-ignore","aria-label":"Edit profile picture",children:e.jsx(pt,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"sm:ml-6 mt-4 sm:mt-0 flex-grow",children:[e.jsx("h1",{className:"text-3xl font-bold",children:t.name}),e.jsx("p",{className:"text-md text-primary",children:t.tagline}),e.jsx("div",{className:"mt-2",children:e.jsx(ha,{rating:f.average,count:f.count,readOnly:!0})}),c!==void 0&&e.jsxs("div",{className:"mt-3 flex items-center space-x-2 text-sm text-light-text dark:text-dark-text justify-center sm:justify-start",children:[e.jsx(ss,{className:"w-5 h-5 text-light-subtle dark:text-dark-subtle"}),e.jsx("span",{className:"font-semibold",children:c}),e.jsx("span",{children:"Followers"})]}),l&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1 text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Profile Completion"}),e.jsxs("span",{className:"font-bold text-primary",children:[m,"%"]})]}),e.jsx(At,{value:m,max:100})]}),e.jsxs("div",{className:"mt-4 space-y-3 text-sm text-light-text dark:text-dark-text text-center sm:text-left",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"font-semibold text-light-subtle dark:text-dark-subtle block mb-2",children:"Teaching Areas"}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center sm:justify-start",children:t.teachingItems&&t.teachingItems.length>0?t.teachingItems.map(N=>e.jsxs("div",{className:"px-3 py-1.5 text-xs font-medium rounded-md bg-primary/5 border border-primary/10 text-light-text dark:text-dark-text text-left",children:[e.jsx("span",{className:"block font-bold text-primary",children:N.subject}),e.jsx("span",{className:"block opacity-80",children:N.audience}),N.grades.length>0&&e.jsx("span",{className:"block opacity-70 mt-0.5 text-[10px]",children:N.grades.join(", ")})]},N.id)):t.subjects.map(N=>e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-primary/10 text-primary-dark dark:text-primary-light",children:N},N))})]}),e.jsxs("div",{children:[e.jsx("strong",{className:"font-semibold text-light-subtle dark:text-dark-subtle block mb-1",children:"Qualifications"}),e.jsx("p",{className:"text-xs",children:t.qualifications.join(" • ")})]})]})]})]}),l&&e.jsx("div",{className:"absolute top-0 right-0 download-ignore",children:e.jsxs("button",{onClick:n,className:"flex-shrink-0 flex items-center space-x-2 px-3 py-1.5 text-xs font-medium text-white bg-primary rounded-md hover:bg-primary-dark transition-colors",children:[e.jsx(pt,{className:"w-3 h-3"}),e.jsx("span",{children:"Edit"})]})}),e.jsxs("div",{className:"md:col-span-1 flex flex-col justify-between items-center pt-4 md:pt-0 md:border-l border-light-border dark:border-dark-border md:pl-6 text-center",children:[e.jsxs("div",{className:"flex flex-col items-center w-full",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Lt,{className:"h-6 w-6"}),e.jsxs("span",{className:"text-lg font-bold",children:["clazz.",e.jsx("span",{className:"text-primary",children:"lk"})]})]}),e.jsx("div",{className:"mt-2 w-24 h-24 rounded-md shadow-sm overflow-hidden bg-white",children:e.jsx(Et,{data:h,logoSrc:"/Logo3.png",size:96,className:""})}),e.jsx("a",{href:h,target:"_blank",rel:"noopener noreferrer",className:"mt-3 text-[10px] sm:text-xs text-light-subtle dark:text-dark-subtle hover:text-primary dark:hover:text-primary-light break-all font-mono bg-gray-50 dark:bg-white/5 px-2 py-1.5 rounded border border-light-border dark:border-dark-border transition-colors max-w-full",children:h})]}),e.jsx("div",{className:"mt-4 space-y-2 text-sm",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(yt,{className:"w-4 h-4 mr-2 text-light-subtle dark:text-dark-subtle"}),e.jsx("span",{children:t.contact.phone})]})})]})]}),e.jsx("div",{className:"border-t border-light-border dark:border-dark-border mt-6 pt-4 text-center",children:e.jsx("p",{className:"text-sm italic text-light-subtle dark:text-dark-subtle",children:'"Join me on clazz.lk to learn, grow, and achieve."'})})]})]})});ms.displayName="ProfileHeader";const Ma=[{id:"overview",label:"Overview",icon:_s},{id:"classes",label:"Classes",icon:as},{id:"courses",label:"Courses",icon:Us},{id:"quizzes",label:"Quizzes",icon:rs},{id:"products",label:"Store",icon:Gs},{id:"my_events",label:"Events",icon:Bs},{id:"past_classes",label:"Past Classes",icon:tt,ownerOnly:!0},{id:"earnings",label:"Earnings",icon:ns,ownerOnly:!0},{id:"attendance",label:"Attendance",icon:ss,ownerOnly:!0},{id:"notifications",label:"Notifications",icon:Vs,ownerOnly:!0},{id:"timetable",label:"Time Table",icon:Ws},{id:"contact",label:"Contact & Location",icon:yt}],Pa=({activeTab:t,setActiveTab:l,isOwnProfile:n,hasEvents:r})=>{const[o,j]=a.useState(!1),p=Ma.filter(u=>!u.ownerOnly||n);console.log("ProfileTabs render:",{isOwnProfile:n,hasEvents:r,visibleTabIds:p.map(u=>u.id)});const c=(u,s)=>{u.stopPropagation(),window.innerWidth<768&&!o?j(!0):(l(s),j(!1))};return e.jsxs(e.Fragment,{children:[o&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-[990] md:hidden",onClick:()=>j(!1)}),e.jsx("div",{className:`
            fixed md:relative top-16 md:top-0 left-0 bottom-0 md:bottom-auto
            z-[1000] md:z-auto
            bg-light-surface dark:bg-dark-surface
            border-r md:border-r-0 md:border md:border-light-border md:dark:border-dark-border
            md:rounded-lg md:shadow-sm
            transition-all duration-300 ease-in-out
            flex flex-col
            ${o?"w-64 shadow-2xl":"w-16 md:w-full"}
        `,onClick:()=>!o&&j(!0),children:e.jsx("nav",{className:"flex flex-col flex-1 overflow-y-auto py-2 md:py-0",children:p.map(u=>{const s=t===u.id,h=u.icon;return e.jsxs("button",{onClick:f=>c(f,u.id),className:`
                      relative flex items-center
                      py-3 md:py-3 transition-all duration-200
                      md:border-l-4 md:border-r-0 md:px-4
                      ${s?"border-primary text-primary bg-primary/5 md:bg-primary/10":"border-transparent text-light-subtle dark:text-dark-subtle hover:text-light-text dark:hover:text-dark-text hover:bg-gray-50 dark:hover:bg-white/5"}
                      ${o?"px-4 justify-start":"px-0 justify-center md:justify-start"}
                  `,"aria-current":s?"page":void 0,title:u.label,children:[e.jsx("div",{className:"flex items-center justify-center flex-shrink-0",children:e.jsx(h,{className:`w-6 h-6 md:w-5 md:h-5 ${s?"text-primary":"currentColor"}`})}),e.jsx("span",{className:`
                      ml-3 font-medium text-sm whitespace-nowrap
                      ${o?"block opacity-100":"hidden md:block"}
                  `,children:u.label}),s&&e.jsx("span",{className:"hidden md:block text-primary ml-auto",children:e.jsx(Ot,{className:"w-4 h-4"})})]},u.id)})})})]})},Aa={teacherId:"",title:"",subject:"",description:"",date:"",startTime:"",endTime:"",fee:0,currency:"LKR",targetAudience:"",mode:"Online",recurrence:"none",status:"scheduled",isPublished:!1,paymentMethod:"platform",documentLink:"",medium:"",grade:""},La=({isOpen:t,onClose:l,onSave:n,initialData:r,teacherId:o})=>{const{subjects:j,functionUrls:p}=Fe(),{currentUser:c}=zt(),{teachers:u}=Ne(),[s,h]=a.useState({}),[f,g]=a.useState(""),[m,x]=a.useState(""),[k,w]=a.useState(""),[P,K]=a.useState(!1),[J,N]=a.useState([]),[I,C]=a.useState({date:"",startTime:"",endTime:""}),[q,y]=a.useState(""),_=a.useMemo(()=>(r==null?void 0:r.meetProvider)==="google"||s.meetProvider==="google",[r,s]),B=a.useMemo(()=>u.find(v=>v.id===o),[u,o]),W=(B==null?void 0:B.teachingItems)||[],U=W.length>0,ne=(B==null?void 0:B.teachingLocations)||[],Le=a.useMemo(()=>{if(U){const v=Array.from(new Set(W.map(T=>T.audience))).map(T=>({value:T,label:T}));return s.targetAudience&&!v.some(T=>T.value===s.targetAudience)&&v.push({value:s.targetAudience,label:s.targetAudience}),v}return ft},[U,W,s.targetAudience]),Te=a.useMemo(()=>{if(U){const T=Array.from(new Set(W.filter(S=>S.audience===s.targetAudience).map(S=>S.subject))).map(S=>({value:S,label:S}));return s.subject&&!T.some(S=>S.value===s.subject)&&T.push({value:s.subject,label:s.subject}),T}return!s.targetAudience||!j[s.targetAudience]?[{value:"Other",label:"Other (please specify)"}]:[...j[s.targetAudience],{value:"Other",label:"Other (please specify)"}]},[s.targetAudience,j,U,W,s.subject]),Me=a.useMemo(()=>{if(U){const v=new Set;W.filter(S=>S.audience===s.targetAudience&&S.subject===s.subject).forEach(S=>S.mediums.forEach(ee=>v.add(ee)));const T=Array.from(v).map(S=>({value:S,label:S}));return s.medium&&!T.some(S=>S.value===s.medium)&&T.push({value:s.medium,label:s.medium}),T}return[]},[U,W,s.targetAudience,s.subject,s.medium]),d=a.useMemo(()=>{if(U){const v=new Set;W.filter(S=>S.audience===s.targetAudience&&S.subject===s.subject).forEach(S=>S.grades.forEach(ee=>v.add(ee)));const T=Array.from(v).map(S=>({value:S,label:S}));return s.grade&&!T.some(S=>S.value===s.grade)&&T.push({value:s.grade,label:s.grade}),T}return[]},[U,W,s.targetAudience,s.subject,s.grade]),be=a.useMemo(()=>{const v=ne.map(T=>({value:T.id,label:`${T.instituteName} - ${T.town} (${T.district})`}));if(r!=null&&r.id&&(r.mode==="Physical"||r.mode==="Both")&&!ne.some(S=>S.instituteName===r.institute&&S.town===r.town&&S.district===r.district)){const S=[r.institute,r.town].filter(Boolean).join(" - ")||"Unspecified Location";v.unshift({value:"legacy_location",label:`${S} (Legacy/Editable)`})}return(c==null?void 0:c.role)==="admin"&&v.push({value:"custom_location",label:"Custom / New Location (Admin Only)"}),v},[ne,r,c]);a.useMemo(()=>{if(!s.district)return[];const v=St[s.district]||[];return[{value:"",label:"Select a town"},...v.map(T=>({value:T,label:T}))]},[s.district]),a.useEffect(()=>{var v,T,S,ee;if(t)if(w(""),!r||!r.id){const H=U?W[0].audience:"Secondary school students (Grade 6–11 / O/L candidates)",ae=U?((v=W.find(le=>le.audience===H))==null?void 0:v.subject)||"":((S=(T=j[H])==null?void 0:T[0])==null?void 0:S.value)||"";h(L(F(L({},Aa),{teacherId:o,fee:"",targetAudience:H,subject:ae}),r||{})),g(""),x(""),N([]),y("")}else{const H=r,ae=((ee=H.fee)==null?void 0:ee.toString())||"";let le="",de="";U||((!ft.some(oe=>oe.value===H.targetAudience)||H.targetAudience==="Other")&&(le=H.targetAudience||""),(j[H.targetAudience]||[]).some(oe=>oe.value===H.subject)||(de=H.subject||"")),h(F(L({},H),{fee:ae,medium:H.medium||"",grade:H.grade||""})),g(le),x(de),N(H.flexibleDates||[]);const he=ne.find(ie=>ie.instituteName===H.institute&&ie.town===H.town&&ie.district===H.district);he?y(he.id):H.id&&(H.mode==="Physical"||H.mode==="Both")?y("legacy_location"):y("")}},[t,r]);const X=v=>{const{name:T,value:S}=v.target;h(ee=>{var H,ae;const Z=F(L({},ee),{[T]:S});if(T==="mode"&&S==="Online"&&(Z.paymentMethod="platform",Z.institute="",Z.district="",Z.town="",y("")),T==="targetAudience"&&S!=="Other")if(g(""),U){const le=((H=W.find(de=>de.audience===S))==null?void 0:H.subject)||"";Z.subject=le,Z.medium="",Z.grade=""}else{const le=j[S]||[];Z.subject=((ae=le[0])==null?void 0:ae.value)||"Other"}return T==="subject"&&(S!=="Other"&&x(""),U&&(Z.medium="",Z.grade="")),Z})},Oe=v=>{const T=v.target.value;if(y(T),!T){h(S=>F(L({},S),{institute:"",district:"",town:""}));return}if(T==="legacy_location"&&r)h(S=>F(L({},S),{institute:r.institute||"",district:r.district||"",town:r.town||""}));else if(T==="custom_location")h(S=>F(L({},S),{institute:"",district:"",town:""}));else{const S=ne.find(ee=>ee.id===T);S&&h(ee=>F(L({},ee),{institute:S.instituteName,district:S.district,town:S.town}))}},me=()=>{I.date&&I.startTime&&I.endTime&&(N(v=>[...v,I]),C({date:"",startTime:"",endTime:""}))},je=v=>{N(T=>T.filter((S,ee)=>ee!==v))},R=v=>we(void 0,null,function*(){v.preventDefault(),w(""),_&&K(!0);let T=s.joiningLink||"",S=s.googleEventId||"";try{if(_){const ae=`${p.googleMeetHandler}/createGoogleMeet`,le=yield fetch(ae,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({teacherId:(c==null?void 0:c.role)==="admin"?o:(c==null?void 0:c.id)||o,title:s.title,startTime:s.startTime,endTime:s.endTime,date:s.date,googleEventId:s.googleEventId})}),de=yield le.json();if(!le.ok||!de.success)throw new Error(de.message||"Failed to create or update Google Meet link.");T=de.meetLink,S=de.eventId}else(s.mode==="Online"||s.mode==="Both")&&s.joiningLink&&new URL(s.joiningLink);const ee=s.targetAudience==="Other"&&!U?f:s.targetAudience;if(!(ee!=null&&ee.trim()))throw new Error("Target Audience is a required field.");const Z=s.subject==="Other"&&!U?m:s.subject;if(!(Z!=null&&Z.trim()))throw new Error("Subject is a required field.");if((s.mode==="Physical"||s.mode==="Both")&&!_&&(!s.institute||!s.district||!s.town))throw new Error("Please select a valid teaching location or ensure all location fields are filled.");let H={};if(s.recurrence==="flexible"){if(J.length===0)throw new Error("Please add at least one date for a flexible class.");const ae=[...J].sort((le,de)=>new Date(le.date).getTime()-new Date(de.date).getTime());H={flexibleDates:ae,date:ae[0].date,startTime:ae[0].startTime,endTime:ae[0].endTime}}else{const ae=new Date(`${s.date}T${s.startTime}`),le=new Date;if((!(r!=null&&r.id)||s.status==="scheduled")&&ae<le)throw new Error("Cannot schedule a class in the past.")}n(F(L(L({},s),H),{joiningLink:T,googleEventId:S,targetAudience:ee,subject:Z,id:(r==null?void 0:r.id)||Date.now(),fee:parseFloat(s.fee)||0}))}catch(ee){w(ee.message||"An error occurred.")}finally{K(!1)}}),qe=r?r.meetProvider==="google"&&!r.id?"Schedule with Google Meet":"Edit Class Details":"Schedule a New Class",_e=q&&!(q==="legacy_location"||q==="custom_location");return e.jsx(Se,{isOpen:t,onClose:l,title:qe,size:"3xl",children:e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsx(E,{label:"Class Title",name:"title",value:s.title||"",onChange:X,required:!0,placeholder:"e.g., A-Level Physics 2025 Theory"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(ge,{label:"Target Audience",name:"targetAudience",value:s.targetAudience||"",onChange:X,options:Le,required:!0}),e.jsx(ge,{label:"Subject",name:"subject",value:s.subject||"",onChange:X,options:Te,required:!0})]}),!U&&s.targetAudience==="Other"&&e.jsx(E,{label:"Please specify audience",name:"customTargetAudience",value:f,onChange:v=>g(v.target.value),required:!0,placeholder:"e.g., International school grade 8"}),!U&&s.subject==="Other"&&e.jsx(E,{label:"Please specify subject",name:"customSubject",value:m,onChange:v=>x(v.target.value),required:!0,placeholder:"e.g., Advanced Robotics"}),U&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(ge,{label:"Medium",name:"medium",value:s.medium||"",onChange:X,options:[{value:"",label:"Select Medium"},...Me]}),e.jsx(ge,{label:"Grade",name:"grade",value:s.grade||"",onChange:X,options:[{value:"",label:"Select Grade"},...d]})]}),e.jsx(ct,{label:"Description",id:"description",name:"description",value:s.description||"",onChange:X,rows:3,placeholder:"Briefly describe the class"},(r==null?void 0:r.id)||`new-class-${t}`),e.jsx(ge,{label:"Recurrence",name:"recurrence",value:s.recurrence||"none",onChange:X,options:[{value:"none",label:"One-time"},{value:"weekly",label:"Weekly"},{value:"flexible",label:"Flexible"}],required:!0}),s.recurrence==="weekly"&&e.jsxs("div",{className:"p-4 border border-dashed border-light-border dark:border-dark-border rounded-md space-y-4",children:[e.jsx(E,{label:"Start Date",name:"date",type:"date",value:s.date||"",onChange:X,required:!0}),e.jsx(E,{label:"End Date (Optional)",name:"endDate",type:"date",value:s.endDate||"",onChange:X}),e.jsx(ge,{label:"Payment Option",name:"weeklyPaymentOption",value:s.weeklyPaymentOption||"per_session",onChange:X,options:[{value:"per_session",label:"Per Session"},{value:"per_month",label:"Per Month"}]})]}),s.recurrence==="flexible"&&e.jsxs("div",{className:"p-4 border border-dashed border-light-border dark:border-dark-border rounded-md space-y-4",children:[e.jsx("h3",{className:"font-medium text-light-text dark:text-dark-text",children:"Define Class Sessions"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto pr-2",children:J.map((v,T)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-light-surface dark:bg-dark-surface rounded-md",children:[e.jsxs("p",{className:"text-sm",children:[new Date(v.date).toLocaleDateString()," at ",v.startTime," - ",v.endTime]}),e.jsx("button",{type:"button",onClick:()=>je(T),className:"p-1 text-red-500 rounded-full hover:bg-red-100 dark:hover:bg-red-900/50",children:e.jsx(ot,{className:"w-4 h-4"})})]},T))}),e.jsxs("div",{className:"flex flex-col md:flex-row items-end gap-2 pt-2 border-t border-light-border dark:border-dark-border",children:[e.jsx(E,{label:"Date",name:"new_date",type:"date",value:I.date,onChange:v=>C(T=>F(L({},T),{date:v.target.value}))}),e.jsx(E,{label:"Start",name:"new_start",type:"time",value:I.startTime,onChange:v=>C(T=>F(L({},T),{startTime:v.target.value}))}),e.jsx(E,{label:"End",name:"new_end",type:"time",value:I.endTime,onChange:v=>C(T=>F(L({},T),{endTime:v.target.value}))}),e.jsx("button",{type:"button",onClick:me,className:"px-4 py-2 bg-primary text-white rounded-md text-sm h-10",children:e.jsx($e,{className:"w-5 h-5"})})]})]}),s.recurrence!=="flexible"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.recurrence==="none"&&e.jsx(E,{label:"Date",name:"date",type:"date",value:s.date||"",onChange:X,required:!0}),e.jsx(E,{label:"Start Time",name:"startTime",type:"time",value:s.startTime||"",onChange:X,required:!0}),e.jsx(E,{label:"End Time",name:"endTime",type:"time",value:s.endTime||"",onChange:X,required:!0})]}),e.jsxs("div",{children:[e.jsx(E,{label:"Fee (LKR)",name:"fee",type:"number",value:s.fee||"",onChange:X,required:!0}),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle mt-1",children:"Fee is per session for 'Weekly (Per Session)' and 'One-time' classes. For 'Weekly (Per Month)' and 'Flexible', this is the total fee for the period."})]}),e.jsx(ge,{label:"Mode",name:"mode",value:s.mode||"Online",onChange:X,options:[{value:"Online",label:"Online"},{value:"Physical",label:"Physical"},{value:"Both",label:"Online & Physical"}],required:!0}),(s.mode==="Physical"||s.mode==="Both")&&!_&&e.jsxs("div",{className:"p-4 border border-light-border dark:border-dark-border rounded-md space-y-4",children:[e.jsx("h3",{className:"font-medium text-light-text dark:text-dark-text",children:"Physical Location & Payment"}),e.jsx(ge,{label:"Select a Saved Location",name:"locationId",value:q,onChange:Oe,options:[{value:"",label:"Select a location..."},...be],required:!0}),be.length===0&&e.jsx("p",{className:"text-red-500 text-xs bg-red-50 dark:bg-red-900/30 p-2 rounded-md",children:"You have not added any teaching locations to your profile yet. Please go to your Profile (Edit Profile -> Optional Details) to add Institutes/Locations before scheduling a physical class."}),q&&(_e?e.jsxs("div",{className:"p-3 bg-light-background dark:bg-dark-background rounded-md text-sm text-light-text dark:text-dark-text border border-light-border dark:border-dark-border",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Institute:"})," ",s.institute]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Area:"})," ",s.town,", ",s.district]})]}):e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsx(E,{label:"Institute Name",name:"institute",value:s.institute||"",onChange:X,required:!0,placeholder:"e.g., Apex Hall"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(kt,{label:"District",options:ls.map(v=>({value:v,label:v})),value:s.district||"",onChange:v=>h(T=>F(L({},T),{district:v,town:""})),placeholder:"District"}),e.jsx(kt,{label:"Town",options:s.district?[{value:"",label:"Select a town"},...(St[s.district]||[]).map(v=>({value:v,label:v}))]:[],value:s.town||"",onChange:v=>h(T=>F(L({},T),{town:v})),placeholder:"Town",disabled:!s.district})]})]})),e.jsx(ge,{label:"Payment Collection Method",name:"paymentMethod",value:s.paymentMethod||"platform",onChange:X,options:[{value:"platform",label:"Collect through clazz.lk (Recommended)"},{value:"manual",label:"Collect manually (e.g., at venue)"}],required:!0})]}),!_&&(s.mode==="Online"||s.mode==="Both")&&e.jsxs("div",{className:"p-4 border border-light-border dark:border-dark-border rounded-md space-y-4",children:[e.jsx("h3",{className:"font-medium text-light-text dark:text-dark-text",children:"Online Details"}),e.jsx(E,{label:"Online Joining Link (Zoom, Manual Meet, etc.)",name:"joiningLink",type:"url",value:s.joiningLink||"",onChange:X,placeholder:"e.g., https://zoom.us/j/1234567890"}),e.jsx(E,{label:"Shared Document Link (Google Drive, etc.)",name:"documentLink",type:"url",value:s.documentLink||"",onChange:X,placeholder:"e.g., https://drive.google.com/drive/folders/..."})]}),_&&e.jsxs("div",{className:"p-4 border border-light-border dark:border-dark-border rounded-md space-y-4",children:[e.jsx("h3",{className:"font-medium text-light-text dark:text-dark-text",children:"Online Details"}),e.jsx("p",{className:"text-sm p-2 bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded-md",children:"A Google Meet link will be automatically generated and attached to this class upon saving."}),e.jsx(E,{label:"Shared Document Link (Google Drive, etc.)",name:"documentLink",type:"url",value:s.documentLink||"",onChange:X,placeholder:"e.g., https://drive.google.com/drive/folders/..."})]}),k&&e.jsx("p",{className:"text-red-500 text-sm text-center",children:k}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-3",children:[e.jsxs("button",{type:"button",onClick:l,className:"inline-flex items-center justify-center px-4 py-2 border border-light-border dark:border-dark-border text-sm font-medium rounded-md shadow-sm text-light-text dark:text-dark-text bg-light-surface dark:bg-dark-surface hover:bg-light-border dark:hover:bg-dark-border/50 transition-colors",children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:P,className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark disabled:opacity-50",children:[P?e.jsx(Ct,{className:"w-4 h-4 mr-2"}):e.jsx(We,{className:"w-4 h-4 mr-2"}),P?"Saving...":"Save Class"]})]})]})})},Yt={teacherId:"",title:"",subject:"",description:"",date:"",startTime:"",durationMinutes:30,fee:0,currency:"LKR",status:"scheduled",isPublished:!1,medium:"",grade:""},Oa=({isOpen:t,onClose:l,onSave:n,initialData:r,teacherId:o})=>{const{allSubjects:j}=Fe(),{teachers:p}=Ne(),[c,u]=a.useState({}),[s,h]=a.useState(!1),f=a.useMemo(()=>p.find(N=>N.id===o),[p,o]),g=(f==null?void 0:f.teachingItems)||[],m=g.length>0,x=a.useMemo(()=>{if(m){const I=Array.from(new Set(g.map(C=>C.subject))).map(C=>({value:C,label:C}));return c.subject&&!I.some(C=>C.value===c.subject)&&I.push({value:c.subject,label:c.subject}),I}return j},[m,g,j,c.subject]),k=a.useMemo(()=>{if(m){const N=new Set;g.filter(C=>C.subject===c.subject).forEach(C=>C.mediums.forEach(q=>N.add(q)));const I=Array.from(N).map(C=>({value:C,label:C}));return c.medium&&!I.some(C=>C.value===c.medium)&&I.push({value:c.medium,label:c.medium}),I}return[]},[m,g,c.subject,c.medium]),w=a.useMemo(()=>{if(m){const N=new Set;g.filter(C=>C.subject===c.subject).forEach(C=>C.grades.forEach(q=>N.add(q)));const I=Array.from(N).map(C=>({value:C,label:C}));return c.grade&&!I.some(C=>C.value===c.grade)&&I.push({value:c.grade,label:c.grade}),I}return[]},[m,g,c.subject,c.grade]);a.useEffect(()=>{var N;t&&(h(!1),u(r?F(L({},r),{fee:r.fee.toString(),durationMinutes:r.durationMinutes.toString()}):F(L({},Yt),{teacherId:o,subject:m?g[0].subject:((N=j[0])==null?void 0:N.value)||"",fee:"",durationMinutes:"30"})))},[t,r,o,j,m,g]);const P=N=>{const{name:I,value:C}=N.target;u(q=>{const y=F(L({},q),{[I]:C});return I==="subject"&&m&&(y.medium="",y.grade=""),y})},K=N=>we(void 0,null,function*(){N.preventDefault(),h(!0);try{yield n(F(L(L({},Yt),c),{id:(r==null?void 0:r.id)||`q_${Date.now()}`,questions:(r==null?void 0:r.questions)||[],fee:parseFloat(c.fee)||0,durationMinutes:parseInt(c.durationMinutes,10)||30,instanceStartDate:(r==null?void 0:r.instanceStartDate)||new Date().toISOString()}))}catch(I){console.error("Error saving quiz from modal:",I)}}),J=r?"Edit Quiz Details":"Schedule a New Quiz";return e.jsx(Se,{isOpen:t,onClose:l,title:J,size:"lg",children:e.jsxs("form",{onSubmit:K,className:"space-y-4",children:[e.jsx(E,{label:"Quiz Title",name:"title",value:c.title||"",onChange:P,required:!0,placeholder:"e.g., Physics Unit 1 Test"}),e.jsx(ge,{label:"Subject",name:"subject",value:c.subject||"",onChange:P,options:x,required:!0}),m&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(ge,{label:"Medium",name:"medium",value:c.medium||"",onChange:P,options:[{value:"",label:"Select Medium"},...k]}),e.jsx(ge,{label:"Grade",name:"grade",value:c.grade||"",onChange:P,options:[{value:"",label:"Select Grade"},...w]})]}),e.jsx(ct,{label:"Description",id:"description",name:"description",value:c.description||"",onChange:P,rows:3,placeholder:"Briefly describe what this quiz covers"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(E,{label:"Date",name:"date",type:"date",value:c.date||"",onChange:P,required:!0}),e.jsx(E,{label:"Start Time",name:"startTime",type:"time",value:c.startTime||"",onChange:P,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(E,{label:"Duration (minutes)",name:"durationMinutes",type:"number",value:c.durationMinutes||"",onChange:P,required:!0}),e.jsx(E,{label:"Fee (LKR)",name:"fee",type:"number",value:c.fee||"",onChange:P,required:!0})]}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-3",children:[e.jsxs("button",{type:"button",onClick:l,className:"inline-flex items-center justify-center px-4 py-2 border border-light-border dark:border-dark-border text-sm font-medium rounded-md shadow-sm text-light-text dark:text-dark-text bg-light-surface dark:bg-dark-surface hover:bg-light-border dark:hover:bg-dark-border/50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-light transition-colors",children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:s,className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-light transition-colors disabled:opacity-50",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),s?"Saving...":r?"Save & Edit Questions":"Save & Add Questions"]})]})]})})},za=({isOpen:t,onClose:l,teacher:n,missingItems:r})=>{var Ee;const{handleUpdateTeacher:o,handleImageSave:j,tuitionInstitutes:p,knownInstitutes:c}=Ne(),{addToast:u}=is(),{subjects:s}=Fe(),[h,f]=a.useState(n),[g,m]=a.useState(0),[x,k]=a.useState(!1),[w,P]=a.useState(""),[K,J]=a.useState(""),[N,I]=a.useState([]),[C,q]=a.useState([]),[y,_]=a.useState(""),[B,W]=a.useState(""),[U,ne]=a.useState(""),[Le,Te]=a.useState(""),[Me,d]=a.useState(n.profileImage||null),[be,X]=a.useState(((Ee=n.coverImages)==null?void 0:Ee[0])||null),[Oe,me]=a.useState(n.verification.id.frontImageUrl||null),[je,R]=a.useState(n.verification.bank.imageUrl||null);a.useEffect(()=>{var A;t&&(f(n),d(n.profileImage||null),X(((A=n.coverImages)==null?void 0:A[0])||null),me(n.verification.id.frontImageUrl||null),R(n.verification.bank.imageUrl||null),m(0),P(ft[0].value),J(""),I([]),q([]),_(""),W(""),ne(""),Te(""))},[t,n]);const{percentage:qe}=Mt(L(L({},n),h)),se=[{name:"Teaching Areas",fields:["teachingItems","qualifications","experienceYears"]},{name:"Contact & Bio",fields:["contact.phone","contact.location","profileImage","bio"]},{name:"Optional Details",fields:["tagline","coverImages","exams","teachingLocations"]},{name:"Verification",fields:["verification.id","verification.bank"]}],_e=a.useMemo(()=>w?s[w]||[]:[],[w,s]),v=a.useMemo(()=>w.includes("Primary")?["Grade 1","Grade 2","Grade 3","Grade 4","Grade 5"]:w.includes("Secondary")||w.includes("Ordinary Level")?["Grade 6","Grade 7","Grade 8","Grade 9","Grade 10","Grade 11"]:w.includes("Advanced Level")?["Grade 12","Grade 13","Revision"]:[],[w]),T=a.useMemo(()=>{if(!y)return[];const A=St[y]||[];return[{value:"",label:"Select a town"},...A.map(M=>({value:M,label:M}))]},[y]),S=a.useMemo(()=>{if(!y||!B)return[];const A=p.map(Q=>({name:Q.name,type:"Tuition Institute"})),M=c.filter(Q=>Q.district===y&&Q.town===B).map(Q=>({name:Q.name,type:Q.type})),V=new Map;return A.forEach(Q=>V.set(Q.name,Q)),M.forEach(Q=>V.set(Q.name,Q)),Array.from(V.values()).sort((Q,D)=>Q.name.localeCompare(D.name))},[p,c,y,B]),ee=A=>{const M=A.target.value;ne(M);const V=S.find(Q=>Q.name.toLowerCase()===M.toLowerCase());V&&Te(V.type)},Z=()=>{if(!w||!K){u("Please select an audience and a subject.","error");return}if(N.length===0){u("Please select at least one medium.","error");return}if(v.length>0&&C.length===0){u("Please select at least one grade.","error");return}const A={id:Ht(),audience:w,subject:K,mediums:N,grades:C};f(M=>{const V=M.teachingItems||[],Q=M.subjects||[],D=Q.includes(K)?Q:[...Q,K];return F(L({},M),{teachingItems:[...V,A],subjects:D})}),I([]),q([])},H=A=>{f(M=>F(L({},M),{teachingItems:(M.teachingItems||[]).filter(V=>V.id!==A)}))},ae=()=>{if(!y||!B||!U||!Le){u("Please fill in all location fields.","error");return}const A={id:Ht(),district:y,town:B,instituteName:U,instituteType:Le};f(M=>F(L({},M),{teachingLocations:[...M.teachingLocations||[],A]})),ne(""),Te("")},le=A=>{f(M=>F(L({},M),{teachingLocations:(M.teachingLocations||[]).filter(V=>V.id!==A)}))},de=A=>{I(M=>M.includes(A)?M.filter(V=>V!==A):[...M,A])},he=A=>{q(M=>M.includes(A)?M.filter(V=>V!==A):[...M,A])},ie=A=>{const{name:M,value:V}=A.target;if(M.startsWith("contact.")){const Q=M.split(".")[1];f(D=>F(L({},D),{contact:F(L({},D.contact),{[Q]:V})}))}else f(Q=>F(L({},Q),{[M]:V}))},pe=(A,M)=>{f(V=>F(L({},V),{[A]:M}))},ze=()=>{g<se.length-1&&m(A=>A+1)},oe=()=>we(void 0,null,function*(){k(!0);try{const A=L({},h);if(Me&&Me!==n.profileImage){const M=yield j(Me,"profile",{teacherId:n.id});M&&(A.profileImage=M,A.avatar=M)}if(be&&(!n.coverImages||!n.coverImages.includes(be))){const M=yield j(be,"cover_add",{teacherId:n.id});M&&(A.coverImages=[M,...(n.coverImages||[]).filter(V=>V!==be)])}if(Oe&&Oe!==n.verification.id.frontImageUrl){const M=yield j(Oe,"id_verification_front",{teacherId:n.id});M&&(A.verification=F(L({},A.verification),{id:F(L({},A.verification.id),{frontImageUrl:M,status:"pending"})}))}if(je&&je!==n.verification.bank.imageUrl){const M=yield j(je,"bank_verification",{teacherId:n.id});M&&(A.verification=F(L({},A.verification),{bank:F(L({},A.verification.bank),{imageUrl:M,status:"pending"})}))}yield o(n.id,A),u("Profile updated successfully!","success"),l()}catch(A){u("Failed to save profile. Please try again.","error")}finally{k(!1)}}),ke=()=>{var A,M,V,Q;switch(g){case 0:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-lg mb-4 text-light-text dark:text-dark-text",children:"Add Your Teaching Subject"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx(ge,{label:"1. Target Audience",name:"audience",value:w,onChange:D=>{P(D.target.value),J("")},options:ft}),e.jsx(ge,{label:"2. Subject",name:"subject",value:K,onChange:D=>J(D.target.value),options:_e})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-light-text dark:text-dark-text mb-2",children:"3. Medium"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:["Sinhala","Tamil","English"].map(D=>e.jsxs("label",{className:`flex items-center px-3 py-1.5 rounded-full border cursor-pointer transition-colors ${N.includes(D)?"bg-primary/10 border-primary text-primary font-medium":"bg-light-background dark:bg-dark-background border-light-border dark:border-dark-border text-light-text dark:text-dark-text"}`,children:[e.jsx("input",{type:"checkbox",className:"hidden",checked:N.includes(D),onChange:()=>de(D)}),N.includes(D)&&e.jsx(Ae,{className:"w-4 h-4 mr-1.5"}),D]},D))})]}),v.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-light-text dark:text-dark-text mb-2",children:"4. Grade(s)"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:v.map(D=>e.jsxs("label",{className:`flex items-center px-3 py-1 rounded-md border cursor-pointer text-xs sm:text-sm transition-colors ${C.includes(D)?"bg-primary text-white border-primary":"bg-light-background dark:bg-dark-background border-light-border dark:border-dark-border text-light-text dark:text-dark-text"}`,children:[e.jsx("input",{type:"checkbox",className:"hidden",checked:C.includes(D),onChange:()=>he(D)}),D]},D))})]}),e.jsxs("button",{onClick:Z,className:"mt-2 flex items-center justify-center w-full py-2 px-4 border border-dashed border-primary text-primary rounded-md hover:bg-primary/10 transition-colors font-medium",children:[e.jsx($e,{className:"w-4 h-4 mr-2"})," Add This Subject"]})]}),h.teachingItems&&h.teachingItems.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"text-sm font-semibold text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Your Teaching Areas"}),h.teachingItems.map(D=>e.jsxs("div",{className:"flex items-start justify-between p-3 bg-light-background dark:bg-dark-background rounded-md border border-light-border dark:border-dark-border",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-primary",children:D.subject}),e.jsx("span",{className:"text-xs px-2 py-0.5 bg-gray-200 dark:bg-gray-700 rounded-full text-gray-700 dark:text-gray-300",children:D.mediums.join(", ")})]}),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle mt-1",children:D.audience}),D.grades.length>0&&e.jsx("p",{className:"text-xs text-light-text dark:text-dark-text mt-1 font-medium",children:D.grades.join(", ")})]}),e.jsx("button",{onClick:()=>H(D.id),className:"text-red-500 hover:bg-red-100 dark:hover:bg-red-900/50 p-1.5 rounded-full transition-colors",children:e.jsx(ot,{className:"w-4 h-4"})})]},D.id))]}),e.jsx("hr",{className:"border-light-border dark:border-dark-border"}),e.jsx(E,{label:"Years of Experience",name:"experienceYears",type:"number",value:((A=h.experienceYears)==null?void 0:A.toString())||"",onChange:ie}),e.jsx(Wt,{label:"Qualifications",tags:h.qualifications||[],onTagsChange:D=>pe("qualifications",D)})]});case 1:return e.jsxs("div",{className:"space-y-4",children:[e.jsx(E,{label:"Contact Number",name:"contact.phone",type:"tel",value:((M=h.contact)==null?void 0:M.phone)||"",onChange:ie}),e.jsx(E,{label:"Email Address",name:"contact.email",type:"email",value:((V=h.contact)==null?void 0:V.email)||"",onChange:ie}),e.jsx(E,{label:"Your Location (City)",name:"contact.location",value:((Q=h.contact)==null?void 0:Q.location)||"",onChange:ie}),e.jsx(et,{label:"Profile Picture",currentImage:Me,onImageChange:d,aspectRatio:"aspect-square"}),e.jsx(ct,{label:"Bio (Tell students about yourself)",id:"bio-completion",name:"bio",value:h.bio||"",onChange:ie,rows:5,placeholder:"Minimum 50 characters..."})]});case 2:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(E,{label:"Profile Tagline",name:"tagline",value:h.tagline||"",onChange:ie,placeholder:"e.g., Passionate Physics Educator"}),e.jsx(et,{label:"Cover Image",currentImage:be,onImageChange:X,aspectRatio:"aspect-video"}),e.jsx(Wt,{label:"Other Exams You Prepare For",tags:h.exams||[],onTagsChange:D=>pe("exams",D)})]}),e.jsxs("div",{className:"p-4 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-lg",children:[e.jsxs("h4",{className:"font-semibold text-lg mb-4 flex items-center text-light-text dark:text-dark-text",children:[e.jsx(It,{className:"w-5 h-5 mr-2 text-primary"}),"Teaching Locations (Optional)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx(kt,{label:"District",options:ls.map(D=>({value:D,label:D})),value:y,onChange:D=>{_(D),W("")},placeholder:"Select District"}),e.jsx(kt,{label:"Town",options:T,value:B,onChange:W,placeholder:"Select Town",disabled:!y})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-light-text dark:text-dark-text mb-1",children:"Institute Name"}),e.jsx("input",{type:"text",list:"institute-suggestions",value:U,onChange:ee,placeholder:"Type or select...",className:"w-full px-3 py-2 border border-light-border dark:border-dark-border bg-light-background dark:bg-dark-background rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm text-light-text dark:text-dark-text",disabled:!y||!B}),e.jsx("datalist",{id:"institute-suggestions",children:S.map((D,He)=>e.jsx("option",{value:D.name},He))}),(!y||!B)&&e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle mt-1",children:"Select District and Town first."})]}),e.jsx(ge,{label:"Type",name:"locType",value:Le,onChange:D=>Te(D.target.value),options:Qs.map(D=>({value:D,label:D}))})]}),e.jsxs("button",{onClick:ae,className:"mt-2 flex items-center justify-center w-full py-2 px-4 border border-dashed border-primary text-primary rounded-md hover:bg-primary/10 transition-colors font-medium",children:[e.jsx($e,{className:"w-4 h-4 mr-2"})," Add Location"]}),h.teachingLocations&&h.teachingLocations.length>0&&e.jsx("div",{className:"mt-4 space-y-2",children:h.teachingLocations.map(D=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-light-background dark:bg-dark-background rounded-md border border-light-border dark:border-dark-border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm text-light-text dark:text-dark-text",children:D.instituteName}),e.jsxs("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:[D.instituteType," • ",D.town,", ",D.district]})]}),e.jsx("button",{onClick:()=>le(D.id),className:"text-red-500 hover:bg-red-100 dark:hover:bg-red-900/50 p-1.5 rounded-full",children:e.jsx(ot,{className:"w-4 h-4"})})]},D.id))})]})]});case 3:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/30 border-l-4 border-blue-400 rounded-r-md",children:[e.jsx("p",{className:"font-bold text-blue-800 dark:text-blue-200",children:"Why Verification?"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:"Verifying your ID and Bank details builds trust with students and is required to enable withdrawals of your earnings. This information is kept confidential."})]}),e.jsx(et,{label:"ID Document (NIC/Passport/License)",currentImage:Oe,onImageChange:me}),e.jsx(et,{label:"Bank Document (Passbook/Statement)",currentImage:je,onImageChange:R})]});default:return null}};return e.jsx(Se,{isOpen:t,onClose:l,title:"Complete Your Teacher Profile",size:"2xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(At,{value:qe,max:100}),e.jsxs("span",{className:"font-bold text-lg text-light-text dark:text-dark-text",children:[qe,"%"]})]}),e.jsxs("div",{className:"relative p-4 bg-light-background dark:bg-dark-background rounded-lg border border-light-border dark:border-dark-border min-h-[300px]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-light-text dark:text-dark-text",children:se[g].name}),e.jsxs("span",{className:"text-xs font-medium text-light-subtle dark:text-dark-subtle",children:["Step ",g+1," of ",se.length]})]}),ke()]}),e.jsxs("div",{className:"flex justify-between items-center pt-4",children:[e.jsxs("button",{onClick:()=>m(A=>A-1),disabled:g===0||x,className:"flex items-center space-x-2 px-4 py-2 text-sm font-medium border border-primary text-primary rounded-md hover:bg-primary/10 transition-colors disabled:opacity-50",children:[e.jsx(Hs,{className:"w-4 h-4"}),e.jsx("span",{children:"Previous"})]}),e.jsxs("button",{onClick:g<se.length-1?ze:oe,disabled:x,className:"flex items-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary-dark transition-colors disabled:opacity-50",children:[e.jsx("span",{children:x?"Saving...":g===se.length-1?"Finish":"Continue"}),g<se.length-1?e.jsx(Ot,{className:"w-4 h-4"}):e.jsx(Ae,{className:"w-4 h-4"})]})]})]})})},Ea=({isOpen:t,onClose:l,onSave:n,teacherId:r})=>{const[o,j]=a.useState({date:"",startTime:"",endTime:"",fee:"",description:"",joiningLink:""}),[p,c]=a.useState("");a.useEffect(()=>{t&&(c(""),j({date:"",startTime:"",endTime:"",fee:"",description:"",joiningLink:""}))},[t]);const u=h=>{const{name:f,value:g}=h.target;j(m=>F(L({},m),{[f]:g}))},s=h=>{if(h.preventDefault(),c(""),o.joiningLink)try{new URL(o.joiningLink)}catch(x){c("The provided joining link is not a valid URL. Please include https://");return}if(new Date(`${o.date}T${o.startTime}`)<new Date){c("Cannot schedule a slot in the past. Please select a future date or time.");return}const m={id:Date.now(),teacherId:r,title:"Free Slot",subject:"1-on-1 Consultation",description:o.description,date:o.date,startTime:o.startTime,endTime:o.endTime,fee:parseFloat(o.fee)||0,currency:"LKR",targetAudience:"Any",mode:"Online",joiningLink:o.joiningLink,recurrence:"none",status:"scheduled",isPublished:!0,paymentMethod:"platform",isFreeSlot:!0};n(m)};return e.jsx(Se,{isOpen:t,onClose:l,title:"Schedule a 1-on-1 Slot",children:e.jsxs("form",{onSubmit:s,className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle -mt-2",children:"This creates a single-enrollment, 1-on-1 online slot. It will be unpublished automatically once a student enrolls."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(E,{label:"Date",name:"date",type:"date",value:o.date,onChange:u,required:!0}),e.jsx(E,{label:"Fee (LKR)",name:"fee",type:"number",value:o.fee,onChange:u,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(E,{label:"Start Time",name:"startTime",type:"time",value:o.startTime,onChange:u,required:!0}),e.jsx(E,{label:"End Time",name:"endTime",type:"time",value:o.endTime,onChange:u,required:!0})]}),e.jsx(E,{label:"Online Joining Link (Zoom, Meet, etc.)",name:"joiningLink",type:"url",value:o.joiningLink,onChange:u,placeholder:"e.g., https://zoom.us/j/1234567890"}),e.jsx(ct,{label:"Description (Optional)",id:"free-slot-description",name:"description",value:o.description,onChange:u,rows:3,placeholder:"Briefly describe what this slot is for (e.g., 'Paper discussion', 'Doubt clearing session')."}),p&&e.jsx("p",{className:"text-red-500 text-sm text-center",children:p}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-3",children:[e.jsxs("button",{type:"button",onClick:l,className:"inline-flex items-center justify-center px-4 py-2 border border-light-border dark:border-dark-border text-sm font-medium rounded-md shadow-sm text-light-text dark:text-dark-text bg-light-surface dark:bg-dark-surface hover:bg-light-border dark:hover:bg-dark-border/50",children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Save Slot"]})]})]})})},Kt=({title:t="We couldn't find that page",message:l="The link you followed may be broken, or the page may have been removed.",actionLabel:n="Go to Home",onAction:r})=>{const{handleNavigate:o}=Fe(),j=()=>{r?r():o({name:"home"})};return e.jsxs("div",{className:"min-h-[60vh] flex flex-col items-center justify-center p-4 text-center animate-fadeIn",children:[e.jsx("div",{className:"mb-6 relative",children:e.jsx("div",{className:"w-24 h-24 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})}),e.jsx("h2",{className:"text-2xl font-bold text-light-text dark:text-dark-text mb-2",children:t}),e.jsx("p",{className:"text-light-subtle dark:text-dark-subtle max-w-md mb-8",children:l}),e.jsxs("button",{onClick:j,className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-colors duration-200",children:[n,e.jsx(Ot,{className:"ml-2 -mr-1 h-5 w-5"})]})]})},Jt=({teacher:t,canEdit:l,onScheduleNew:n,onScheduleFreeSlot:r,onScheduleGoogleMeet:o,onEdit:j,onDelete:p})=>{const{sales:c,handleTogglePublishState:u}=Ne(),{handleNavigate:s,functionUrls:h}=Fe(),f=a.useMemo(()=>{const x={},k=new Map(t.individualClasses.map(w=>[w.id,w]));return c.filter(w=>w.teacherId===t.id&&w.status==="completed"&&w.itemType==="class").forEach(w=>{const P=k.get(w.itemId);if(P&&w.itemSnapshot&&"recurrence"in w.itemSnapshot){const K=w.itemSnapshot.instanceStartDate,J=P.instanceStartDate;if(K===J){const N=`class_${w.itemId}`;x[N]=(x[N]||0)+1}}}),x},[c,t.id,t.individualClasses]),g=a.useMemo(()=>l?t.individualClasses.filter(x=>!x.isDeleted):t.individualClasses.filter(x=>x.isPublished&&x.status!=="finished"&&x.status!=="canceled"&&!x.isDeleted),[l,t.individualClasses]),m=()=>{const x=`${h.googleMeetHandler}/googleAuthRedirect?teacherId=${t.id}`;window.location.href=x};return e.jsxs("div",{children:[l&&e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("button",{onClick:n,className:"flex-1 sm:flex-none flex items-center justify-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary-dark transition-colors",children:[e.jsx($e,{className:"h-4 w-4"}),e.jsx("span",{children:"Schedule Group Class"})]}),e.jsxs("button",{onClick:o,disabled:!t.googleRefreshToken,className:"flex-1 sm:flex-none flex items-center justify-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:t.googleRefreshToken?"Schedule a class with an auto-generated Google Meet link":"Connect your Google Account first",children:[e.jsx(Ys,{className:"h-4 w-4"}),e.jsx("span",{children:"Schedule with G-Meet"})]}),e.jsxs("button",{onClick:r,className:"flex-1 sm:flex-none flex items-center justify-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 transition-colors",children:[e.jsx($e,{className:"h-4 w-4"}),e.jsx("span",{children:"Schedule 1-on-1 Slot"})]})]}),!t.googleRefreshToken&&e.jsxs("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/30 border-l-4 border-yellow-400 rounded-r-md flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"To automatically generate Google Meet links, you need to connect your Google account."}),e.jsxs("button",{onClick:m,className:"flex-shrink-0 flex items-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-gray-700 rounded-md hover:bg-gray-800 dark:bg-gray-600 dark:hover:bg-gray-700 transition-colors",children:[e.jsx(Ks,{className:"w-5 h-5"}),e.jsx("span",{className:"text-center",children:"Connect Google Account"})]})]}),t.googleRefreshToken&&e.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-900/30 border-l-4 border-green-400 rounded-r-md flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),e.jsx("p",{className:"text-sm font-semibold text-green-800 dark:text-green-200",children:"Your Google Account is connected. You can now schedule classes with Google Meet."})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:g.map(x=>e.jsx(Sa,{classInfo:x,teacher:t,viewMode:l?"teacher":"public",enrollmentCount:f[`class_${x.id}`]||0,onView:k=>s({name:"class_detail_slug",slug:Ze(k.title)}),onEdit:j,onDelete:p,onTogglePublish:k=>u(t.id,k,"class")},x.id))})]})},Ra=({isOpen:t,onClose:l,course:n,teacher:r})=>{const{users:o,sales:j}=Ne(),[p,c]=a.useState(""),[u,s]=a.useState(!1),h=a.useRef(null),f=Dt.useMemo(()=>{const k=j.filter(w=>w.itemId===n.id&&w.status==="completed").map(w=>w.studentId);return o.filter(w=>k.includes(w.id))},[j,n.id,o]),g=o.find(k=>k.id===p),m=()=>we(void 0,null,function*(){if(!(!h.current||!g)){s(!0);try{const w=(yield $t(h.current,{scale:2,backgroundColor:"#ffffff"})).toDataURL("image/png"),P=new Rt("l","mm","a4"),K=P.internal.pageSize.getWidth(),J=P.internal.pageSize.getHeight();P.addImage(w,"PNG",0,0,K,J),P.save(`Certificate - ${g.firstName} ${g.lastName}.pdf`)}catch(k){console.error("Certificate generation failed",k)}finally{s(!1)}}}),x=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return e.jsx(Se,{isOpen:t,onClose:l,title:"Issue Certificate",size:"4xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-md border border-blue-200 dark:border-blue-800",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:["Select a student to generate a certificate of completion for ",e.jsx("strong",{children:n.title}),"."]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Select Student"}),e.jsxs("select",{className:"w-full p-2 border rounded-md bg-light-surface dark:bg-dark-surface border-light-border dark:border-dark-border",value:p,onChange:k=>c(k.target.value),children:[e.jsx("option",{value:"",children:"-- Choose Student --"}),f.map(k=>e.jsxs("option",{value:k.id,children:[k.firstName," ",k.lastName," (",k.email,")"]},k.id))]})]}),g&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border border-gray-300 shadow-lg overflow-hidden",children:e.jsxs("div",{ref:h,className:"relative w-full bg-white text-black p-16 text-center flex flex-col justify-center items-center",style:{minHeight:"600px",border:"20px solid #2563eb"},children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-full opacity-5 pointer-events-none",style:{backgroundImage:"url(/Logo3.png)",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"50%"}}),e.jsx("h1",{className:"text-5xl font-serif font-bold text-blue-900 mb-8 uppercase tracking-widest",children:"Certificate of Completion"}),e.jsx("p",{className:"text-xl mb-2",children:"This is to certify that"}),e.jsxs("h2",{className:"text-4xl font-bold text-black mb-4 border-b-2 border-gray-400 px-8 pb-2 inline-block min-w-[300px]",children:[g.firstName," ",g.lastName]}),e.jsx("p",{className:"text-xl mb-2",children:"has successfully completed the course"}),e.jsx("h3",{className:"text-3xl font-bold text-blue-700 mb-12",children:n.title}),e.jsxs("div",{className:"flex justify-between w-full px-20 mt-12",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-bold text-lg",children:x}),e.jsx("div",{className:"h-px w-40 bg-black mt-1"}),e.jsx("p",{className:"text-sm mt-1 font-semibold text-gray-600",children:"Date"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-bold text-lg font-signature text-2xl",children:r.name}),e.jsx("div",{className:"h-px w-40 bg-black mt-1"}),e.jsx("p",{className:"text-sm mt-1 font-semibold text-gray-600",children:"Instructor"})]})]}),e.jsxs("div",{className:"mt-12 text-xs text-gray-400",children:["Verified by clazz.lk | ID: ",n.id,"-",g.id]})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:m,disabled:u,className:"flex items-center space-x-2 px-6 py-2 bg-primary text-white font-bold rounded-md hover:bg-primary-dark disabled:opacity-50",children:[e.jsx(jt,{className:"w-5 h-5"}),e.jsx("span",{children:u?"Generating...":"Download PDF"})]})})]})]})})},Xt=({teacher:t,canEdit:l,onDelete:n})=>{const{sales:r,handleTogglePublishState:o}=Ne(),{handleNavigate:j}=Fe(),[p,c]=a.useState(null),u=a.useMemo(()=>{const g={};return r.filter(m=>m.teacherId===t.id&&m.status==="completed"&&m.itemType==="course").forEach(m=>{const x=`course_${m.itemId}`;g[x]=(g[x]||0)+1}),g},[r,t.id]),s=a.useMemo(()=>l?t.courses.filter(g=>!g.isDeleted):t.courses.filter(g=>g.isPublished&&!g.isDeleted),[l,t.courses]),h=()=>t&&j({name:"course_editor",teacherId:t.id}),f=g=>t&&j({name:"course_editor",courseId:g,teacherId:t.id});return e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[l&&e.jsxs("button",{onClick:h,className:"min-h-[200px] flex flex-col items-center justify-center rounded-lg border-2 border-dashed border-light-border dark:border-dark-border hover:border-primary dark:hover:border-primary-light transition-colors text-light-subtle dark:text-dark-subtle hover:text-primary dark:hover:text-primary-light",children:[e.jsx($e,{className:"w-10 h-10"}),e.jsx("span",{className:"mt-2 font-semibold",children:"Create New Course"})]}),s.map(g=>e.jsxs("div",{className:"relative group",children:[e.jsx(Ca,{course:g,teacher:t,viewMode:l?"teacher":"public",enrollmentCount:u[`course_${g.id}`]||0,onView:m=>j({name:"course_detail_slug",slug:Ze(m.title)}),onEdit:f,onDelete:n,onTogglePublish:(m,x)=>o(t.id,m,"course",x)}),l&&e.jsx("button",{onClick:()=>c(g),className:"absolute top-2 right-2 z-10 bg-white dark:bg-gray-800 p-2 rounded-full shadow-md text-amber-500 hover:text-amber-600 transition-colors",title:"Issue Certificate",children:e.jsx(Js,{className:"w-5 h-5"})})]},g.id))]}),l&&e.jsxs("div",{className:"mt-8 p-4 bg-yellow-50 dark:bg-yellow-900/30 border-l-4 border-yellow-400 rounded-r-md text-yellow-800 dark:text-yellow-200",children:[e.jsx("h4",{className:"font-bold",children:"Content Security Notice"}),e.jsx("p",{className:"text-sm mt-2",children:"Please be advised that clazz.lk does not monitor or restrict downloading, screen recording, or external sharing of your content by students or third parties. While we take measures to provide a secure platform, we cannot guarantee complete protection against such actions."})]}),p&&e.jsx(Ra,{isOpen:!!p,onClose:()=>c(null),course:p,teacher:t})]})},Zt=({teacher:t,canEdit:l,onScheduleNew:n,onEdit:r,onCancel:o})=>{const{sales:j,handleTogglePublishState:p}=Ne(),{currentUser:c}=zt(),{handleNavigate:u}=Fe(),s=a.useMemo(()=>{const f={},g=new Map(t.quizzes.map(m=>[m.id,m]));return t.quizzes.forEach(m=>{f[`quiz_${m.id}`]={newEnrollments:0,totalEnrollments:0}}),j.filter(m=>m.teacherId===t.id&&m.status==="completed"&&m.itemType==="quiz").forEach(m=>{const x=`quiz_${m.itemId}`;if(f[x]){f[x].totalEnrollments+=1;const k=g.get(m.itemId);if(k&&m.itemSnapshot&&"questions"in m.itemSnapshot){const w=m.itemSnapshot.instanceStartDate,P=k.instanceStartDate;(P&&w===P||!P&&!w)&&(f[x].newEnrollments+=1)}}}),f},[j,t.id,t.quizzes]),h=a.useMemo(()=>l?t.quizzes.filter(f=>!f.isDeleted):t.quizzes.filter(f=>{const g=ds(f);return f.isPublished&&g!=="finished"&&g!=="canceled"&&!f.isDeleted}),[l,t.quizzes]);return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[l&&e.jsxs("button",{onClick:n,className:"min-h-[200px] flex flex-col items-center justify-center rounded-lg border-2 border-dashed border-light-border dark:border-dark-border hover:border-primary dark:hover:border-primary-light transition-colors text-light-subtle dark:text-dark-subtle hover:text-primary dark:hover:text-primary-light",children:[e.jsx($e,{className:"w-10 h-10"}),e.jsx("span",{className:"mt-2 font-semibold",children:"Schedule New Quiz"})]}),h.map(f=>e.jsx(Ia,{quiz:f,teacher:t,viewMode:l?"teacher":"public",currentUser:c,enrollmentCount:s[`quiz_${f.id}`],onView:g=>u({name:"quiz_detail_slug",slug:Ze(g.title)}),onEdit:r,onManage:g=>u({name:"quiz_editor",quizId:g.id,teacherId:t.id}),onCancel:o,onTogglePublish:g=>p(t.id,g,"quiz")},f.id))]})},$a=({isOpen:t,onClose:l,onSave:n,initialData:r,teacherId:o})=>{var J,N;const{handleImageSave:j}=Ne(),[p,c]=a.useState({}),[u,s]=a.useState([null,null,null]),[h,f]=a.useState(!1),[g,m]=a.useState("");a.useEffect(()=>{if(t)if(m(""),f(!1),r){c(r);const I=r.coverImages||[];s([...I,null,null,null].slice(0,3))}else c({teacherId:o,title:"",description:"",type:"digital",price:0,currency:"LKR",isPublished:!1,adminApproval:"not_requested",coverImages:[]}),s([null,null,null])},[t,r,o]);const x=(I,C)=>{const q=[...u];q[I]=C,s(q)},k=I=>{const C=[...u];C[I]=null,s(C)},w=I=>{const{name:C,value:q,type:y}=I.target,_=y==="number"?parseFloat(q)||0:q;c(B=>F(L({},B),{[C]:_}))},P=I=>we(void 0,null,function*(){I.preventDefault(),m(""),f(!0);try{const C=u.map(_=>_&&_.startsWith("data:image")?j(_,"product_cover",{teacherId:o}):Promise.resolve(_)),q=(yield Promise.all(C)).filter(Boolean);if(q.length===0)throw new Error("At least one cover image is required.");const y=F(L({id:(r==null?void 0:r.id)||`prod_${Date.now()}`},p),{coverImages:q});yield n(y),l()}catch(C){m(C.message)}finally{f(!1)}}),K=p.type==="physical"?3:1;return e.jsx(Se,{isOpen:t,onClose:l,title:r?"Edit Product":"Create New Product",children:e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsx(E,{label:"Product Title",name:"title",value:p.title||"",onChange:w,required:!0}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"block text-sm font-medium text-light-text dark:text-dark-text mb-1",children:["Product Images ",p.type==="physical"&&`(up to ${K})`]}),Array.from({length:K}).map((I,C)=>e.jsxs("div",{children:[e.jsx(et,{label:C===0?"Main Cover Image":`Additional Image ${C+1}`,currentImage:u[C],onImageChange:q=>x(C,q),aspectRatio:"aspect-video"}),u[C]&&e.jsxs("button",{type:"button",onClick:()=>k(C),className:"text-xs text-red-500 hover:underline mt-1 flex items-center gap-1",children:[e.jsx(ot,{className:"w-3 h-3"})," Remove Image"]})]},C))]}),e.jsx(ct,{label:"Description",id:"description",name:"description",value:p.description||"",onChange:w,rows:4}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(ge,{label:"Product Type",name:"type",value:p.type||"digital",onChange:w,options:[{value:"digital",label:"Digital"},{value:"physical",label:"Physical"}]}),e.jsxs("div",{children:[e.jsx(E,{label:"Price (LKR)",name:"price",type:"number",value:((J=p.price)==null?void 0:J.toString())||"",onChange:w,required:!0}),p.type==="physical"&&e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle mt-1",children:"No extra charges are collected for Shipping. Please include the shipping cost in the product price."})]})]}),p.type==="digital"&&e.jsx(E,{label:"Download URL / File Path",name:"downloadUrl",value:p.downloadUrl||"",onChange:w,placeholder:"e.g., Google Drive link"}),p.type==="physical"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(E,{label:"Stock Quantity",name:"stock",type:"number",value:((N=p.stock)==null?void 0:N.toString())||"",onChange:w,placeholder:"Leave empty for unlimited"}),e.jsx(E,{label:"Order Lead Time",name:"orderLeadTime",type:"text",value:p.orderLeadTime||"",onChange:w,placeholder:"e.g., 2-3 business days"})]}),g&&e.jsx("p",{className:"text-red-500 text-sm text-center",children:g}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-3",children:[e.jsxs("button",{type:"button",onClick:l,className:"px-4 py-2 border rounded-md flex items-center text-light-text dark:text-dark-text",children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:h,className:"px-4 py-2 bg-primary text-white rounded-md disabled:opacity-50 flex items-center",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),h?"Saving...":"Save Product"]})]})]})})},es=({teacher:t,canEdit:l,onDelete:n})=>{const{sales:r,handleTogglePublishState:o,handleSaveProduct:j}=Ne(),{handleNavigate:p}=Fe(),[c,u]=a.useState(!1),[s,h]=a.useState(null);a.useMemo(()=>({}),[r,t.id]);const f=a.useMemo(()=>l?(t.products||[]).filter(x=>!x.isDeleted):(t.products||[]).filter(x=>x.isPublished&&!x.isDeleted),[l,t.products]),g=()=>{h(null),u(!0)},m=x=>{h(x),u(!0)};return e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[l&&e.jsxs("button",{onClick:g,className:"min-h-[200px] flex flex-col items-center justify-center rounded-lg border-2 border-dashed border-light-border dark:border-dark-border hover:border-primary dark:hover:border-primary-light transition-colors text-light-subtle dark:text-dark-subtle hover:text-primary dark:hover:text-primary-light",children:[e.jsx($e,{className:"w-10 h-10"}),e.jsx("span",{className:"mt-2 font-semibold",children:"Create New Product"})]}),f.map(x=>e.jsx(Ta,{product:x,teacher:t,viewMode:l?"teacher":"public",onViewDetails:k=>p({name:"product_detail_slug",slug:Ze(k.title)}),onEdit:m,onDelete:n,onTogglePublish:(k,w)=>o(t.id,k,"product",w)},x.id))]}),e.jsx($a,{isOpen:c,onClose:()=>u(!1),onSave:j,initialData:s,teacherId:t.id})]})},ts={bankName:"",branchName:"",accountHolderName:"",accountNumber:""},Fa=({isOpen:t,onClose:l,onSave:n,initialData:r})=>{const[o,j]=a.useState(r||ts);a.useEffect(()=>{t&&j(r||ts)},[t,r]);const p=u=>{const{name:s,value:h}=u.target;j(f=>F(L({},f),{[s]:h}))},c=u=>{u.preventDefault(),n(o)};return e.jsx(Se,{isOpen:t,onClose:l,title:"Manage Bank Details for Payouts",children:e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle -mt-2",children:"This information is kept confidential and is used solely for processing your earnings withdrawals."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(E,{label:"Bank Name",name:"bankName",value:o.bankName,onChange:p,required:!0,placeholder:"e.g., Sampath Bank"}),e.jsx(E,{label:"Branch Name",name:"branchName",value:o.branchName,onChange:p,required:!0,placeholder:"e.g., Head Office"})]}),e.jsx(E,{label:"Account Holder Name",name:"accountHolderName",value:o.accountHolderName,onChange:p,required:!0,placeholder:"As it appears on your bank statement"}),e.jsx(E,{label:"Account Number",name:"accountNumber",value:o.accountNumber,onChange:p,required:!0,placeholder:"e.g., 1234567890"}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-3",children:[e.jsxs("button",{type:"button",onClick:l,className:"inline-flex items-center justify-center px-4 py-2 border border-light-border dark:border-dark-border text-sm font-medium rounded-md shadow-sm text-light-text dark:text-dark-text bg-light-surface dark:bg-dark-surface hover:bg-light-border dark:hover:bg-dark-border/50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-light transition-colors",children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-light transition-colors",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Save Details"]})]})]})})},qa=({isOpen:t,onClose:l,onSave:n,verificationType:r})=>{const[o,j]=a.useState(null),[p,c]=a.useState("");a.useEffect(()=>{t&&(j(null),c(""))},[t]);const u=()=>{o&&n(o,p)},s={id_front:"Upload ID Verification (Front)",id_back:"Upload ID Verification (Back)",bank:"Upload Bank Details Verification Document"},h={id_front:"Please upload a clear image of the front of your National ID Card, Passport, or Driving License.",id_back:"Please upload a clear image of the back of your National ID Card or Driving License.",bank:"Please upload a clear image of your bank passbook page showing your name and account number, or a relevant online banking screenshot."};return e.jsx(Se,{isOpen:t,onClose:l,title:s[r],children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:h[r]}),e.jsx(et,{label:"Verification Document Image",currentImage:o,onImageChange:j,aspectRatio:"aspect-video"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"requestNote",className:"block text-sm font-medium text-light-text dark:text-dark-text mb-1",children:"Message to Admin (Optional)"}),e.jsx("textarea",{id:"requestNote",value:p,onChange:f=>c(f.target.value),rows:3,className:"w-full px-3 py-2 border border-light-border dark:border-dark-border placeholder-light-subtle dark:placeholder-dark-subtle text-light-text dark:text-dark-text bg-light-background dark:bg-dark-background rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm",placeholder:"Add any notes for the administrator regarding this document."})]}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-3",children:[e.jsxs("button",{type:"button",onClick:l,className:"inline-flex items-center justify-center px-4 py-2 border border-light-border dark:border-dark-border text-sm font-medium rounded-md shadow-sm text-light-text dark:text-dark-text bg-light-surface dark:bg-dark-surface hover:bg-light-border dark:hover:bg-dark-border/50",children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"button",onClick:u,disabled:!o,className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark disabled:opacity-50",children:[e.jsx(We,{className:"w-5 h-5 mr-2"}),"Submit for Review"]})]})]})})},_a=({isOpen:t,onClose:l,teacher:n,withdrawal:r})=>{const o=a.useRef(null),j=()=>{const u=o.current;u&&$t(u,{scale:2}).then(s=>{const h=s.toDataURL("image/png"),f=new Rt("p","mm","a4"),g=f.internal.pageSize.getWidth(),m=s.height*g/s.width;f.addImage(h,"PNG",0,0,g,m),f.save(`payout-invoice-${r.id}.pdf`)})};if(!t)return null;const p=new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR"}),c=r.processedAt?new Date(r.processedAt).toLocaleDateString():"N/A";return e.jsx(Se,{isOpen:t,onClose:l,title:`Payout Invoice #${r.id}`,children:e.jsxs("div",{children:[e.jsxs("div",{ref:o,className:"p-8 space-y-8 text-sm bg-light-surface dark:bg-dark-surface text-light-text dark:text-dark-text",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-lg",children:"PAYMENT VOUCHER"}),e.jsx("p",{className:"text-light-subtle dark:text-dark-subtle",children:"From:"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx(Lt,{className:"h-8 w-8"}),e.jsxs("span",{className:"text-xl font-bold",children:["clazz.",e.jsx("span",{className:"text-primary",children:"lk"})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{children:["Invoice #: ",r.id]}),e.jsxs("p",{children:["Date Issued: ",c]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-light-subtle dark:text-dark-subtle",children:"Paid To:"}),e.jsx("p",{className:"font-bold text-lg",children:n.name}),e.jsx("p",{children:n.email}),n.payoutDetails&&e.jsxs("div",{className:"text-xs mt-1 text-light-subtle dark:text-dark-subtle",children:[e.jsxs("p",{children:[n.payoutDetails.bankName," - ",n.payoutDetails.branchName]}),e.jsxs("p",{children:["A/C: **** **** ",n.payoutDetails.accountNumber.slice(-4)]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-light-background dark:bg-dark-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-4 py-2 text-right font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Amount"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{className:"border-b border-light-border dark:border-dark-border text-light-text dark:text-dark-text",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:"font-semibold",children:"Payout for services rendered on clazz.lk"}),e.jsxs("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:["Request Date: ",new Date(r.requestedAt).toLocaleDateString()]})]}),e.jsx("td",{className:"px-4 py-3 text-right font-semibold",children:p.format(r.amount)})]})})]})}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("div",{className:"w-full max-w-sm space-y-2",children:e.jsxs("div",{className:"flex justify-between font-bold text-xl pt-2 border-t-2 border-light-text dark:border-dark-text",children:[e.jsx("span",{children:"Total Paid"}),e.jsx("span",{children:p.format(r.amount)})]})})}),e.jsx("p",{className:"text-center text-xs text-light-subtle dark:text-dark-subtle pt-6",children:"This is a computer-generated document. Thank you for being a part of the clazz.lk community."})]}),e.jsx("div",{className:"p-4 bg-light-background dark:bg-dark-background border-t border-light-border dark:border-dark-border flex justify-end",children:e.jsxs("button",{onClick:j,className:"flex items-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary-dark transition-colors",children:[e.jsx(jt,{className:"w-4 h-4"}),e.jsx("span",{children:"Download PDF"})]})})]})})},bt=({title:t,value:l,icon:n})=>e.jsx("div",{className:"bg-light-background dark:bg-dark-background p-5 rounded-lg border border-light-border dark:border-dark-border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-primary/10 text-primary rounded-lg mr-4",children:n}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-light-subtle dark:text-dark-subtle",children:t}),e.jsx("p",{className:"text-2xl font-bold text-light-text dark:text-dark-text",children:l})]})]})}),us=({status:t})=>{const l={verified:{icon:e.jsx(Ae,{className:"w-4 h-4 mr-1.5"}),text:"Verified",classes:"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300"},pending:{icon:e.jsx(tt,{className:"w-4 h-4 mr-1.5"}),text:"Pending Review",classes:"bg-yellow-100 text-yellow-800 dark:bg-yellow-800/50 dark:text-yellow-300"},rejected:{icon:e.jsx(dt,{className:"w-4 h-4 mr-1.5"}),text:"Rejected",classes:"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300"},unverified:{icon:e.jsx(ea,{className:"w-4 h-4 mr-1.5"}),text:"Not Submitted",classes:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},{icon:n,text:r,classes:o}=l[t];return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${o}`,children:[n,r]})},Ua=({status:t})=>{const l={Upcoming:"bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300",Processed:"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300",Processing:"bg-yellow-100 text-yellow-800 dark:bg-yellow-800/50 dark:text-yellow-300 animate-pulse"},n={Upcoming:e.jsx(tt,{className:"w-4 h-4 mr-1.5"}),Processed:e.jsx(Ae,{className:"w-4 h-4 mr-1.5"}),Processing:e.jsx(tt,{className:"w-4 h-4 mr-1.5"})};return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l[t]}`,children:[n[t],t]})},Ga=({status:t})=>{const n={completed:{icon:e.jsx(Ae,{className:"w-4 h-4 mr-1.5"}),text:"Completed",classes:"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300"},refunded:{icon:e.jsx(dt,{className:"w-4 h-4 mr-1.5"}),text:"Refunded",classes:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"},hold:{icon:e.jsx(ta,{className:"w-4 h-4 mr-1.5"}),text:"On Hold",classes:"bg-yellow-100 text-yellow-800 dark:bg-yellow-800/50 dark:text-yellow-300"},failed:{icon:e.jsx(dt,{className:"w-4 h-4 mr-1.5"}),text:"Failed",classes:"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300"},cleared:{icon:e.jsx(Ae,{className:"w-4 h-4 mr-1.5"}),text:"Cleared",classes:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"},canceled:{icon:e.jsx(dt,{className:"w-4 h-4 mr-1.5"}),text:"Canceled",classes:"bg-orange-100 text-orange-800 dark:bg-orange-900/50 dark:text-orange-300"}}[t];if(!n)return null;const{icon:r,text:o,classes:j}=n;return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${j}`,children:[r,o]})},Ba=({title:t,verification:l,onUpload:n,isAdminView:r,onApprove:o,onReject:j,onViewImage:p})=>e.jsxs("div",{className:"border border-light-border dark:border-dark-border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-light-text dark:text-dark-text",children:t}),e.jsx(us,{status:l.status})]}),!r&&l.status!=="verified"&&e.jsxs("button",{onClick:n,className:"flex-shrink-0 flex items-center space-x-2 px-3 py-1.5 text-xs font-medium text-white bg-primary rounded-md hover:bg-primary-dark",children:[e.jsx(Zs,{className:"w-3 h-3"}),e.jsx("span",{children:l.imageUrl?"Re-upload":"Upload"})]})]}),l.rejectionReason&&e.jsxs("p",{className:"text-xs text-red-500 bg-red-50 dark:bg-red-900/30 p-2 rounded-md",children:[e.jsx("strong",{children:"Reason:"})," ",l.rejectionReason]}),(r||l.status==="pending")&&l.imageUrl&&e.jsx("div",{className:"pt-2",children:e.jsx("button",{onClick:()=>p(l.imageUrl,`${t} Document`),className:"text-sm font-medium text-primary hover:underline",children:"View Submitted Document"})}),r&&l.status==="pending"&&e.jsxs("div",{className:"mt-4 space-y-2",children:[l.requestNote&&e.jsxs("p",{className:"text-xs italic text-light-subtle dark:text-dark-subtle p-2 bg-light-background dark:bg-dark-background rounded-md",children:[e.jsx("strong",{children:"Teacher's Note:"})," ",l.requestNote]}),e.jsxs("div",{className:"flex space-x-2 pt-2",children:[e.jsx("button",{onClick:o,className:"px-3 py-1 text-xs font-medium text-white bg-green-600 rounded-md hover:bg-green-700",children:"Approve"}),e.jsx("button",{onClick:j,className:"px-3 py-1 text-xs font-medium text-white bg-red-600 rounded-md hover:bg-red-700",children:"Reject"})]})]})]}),Va=({teacher:t,allSales:l,allUsers:n,isAdminView:r,onWithdraw:o,onSaveBankDetails:j,onVerificationUpload:p,onVerificationDecision:c,onUpdatePhysicalOrderStatus:u})=>{var xt,nt,ht;const{processMonthlyPayouts:s,tuitionInstitutes:h}=Ne(),[f,g]=a.useState(!0),[m,x]=a.useState(!1),[k,w]=a.useState(!1),[P,K]=a.useState(""),[J,N]=a.useState(!1),[I,C]=a.useState("id_front"),[q,y]=a.useState(!1),[_,B]=a.useState(null),[W,U]=a.useState(!1),[ne,Le]=a.useState(null),[Te,Me]=a.useState(null),[d,be]=a.useState(""),[X,Oe]=a.useState("all"),[me,je]=a.useState("all"),[R,qe]=a.useState(null),[se,_e]=a.useState({key:"saleDate",direction:"descending"}),[v,T]=a.useState(null);a.useEffect(()=>{we(void 0,null,function*(){t.id&&(g(!0),yield s("teacher",t.id),g(!1))})},[t.id,s]);const S=a.useCallback(()=>x(!1),[]),ee=a.useCallback(()=>w(!1),[]),Z=a.useCallback(()=>N(!1),[]),H=a.useCallback(()=>y(!1),[]),ae=a.useCallback(()=>{U(!1),Le(null)},[]),le=a.useCallback(()=>Me(null),[]),de=a.useCallback(()=>qe(null),[]),he=new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR"}),ie=t.verification.id.status==="verified"&&t.verification.bank.status==="verified",pe=a.useMemo(()=>l.filter(b=>b.teacherId===t.id).map(b=>F(L({},b),{student:n.find(Y=>Y.id===b.studentId)})),[l,n,t.id]),ze=a.useMemo(()=>t.manualEarningsByInstitute?Object.entries(t.manualEarningsByInstitute).map(([b,Y])=>{const ce=h.find(fe=>fe.id===b);return{instituteName:(ce==null?void 0:ce.name)||"Unknown Institute",balance:Y}}):[],[t.manualEarningsByInstitute,h]),{lastMonthPayout:oe,payoutDate:ke,payoutStatus:Ee}=a.useMemo(()=>{var gt;const b=new Date,Y=new Date(b.getFullYear(),b.getMonth(),1),ce=new Date(Y.getTime()-1),fe=new Date(ce.getFullYear(),ce.getMonth(),1),ue=pe.filter(Ke=>{const Pe=new Date(Ke.saleDate);return Ke.status==="completed"&&Pe>=fe&&Pe<=ce}).reduce((Ke,Pe)=>Ke+(Pe.totalAmount+Pe.amountPaidFromBalance),0),ye=ue*(t.commissionRate/100),Ce=ue-ye,Qe=new Date(b.getFullYear(),b.getMonth(),15),Ue=`${ce.getFullYear()}-${String(ce.getMonth()+1).padStart(2,"0")}`;let Ge="Upcoming";(gt=t.earnings.processedPayouts)!=null&&gt.includes(Ue)?Ge="Processed":b.getDate()>=15&&(Ge="Processing");const Ye=ce.toLocaleString("default",{month:"long"});return{lastMonthPayout:{gross:ue,fee:ye,net:Ce,monthName:Ye},payoutDate:Qe,payoutStatus:Ge}},[pe,t.commissionRate,t.earnings.processedPayouts]),A=a.useMemo(()=>{const b=new Date,Y=new Date(b);Y.setDate(b.getDate()-(b.getDay()===0?6:b.getDay()-1)),Y.setHours(0,0,0,0);const ce=new Date(b.getFullYear(),b.getMonth(),1);ce.setHours(0,0,0,0);let fe=pe.filter(te=>{var Ge,Ye;if(te.status==="hold")return!1;const ue=d.toLowerCase(),ye=!ue||te.itemName.toLowerCase().includes(ue)||((Ge=te.student)==null?void 0:Ge.firstName)&&te.student.firstName.toLowerCase().includes(ue)||((Ye=te.student)==null?void 0:Ye.lastName)&&te.student.lastName.toLowerCase().includes(ue),Ce=X==="all"||te.itemType===X,Qe=new Date(te.saleDate);let Ue=!0;return me==="week"?Ue=Qe>=Y:me==="month"&&(Ue=Qe>=ce),ye&&Ce&&Ue});return se.key&&fe.sort((te,ue)=>{let ye,Ce;switch(se.key){case"student":ye=te.student?`${te.student.firstName} ${te.student.lastName}`.toLowerCase():"",Ce=ue.student?`${ue.student.firstName} ${ue.student.lastName}`.toLowerCase():"";break;case"totalAmount":ye=te.totalAmount+te.amountPaidFromBalance,Ce=ue.totalAmount+ue.amountPaidFromBalance;break;case"saleDate":ye=new Date(te.saleDate).getTime(),Ce=new Date(ue.saleDate).getTime();break;default:ye=te[se.key],Ce=ue[se.key]}return ye<Ce?se.direction==="ascending"?-1:1:ye>Ce?se.direction==="ascending"?1:-1:0}),fe},[pe,d,X,me,se]),M=b=>{let Y="ascending";se&&se.key===b&&se.direction==="ascending"&&(Y="descending"),_e({key:b,direction:Y})},V=b=>se.key===b?se.direction==="ascending"?"▲":"▼":"",Q=a.useMemo(()=>[...t.withdrawalHistory].sort((b,Y)=>new Date(Y.requestedAt).getTime()-new Date(b.requestedAt).getTime()),[t.withdrawalHistory]),D=()=>{const b=parseFloat(P);b>0&&b<=t.earnings.available&&o(b),w(!1),K("")},He=b=>{C(b),N(!0)},st=(b,Y)=>{p(I,b,Y),N(!1)},at=b=>{B(b),y(!0)},mt=b=>{_&&c(_,"reject",b),y(!1),B(null)},ut=b=>{b&&(Le(b),U(!0))},Ve=(b,Y)=>{qe({url:b,title:Y})},vt=b=>{j(b),S()},rt=({status:b})=>{const Y={pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-800/50 dark:text-yellow-300",completed:"bg-green-100 text-green-800 dark:bg-green-800/50 dark:text-green-300",failed:"bg-red-100 text-red-800 dark:bg-red-800/50 dark:text-red-300"},ce={pending:e.jsx(tt,{className:"w-4 h-4 mr-1.5"}),completed:e.jsx(Ae,{className:"w-4 h-4 mr-1.5"}),failed:e.jsx(dt,{className:"w-4 h-4 mr-1.5"})};return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${Y[b]}`,children:[ce[b],b.charAt(0).toUpperCase()+b.slice(1)]})};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(bt,{title:"Total Earnings",value:he.format(t.earnings.total),icon:e.jsx(ns,{className:"w-6 h-6"})}),e.jsx(bt,{title:"Total Withdrawn",value:he.format(t.earnings.withdrawn),icon:e.jsx(Ae,{className:"w-6 h-6"})}),e.jsx(bt,{title:"Available for Withdrawal",value:he.format(t.earnings.available),icon:e.jsx(tt,{className:"w-6 h-6"})}),e.jsx(bt,{title:"Platform Commission",value:`${t.commissionRate}%`,icon:e.jsx(Xs,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md text-light-text dark:text-dark-text",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:["Last Month's Payout Summary (",oe.monthName,")"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-light-background dark:bg-dark-background p-4 rounded-md",children:[e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:"Gross Earnings"}),e.jsx("p",{className:"text-2xl font-bold",children:he.format(oe.gross)})]}),e.jsx("div",{className:"bg-light-background dark:bg-dark-background p-4 rounded-md",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:"Net Payout Amount"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:he.format(oe.net)})]}),e.jsxs("div",{className:"mt-2 sm:mt-0 text-left sm:text-right",children:[e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:"Available to withdraw on"}),e.jsx("p",{className:"font-semibold",children:ke.toLocaleDateString()}),e.jsx("div",{className:"mt-1 flex justify-start sm:justify-end",children:e.jsx(Ua,{status:Ee})})]})]})})]})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Earnings from Institute Manual Collections"}),ze.length>0?e.jsxs("div",{className:"space-y-3",children:[ze.map(({instituteName:b,balance:Y})=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-light-background dark:bg-dark-background rounded-md",children:[e.jsx("span",{className:"font-medium",children:b}),e.jsx("span",{className:"font-bold text-lg text-primary",children:he.format(Y)})]},b)),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle pt-2",children:"Note: This amount is paid directly to you by the institute and cannot be withdrawn through the clazz.lk platform."})]}):e.jsx("p",{className:"text-center py-4 text-light-subtle dark:text-dark-subtle",children:"No earnings from institute manual collections yet."})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-light-text dark:text-dark-text",children:"Verification Status"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"border border-light-border dark:border-dark-border rounded-lg p-4 space-y-3",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-light-text dark:text-dark-text",children:"ID Verification"}),e.jsx(us,{status:t.verification.id.status})]})}),t.verification.id.rejectionReason&&e.jsxs("p",{className:"text-xs text-red-500 bg-red-50 dark:bg-red-900/30 p-2 rounded-md",children:[e.jsx("strong",{children:"Reason:"})," ",t.verification.id.rejectionReason]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-light-border/50 dark:border-dark-border/50",children:[e.jsx("p",{className:"text-sm font-medium",children:"Front Image"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[t.verification.id.frontImageUrl&&(r||t.verification.id.status==="pending")&&e.jsx("button",{onClick:()=>Ve(t.verification.id.frontImageUrl,"ID Front Image"),className:"text-xs font-medium text-primary hover:underline",children:"View"}),!r&&t.verification.id.status!=="verified"&&e.jsx("button",{onClick:()=>He("id_front"),className:"px-2 py-1 text-xs text-primary border border-primary rounded-md hover:bg-primary/10",children:t.verification.id.frontImageUrl?"Re-upload":"Upload"})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-light-border/50 dark:border-dark-border/50",children:[e.jsx("p",{className:"text-sm font-medium",children:"Back Image"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[t.verification.id.backImageUrl&&(r||t.verification.id.status==="pending")&&e.jsx("button",{onClick:()=>Ve(t.verification.id.backImageUrl,"ID Back Image"),className:"text-xs font-medium text-primary hover:underline",children:"View"}),!r&&t.verification.id.status!=="verified"&&e.jsx("button",{onClick:()=>He("id_back"),className:"px-2 py-1 text-xs text-primary border border-primary rounded-md hover:bg-primary/10",children:t.verification.id.backImageUrl?"Re-upload":"Upload"})]})]}),r&&t.verification.id.status==="pending"&&e.jsxs("div",{className:"mt-4 space-y-2 pt-2 border-t border-light-border/50 dark:border-dark-border/50",children:[t.verification.id.requestNote&&e.jsxs("p",{className:"text-xs italic text-light-subtle dark:text-dark-subtle p-2 bg-light-background dark:bg-dark-background rounded-md",children:[e.jsx("strong",{children:"Teacher's Note:"})," ",t.verification.id.requestNote]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>c("id","approve",""),className:"px-3 py-1 text-xs font-medium text-white bg-green-600 rounded-md hover:bg-green-700",children:"Approve"}),e.jsx("button",{onClick:()=>at("id"),className:"px-3 py-1 text-xs font-medium text-white bg-red-600 rounded-md hover:bg-red-700",children:"Reject"})]})]})]}),e.jsx(Ba,{title:"Bank Details Verification",verification:t.verification.bank,onUpload:()=>He("bank"),isAdminView:r,onApprove:()=>c("bank","approve",""),onReject:()=>at("bank"),onViewImage:Ve})]})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-light-text dark:text-dark-text",children:"Bank & Payouts"}),t.payoutDetails?e.jsxs("div",{className:"text-sm text-light-subtle dark:text-dark-subtle mt-1",children:[e.jsxs("p",{children:[t.payoutDetails.bankName," - ",t.payoutDetails.branchName]}),e.jsxs("p",{children:["A/C: **** **** ",t.payoutDetails.accountNumber.slice(-4)]})]}):e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle mt-1",children:"No bank details added yet."})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center space-x-2 px-3 py-1.5 text-xs font-medium border border-light-border dark:border-dark-border rounded-md hover:bg-light-border dark:hover:bg-dark-border text-light-text dark:text-dark-text",children:[e.jsx(pt,{className:"w-3 h-3"}),e.jsx("span",{children:"Edit"})]}),e.jsx("button",{onClick:()=>w(!0),disabled:!ie||t.earnings.available<=0||f,className:"px-3 py-1.5 text-xs font-medium text-white bg-primary rounded-md hover:bg-primary-dark disabled:bg-gray-400 disabled:cursor-not-allowed",children:f?"Checking...":"Request Withdrawal"})]})]}),!ie&&e.jsx("p",{className:"mt-4 text-xs text-yellow-600 bg-yellow-50 dark:bg-yellow-900/30 p-2 rounded-md",children:"Please complete both ID and Bank verification to enable withdrawals."})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-light-text dark:text-dark-text",children:"Withdrawal History"}),Q.length>0?e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"min-w-full divide-y divide-light-border dark:divide-dark-border text-sm",children:[e.jsx("thead",{className:"bg-light-background dark:bg-dark-background sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Requested"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Processed"}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-light-border dark:divide-dark-border",children:Q.map(b=>e.jsxs("tr",{className:"text-light-text dark:text-dark-text",children:[e.jsx("td",{className:"px-3 py-3 whitespace-nowrap",children:new Date(b.requestedAt).toLocaleDateString()}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap",children:b.processedAt?new Date(b.processedAt).toLocaleDateString():"N/A"}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-right font-semibold",children:he.format(b.amount)}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-center",children:e.jsx(rt,{status:b.status})}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-center",children:b.status==="completed"?e.jsx("button",{onClick:()=>Me(b),className:"text-primary hover:underline text-xs font-semibold",children:"View Invoice"}):b.notes?e.jsx("span",{className:"text-xs text-light-subtle dark:text-dark-subtle italic",title:b.notes,children:"Has Notes"}):"-"})]},b.id))})]})}):e.jsx("p",{className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:"No withdrawal requests have been made yet."})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-light-text dark:text-dark-text",children:"Sales History"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-4",children:[e.jsxs("div",{className:"flex-grow grid grid-cols-2 sm:flex sm:space-x-2 rounded-md shadow-sm",role:"group",children:[e.jsx("button",{onClick:()=>je("all"),className:`px-4 py-2 text-sm font-medium border rounded-l-lg ${me==="all"?"bg-primary text-white border-primary":"bg-light-surface dark:bg-dark-surface border-light-border dark:border-dark-border hover:bg-light-border dark:hover:bg-dark-border text-light-text dark:text-dark-text"}`,children:"All Time"}),e.jsx("button",{onClick:()=>je("week"),className:`px-4 py-2 text-sm font-medium border-t border-b ${me==="week"?"bg-primary text-white border-primary":"bg-light-surface dark:bg-dark-surface border-light-border dark:border-dark-border hover:bg-light-border dark:hover:bg-dark-border text-light-text dark:text-dark-text"}`,children:"This Week"}),e.jsx("button",{onClick:()=>je("month"),className:`px-4 py-2 text-sm font-medium border rounded-r-lg sm:border-l-0 ${me==="month"?"bg-primary text-white border-primary":"bg-light-surface dark:bg-dark-surface border-light-border dark:border-dark-border hover:bg-light-border dark:hover:bg-dark-border text-light-text dark:text-dark-text"}`,children:"This Month"})]}),e.jsx("input",{type:"text",placeholder:"Search by item or student...",value:d,onChange:b=>be(b.target.value),className:"w-full sm:w-auto px-3 py-2 border border-light-border dark:border-dark-border placeholder-light-subtle dark:placeholder-dark-subtle text-light-text dark:text-dark-text bg-light-background dark:bg-dark-background rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"}),e.jsxs("select",{value:X,onChange:b=>Oe(b.target.value),className:"w-full sm:w-auto px-3 py-2 border border-light-border dark:border-dark-border text-light-text dark:text-dark-text bg-light-background dark:bg-dark-background rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"class",children:"Classes"}),e.jsx("option",{value:"course",children:"Courses"}),e.jsx("option",{value:"quiz",children:"Quizzes"})]})]}),A.length>0?e.jsx("div",{className:"overflow-x-auto max-h-[40rem]",children:e.jsxs("table",{className:"min-w-full divide-y divide-light-border dark:divide-dark-border text-sm",children:[e.jsx("thead",{className:"bg-light-background dark:bg-dark-background sticky top-0",children:e.jsxs("tr",{className:"text-light-text dark:text-dark-text",children:[e.jsx("th",{className:"px-3 py-3 text-left text-xs",children:e.jsxs("button",{onClick:()=>M("saleDate"),className:"flex items-center font-medium uppercase tracking-wider",children:["Date ",e.jsx("span",{className:"ml-1",children:V("saleDate")})]})}),e.jsx("th",{className:"px-3 py-3 text-left text-xs",children:e.jsxs("button",{onClick:()=>M("student"),className:"flex items-center font-medium uppercase tracking-wider",children:["Student ",e.jsx("span",{className:"ml-1",children:V("student")})]})}),e.jsx("th",{className:"px-3 py-3 text-left text-xs",children:e.jsxs("button",{onClick:()=>M("itemName"),className:"flex items-center font-medium uppercase tracking-wider",children:["Item ",e.jsx("span",{className:"ml-1",children:V("itemName")})]})}),e.jsx("th",{className:"px-3 py-3 text-right text-xs",children:e.jsxs("button",{onClick:()=>M("totalAmount"),className:"w-full flex justify-end items-center font-medium uppercase tracking-wider",children:["Total Sale ",e.jsx("span",{className:"ml-1",children:V("totalAmount")})]})}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-medium uppercase tracking-wider",children:"Shipping"}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-medium uppercase tracking-wider",children:"Order Status"}),e.jsx("th",{className:"px-3 py-3 text-center text-xs",children:e.jsxs("button",{onClick:()=>M("status"),className:"w-full flex justify-center items-center font-medium uppercase tracking-wider",children:["Sale Status ",e.jsx("span",{className:"ml-1",children:V("status")})]})})]})}),e.jsx("tbody",{className:"divide-y divide-light-border dark:divide-dark-border",children:A.map(b=>{var fe;const Y=b.totalAmount+b.amountPaidFromBalance,ce=(fe=b.cartItems)==null?void 0:fe.some(te=>te.type==="product"&&te.product.type==="physical");return e.jsxs("tr",{className:`${b.status==="refunded"?"bg-gray-50 dark:bg-gray-800/50":""} text-light-text dark:text-dark-text`,children:[e.jsx("td",{className:"px-3 py-3 whitespace-nowrap",children:new Date(b.saleDate).toLocaleDateString()}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap",children:e.jsx("button",{onClick:()=>ut(b.student),className:"text-primary hover:underline font-medium disabled:text-light-subtle dark:text-dark-subtle disabled:no-underline",disabled:!b.student,children:b.student?`${b.student.firstName} ${b.student.lastName}`:"N/A"})}),e.jsxs("td",{className:"px-3 py-3",children:[e.jsx("p",{className:"font-medium",children:b.itemName}),e.jsx("p",{className:"text-xs capitalize text-light-subtle dark:text-dark-subtle",children:b.itemType.replace(/_/g," ")})]}),e.jsx("td",{className:`px-3 py-3 whitespace-nowrap text-right font-semibold ${b.status==="refunded"&&"line-through text-light-subtle dark:text-dark-subtle"}`,children:he.format(Y)}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-center",children:b.shippingAddress?e.jsx("button",{onClick:()=>T(b),className:"text-primary hover:underline text-xs font-semibold",children:"View Address"}):e.jsx("span",{className:"text-light-subtle dark:text-dark-subtle text-xs",children:"-"})}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-center",children:ce?e.jsxs("select",{value:b.physicalOrderStatus||"pending",onChange:te=>u(b.id,te.target.value),className:"w-full p-1 text-xs border rounded-md bg-light-background dark:bg-dark-background border-light-border dark:border-dark-border focus:ring-primary focus:border-primary",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"})]}):e.jsx("span",{className:"text-light-subtle dark:text-dark-subtle text-xs",children:"-"})}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-center",children:e.jsx(Ga,{status:b.status})})]},b.id)})})]})}):e.jsx("p",{className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:"No sales transactions found for the current filters."})]}),ne&&e.jsx(ua,{isOpen:W,onClose:ae,student:ne}),e.jsx(Fa,{isOpen:m,onClose:S,onSave:vt,initialData:t.payoutDetails}),e.jsx(Tt,{isOpen:k,onClose:ee,onConfirm:D,title:"Request Withdrawal",message:`Enter amount to withdraw (Available: ${he.format(t.earnings.available)})`,confirmText:"Yes, Withdraw",children:e.jsx("input",{type:"number",value:P,onChange:b=>K(b.target.value),max:t.earnings.available,className:"w-full mt-4 p-2 border rounded-md text-light-text dark:text-dark-text bg-light-background dark:bg-dark-background border-light-border dark:border-dark-border",placeholder:"Amount"})}),e.jsx(qa,{isOpen:J,onClose:Z,onSave:st,verificationType:I}),e.jsx(xa,{isOpen:q,onClose:H,onSubmit:mt}),Te&&e.jsx(_a,{isOpen:!!Te,onClose:le,teacher:t,withdrawal:Te}),R&&e.jsx(cs,{isOpen:!!R,onClose:de,imageUrl:R.url,title:R.title}),v&&v.shippingAddress&&e.jsx(Se,{isOpen:!!v,onClose:()=>T(null),title:"Shipping Details",children:e.jsxs("div",{className:"space-y-4 text-sm text-light-text dark:text-dark-text",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Recipient:"}),e.jsxs("p",{children:[(xt=v.student)==null?void 0:xt.firstName," ",(nt=v.student)==null?void 0:nt.lastName]}),e.jsx("p",{children:(ht=v.student)==null?void 0:ht.contactNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Address:"}),e.jsxs("address",{className:"not-italic",children:[v.shippingAddress.line1,e.jsx("br",{}),v.shippingAddress.line2&&e.jsxs(e.Fragment,{children:[v.shippingAddress.line2,e.jsx("br",{})]}),v.shippingAddress.city,", ",v.shippingAddress.state," ",v.shippingAddress.postalCode,e.jsx("br",{}),v.shippingAddress.country]})]})]})})]})},xs=Dt.forwardRef(({teacher:t},l)=>{var p,c,u,s,h,f,g,m;const n=t.username?`${window.location.origin}/teacher/${t.username}`:`${window.location.origin}/?teacherId=${t.id}`,r=t.name.length>25?"22px":t.name.length>18?"26px":"28px",o=t.tagline&&t.tagline.length>50?"13px":t.tagline&&t.tagline.length>30?"14px":"15px",j=(((p=t.subjects)==null?void 0:p.join(", ").length)||0)>80||(((c=t.qualifications)==null?void 0:c.join(", ").length)||0)>80?"11px":"13px";return e.jsxs("div",{ref:l,style:{width:"504px",height:"288px",borderRadius:"20px",overflow:"hidden",display:"flex",boxShadow:"0 12px 30px rgba(0,0,0,0.1)",fontFamily:"Inter, system-ui, sans-serif",position:"relative",backgroundColor:"#ffffff"},children:[e.jsx("div",{style:{position:"absolute",left:0,top:0,width:"180px",height:"100%",background:"linear-gradient(145deg, #2563eb 0%, #1d4ed8 100%)",clipPath:"polygon(0 0, 100% 0, 70% 100%, 0% 100%)",zIndex:0}}),e.jsxs("div",{style:{width:"180px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-between",padding:"24px 12px",color:"white",position:"relative",zIndex:1},children:[t.profileImage?e.jsx("img",{src:Pt(t.profileImage,128,128),alt:t.name,crossOrigin:"anonymous",style:{width:"96px",height:"96px",borderRadius:"50%",objectFit:"cover",border:"3px solid rgba(255,255,255,0.6)",boxShadow:"0 8px 18px rgba(0,0,0,0.25)"}}):e.jsxs("div",{style:{width:"96px",height:"96px",borderRadius:"50%",backgroundColor:"rgba(255,255,255,0.15)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"2rem",fontWeight:700,color:"white",border:"3px solid rgba(255,255,255,0.6)"},children:[((s=(u=t.name)==null?void 0:u.split(" ")[0])==null?void 0:s.charAt(0))||"",((f=(h=t.name)==null?void 0:h.split(" ")[1])==null?void 0:f.charAt(0))||""]}),e.jsx("div",{style:{backgroundColor:"white",borderRadius:"8px",padding:"6px",boxShadow:"0 2px 5px rgba(0,0,0,0.15)",width:"100px",height:"100px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Et,{data:n,logoSrc:"/Logo3.png",size:88,crossOrigin:"anonymous"})})]}),e.jsxs("div",{style:{flex:1,padding:"20px 26px",display:"flex",flexDirection:"column",justifyContent:"space-between",position:"relative",zIndex:1,color:"#0f172a",overflow:"hidden"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:[e.jsx(Lt,{style:{height:"22px",width:"22px",color:"#2563eb"}}),e.jsxs("span",{style:{fontSize:"17px",fontWeight:700,marginLeft:"6px",color:"#1e293b"},children:["clazz.",e.jsx("span",{style:{color:"#2563eb"},children:"lk"})]})]}),e.jsxs("div",{style:{marginTop:"12px"},children:[e.jsx("h2",{style:{fontSize:r,fontWeight:800,lineHeight:1.2,margin:0,color:"#0f172a",textTransform:"capitalize",letterSpacing:"-0.5px"},children:t.name}),e.jsx("p",{style:{fontSize:o,color:"#2563eb",margin:"2px 0 0 0",fontWeight:500,letterSpacing:"0.2px"},children:t.tagline})]}),e.jsxs("div",{style:{marginTop:"10px",fontSize:j,lineHeight:1.5,color:"#475569",maxHeight:"70px",overflow:"hidden"},children:[((g=t.subjects)==null?void 0:g.length)>0&&e.jsxs("p",{style:{margin:"0 0 4px 0"},children:[e.jsx("strong",{style:{color:"#0f172a"},children:"Subjects:"})," ",t.subjects.join(" • ")]}),((m=t.qualifications)==null?void 0:m.length)>0&&e.jsxs("p",{style:{margin:0},children:[e.jsx("strong",{style:{color:"#0f172a"},children:"Qualifications:"})," ",t.qualifications.join(" • ")]})]}),e.jsxs("div",{style:{borderTop:"1px solid #e2e8f0",paddingTop:"10px",display:"flex",gap:"16px",alignItems:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(yt,{style:{width:"13px",height:"13px",color:"#64748b"}}),e.jsx("span",{style:{fontSize:"12px",marginLeft:"6px",color:"#475569"},children:t.contact.phone})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(os,{style:{width:"13px",height:"13px",color:"#64748b"}}),e.jsx("span",{style:{fontSize:"12px",marginLeft:"6px",color:"#475569"},children:t.contact.email})]})]})]})]})});xs.displayName="BusinessCard";const Nt=({icon:t,label:l,value:n})=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 text-primary",children:t}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:l}),e.jsx("a",{href:l==="Email"?`mailto:${n}`:l==="Phone"?`tel:${n}`:"#",className:"text-md font-medium text-light-text dark:text-dark-text hover:text-primary dark:hover:text-primary-light",children:n})]})]}),Wa=({teacher:t})=>{const{contact:l}=t,n=a.useRef(null),r=a.useRef(null),[o,j]=a.useState(null),p=t.username?`${window.location.origin}/teacher/${t.username}`:`${window.location.origin}/?teacherId=${t.id}`;a.useEffect(()=>{const s=r.current,h=n.current;if(!s||!h)return;const f=new ResizeObserver(()=>{const g=s.offsetWidth,m=504,x=288;if(g<m){const k=g/m;h.style.transform=`scale(${k})`,h.style.transformOrigin="top left",s.style.height=`${x*k}px`}else h.style.transform="scale(1)",h.style.transformOrigin="top left",s.style.height=`${x}px`});return f.observe(s),()=>f.disconnect()},[]);const c=()=>{const s=n.current;s&&$t(s,{useCORS:!0,backgroundColor:null,scale:4}).then(h=>{const f=h.toDataURL("image/png"),g=h.width/h.height,m=88.9,x=m/g,k=new Rt({orientation:"landscape",unit:"mm",format:[m,x]});k.addImage(f,"PNG",0,0,m,x),k.save(`${t.username}-business-card.pdf`)})},u=()=>we(void 0,null,function*(){if(!o){alert("QR Code is not ready yet. Please wait a moment.");return}const s=document.createElement("a");s.style.display="none",s.href=o,s.download=`${t.username||t.id}_qrcode.png`,document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(s.href),document.body.removeChild(s)});return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 items-start",children:[e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Contact Details"}),e.jsx(Nt,{icon:e.jsx(yt,{}),label:"Phone",value:l.phone}),e.jsx(Nt,{icon:e.jsx(os,{}),label:"Email",value:l.email}),e.jsx(Nt,{icon:e.jsx(It,{}),label:"Location",value:l.location}),t.teachingLocations&&t.teachingLocations.length>0&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-light-border dark:border-dark-border",children:[e.jsxs("h3",{className:"text-md font-semibold mb-3 text-light-text dark:text-dark-text flex items-center",children:[e.jsx(It,{className:"w-5 h-5 mr-2 text-primary"}),"Teaching Locations"]}),e.jsx("div",{className:"space-y-3",children:t.teachingLocations.map(s=>e.jsxs("div",{className:"flex items-start gap-3 p-2 rounded-md bg-light-background dark:bg-dark-background",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm text-light-text dark:text-dark-text",children:s.instituteName}),e.jsxs("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:[e.jsx("span",{className:"inline-block px-1.5 py-0.5 rounded bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium mr-1",children:s.instituteType}),s.town,", ",s.district]})]})]},s.id))})]}),e.jsxs("div",{className:"flex items-center space-x-4 pt-4 border-t border-light-border dark:border-dark-border",children:[e.jsx("div",{className:`flex-shrink-0 w-8 h-8 ${l.onlineAvailable?"text-green-500":"text-red-500"}`,children:e.jsx(sa,{})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:"Availability"}),e.jsx("p",{className:`text-md font-medium ${l.onlineAvailable?"text-green-500":"text-red-500"}`,children:l.onlineAvailable?"Available for Online Classes":"Not Available for Online Classes"})]})]})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md overflow-hidden",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Business Card"}),e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle mb-4",children:"Download a shareable business card with your profile details."}),e.jsx("div",{ref:r,className:"mx-auto",style:{maxWidth:"504px"},children:e.jsx(xs,{ref:n,teacher:t})}),e.jsxs("button",{onClick:c,className:"mt-4 w-full flex items-center justify-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary-dark transition-colors",children:[e.jsx(jt,{className:"w-5 h-5"}),e.jsx("span",{children:"Download Card (PDF)"})]})]})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Profile QR Code"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-6",children:[e.jsx("div",{className:"p-2 bg-white rounded-lg shadow",children:e.jsx(Et,{data:p,logoSrc:"/Logo3.png",size:144,onDataUrlReady:j,className:"w-36 h-36"})}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-light-subtle dark:text-dark-subtle",children:"Download a high-resolution QR code that links directly to your public profile. Perfect for printing on flyers, posters, or sharing online."}),e.jsxs("button",{onClick:u,className:"mt-4 inline-flex items-center justify-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary-dark transition-colors",children:[e.jsx(jt,{className:"w-5 h-5"}),e.jsx("span",{children:"Download QR Code (PNG)"})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle font-medium mb-1",children:"Profile URL"}),e.jsx("a",{href:p,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary break-all hover:underline font-mono bg-light-background dark:bg-dark-background px-2 py-1 rounded border border-light-border dark:border-dark-border inline-block",children:p})]})]})]})]})]})},Ha=({teacher:t,events:l,canEdit:n=!1,onScheduleNew:r,onEdit:o,onCancel:j,onTogglePublish:p})=>{const{handleNavigate:c}=Fe();return e.jsxs("div",{className:"space-y-6",children:[n&&r&&e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:r,className:"flex items-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary-dark transition-colors",children:[e.jsx($e,{className:"w-5 h-5"}),e.jsx("span",{children:"Schedule New Event"})]})}),l.length===0?e.jsxs("div",{className:"text-center py-16 text-light-subtle dark:text-dark-subtle",children:[e.jsx("p",{className:"text-lg font-semibold",children:"No upcoming events"}),e.jsxs("p",{children:[t.name," has no scheduled events."]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(({event:u,organizer:s})=>e.jsx(Da,{event:u,organizer:s,onView:h=>c({name:"event_detail_slug",slug:Ze(h.title)}),onEdit:n&&u.organizerId===t.id?o:void 0,onDelete:n&&u.organizerId===t.id&&j?h=>j(h):void 0,onTogglePublish:n&&u.organizerId===t.id&&p?h=>p(h):void 0},u.id))})]})},Qa=({isOpen:t,onClose:l,onSave:n,classInfo:r,instanceDate:o})=>{const[j,p]=a.useState([""]),[c,u]=a.useState("");a.useEffect(()=>{var m;if(t&&r&&o){const x=(m=r.recordingUrls)==null?void 0:m[o];p(x&&x.length>0?x:[""]),u("")}},[t,r,o]);const s=(m,x)=>{const k=[...j];k[m]=x,p(k)},h=()=>{p(m=>[...m,""])},f=m=>{p(x=>x.filter((k,w)=>w!==m))},g=m=>{if(m.preventDefault(),u(""),!r||!o)return;const x=j.filter(k=>k.trim()!=="");for(const k of x)try{new URL(k)}catch(w){u(`Invalid URL detected: "${k}". Please ensure all links are valid.`);return}n(r.id,o,x)};return!r||!o?null:e.jsx(Se,{isOpen:t,onClose:l,title:`Recordings for "${r.title}" on ${new Date(o).toLocaleDateString()}`,children:e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/30 border-l-4 border-yellow-400 rounded-r-md text-yellow-800 dark:text-yellow-200",children:[e.jsx("h4",{className:"font-bold",children:"Important Notice"}),e.jsx("p",{className:"text-sm mt-2",children:"It is highly recommended to add recordings of your online class. These links will be visible only to enrolled students and serve as crucial evidence in case of payment disputes."})]}),e.jsx("div",{className:"space-y-3",children:j.map((m,x)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{label:`Recording URL #${x+1}`,name:`recordingUrl-${x}`,type:"url",value:m,onChange:k=>s(x,k.target.value),placeholder:"https://..."}),j.length>1&&e.jsx("button",{type:"button",onClick:()=>f(x),className:"p-2 text-red-500 hover:bg-red-100 dark:hover:bg-red-900/50 rounded-full mt-6",children:e.jsx(ot,{className:"w-5 h-5"})})]},x))}),e.jsxs("button",{type:"button",onClick:h,className:"w-full flex items-center justify-center gap-2 text-sm font-medium text-primary border-2 border-dashed border-primary/50 rounded-md py-2 hover:bg-primary/10",children:[e.jsx($e,{className:"w-4 h-4"})," Add Another Link"]}),c&&e.jsx("p",{className:"text-red-500 text-sm text-center",children:c}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-3",children:[e.jsxs("button",{type:"button",onClick:l,className:"inline-flex items-center justify-center px-4 py-2 border border-light-border dark:border-dark-border text-sm font-medium rounded-md shadow-sm",children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Save Links"]})]})]})})},Ya=({isOpen:t,onClose:l,onSave:n,classInfo:r,instanceDate:o,enrolledStudents:j})=>{const[p,c]=a.useState(""),[u,s]=a.useState({}),[h,f]=a.useState("");a.useEffect(()=>{var x;if(t&&r&&o){f("");const k=(x=r.grades)==null?void 0:x[o];if(k){c(k.maxMark.toString());const w={};k.studentScores.forEach(P=>{w[P.studentId]=P.score.toString()}),s(w)}else c(""),s({})}},[t,r,o]);const g=(x,k)=>{s(w=>F(L({},w),{[x]:k}))},m=x=>{if(x.preventDefault(),f(""),!r||!o)return;const k=parseFloat(p);if(isNaN(k)||k<=0){f('Please enter a valid positive number for "Out of Mark".');return}const w=j.map(P=>{const K=u[P.id]||"0",J=parseFloat(K);if(isNaN(J)||J<0||J>k)throw new Error(`Invalid score for ${P.firstName}. Score must be between 0 and ${k}.`);return{studentId:P.id,score:J}});try{const P={maxMark:k,studentScores:w};n(r.id,o,P)}catch(P){f(P.message)}};return!r||!o?null:e.jsx(Se,{isOpen:t,onClose:l,title:`Grades for "${r.title}" on ${new Date(o).toLocaleDateString()}`,size:"2xl",children:e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsx(E,{label:"Out of Mark (Maximum Score)",name:"maxMark",type:"number",value:p,onChange:x=>c(x.target.value),required:!0,placeholder:"e.g., 100"}),e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"min-w-full divide-y divide-light-border dark:divide-dark-border text-sm",children:[e.jsx("thead",{className:"bg-light-background dark:bg-dark-background sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Student ID"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Score"})]})}),e.jsx("tbody",{className:"divide-y divide-light-border dark:divide-dark-border",children:j.map(x=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-4 py-2 font-medium text-light-text dark:text-dark-text",children:[x.firstName," ",x.lastName]}),e.jsx("td",{className:"px-4 py-2 text-light-text dark:text-dark-text",children:x.id}),e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsx("input",{type:"number",value:u[x.id]||"",onChange:k=>g(x.id,k.target.value),min:"0",max:p||void 0,className:"w-24 p-1 border rounded-md text-right bg-light-surface dark:bg-dark-surface border-light-border dark:border-dark-border text-light-text dark:text-dark-text",placeholder:"Score"})})]},x.id))})]})}),h&&e.jsx("p",{className:"text-red-500 text-sm text-center",children:h}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-3",children:[e.jsxs("button",{type:"button",onClick:l,className:"inline-flex items-center justify-center px-4 py-2 border border-light-border dark:border-dark-border text-sm font-medium rounded-md shadow-sm",children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",className:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Save Grades"]})]})]})})},Ka=({isOpen:t,onClose:l,classInfo:n,instanceDate:r,enrolledStudents:o})=>{var c;if(!t||!n||!r)return null;const j=((c=n.homeworkSubmissions)==null?void 0:c[r])||[],p=new Map(j.map(u=>[u.studentId,u]));return e.jsx(Se,{isOpen:t,onClose:l,title:`Homework for "${n.title}" on ${new Date(r).toLocaleDateString()}`,size:"2xl",children:e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"min-w-full divide-y divide-light-border dark:divide-dark-border text-sm",children:[e.jsx("thead",{className:"bg-light-background dark:bg-dark-background sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Student ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Submission"})]})}),e.jsx("tbody",{className:"divide-y divide-light-border dark:divide-dark-border",children:o.length>0?o.map(u=>{const s=p.get(u.id);return e.jsxs("tr",{children:[e.jsxs("td",{className:"px-4 py-2 font-medium text-light-text dark:text-dark-text",children:[u.firstName," ",u.lastName]}),e.jsx("td",{className:"px-4 py-2 text-light-text dark:text-dark-text",children:u.id}),e.jsx("td",{className:"px-4 py-2",children:s?e.jsxs("a",{href:s.link,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-primary hover:underline",children:[e.jsx(aa,{className:"w-4 h-4"}),"View Submission"]}):e.jsx("span",{className:"text-light-subtle dark:text-dark-subtle italic",children:"Not Submitted"})})]},u.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:"No students were enrolled for this session."})})})]})})})},Ja=({teacher:t,sales:l})=>{const{handleSaveClassRecording:n,handleSaveGrading:r,users:o}=Ne(),[j,p]=a.useState({isOpen:!1,classInfo:null,instanceDate:null}),[c,u]=a.useState({isOpen:!1,classInfo:null,instanceDate:null,enrolledStudents:[]}),[s,h]=a.useState({isOpen:!1,classInfo:null,instanceDate:null,enrolledStudents:[]}),f=a.useMemo(()=>{const N=[],I=new Date,C=y=>{const _=y.getFullYear(),B=String(y.getMonth()+1).padStart(2,"0"),W=String(y.getDate()).padStart(2,"0");return`${_}-${B}-${W}`};return t.individualClasses.forEach(y=>{if(!(y.status==="canceled"||y.isDeleted))if(y.recurrence==="weekly"){let _=new Date(y.date+"T00:00:00");const B=y.endDate?new Date(y.endDate+"T23:59:59"):I,[W,U]=y.endTime.split(":").map(Number);for(;_<=B;){const ne=new Date(_);if(ne.setHours(W,U,59,999),ne<I&&N.push({classInfo:y,instanceDate:C(_)}),_>I&&_>B)break;_.setDate(_.getDate()+7)}}else new Date(`${y.date}T${y.endTime}`)<I&&N.push({classInfo:y,instanceDate:y.date})}),N.sort((y,_)=>new Date(_.instanceDate).getTime()-new Date(y.instanceDate).getTime()).map(y=>{const B=l.filter(W=>W.itemId===y.classInfo.id&&W.itemType==="class"&&W.status==="completed").filter(W=>{const U=new Date(W.saleDate);return U.setHours(0,0,0,0),new Date(y.instanceDate+"T00:00:00")>=U}).length;return F(L({},y),{enrollmentCount:B})}).filter(y=>y.enrollmentCount>0)},[t.individualClasses,l]),g=(N,I)=>{p({isOpen:!0,classInfo:N,instanceDate:I})},m=()=>{p({isOpen:!1,classInfo:null,instanceDate:null})},x=(N,I)=>{const C=new Set(l.filter(y=>y.itemId===N.id&&y.itemType==="class"&&y.status==="completed"&&new Date(y.saleDate)<=new Date(I)).map(y=>y.studentId)),q=o.filter(y=>C.has(y.id));u({isOpen:!0,classInfo:N,instanceDate:I,enrolledStudents:q})},k=()=>{u({isOpen:!1,classInfo:null,instanceDate:null,enrolledStudents:[]})},w=(N,I)=>{const C=new Set(l.filter(y=>y.itemId===N.id&&y.itemType==="class"&&y.status==="completed"&&new Date(y.saleDate)<=new Date(I)).map(y=>y.studentId)),q=o.filter(y=>C.has(y.id));h({isOpen:!0,classInfo:N,instanceDate:I,enrolledStudents:q})},P=()=>{h({isOpen:!1,classInfo:null,instanceDate:null,enrolledStudents:[]})},K=(N,I,C)=>{n(t.id,N,I,C),m()},J=(N,I,C)=>{r(t.id,N,I,C),k()};return f.length===0?e.jsxs("div",{className:"text-center py-16 text-light-subtle dark:text-dark-subtle",children:[e.jsx("p",{children:"You have no past classes with enrolled students."}),e.jsx("p",{className:"text-sm",children:"Once a class session with students is finished, it will appear here."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/30 border-l-4 border-yellow-400 rounded-r-md text-yellow-800 dark:text-yellow-200",children:[e.jsx("h4",{className:"font-bold",children:"Manage Past Classes"}),e.jsx("p",{className:"text-sm mt-2",children:"This section lists all your finished class sessions. It is highly recommended to upload a recording for each session. You can also add grades and view homework submissions for your students here."})]}),e.jsx("div",{className:"space-y-4",children:f.map(({classInfo:N,instanceDate:I,enrollmentCount:C})=>{var W,U;const q=(W=N.recordingUrls)==null?void 0:W[I],y=q&&q.length>0,_=(U=N.grades)==null?void 0:U[I],B=C>0;return e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-light-surface dark:bg-dark-surface rounded-lg shadow-sm border border-light-border dark:border-dark-border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-light-text dark:text-dark-text",children:N.title}),e.jsxs("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:["Session Date: ",new Date(I).toLocaleDateString()]})]}),e.jsx("div",{className:"mt-4 sm:mt-0 w-full sm:w-auto flex flex-col sm:flex-row gap-2",children:B?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>g(N,I),className:"w-full sm:w-auto flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium text-primary border border-primary rounded-md hover:bg-primary/10 transition-colors",children:[e.jsx(as,{className:"w-5 h-5"}),y?`Edit Recordings (${q.length})`:"Add Recording"]}),e.jsxs("button",{onClick:()=>w(N,I),className:"w-full sm:w-auto flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 transition-colors",children:[e.jsx(rs,{className:"w-4 h-4"}),"View Homework"]}),e.jsxs("button",{onClick:()=>x(N,I),className:"w-full sm:w-auto flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary-dark transition-colors",children:[e.jsx(pt,{className:"w-4 h-4"}),_?"Edit Grades":"Add Grades"]})]}):e.jsx("div",{className:"w-full sm:w-auto text-center px-4 py-2 text-sm font-medium text-light-subtle dark:text-dark-subtle bg-light-background dark:bg-dark-background rounded-md",children:"No Students Enrolled"})})]},`${N.id}-${I}`)})}),e.jsx(Qa,{isOpen:j.isOpen,onClose:m,onSave:K,classInfo:j.classInfo,instanceDate:j.instanceDate}),e.jsx(Ya,{isOpen:c.isOpen,onClose:k,onSave:J,classInfo:c.classInfo,instanceDate:c.instanceDate,enrolledStudents:c.enrolledStudents}),e.jsx(Ka,{isOpen:s.isOpen,onClose:P,classInfo:s.classInfo,instanceDate:s.instanceDate,enrolledStudents:s.enrolledStudents})]})},Xa=({teacher:t})=>{const{handleSendNotification:l}=Ne(),[n,r]=a.useState(""),[o,j]=a.useState("all_followers"),[p,c]=a.useState(""),[u,s]=a.useState([]),[h,f]=a.useState(!1);a.useEffect(()=>{const m=fa(ya(Xe,"notifications"),ka("teacherId","==",t.id),ja("createdAt","desc")),x=va(m,k=>{const w=k.docs.map(P=>L({id:P.id},P.data()));s(w)});return()=>x()},[t.id]);const g=m=>we(void 0,null,function*(){if(m.preventDefault(),!n.trim())return;f(!0);let x;if(o==="class"&&p){const k=t.individualClasses.find(w=>w.id===p);if(!k){alert("Selected class not found."),f(!1);return}x={type:"class",classId:k.id,className:k.title}}else x="all_followers";yield l(t.id,n,x),r(""),f(!1)});return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Send a Notification"}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notification-content",className:"block text-sm font-medium mb-1",children:"Message"}),e.jsx("textarea",{id:"notification-content",value:n,onChange:m=>r(m.target.value),rows:4,maxLength:250,className:"w-full p-2 border border-light-border dark:border-dark-border rounded-md bg-light-background dark:bg-dark-background focus:ring-primary focus:border-primary",placeholder:"Announce a new class, share an update, etc.",required:!0}),e.jsxs("p",{className:"text-xs text-right text-light-subtle dark:text-dark-subtle",children:[n.length," / 250"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Target Audience"}),e.jsxs("select",{value:o,onChange:m=>j(m.target.value),className:"w-full p-2 border border-light-border dark:border-dark-border rounded-md bg-light-background dark:bg-dark-background",children:[e.jsx("option",{value:"all_followers",children:"All Followers"}),e.jsx("option",{value:"class",children:"Students of a specific class"})]})]}),o==="class"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Select Class"}),e.jsxs("select",{value:p,onChange:m=>c(Number(m.target.value)),className:"w-full p-2 border border-light-border dark:border-dark-border rounded-md bg-light-background dark:bg-dark-background",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"-- Select a class --"}),t.individualClasses.map(m=>e.jsx("option",{value:m.id,children:m.title},m.id))]})]}),e.jsx("button",{type:"submit",disabled:h,className:"w-full bg-primary text-white font-bold py-2 rounded-md hover:bg-primary-dark disabled:opacity-50",children:h?"Sending...":"Send Notification"})]})]}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Sent History"}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto pr-2",children:u.length>0?u.map(m=>e.jsxs("div",{className:"p-3 border-b border-light-border dark:border-dark-border",children:[e.jsx("p",{className:"text-sm text-light-text dark:text-dark-text",children:m.content}),e.jsxs("div",{className:"text-xs text-light-subtle dark:text-dark-subtle mt-2 flex justify-between",children:[e.jsx("span",{children:new Date(m.createdAt).toLocaleString()}),e.jsx("span",{className:"font-semibold",children:m.target==="all_followers"?"To All Followers":`To class: ${m.target.className}`})]})]},m.id)):e.jsx("p",{className:"text-center text-sm text-light-subtle dark:text-dark-subtle py-8",children:"No notifications sent yet."})})]})]})},pr=({teacherId:t,slug:l})=>{var Ut,Gt;const{currentUser:n}=zt(),{sales:r,teachers:o,users:j,handleUpdateTeacher:p,handleSaveClass:c,handleSaveQuiz:u,handleCancelItem:s,handleRequestWithdrawal:h,handleSaveBankDetails:f,handleVerificationUpload:g,handleVerificationDecision:m,handleTogglePublishState:x,handleRemoveCoverImageFromArray:k,handleFollowToggle:w,handleDeleteQuizSubmissions:P,tuitionInstitutes:K,handleUpdatePhysicalOrderStatus:J,loading:N,processMonthlyPayouts:I,submissions:C,handleImageSave:q}=Ne(),y=is(),_=Fe(),{addToast:B,openImageUploadModal:W}=y,{handleNavigate:U,teacherDashboardMessage:ne,functionUrls:Le,gDriveFetcherApiKey:Te}=_,{enableNotifications:Me}=ra(),d=a.useMemo(()=>t?o.find(i=>i.id===t):l?o.find(i=>i.username===l):null,[o,t,l]),{percentage:be,missing:X}=Mt(d),Oe=a.useMemo(()=>d?{"@context":"https://schema.org","@type":"Person",name:d.name,description:d.bio,image:d.profileImage,jobTitle:"Teacher",url:window.location.href}:null,[d]),me=(n==null?void 0:n.id)===(d==null?void 0:d.userId),je=(n==null?void 0:n.role)==="admin",R=me||je,qe=me?((Ut=d==null?void 0:d.followers)==null?void 0:Ut.length)||0:void 0,se=a.useMemo(()=>{var i;return((i=n==null?void 0:n.followingTeacherIds)==null?void 0:i.includes((d==null?void 0:d.id)||""))||!1},[n,d]),[_e,v]=a.useState("overview"),[T,S]=a.useState(null),[ee,Z]=a.useState(!1),[H,ae]=a.useState(!1),[le,de]=a.useState(null),[he,ie]=a.useState(!1),[pe,ze]=a.useState(null),[oe,ke]=a.useState(null),[Ee,A]=a.useState(null),[M,V]=a.useState(!1),[Q,D]=a.useState(!0),[He,st]=a.useState(!0),[at,mt]=a.useState(null),[ut,Ve]=a.useState(!1),[vt,rt]=a.useState(null),{handleSaveEvent:xt}=na({currentUser:n,teachers:o,sales:r,submissions:C,ui:y,nav:_,handleUpdateTeacher:p,handleImageSave:q}),[nt,ht]=a.useState(!1),b=8,Y=((Gt=d==null?void 0:d.youtubeLinks)==null?void 0:Gt.filter(Boolean))||[],ce=nt?Y:Y.slice(0,b),[fe,te]=a.useState([]),[ue,ye]=a.useState(!1),[Ce,Qe]=a.useState(null),[Ue,Ge]=a.useState(null),[Ye,gt]=a.useState(!1),Ke=5;a.useEffect(()=>{if(!(d!=null&&d.googleDriveLink)){te([]);return}we(void 0,null,function*(){ye(!0),Qe(null);try{const O=yield fetch(Le.gDriveFetcher,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:d.googleDriveLink,apiKey:Te})}),$=yield O.json();if(!O.ok||!$.success)throw new Error($.message||"Failed to fetch photos. Please ensure the link is a public Google Drive folder.");te($.photos)}catch(O){Qe(O.message),console.error("Failed to fetch photos from Google Drive:",O)}finally{ye(!1)}})},[d==null?void 0:d.googleDriveLink]),a.useEffect(()=>{const i=localStorage.getItem("dismissed_teacher_msg");st(!(ne&&ne!==i))},[ne]);const Pe=a.useMemo(()=>{if(!d)return[];const i=K.flatMap($=>($.events||[]).map(re=>({event:re,organizer:$}))).filter(({event:$})=>{var re;return(re=$.participatingTeacherIds)==null?void 0:re.includes(d.id)}),O=(d.events||[]).map($=>({event:$,organizer:d}));return[...i,...O].sort(($,re)=>new Date($.event.startDate).getTime()-new Date(re.event.startDate).getTime())},[d,K]),hs=a.useMemo(()=>Pe.length?R?Pe.length:Pe.filter(i=>i.event.isPublished).length:0,[Pe,R]);a.useEffect(()=>{we(void 0,null,function*(){d!=null&&d.id&&(D(!0),yield I("teacher",d.id),D(!1))})},[d==null?void 0:d.id]);const gs=a.useCallback(()=>{Z(!1),S(null)},[]),bs=a.useCallback(()=>{ie(!1),de(null)},[]),ps=a.useCallback(()=>ze(null),[]),fs=a.useCallback(()=>ke(null),[]),[Ft,qt]=a.useState(0),[js,_t]=a.useState(0),ks=i=>we(void 0,null,function*(){d&&(yield xt(F(L({},i),{organizerId:d.id,organizerType:"teacher"})),Ve(!1),rt(null))}),ys=()=>d&&U({name:"edit_teacher_profile",teacherId:d.id}),vs=i=>{const O=T,$=O?ca(O):"scheduled";if(O&&($==="finished"||$==="canceled"||O.status==="canceled")){const re=new Date(`${i.date}T${i.startTime}`),Ie=new Date;let ve=!1;i.recurrence==="flexible"&&i.flexibleDates?ve=i.flexibleDates.some(lt=>new Date(`${lt.date}T${lt.startTime}`)>Ie):ve=re>Ie,ve&&(i.status="scheduled",i.instanceStartDate=new Date().toISOString(),i.attendance=[])}c(i),Z(!1),S(null)},ws=i=>{c(i),ae(!1)},Ns=i=>we(void 0,null,function*(){const O=d==null?void 0:d.quizzes.find($=>$.id===i.id);O&&(O.status==="finished"||ds(O)==="finished")&&new Date(`${i.date}T${i.startTime}`)>new Date&&(i.status="scheduled",i.instanceStartDate=new Date().toISOString()),yield u(i),ie(!1),de(null),d&&U({name:"quiz_editor",quizId:i.id,teacherId:d.id})}),Ss=()=>{!pe||!d||(s(d.id,pe.id,pe.type),ze(null))},Cs=()=>we(void 0,null,function*(){if(!oe||!d)return;const{id:i,type:O}=oe;if(O==="course"||O==="product"){const $=O==="course"?"courses":"products",Ie=(d[$]||[]).map(ve=>ve.id===i?F(L({},ve),{isDeleted:!0,isPublished:!1}):ve);try{yield p(d.id,{[$]:Ie}),B(`${O.charAt(0).toUpperCase()+O.slice(1)} deleted.`,"success")}catch(ve){B(`Failed to delete ${O}.`,"error"),console.error(ve)}}else if(O==="class"){const $=d.individualClasses.find(z=>z.id===i);if(!$){B("Class not found to delete.","error"),ke(null);return}const re=pa(Xe),Ie=r.filter(z=>{var xe;return z.itemId===i&&z.itemType==="class"&&z.status==="completed"&&((xe=z.itemSnapshot)==null?void 0:xe.instanceStartDate)===$.instanceStartDate});let ve=0;if(Ie.length>0)for(const z of Ie){const xe=it(Xe,"sales",z.id),De=it(Xe,"users",z.studentId),Re=z.totalAmount+z.amountPaidFromBalance;if(re.update(xe,{status:"refunded"}),re.update(De,{accountBalance:wt(Re)}),z.teacherId&&z.teacherCommission&&z.teacherCommission>0){const Je=it(Xe,"teachers",z.teacherId);re.update(Je,{"earnings.total":wt(-z.teacherCommission)})}if(z.instituteId&&z.instituteCommission&&z.instituteCommission>0){const Je=it(Xe,"tuitionInstitutes",z.instituteId);re.update(Je,{"earnings.total":wt(-z.instituteCommission)})}ve++}const lt=d.individualClasses.map(z=>z.id===i?F(L({},z),{isDeleted:!0,isPublished:!1}):z),G=it(Xe,"teachers",d.id);re.update(G,{individualClasses:lt});try{yield re.commit(),ve>0?B(`Class deleted. ${ve} student(s) have been fully refunded.`,"success"):B("Class deleted successfully.","success")}catch(z){B("Failed to delete class and process refunds.","error"),console.error(z)}}ke(null)}),Is=i=>{if(!d)return;const O=d.coverImages[i];k(d.id,O),_t($=>Math.max(0,$-1))},Ts=()=>{localStorage.setItem("dismissed_teacher_msg",ne),st(!0)},{weekStart:Ds,weekEnd:Ms,scheduleForWeek:Ps}=a.useMemo(()=>{if(!d)return{weekStart:new Date,weekEnd:new Date,scheduleForWeek:[]};const i=G=>{const z=new Date,xe=z.getDay(),De=z.getDate()-xe+(xe===0?-6:1),Re=new Date(new Date(z.setDate(De+G*7)).setHours(0,0,0,0)),Je=new Date(Re);return Je.setDate(Re.getDate()+6),Je.setHours(23,59,59,999),{weekStart:Re,weekEnd:Je}},O=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],{weekStart:$,weekEnd:re}=i(Ft),Ie=[];return d.individualClasses.filter(G=>!G.isDeleted&&(R||G.isPublished)).forEach(G=>{const z=new Date(G.date);if(z.setMinutes(z.getMinutes()+z.getTimezoneOffset()),G.recurrence==="weekly"){const xe=O[z.getDay()],De=new Date(G.date),Re=G.endDate?new Date(G.endDate):null;De<=re&&(!Re||Re>=$)&&Ie.push({id:G.id,type:"class",day:xe,subject:G.subject,title:G.title,startTime:G.startTime,endTime:G.endTime})}else if(G.recurrence==="flexible"&&G.flexibleDates)G.flexibleDates.forEach(xe=>{const De=new Date(xe.date);if(De.setMinutes(De.getMinutes()+De.getTimezoneOffset()),De>=$&&De<=re){const Re=O[De.getDay()];Ie.push({id:G.id,type:"class",day:Re,subject:G.subject,title:G.title,startTime:xe.startTime,endTime:xe.endTime})}});else if(z>=$&&z<=re){const xe=O[z.getDay()];Ie.push({id:G.id,type:"class",day:xe,subject:G.subject,title:G.title,startTime:G.startTime,endTime:G.endTime})}}),d.quizzes.filter(G=>!G.isDeleted&&(R||G.isPublished)).forEach(G=>{const z=new Date(G.date);if(z.setMinutes(z.getMinutes()+z.getTimezoneOffset()),z>=$&&z<=re){const xe=O[z.getDay()];Ie.push({id:G.id,type:"quiz",day:xe,subject:G.subject,title:G.title,startTime:G.startTime,endTime:""})}}),{weekStart:$,weekEnd:re,scheduleForWeek:Ie}},[d,Ft,R]),As=()=>oe?oe.type==="class"&&(oe.enrollmentCount||0)>0?`Are you sure you want to delete this class? This will automatically issue a full refund to all ${oe.enrollmentCount} enrolled students. This action cannot be undone.`:`Are you sure you want to delete this ${oe.type}? This action cannot be undone.`:"";if(N)return e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-20 text-center flex flex-col items-center justify-center",children:[e.jsx(Ct,{className:"w-8 h-8 text-primary"}),e.jsx("p",{className:"mt-4 text-light-subtle dark:text-dark-subtle",children:"Loading teacher profile..."})]});if(!d)return e.jsx(Kt,{});if(!(d.registrationStatus==="approved"||n&&(n.id===d.userId||n.role==="admin")))return e.jsx(Kt,{title:"Profile Private",message:"This teacher's profile is currently not public."});const Ls=()=>{switch(_e){case"overview":return e.jsxs("div",{className:"space-y-12",children:[d.bio&&e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 md:p-8 rounded-lg shadow-md animate-fadeIn",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4 text-light-text dark:text-dark-text",children:["About ",d.name.split(" ")[0]]}),e.jsx("div",{className:"text-light-text dark:text-dark-text",children:e.jsx(Qt,{content:d.bio,className:"prose-relaxed"})})]}),Y.length>0&&e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 md:p-8 rounded-lg shadow-md animate-fadeIn",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4 text-light-text dark:text-dark-text",children:["Showcase Videos (",Y.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:ce.map((i,O)=>{const $=da(i);if(!$)return null;const re=`https://img.youtube.com/vi/${$}/hqdefault.jpg`;return e.jsxs("button",{onClick:()=>mt($),className:"relative group aspect-video rounded-lg overflow-hidden shadow-sm transition-transform hover:scale-105",children:[e.jsx("img",{src:re,alt:`YouTube video thumbnail ${O+1}`,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(oa,{className:"w-16 h-16 text-white/80"})})]},O)})}),Y.length>b&&e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>ht(i=>!i),className:"px-6 py-2 border border-primary text-primary font-semibold rounded-full hover:bg-primary/10 transition-colors",children:nt?"Show Less":`Show All ${Y.length} Videos`})})]}),d.googleDriveLink&&e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 md:p-8 rounded-lg shadow-md animate-fadeIn",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-light-text dark:text-dark-text",children:"Showcase Images"}),ue?e.jsx("div",{className:"flex justify-center items-center h-24",children:e.jsx(Ct,{className:"w-8 h-8 text-primary"})}):Ce?e.jsx("p",{className:"text-red-500 text-center bg-red-50 dark:bg-red-900/20 p-3 rounded-md",children:Ce}):fe.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:(Ye?fe:fe.slice(0,Ke)).map((i,O)=>e.jsx("button",{onClick:()=>Ge({url:i.url_highres||i.url_thumb,title:`Image ${O+1}`}),className:"relative group aspect-square rounded-lg overflow-hidden shadow-sm transition-transform hover:scale-105",children:e.jsx("img",{src:Pt(i.url_thumb,400),alt:`Showcase image ${O+1}`,className:"w-full h-full object-cover"})},i.id||O))}),fe.length>Ke&&e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>gt(i=>!i),className:"px-6 py-2 border border-primary text-primary font-semibold rounded-full hover:bg-primary/10 transition-colors",children:Ye?"Show Less":`Show All ${fe.length} Images`})})]}):e.jsx("p",{className:"text-light-subtle dark:text-dark-subtle text-center py-8",children:"No images found in the provided Google Drive folder."})]}),(R||d.individualClasses.some(i=>i.isPublished&&!i.isDeleted))&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-light-text dark:text-dark-text",children:"Classes"}),!R&&e.jsx("button",{onClick:()=>v("classes"),className:"text-sm font-medium text-primary hover:underline",children:"View All"})]}),e.jsx(Jt,{teacher:d,canEdit:R,onScheduleNew:()=>{S(null),Z(!0)},onScheduleFreeSlot:()=>ae(!0),onScheduleGoogleMeet:()=>{S({meetProvider:"google"}),Z(!0)},onEdit:i=>{S(i),Z(!0)},onDelete:(i,O)=>ke({id:i,type:"class",enrollmentCount:O})})]}),(R||d.courses.some(i=>i.isPublished&&!i.isDeleted))&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-light-text dark:text-dark-text",children:"Courses"}),!R&&e.jsx("button",{onClick:()=>v("courses"),className:"text-sm font-medium text-primary hover:underline",children:"View All"})]}),e.jsx(Xt,{teacher:d,canEdit:R,onDelete:i=>ke({id:i,type:"course"})})]}),(R||d.quizzes.some(i=>i.isPublished&&!i.isDeleted))&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-light-text dark:text-dark-text",children:"Quizzes"}),!R&&e.jsx("button",{onClick:()=>v("quizzes"),className:"text-sm font-medium text-primary hover:underline",children:"View All"})]}),e.jsx(Zt,{teacher:d,canEdit:R,onScheduleNew:()=>ie(!0),onEdit:i=>{de(i),ie(!0)},onCancel:i=>ze({id:i,type:"quiz"})})]}),(R||d.products&&d.products.some(i=>i.isPublished&&!i.isDeleted))&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-light-text dark:text-dark-text",children:"Store"}),!R&&e.jsx("button",{onClick:()=>v("products"),className:"text-sm font-medium text-primary hover:underline",children:"View All"})]}),e.jsx(es,{teacher:d,canEdit:R,onDelete:i=>ke({id:i,type:"product"})})]})]});case"classes":return e.jsx(Jt,{teacher:d,canEdit:R,onScheduleNew:()=>{S(null),Z(!0)},onScheduleFreeSlot:()=>ae(!0),onScheduleGoogleMeet:()=>{S({meetProvider:"google"}),Z(!0)},onEdit:i=>{S(i),Z(!0)},onDelete:(i,O)=>ke({id:i,type:"class",enrollmentCount:O})});case"courses":return e.jsx(Xt,{teacher:d,canEdit:R,onDelete:i=>ke({id:i,type:"course"})});case"quizzes":return e.jsx(Zt,{teacher:d,canEdit:R,onScheduleNew:()=>ie(!0),onEdit:i=>{de(i),ie(!0)},onCancel:i=>ze({id:i,type:"quiz"})});case"products":return e.jsx(es,{teacher:d,canEdit:R,onDelete:i=>ke({id:i,type:"product"})});case"my_events":return e.jsx(Ha,{teacher:d,events:Pe,canEdit:me,onScheduleNew:()=>{rt(null),Ve(!0)},onEdit:i=>{rt(i),Ve(!0)},onCancel:i=>ke({id:i,type:"event"}),onTogglePublish:i=>x(d.id,i,"events")});case"past_classes":return R?e.jsx(Ja,{teacher:d,sales:r}):null;case"earnings":return R?e.jsx(Va,{teacher:d,allSales:r,allUsers:j,isAdminView:je,onWithdraw:i=>h(d.id,i),onSaveBankDetails:i=>f(d.id,i),onVerificationUpload:(i,O,$)=>g(d.id,i,O,$),onVerificationDecision:(i,O,$)=>m(d.id,i,O,$),onUpdatePhysicalOrderStatus:J}):null;case"attendance":return R?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Select a Class"}),e.jsx("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto pr-2",children:d.individualClasses.filter(i=>i.status!=="canceled").map(i=>e.jsxs("button",{onClick:()=>A(i),className:`w-full text-left p-3 border rounded-lg transition-colors ${(Ee==null?void 0:Ee.id)===i.id?"bg-primary/10 border-primary":"border-light-border dark:border-dark-border hover:bg-light-border dark:hover:bg-dark-border"}`,children:[e.jsx("p",{className:"font-bold",children:i.title}),e.jsxs("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:[i.subject," - ",new Date(i.date).toLocaleDateString()]})]},i.id))})]}),e.jsx("div",{className:"md:col-span-2",children:Ee?e.jsx(Na,{classInfo:Ee}):e.jsx("div",{className:"h-full flex items-center justify-center text-center p-8 bg-light-background dark:bg-dark-background rounded-lg",children:e.jsx("p",{className:"text-light-subtle dark:text-dark-subtle",children:"Select a class from the left to view attendance records."})})})]}):null;case"notifications":return R?e.jsx(Xa,{teacher:d}):null;case"timetable":return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("button",{onClick:()=>qt(i=>i-1),className:"px-4 py-2 text-sm font-medium border border-light-border dark:border-dark-border rounded-md hover:bg-light-border dark:hover:bg-dark-border transition-colors",children:"< Previous Week"}),e.jsxs("span",{className:"font-semibold",children:[Ds.toLocaleDateString()," - ",Ms.toLocaleDateString()]}),e.jsx("button",{onClick:()=>qt(i=>i+1),className:"px-4 py-2 text-sm font-medium border border-light-border dark:border-dark-border rounded-md hover:bg-light-border dark:hover:bg-dark-border transition-colors",children:"Next Week >"})]}),e.jsx(ga,{schedule:Ps,onItemClick:i=>U(i.type==="class"?{name:"class_detail_slug",slug:Ze(i.title||"")}:{name:"quiz_detail_slug",slug:Ze(i.title||"")})})]});case"contact":return e.jsx(Wa,{teacher:d});default:return e.jsx("div",{children:"Select a tab"})}};return e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(ba,{title:d?`${d.name} | clazz.lk`:"Teacher Profile",description:d?d.tagline||d.bio.substring(0,160):"View teacher profile.",image:d?d.profileImage:void 0,structuredData:Oe}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"md:w-64 flex-shrink-0 relative z-20",children:e.jsx("div",{className:"sticky top-24",children:e.jsx(Pa,{activeTab:_e,setActiveTab:v,isOwnProfile:R,hasEvents:hs>0})})}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-8 pl-16 md:pl-0 animate-slideInUp relative z-0",children:[_e==="overview"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-end gap-4 mb-6",children:[me&&!He&&ne?e.jsxs("div",{className:"flex-grow p-4 bg-blue-50 dark:bg-blue-900/30 border-l-4 border-blue-400 rounded-r-md relative animate-fadeIn",children:[e.jsx("button",{onClick:Ts,className:"absolute top-2 right-2 p-1 text-blue-400 hover:text-blue-600 dark:hover:text-blue-200",children:e.jsx(Be,{className:"w-5 h-5"})}),e.jsxs("div",{className:"pr-8",children:[e.jsx("h4",{className:"font-bold text-blue-800 dark:text-blue-200 mb-2",children:"Platform Announcement"}),e.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300 prose-sm max-w-none",children:e.jsx(Qt,{content:ne})})]})]}):e.jsx("div",{}),me&&"Notification"in window&&Notification.permission==="default"&&e.jsxs("button",{onClick:()=>Me(),className:"flex-shrink-0 flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg shadow-md hover:shadow-lg transition-all animate-pulse",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"})}),"Turn on Notifications"]})]}),R&&(be===100?e.jsx("div",{className:"mb-6 animate-fadeIn",children:e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/30 border-l-4 border-green-500 p-3 rounded-r-lg shadow-sm flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),e.jsxs("p",{className:"text-sm font-medium text-green-800 dark:text-green-200",children:["Great job, ",d.name.split(" ")[0],"! Your profile is 100% complete."]})]}),e.jsx("button",{onClick:()=>V(!0),className:"text-xs px-3 py-1.5 bg-white dark:bg-green-800 border border-green-200 dark:border-green-700 text-green-700 dark:text-green-100 font-medium rounded hover:bg-green-50 dark:hover:bg-green-700 transition-colors",children:"Edit Details"})]})}):(be<100||je)&&e.jsx("div",{className:"mb-6 animate-fadeIn",children:e.jsxs("div",{className:"bg-yellow-100 dark:bg-yellow-900/50 border-l-4 border-yellow-500 text-yellow-800 dark:text-yellow-200 p-4 rounded-r-lg shadow-lg flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"font-bold",children:"Complete your profile for a better experience!"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsx(At,{value:be,max:100}),e.jsxs("span",{className:"font-bold text-sm flex-shrink-0",children:[be,"%"]})]})]}),e.jsx("button",{onClick:()=>V(!0),className:"bg-yellow-500 text-white font-bold py-2 px-4 rounded-md hover:bg-yellow-600 transition-colors flex-shrink-0 w-full sm:w-auto",children:"Complete Profile"})]})})),d.registrationStatus!=="approved"&&R&&e.jsx("div",{className:`p-4 rounded-md mb-6 text-center font-semibold text-white ${d.registrationStatus==="pending"?"bg-yellow-500":"bg-red-500"}`,children:d.registrationStatus==="pending"?"Your profile is currently under review and not yet visible to the public. Please ensure that your profile is at least 50% complete to make it publicly visible.":"Your registration has been rejected. Please contact support."}),e.jsx(ms,{teacher:d,isOwnProfile:R,onEditProfile:ys,onEditImage:i=>W(i,{teacherId:d.id}),onRemoveCoverImage:Is,coverImageIndex:js,setCoverImageIndex:_t,followerCount:qe}),!me&&(n==null?void 0:n.role)==="student"&&e.jsx("div",{className:"flex justify-center -mt-4 mb-8 download-ignore",children:e.jsxs("button",{onClick:()=>w(d.id),className:`flex items-center space-x-2 px-6 py-2 rounded-full font-semibold transition-colors ${se?"bg-primary/10 text-primary border border-primary/20":"bg-primary text-white"}`,children:[se?e.jsx(Ae,{className:"w-5 h-5"}):e.jsx(la,{className:"w-5 h-5"}),e.jsx("span",{children:se?"Following":"Follow"})]})})]}),e.jsx("div",{children:Ls()})]})]}),e.jsx(La,{isOpen:ee,onClose:gs,onSave:vs,initialData:T,teacherId:d.id}),e.jsx(Ea,{isOpen:H,onClose:()=>ae(!1),onSave:ws,teacherId:d.id}),e.jsx(Oa,{isOpen:he,onClose:bs,onSave:Ns,initialData:le,teacherId:d.id}),pe&&e.jsx(Tt,{isOpen:!0,onClose:ps,onConfirm:Ss,title:`Cancel ${pe.type}`,message:`Are you sure you want to cancel this ${pe.type}? This will refund all enrolled students.`,confirmText:"Yes, Cancel"}),oe&&e.jsx(Tt,{isOpen:!0,onClose:fs,onConfirm:Cs,title:`Delete ${oe.type}`,message:As(),confirmText:"Yes, Delete"}),R&&e.jsx(za,{isOpen:M,onClose:()=>V(!1),teacher:d,missingItems:X}),at&&e.jsx(Se,{isOpen:!0,onClose:()=>mt(null),title:"Video Showcase",size:"4xl",children:e.jsx(ia,{videoId:at,currentUser:n})}),Ue&&e.jsx(cs,{isOpen:!0,onClose:()=>Ge(null),imageUrl:Ue.url,title:Ue.title}),ut&&e.jsx(wa,{isOpen:ut,onClose:()=>Ve(!1),onSave:ks,organizerId:d.id,organizerType:"teacher",initialData:vt})]})};export{pr as default};
