var K=Object.defineProperty,B=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var E=(s,r,a)=>r in s?K(s,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[r]=a,S=(s,r)=>{for(var a in r||(r={}))T.call(r,a)&&E(s,a,r[a]);if(y)for(var a of y(r))z.call(r,a)&&E(s,a,r[a]);return s},O=(s,r)=>B(s,H(r));var M=(s,r)=>{var a={};for(var i in s)T.call(s,i)&&r.indexOf(i)<0&&(a[i]=s[i]);if(s!=null&&y)for(var i of y(s))r.indexOf(i)<0&&z.call(s,i)&&(a[i]=s[i]);return a};import{e as P,r as m,j as e,l as I,aq as Y,b as q,u as V,d as G,i as Q,S as W,C as J,M as X,D as Z,y as U,a9 as ee,Y as te,am as se}from"./index-BXN-gaEy.js";import{C as ae}from"./Countdown-tuRDrQvi.js";import{C as re}from"./ConfirmationModal-CVK0Y9X0.js";import{S as ne}from"./SEOHead-fOquVp0s.js";import{s as L}from"./slug-Be7lxzw5.js";import"./vendor-firebase-CLtQg3ae.js";const ie=a=>{var i=a,{isFavorite:s}=i,r=M(i,["isFavorite"]);return e.jsx("svg",O(S({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},r),{children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",className:`transition-all duration-300 ${s?"fill-red-500 stroke-red-600":"fill-white/80 stroke-white"}`,strokeWidth:"1.5"})}))},le=({photo:s,isFavorite:r,downloadPrice:a,downloadPriceHighRes:i,printOptions:h,eventId:g,instituteId:d})=>{const{toggleFavoritePhoto:j,addToCart:N}=P(),[x,p]=m.useState(!1),t=m.useRef(null);m.useEffect(()=>{function l(b){t.current&&!t.current.contains(b.target)&&p(!1)}return x?document.addEventListener("mousedown",l):document.removeEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)}},[x]);const o=new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR",minimumFractionDigits:0}),f=(l,b,C)=>{N({type:l,photo:s,printOption:C,eventId:g,instituteId:d,price:b}),p(!1)};return e.jsxs("div",{className:`relative aspect-square group rounded-lg shadow-md animate-fadeIn ${x?"z-10 overflow-visible":"overflow-hidden"}`,children:[e.jsx("img",{src:I(s.url_thumb,400),alt:`Event photo ${s.id}`,loading:"lazy",className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-110",crossOrigin:"anonymous"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("span",{className:"text-white/20 dark:text-black/20 text-4xl font-bold transform -rotate-12 select-none",children:"Clazz.lk"})}),e.jsxs("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-between p-3",children:[e.jsx("div",{children:e.jsx("button",{onClick:()=>j(s.id),className:"p-2 bg-black/30 rounded-full backdrop-blur-sm hover:scale-110 transition-transform","aria-label":r?"Remove from favorites":"Add to favorites",children:e.jsx(ie,{isFavorite:r,className:"w-6 h-6"})})}),e.jsxs("div",{className:"relative",ref:t,children:[e.jsxs("button",{onClick:()=>p(l=>!l),className:"w-full flex items-center justify-center gap-2 bg-primary text-white text-sm font-semibold py-2 rounded-md hover:bg-primary-dark transition-colors",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{children:"Add to Cart"})]}),x&&e.jsxs("div",{className:"absolute bottom-full mb-2 w-56 left-1/2 -translate-x-1/2 bg-light-surface dark:bg-dark-surface rounded-md shadow-lg overflow-hidden animate-slideInUp",style:{animationDuration:"200ms"},children:[e.jsxs("button",{onClick:()=>f("photo_download",a),className:"w-full text-left p-3 hover:bg-light-border dark:hover:bg-dark-border flex justify-between items-center",children:[e.jsx("span",{className:"text-sm whitespace-nowrap",children:"Download (Standard)"}),e.jsx("span",{className:"font-semibold text-sm whitespace-nowrap",children:o.format(a)})]}),e.jsxs("button",{onClick:()=>f("photo_download_highres",i),className:"w-full text-left p-3 hover:bg-light-border dark:hover:bg-dark-border flex justify-between items-center",children:[e.jsx("span",{className:"text-sm whitespace-nowrap",children:"Download (Full Quality)"}),e.jsx("span",{className:"font-semibold text-sm whitespace-nowrap",children:o.format(i)})]}),h.map(l=>e.jsxs("button",{onClick:()=>f("photo_print",l.price,l),className:"w-full text-left p-3 hover:bg-light-border dark:hover:bg-dark-border flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm whitespace-nowrap",children:["Print (",l.size,")"]}),e.jsx("span",{className:"font-semibold text-sm whitespace-nowrap",children:o.format(l.price)})]},l.id))]})]})]})]})},v=({icon:s,label:r,value:a})=>e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 w-5 h-5 text-light-subtle dark:text-dark-subtle mt-1",children:s}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-light-subtle dark:text-dark-subtle",children:r}),e.jsx("div",{className:"text-md font-semibold text-light-text dark:text-dark-text",children:a||"-"})]})]}),oe=({teacher:s,onClick:r})=>e.jsxs("div",{onClick:r,className:"flex items-center space-x-3 p-3 rounded-lg hover:bg-light-background dark:hover:bg-dark-background cursor-pointer transition-colors border border-transparent hover:border-light-border dark:hover:border-dark-border",children:[e.jsx("img",{src:I(s.profileImage,48,48),alt:s.name,className:"w-10 h-10 rounded-full object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm text-light-text dark:text-dark-text",children:s.name}),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle truncate max-w-[150px]",children:s.tagline})]})]}),de=({event:s,organizerId:r})=>{var a;return!((a=s.gallery)!=null&&a.photos)||s.gallery.photos.length===0?null:e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Event Photos"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:s.gallery.photos.map((i,h)=>{var g,d;return e.jsx(le,{photo:i,isFavorite:!1,downloadPrice:((g=s.gallery)==null?void 0:g.downloadPrice)||0,downloadPriceHighRes:((d=s.gallery)==null?void 0:d.downloadPriceHighRes)||0,printOptions:[],eventId:s.id,instituteId:r},h)})})]})},pe=({eventId:s,slug:r})=>{const{currentUser:a}=q(),{handleBack:i,handleNavigate:h}=V(),{setModalState:g}=P(),{teachers:d,tuitionInstitutes:j,handleEnroll:N,sales:x,loading:p}=G(),{event:t,organizer:o}=m.useMemo(()=>{for(const n of j){let c=(n.events||[]).find(u=>u.id===s);if(!c&&r&&(c=(n.events||[]).find(u=>L(u.title)===r)),c)return{event:c,organizer:n}}for(const n of d){let c=(n.events||[]).find(u=>u.id===s);if(!c&&r&&(c=(n.events||[]).find(u=>L(u.title)===r)),c)return{event:c,organizer:n}}return{event:null,organizer:null}},[j,d,s,r]),f=m.useMemo(()=>!a||!t?!1:x.some(n=>n.studentId===a.id&&n.itemId===t.id&&n.itemType==="event"&&n.status==="completed"),[a,x,t]),l=m.useMemo(()=>t?d.filter(n=>t.participatingTeacherIds.includes(n.id)):[],[d,t]),b=m.useMemo(()=>!t||!o?null:{"@context":"https://schema.org","@type":"Event",name:t.title,description:t.description||"",startDate:`${t.startDate}T${t.startTime}`,endDate:`${t.startDate}T${t.endTime||"23:59"}`,eventStatus:"https://schema.org/EventScheduled",organizer:{"@type":o.userId?"Person":"Organization",name:o.name},image:t.flyerImage?[t.flyerImage]:[],offers:{"@type":"Offer",price:0,priceCurrency:"LKR",availability:"https://schema.org/InStock"}},[t,o]),[C,k]=m.useState(!1),w=m.useMemo(()=>t?Q(t):"scheduled",[t]);if(p)return e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-20 text-center flex flex-col items-center justify-center",children:[e.jsx(W,{className:"w-8 h-8 text-primary"}),e.jsx("p",{className:"mt-4 text-light-subtle dark:text-dark-subtle",children:"Loading event details..."})]});if(!t||!o)return e.jsx("div",{children:"Event not found. It may have been removed by the organizer."});const R=()=>{a?k(!0):g({name:"login",preventRedirect:!0})},$=()=>{N(t,"event"),k(!1)},F=new Intl.NumberFormat("en-LK",{style:"currency",currency:"LKR"}),_=new Date(`${t.startDate}T${t.startTime}`),D=new Date(t.registrationDeadline),A=()=>w==="canceled"?"Event Canceled":w==="finished"?"Event Finished":f?"You are Registered":new Date>D?"Registration Closed":(a==null?void 0:a.role)==="teacher"||(a==null?void 0:a.role)==="admin"?"Only students can enroll":"Register Now";return e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8 animate-slideInUp",children:[e.jsx(ne,{title:t?t.title:"Event Details",description:t?(t.description||"").substring(0,160):"View event details on clazz.lk",image:t?t.flyerImage:void 0,structuredData:b}),e.jsx("div",{className:"mb-4",children:e.jsxs("button",{onClick:i,className:"flex items-center space-x-2 text-sm font-medium text-primary hover:text-primary-dark transition-colors",children:[e.jsx(J,{className:"h-5 w-5"}),e.jsx("span",{children:"Back"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsx("div",{className:"bg-light-surface dark:bg-dark-surface rounded-lg shadow-lg overflow-hidden",children:e.jsx("img",{src:I(t.flyerImage,800),alt:t.title,className:"w-full h-auto object-cover",crossOrigin:"anonymous"})}),e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("span",{className:"px-3 py-1 text-sm font-semibold rounded-full bg-indigo-100 text-indigo-800 dark:bg-indigo-900/50 dark:text-indigo-300 uppercase tracking-wider",children:t.category}),e.jsx("h1",{className:"mt-3 text-3xl md:text-4xl font-bold",children:t.title}),e.jsx("div",{className:"mt-4",children:e.jsx(X,{content:t.description})}),e.jsxs("div",{className:"mt-6",children:[e.jsx("p",{className:"text-sm text-light-subtle dark:text-dark-subtle",children:"Organized by"}),e.jsx("p",{className:"font-semibold text-lg",children:o.name})]})]}),e.jsx(de,{event:t,organizerId:o.id})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"sticky top-24 space-y-8",children:[e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface rounded-lg shadow-md p-6 space-y-4",children:[w==="scheduled"&&e.jsxs("div",{className:"pb-4 border-b border-light-border dark:border-dark-border",children:[e.jsx("h3",{className:"font-bold text-center text-lg mb-2",children:"Event Starts In"}),e.jsx(ae,{targetDate:_,completionMessage:"Event is starting!"})]}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:t.tickets.price>0?F.format(t.tickets.price):"Free"}),e.jsx("button",{onClick:R,disabled:f||w!=="scheduled"||new Date>D||(a==null?void 0:a.role)==="teacher"||(a==null?void 0:a.role)==="admin",className:"w-full bg-primary text-white font-bold py-3 rounded-md hover:bg-primary-dark transition-colors disabled:bg-gray-500 disabled:cursor-not-allowed",children:A()}),e.jsxs("div",{className:"pt-4 border-t border-light-border dark:border-dark-border space-y-3 text-sm",children:[e.jsx(v,{icon:e.jsx(Z,{}),label:"Date",value:`${new Date(t.startDate).toLocaleDateString()} - ${new Date(t.endDate).toLocaleDateString()}`}),e.jsx(v,{icon:e.jsx(U,{}),label:"Time",value:`${t.startTime} - {event.endTime}`}),e.jsx(v,{icon:e.jsx(ee,{}),label:"Mode",value:t.mode}),t.mode!=="Online"&&e.jsx(v,{icon:e.jsx(te,{}),label:"Venue",value:t.venue}),e.jsx(v,{icon:e.jsx(se,{}),label:"Max Participants",value:t.tickets.maxParticipants?`${t.tickets.maxParticipants}`:"Unlimited"})]})]}),l.length>0&&e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Participating Teachers"}),e.jsx("div",{className:"space-y-2",children:l.map(n=>e.jsx(oe,{teacher:n,onClick:()=>{n.username?h({name:"teacher_profile_slug",slug:n.username}):h({name:"teacher_profile",teacherId:n.id})}},n.id))})]})]})})]}),C&&e.jsx(re,{isOpen:!0,onClose:()=>k(!1),onConfirm:$,title:`Confirm Registration: ${t.title}`,message:"Are you sure you want to register for this event?",confirmText:"Yes, Register"})]})};export{pe as default};
