var L=Object.defineProperty,T=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var h=Object.getOwnPropertySymbols;var y=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var k=(s,l,a)=>l in s?L(s,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[l]=a,w=(s,l)=>{for(var a in l||(l={}))y.call(l,a)&&k(s,a,l[a]);if(h)for(var a of h(l))N.call(l,a)&&k(s,a,l[a]);return s},C=(s,l)=>T(s,F(l));var S=(s,l)=>{var a={};for(var i in s)y.call(s,i)&&l.indexOf(i)<0&&(a[i]=s[i]);if(s!=null&&h)for(var i of h(s))l.indexOf(i)<0&&N.call(s,i)&&(a[i]=s[i]);return a};import{d as I,u as O,r as o,j as e,C as B}from"./index-BXN-gaEy.js";import{P as D}from"./ProductCard-BOy-eRLr.js";import{S as R}from"./SearchBar-WR6MAao9.js";import{u as z}from"./useSEO-BjUGcIuA.js";import"./vendor-firebase-CLtQg3ae.js";import"./slug-Be7lxzw5.js";const H=[{value:"newest",label:"Newest First"},{value:"price_high",label:"Price: High to Low"},{value:"price_low",label:"Price: Low to High"},{value:"title_asc",label:"Title (A-Z)"},{value:"title_desc",label:"Title (Z-A)"}],b=9,K=()=>{const{teachers:s}=I(),{handleNavigate:l}=O(),[a,i]=o.useState(b),[m,P]=o.useState("newest"),[d,_]=o.useState(""),[n,E]=o.useState("all"),f=o.useRef(null),x=o.useRef(!1);z("Store | clazz.lk","Browse digital and physical goods from our top educators.");const M=()=>l({name:"home"}),v=o.useMemo(()=>s.filter(r=>r.registrationStatus==="approved").flatMap(r=>(r.products||[]).map(t=>C(w({},t),{teacher:r}))),[s]),p=o.useMemo(()=>[...v.filter(t=>{if(!t.isPublished||t.adminApproval!=="approved")return!1;if(d.trim()){const c=d.toLowerCase();if(![t.title,t.description,t.teacher.name].join(" ").toLowerCase().includes(c))return!1}return!(n!=="all"&&t.type!==n)})].sort((t,c)=>{switch(m){case"newest":return c.id.localeCompare(t.id);case"price_high":return c.price-t.price;case"price_low":return t.price-c.price;case"title_desc":return c.title.localeCompare(t.title);case"title_asc":default:return t.title.localeCompare(c.title)}}),[v,d,m,n]);o.useEffect(()=>{i(b)},[d,m,n]);const u=o.useMemo(()=>p.slice(0,a),[p,a]),j=o.useCallback(r=>{r[0].isIntersecting&&!x.current&&(x.current=!0,i(c=>c+b))},[]);o.useEffect(()=>{x.current=!1},[a]),o.useEffect(()=>{const r=new IntersectionObserver(j,{root:null,rootMargin:"200px",threshold:0}),t=f.current;return t&&r.observe(t),()=>{t&&r.unobserve(t)}},[j,u]);const A=r=>{l({name:"product_detail",productId:r.id})};return e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8 animate-slideInUp",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("button",{onClick:M,className:"flex items-center space-x-2 text-sm font-medium text-primary hover:text-primary-dark",children:[e.jsx(B,{className:"h-5 w-5"}),e.jsx("span",{children:"Back to Home"})]})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold",children:"Educator's Store"}),e.jsx("p",{className:"mt-2 text-lg text-light-subtle dark:text-dark-subtle",children:"Digital & Physical goods created by our teachers."})]}),e.jsx("div",{className:"sticky top-16 z-20 py-4 bg-light-background/80 dark:bg-dark-background/80 backdrop-blur-sm -mx-4 sm:px-6 lg:-mx-8 px-4 sm:px-6 lg:px-8 mb-8",children:e.jsxs("div",{className:"max-w-5xl mx-auto space-y-4",children:[e.jsx(R,{searchQuery:d,setSearchQuery:_}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sort-products",className:"block text-sm font-medium mb-1",children:"Sort by"}),e.jsx("select",{id:"sort-products",value:m,onChange:r=>P(r.target.value),className:"w-full p-2 border rounded-md bg-light-surface dark:bg-dark-surface border-light-border dark:border-dark-border",children:H.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"filter-type",className:"block text-sm font-medium mb-1",children:"Product Type"}),e.jsxs("select",{id:"filter-type",value:n,onChange:r=>E(r.target.value),className:"w-full p-2 border rounded-md bg-light-surface dark:bg-dark-surface border-light-border dark:border-dark-border",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"digital",children:"Digital"}),e.jsx("option",{value:"physical",children:"Physical"})]})]})]})]})}),u.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-light-subtle dark:text-dark-subtle mb-6",children:["Showing ",u.length," of ",p.length," products."]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:u.map(c=>{var g=c,{teacher:r}=g,t=S(g,["teacher"]);return e.jsx(D,{product:t,teacher:r,viewMode:"public",onViewDetails:A},t.id)})}),u.length<p.length&&e.jsx("div",{ref:f,className:"flex justify-center items-center h-20",children:e.jsx("div",{className:"w-8 h-8 border-4 border-dashed rounded-full animate-spin border-primary"})})]}):e.jsxs("div",{className:"text-center py-16 text-light-subtle dark:text-dark-subtle",children:[e.jsx("p",{className:"text-xl font-semibold",children:"No products found"}),e.jsx("p",{children:"Try adjusting your search query or filters."})]})]})};export{K as default};
