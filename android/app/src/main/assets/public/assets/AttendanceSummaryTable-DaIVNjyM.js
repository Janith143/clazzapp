var ee=Object.defineProperty,te=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var z=(d,s,n)=>s in d?ee(d,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):d[s]=n,x=(d,s)=>{for(var n in s||(s={}))re.call(s,n)&&z(d,n,s[n]);if(V)for(var n of V(s))se.call(s,n)&&z(d,n,s[n]);return d},m=(d,s)=>te(d,ae(s));var K=(d,s,n)=>new Promise((p,v)=>{var i=t=>{try{b(n.next(t))}catch(a){v(a)}},o=t=>{try{b(n.throw(t))}catch(a){v(a)}},b=t=>t.done?p(t.value):Promise.resolve(t.value).then(i,o);b((n=n.apply(d,s)).next())});import{d as Q,e as le,r as f,j as e,F as de,G as g,Q as ne,J as ie,I as X,aA as oe,T as ce,K as ue,X as xe,N as me,_ as J,l as ge,a6 as he,z as be,O as pe}from"./index-BXN-gaEy.js";const ke=["Workshop","Seminar","Exhibition","Competition","Camp","Class Series","Award Ceremony"],ye=({selected:d,onChange:s})=>{const{teachers:n}=Q(),[p,v]=f.useState(!1),i=f.useRef(null),o=f.useMemo(()=>n.filter(a=>a.registrationStatus==="approved"),[n]);f.useEffect(()=>{const a=j=>{i.current&&!i.current.contains(j.target)&&v(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[i]);const b=a=>{d.includes(a)?s(d.filter(j=>j!==a)):s([...d,a])},t=d.map(a=>{var j;return(j=n.find(N=>N.id===a))==null?void 0:j.name}).filter(Boolean).join(", ");return e.jsxs("div",{className:"relative",ref:i,children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-light-text dark:text-dark-text",children:"Participating Teachers"}),e.jsx("button",{type:"button",onClick:()=>v(!p),className:"w-full p-2 border border-light-border dark:border-dark-border rounded-md bg-light-background dark:bg-dark-background text-left truncate text-light-text dark:text-dark-text",children:d.length>0?t:e.jsx("span",{className:"text-light-subtle dark:text-dark-subtle",children:"Select teachers..."})}),p&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-md shadow-lg max-h-60 overflow-y-auto",children:o.map(a=>e.jsxs("label",{className:"flex items-center p-2 hover:bg-light-border dark:hover:bg-dark-border cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d.includes(a.id),onChange:()=>b(a.id),className:"h-4 w-4 text-primary focus:ring-primary border-light-border dark:border-dark-border rounded"}),e.jsx("span",{className:"ml-3 text-sm text-light-text dark:text-dark-text",children:a.name})]},a.id))})]})},Ne=({isOpen:d,onClose:s,onSave:n,organizerId:p,organizerType:v="tuition_institute",initialData:i})=>{var A,R,q,F,H,_,M,G,O,U,B;const{handleImageSave:o}=Q(),{addToast:b}=le(),[t,a]=f.useState({}),[j,N]=f.useState(""),[S,D]=f.useState(null),[E,I]=f.useState(!1);f.useEffect(()=>{var l;if(d){N(""),D(null);const r={isEnabled:!1,googleDriveLink:"",downloadPrice:150,downloadPriceHighRes:500,bulkDiscounts:[]};a(i?m(x({},i),{tickets:{price:i.tickets.price.toString(),maxParticipants:((l=i.tickets.maxParticipants)==null?void 0:l.toString())||null},gallery:i.gallery||r}):{organizerId:p,organizerType:"tuition_institute",title:"",description:"",category:"Workshop",mode:"Physical",isPublished:!0,adminApproval:"approved",status:"scheduled",participatingTeacherIds:[],tickets:{price:"",maxParticipants:null},gallery:r})}},[d,i,p]);const h=l=>{const{name:r,value:c}=l.target;a(u=>m(x({},u),{[r]:c}))},T=l=>{const{name:r,value:c}=l.target;a(u=>m(x({},u),{tickets:m(x({},u.tickets),{[r]:c})}))},P=l=>{const{name:r,value:c,type:u,checked:k}=l.target;a(y=>m(x({},y),{gallery:m(x({},y.gallery||{isEnabled:!1}),{[r]:u==="checkbox"?k:c})}))},L=(l,r,c)=>{var y;const u=[...((y=t.gallery)==null?void 0:y.bulkDiscounts)||[]],k=parseInt(c,10);u[l]=m(x({},u[l]),{id:u[l].id||J(),[r]:isNaN(k)?0:k}),a(C=>m(x({},C),{gallery:m(x({},C.gallery),{bulkDiscounts:u})}))},W=()=>{const l={id:J(),quantity:5,discountPercent:10};a(r=>{var c;return m(x({},r),{gallery:m(x({},r.gallery||{isEnabled:!1}),{bulkDiscounts:[...((c=r.gallery)==null?void 0:c.bulkDiscounts)||[],l]})})})},Z=l=>{a(r=>m(x({},r),{gallery:m(x({},r.gallery),{bulkDiscounts:r.gallery.bulkDiscounts.filter((c,u)=>u!==l)})}))},$=l=>K(void 0,null,function*(){var r,c,u;l.preventDefault(),N(""),I(!0);try{let k=(i==null?void 0:i.flyerImage)||"";if(S){const w=yield o(S,"event_flyer",{organizerId:p});if(!w)throw new Error("Flyer image upload failed.");k=w}if(!k)throw new Error("A flyer image is required.");const y=(r=t.gallery)!=null&&r.isEnabled?{isEnabled:!0,googleDriveLink:t.gallery.googleDriveLink||"",downloadPrice:parseFloat(t.gallery.downloadPrice)||0,downloadPriceHighRes:parseFloat(t.gallery.downloadPriceHighRes)||0,bulkDiscounts:(t.gallery.bulkDiscounts||[]).filter(w=>w.quantity>0&&w.discountPercent>0)}:{isEnabled:!1,googleDriveLink:"",downloadPrice:0,downloadPriceHighRes:0,bulkDiscounts:[]},C=m(x({},t),{id:(i==null?void 0:i.id)||`evt_${Date.now()}`,flyerImage:k,tickets:{price:parseFloat((c=t.tickets)==null?void 0:c.price)||0,maxParticipants:(u=t.tickets)!=null&&u.maxParticipants?parseInt(t.tickets.maxParticipants,10):null},gallery:y});n(C)}catch(k){const y=k.message||"An error occurred.";N(y),b(y,"error")}finally{I(!1)}}),Y=i?"Edit Event":"Schedule New Event";return e.jsx(de,{isOpen:d,onClose:s,title:Y,size:"4xl",children:e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(g,{label:"Event Title",name:"title",value:t.title||"",onChange:h,required:!0}),e.jsx(ne,{label:"Flyer Image",currentImage:S||t.flyerImage||null,onImageChange:D,aspectRatio:"aspect-video"}),e.jsx(ie,{label:"Description",id:"description",name:"description",value:t.description||"",onChange:h,rows:5})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(X,{label:"Category",name:"category",value:t.category||"",onChange:h,options:ke.map(l=>({value:l,label:l})),required:!0}),e.jsx(X,{label:"Mode",name:"mode",value:t.mode||"Physical",onChange:h,options:[{value:"Physical",label:"Physical"},{value:"Online",label:"Online"},{value:"Hybrid",label:"Hybrid"}]}),(t.mode==="Physical"||t.mode==="Hybrid")&&e.jsx(g,{label:"Venue / Address",name:"venue",value:t.venue||"",onChange:h}),(t.mode==="Online"||t.mode==="Hybrid")&&e.jsx(g,{label:"Online Link (Zoom, Meet, etc.)",name:"onlineLink",type:"url",value:t.onlineLink||"",onChange:h}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(g,{label:"Start Date",name:"startDate",type:"date",value:t.startDate||"",onChange:h,required:!0}),e.jsx(g,{label:"Start Time",name:"startTime",type:"time",value:t.startTime||"",onChange:h,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(g,{label:"End Date",name:"endDate",type:"date",value:t.endDate||"",onChange:h,required:!0}),e.jsx(g,{label:"End Time",name:"endTime",type:"time",value:t.endTime||"",onChange:h,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(g,{label:"Registration Deadline",name:"registrationDeadline",type:"date",value:t.registrationDeadline||"",onChange:h,required:!0}),e.jsx(g,{label:"Duration",name:"duration",value:t.duration||"",onChange:h,placeholder:"e.g., 3 hours, Full Day"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(g,{label:"Price per Ticket (LKR)",name:"price",type:"number",value:((A=t.tickets)==null?void 0:A.price)||"",onChange:T,required:!0}),e.jsx(g,{label:"Max Participants",name:"maxParticipants",type:"number",value:((R=t.tickets)==null?void 0:R.maxParticipants)||"",onChange:T,placeholder:"Leave empty for unlimited"})]}),e.jsx(ye,{selected:t.participatingTeacherIds||[],onChange:l=>a(r=>m(x({},r),{participatingTeacherIds:l}))})]})]}),e.jsx("div",{className:"md:col-span-2 pt-4 mt-4 border-t border-light-border dark:border-dark-border",children:e.jsxs("details",{className:"group",open:(q=t.gallery)==null?void 0:q.isEnabled,children:[e.jsxs("summary",{className:"cursor-pointer font-semibold text-lg list-none flex justify-between items-center text-light-text dark:text-dark-text",children:[e.jsx("span",{children:"Photo Gallery & Sales"}),e.jsx("span",{className:"text-primary transform group-open:rotate-180 transition-transform duration-200",children:e.jsx(oe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mt-4 space-y-4 animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-light-background dark:bg-dark-background rounded-md border border-light-border dark:border-dark-border",children:[e.jsx("input",{type:"checkbox",id:"galleryEnabled",name:"isEnabled",checked:((F=t.gallery)==null?void 0:F.isEnabled)||!1,onChange:P,className:"h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded"}),e.jsx("label",{htmlFor:"galleryEnabled",className:"text-sm font-medium text-light-text dark:text-dark-text",children:"Enable Photo Gallery for this Event"})]}),((H=t.gallery)==null?void 0:H.isEnabled)&&e.jsxs("div",{className:"space-y-4 p-4 border border-light-border dark:border-dark-border rounded-lg bg-light-background dark:bg-dark-background",children:[e.jsx(g,{label:"Google Drive Folder Link",name:"googleDriveLink",value:((_=t.gallery)==null?void 0:_.googleDriveLink)||"",onChange:P,placeholder:"Must be a public 'Anyone with the link' folder"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(g,{label:"Standard Download Price (LKR)",name:"downloadPrice",type:"number",min:0,value:((G=(M=t.gallery)==null?void 0:M.downloadPrice)==null?void 0:G.toString())||"",onChange:P}),e.jsx(g,{label:"Full Quality Download Price (LKR)",name:"downloadPriceHighRes",type:"number",min:0,value:((U=(O=t.gallery)==null?void 0:O.downloadPriceHighRes)==null?void 0:U.toString())||"",onChange:P})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2 text-light-text dark:text-dark-text",children:"Bulk Purchase Discounts"}),e.jsx("div",{className:"space-y-2",children:(((B=t.gallery)==null?void 0:B.bulkDiscounts)||[]).map((l,r)=>e.jsxs("div",{className:"flex flex-wrap items-center gap-2 p-2 bg-light-surface dark:bg-dark-surface rounded border border-light-border dark:border-dark-border",children:[e.jsx("span",{className:"text-sm text-light-text dark:text-dark-text",children:"If cart has"}),e.jsx("input",{type:"number",min:"1",value:l.quantity||"",onChange:c=>L(r,"quantity",c.target.value),className:"w-16 p-1 border rounded bg-light-background dark:bg-dark-background border-light-border dark:border-dark-border text-light-text dark:text-dark-text"}),e.jsx("span",{className:"text-sm text-light-text dark:text-dark-text",children:"or more photos, give a"}),e.jsx("input",{type:"number",min:"0",max:"100",value:l.discountPercent||"",onChange:c=>L(r,"discountPercent",c.target.value),className:"w-16 p-1 border rounded bg-light-background dark:bg-dark-background border-light-border dark:border-dark-border text-light-text dark:text-dark-text"}),e.jsx("span",{className:"text-sm text-light-text dark:text-dark-text",children:"% discount."}),e.jsx("button",{type:"button",onClick:()=>Z(r),className:"p-1 text-red-500 ml-auto",children:e.jsx(ce,{className:"w-4 h-4"})})]},l.id||r))}),e.jsxs("button",{type:"button",onClick:W,className:"mt-2 flex items-center gap-1 text-sm font-medium text-primary hover:text-primary-dark",children:[e.jsx(ue,{className:"w-4 h-4"})," Add Discount Tier"]})]})]})]})]})}),j&&e.jsx("p",{className:"text-red-500 text-sm text-center",children:j}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-3",children:[e.jsxs("button",{type:"button",onClick:s,className:"inline-flex items-center justify-center px-4 py-2 border border-light-border dark:border-dark-border text-sm font-medium rounded-md shadow-sm text-light-text dark:text-dark-text bg-light-surface dark:bg-dark-surface hover:bg-light-border dark:hover:bg-dark-border/50",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:E,className:"inline-flex items-center justify-center px-4 py-2 bg-primary text-white rounded-md disabled:opacity-50",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),E?"Saving...":"Save Event"]})]})]})})},je=({status:d})=>{switch(d){case"paid":return e.jsx("span",{title:"Paid via Platform",children:e.jsx(pe,{className:"w-5 h-5 text-green-500"})});case"paid_at_venue":return e.jsx("span",{title:"Paid at Venue",children:e.jsx(be,{className:"w-5 h-5 text-blue-500"})});case"unpaid":return e.jsx("span",{title:"Unpaid",children:e.jsx(he,{className:"w-5 h-5 text-red-500"})});default:return null}},we=({classInfo:d})=>{const s=d.attendance||[],n=s.length,p=s.filter(o=>o.paymentStatus==="paid").length,v=s.filter(o=>o.paymentStatus==="paid_at_venue").length,i=s.filter(o=>o.paymentStatus==="unpaid").length;return e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6 text-center",children:[e.jsxs("div",{className:"p-3 bg-light-background dark:bg-dark-background rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-light-text dark:text-dark-text",children:n}),e.jsx("p",{className:"text-sm font-medium text-light-subtle dark:text-dark-subtle",children:"Total Attended"})]}),e.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-900/30 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:p}),e.jsx("p",{className:"text-sm font-medium text-green-700 dark:text-green-300",children:"Paid (Platform)"})]}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:v}),e.jsx("p",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:"Paid (Venue)"})]}),e.jsxs("div",{className:"p-3 bg-red-50 dark:bg-red-900/30 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:i}),e.jsx("p",{className:"text-sm font-medium text-red-700 dark:text-red-300",children:"Unpaid"})]})]}),e.jsx("h4",{className:"text-lg font-semibold mb-2 text-light-text dark:text-dark-text",children:"Attendance Log"}),e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"min-w-full divide-y divide-light-border dark:divide-dark-border text-sm",children:[e.jsx("thead",{className:"bg-light-background dark:bg-dark-background sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"#"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Time"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-light-subtle dark:text-dark-subtle uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-light-border dark:divide-dark-border",children:s.length>0?[...s].sort((o,b)=>new Date(b.attendedAt).getTime()-new Date(o.attendedAt).getTime()).map((o,b)=>e.jsxs("tr",{className:"text-light-text dark:text-dark-text",children:[e.jsx("td",{className:"px-4 py-3",children:b+1}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:ge(o.studentAvatar,32,32),alt:o.studentName,className:"w-8 h-8 rounded-full mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-light-text dark:text-dark-text",children:o.studentName}),e.jsx("p",{className:"text-xs text-light-subtle dark:text-dark-subtle",children:o.studentId})]})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:new Date(o.attendedAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:new Date(o.attendedAt).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx(je,{status:o.paymentStatus})})]},o.studentId)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-8 text-light-subtle dark:text-dark-subtle",children:"No attendance records for this class yet."})})})]})})]})};export{we as A,Ne as T};
